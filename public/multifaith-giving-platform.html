<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Multi-Faith Giving Platform</title>
  <meta name="description" content="Give and manage faith-specific donations across every region with a single secure platform."/>
  <style>
    :root {
      --bg: #f8f6f1;
      --bg-soft: #ffffff;
      --bg-glass: rgba(255, 255, 255, 0.75);
      --card: #ffffff;
      --ink: #1f2933;
      --muted: #5f6b7d;
      --accent: #d4a24c;
      --accent-2: #7a9d92;
      --accent-3: #e2c184;
      --danger: #d9534f;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.92), transparent 55%), var(--bg);
      color: var(--ink);
      font: 16px/1.6 "Inter", system-ui, -apple-system, "Segoe UI", sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }

    img {
      max-width: 100%;
      display: block;
    }

    a {
      color: var(--accent);
    }

    a:hover {
      color: var(--accent-2);
    }

    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(255, 255, 255, 0.94);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(31, 41, 55, 0.08);
    }

    .nav {
      width: min(100%, 1200px);
      margin: 0 auto;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 18px;
      justify-content: space-between;
      flex-wrap: wrap;
      color: var(--ink);
    }

    .brand {
      display: flex;
      align-items: baseline;
      gap: 10px;
      font-weight: 800;
      letter-spacing: 0.6px;
      text-transform: uppercase;
      color: var(--ink);
    }

    .brand span {
      font-size: 13px;
      color: var(--muted);
    }

    .nav a.btn {
      text-decoration: none;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 11px 18px;
      border-radius: 12px;
      font-weight: 700;
      color: #fff;
      background: linear-gradient(135deg, var(--accent), var(--accent-3));
      border: 1px solid rgba(212, 162, 76, 0.35);
      box-shadow: 0 10px 26px rgba(212, 162, 76, 0.25);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: box-shadow 0.2s ease, transform 0.2s ease;
      min-height: 48px;
      touch-action: manipulation;
    }

    .btn.liquid {
      padding: 0;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.85);
      border: 1px solid rgba(212, 162, 76, 0.5);
      box-shadow: 0 12px 30px rgba(225, 192, 128, 0.3);
      text-transform: uppercase;
      letter-spacing: 0.6px;
      min-width: 0;
    }

    .btn.liquid span {
      position: relative;
      z-index: 1;
      padding: 14px 36px;
      color: var(--ink);
    }

    .btn.liquid .liquid {
      position: absolute;
      inset: -80px 0 auto;
      height: 220px;
      background: linear-gradient(135deg, rgba(212, 162, 76, 0.65), rgba(226, 193, 132, 0.7), rgba(122, 157, 146, 0.65));
      background-size: 200% 200%;
      animation: holographicFlow 8s ease-in-out infinite;
      box-shadow: inset 0 0 40px rgba(255, 255, 255, 0.45);
      z-index: 0;
      transition: 0.6s ease;
    }

    .btn.liquid .liquid::after,
    .btn.liquid .liquid::before {
      content: '';
      position: absolute;
      width: 200%;
      height: 200%;
      top: 0;
      left: 0;
      transform: translate(-25%, -75%);
      border-radius: 45%;
    }

    .btn.liquid .liquid::after {
      background: rgba(255, 255, 255, 0.76);
      box-shadow: 0 0 12px 6px rgba(212, 162, 76, 0.45), inset 0 0 8px rgba(226, 193, 132, 0.42);
      animation: animate 5s linear infinite;
      opacity: 0.85;
    }

    .btn.liquid .liquid::before {
      background: rgba(255, 255, 255, 0.35);
      box-shadow: 0 0 12px rgba(226, 193, 132, 0.4), inset 0 0 6px rgba(226, 193, 132, 0.35);
      animation: animate 7s linear infinite;
    }

    .btn.liquid:hover .liquid {
      top: -140px;
    }

    .btn.liquid:hover {
      box-shadow: 0 0 8px rgba(212, 162, 76, 0.6), inset 0 0 6px rgba(212, 162, 76, 0.55);
      transform: translateY(-2px);
    }

    .btn.ghost {
      background: #fff;
      color: var(--accent);
      border-color: rgba(212, 162, 76, 0.35);
      box-shadow: none;
    }

    .btn.ghost:hover {
      background: rgba(212, 162, 76, 0.1);
      color: var(--ink);
    }

    main {
      width: min(100%, 1200px);
      margin: 0 auto;
      padding: 24px 18px 90px;
      display: grid;
      gap: 56px;
      flex: 1 0 auto;
    }

    .hero {
      display: grid;
      gap: 24px;
      align-items: center;
      grid-template-columns: minmax(0, 1fr);
    }

    .hero h1 {
      margin: 0;
      font-size: clamp(36px, 6vw, 58px);
      line-height: 1.1;
      font-weight: 900;
      letter-spacing: -0.5px;
    }

    .hero p {
      margin: 14px 0 26px;
      color: var(--muted);
      font-size: 18px;
      max-width: 580px;
    }

    .hero-media {
      position: relative;
      border-radius: 30px;
      overflow: hidden;
      background: var(--card);
      box-shadow: 0 18px 44px rgba(31, 41, 55, 0.15);
      min-height: 260px;
    }

    .hero-media:before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(212, 162, 76, 0.28), transparent 55%);
      pointer-events: none;
    }

    .hero-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 12px;
    }

    .hero-list li {
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(31, 41, 55, 0.05);
      border-radius: 16px;
      padding: 14px 16px;
      border: 1px solid rgba(31, 41, 55, 0.08);
      font-weight: 600;
      color: var(--ink);
    }

    .hero-list li span {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background: rgba(212, 162, 76, 0.18);
      color: var(--accent);
      font-weight: 700;
    }

    section h2 {
      margin: 0 0 18px;
      font-size: clamp(28px, 4vw, 36px);
      font-weight: 900;
      letter-spacing: -0.3px;
    }

    section p.lead {
      margin: 0 0 24px;
      color: var(--muted);
      max-width: 720px;
      font-size: 17px;
    }

    .region-slider {
      position: relative;
      background: var(--bg-soft);
      border-radius: 24px;
      border: 1px solid rgba(31, 41, 55, 0.12);
      overflow: hidden;
      box-shadow: 0 18px 38px rgba(31, 41, 55, 0.12);
      max-width: 960px;
      margin: 0 auto;
    }

    .region-track {
      display: flex;
      transition: transform 0.6s ease;
      width: 100%;
      position: relative;
      z-index: 0;
    }

    .region-transition {
      position: absolute;
      top: var(--transition-top, 0);
      left: var(--transition-left, 0);
      width: var(--transition-width, 100%);
      height: var(--transition-height, 100%);
      pointer-events: none;
      opacity: 0;
      z-index: 1;
      transition: opacity 0.28s ease;
      border-radius: inherit;
      overflow: hidden;
    }

    .region-transition.is-active {
      opacity: 1;
    }

    .transition-scene {
      position: absolute;
      inset: 0;
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
    }

    .region-transition.is-active .transition-scene[data-scene="current"] {
      animation: regionSceneDim var(--transition-duration, 1400ms) cubic-bezier(1, 0, 1, 1) forwards;
    }

    .transition-scene[data-scene="next"] {
      filter: brightness(0%);
      -webkit-mask-image: var(--transition-mask-image, none);
      mask-image: var(--transition-mask-image, none);
      -webkit-mask-size: 6%;
      mask-size: 6%;
      -webkit-mask-position: center;
      mask-position: center;
      -webkit-mask-repeat: no-repeat;
      mask-repeat: no-repeat;
    }

    .region-transition.is-active .transition-scene[data-scene="next"] {
      animation: regionSceneReveal var(--transition-duration, 1400ms) cubic-bezier(1, 0, 1, 1) forwards;
    }

    .region-slide {
      min-width: 100%;
      padding: 26px;
      display: grid;
      gap: 20px;
      grid-template-columns: minmax(280px, 1fr) minmax(260px, 0.8fr);
      align-items: stretch;
    }

    .region-meta {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 20px;
      align-items: start;
    }

    .region-heading {
      grid-column: 1 / -1;
      display: grid;
      gap: 12px;
    }

    .region-details {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 20px;
      align-items: start;
    }

    .region-details > :only-child {
      grid-column: 1 / -1;
    }

    .region-media {
      position: relative;
      width: 100%;
      height: 220px;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 16px 28px rgba(31, 41, 55, 0.18);
    }

    .region-media::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      box-shadow: inset 0 0 0 1px rgba(31, 41, 55, 0.08);
      pointer-events: none;
    }

    .region-slide .region-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      will-change: transform;
      transform: scale(1.04);
      animation-duration: 14s;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
      animation-play-state: paused;
    }

    .region-slide.pan-up .region-image {
      animation-name: regionPanUp;
      transform-origin: center bottom;
    }

    .region-slide.pan-down .region-image {
      animation-name: regionPanDown;
      transform-origin: center top;
    }

    .region-slide.active .region-image {
      animation-play-state: running;
    }

    @keyframes regionPanUp {
      0% {
        transform: scale(1.05) translateY(12%);
      }
      100% {
        transform: scale(1.05) translateY(-12%);
      }
    }

    @keyframes regionPanDown {
      0% {
        transform: scale(1.05) translateY(-12%);
      }
      100% {
        transform: scale(1.05) translateY(12%);
      }
    }

    @keyframes regionSceneReveal {
      0% {
        filter: brightness(0%);
        -webkit-mask-size: 6%;
        mask-size: 6%;
      }
      12% {
        filter: brightness(55%);
        -webkit-mask-size: 12%;
        mask-size: 12%;
      }
      28% {
        filter: brightness(100%);
      }
      100% {
        filter: brightness(100%);
        -webkit-mask-size: 1600%;
        mask-size: 1600%;
      }
    }

    @keyframes regionSceneDim {
      0% {
        filter: brightness(100%);
      }
      100% {
        filter: brightness(40%);
      }
    }

    .region-meta h3 {
      margin: 0;
      font-size: 26px;
      font-weight: 800;
      color: var(--ink);
    }

    .currency-row {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      gap: 16px;
      margin: 0;
      font-size: 15px;
      color: var(--muted);
    }

    .currency-row strong {
      font-size: 15px;
      letter-spacing: 0.35px;
      color: var(--accent);
      flex-shrink: 0;
      line-height: 1.4;
      padding-top: 6px;
    }

    .currency-list {
      margin: 0;
      padding: 0;
      list-style: none;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .currency-item {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 12px 16px;
      border-radius: 18px;
      background: #ffffff;
      border: 1px solid rgba(31, 41, 55, 0.1);
      box-shadow: 0 12px 24px rgba(31, 41, 55, 0.12);
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      color: var(--ink);
      min-width: 150px;
    }

    .currency-item img {
      flex: 0 0 auto;
      height: 72px;
      width: auto;
      max-width: 160px;
      object-fit: contain;
      border-radius: 12px;
      background: rgba(250, 249, 244, 0.9);
      box-shadow: 0 10px 20px rgba(31, 41, 55, 0.18);
    }

    .currency-item span {
      flex: 1;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.6px;
      text-align: right;
      color: var(--accent);
    }

    .region-details ul {
      margin: 0;
      padding: 0;
      list-style: none;
      display: grid;
      gap: 10px;
    }

    .region-details ul li {
      padding: 10px 14px;
      border-radius: 14px;
      background: rgba(31, 41, 55, 0.05);
      border: 1px solid rgba(31, 41, 55, 0.1);
      font-size: 14px;
      color: var(--ink);
    }

    .faith-identity {
      display: inline-flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 12px;
    }

    .faith-label {
      font-weight: 700;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      font-size: 13px;
      color: var(--accent);
    }

    .faith-symbol {
      position: relative;
      width: 66px;
      height: 66px;
      border-radius: 22px;
      background: linear-gradient(135deg, rgba(245, 214, 148, 0.95), rgba(255, 238, 207, 0.85), rgba(205, 220, 212, 0.9));
      background-size: 200% 200%;
      animation: holographicFlow 9s ease-in-out infinite;
      mask-image: var(--symbol-image);
      mask-repeat: no-repeat;
      mask-position: center;
      mask-size: 70%;
      -webkit-mask-image: var(--symbol-image);
      -webkit-mask-repeat: no-repeat;
      -webkit-mask-position: center;
      -webkit-mask-size: 70%;
      box-shadow: 0 12px 28px rgba(212, 162, 76, 0.32);
      transition: transform 0.18s ease, box-shadow 0.2s ease;
      transform: perspective(600px) rotateX(0deg) rotateY(0deg);
      transform-style: preserve-3d;
      pointer-events: auto;
    }

    .faith-symbol::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      box-shadow: inset 0 0 18px rgba(255, 255, 255, 0.25);
      opacity: 0.6;
      pointer-events: none;
    }

    .faith-symbol:hover {
      box-shadow: 0 16px 40px rgba(212, 162, 76, 0.35);
    }

    .slider-controls {
      position: absolute;
      inset: auto 0 18px 0;
      display: flex;
      justify-content: space-between;
      padding: 0 22px;
      pointer-events: none;
      z-index: 2;
    }

    .slider-btn {
      pointer-events: all;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      border: 1px solid rgba(31, 41, 55, 0.14);
      background: rgba(255, 255, 255, 0.9);
      color: var(--ink);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(31, 41, 55, 0.14);
    }

    .slider-btn:hover {
      background: var(--accent);
      color: #fff;
    }

    .slider-dots {
      position: absolute;
      left: 50%;
      bottom: 24px;
      transform: translateX(-50%);
      display: inline-flex;
      gap: 10px;
      z-index: 2;
    }

    .slider-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(31, 41, 55, 0.16);
      cursor: pointer;
    }

    .slider-dot.active {
      background: var(--accent);
    }

    .sector-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
    }

    .sector-card {
      background: var(--card);
      padding: 20px;
      border-radius: 18px;
      border: 1px solid rgba(31, 41, 55, 0.08);
      display: grid;
      gap: 10px;
      box-shadow: 0 12px 28px rgba(31, 41, 55, 0.12);
    }

    .sector-card h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 800;
      color: var(--ink);
    }

    .sector-card p {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    form {
      display: grid;
      gap: 18px;
    }

    .form-card {
      background: var(--card);
      border-radius: 24px;
      border: 1px solid rgba(31, 41, 55, 0.1);
      padding: 24px;
      box-shadow: 0 18px 40px rgba(31, 41, 55, 0.14);
    }

    .form-card h3 {
      margin: 0 0 14px;
      font-size: 22px;
      font-weight: 800;
    }

    .form-row {
      display: grid;
      gap: 16px;
    }

    .form-actions {
      display: flex;
      justify-content: flex-start;
      flex-wrap: wrap;
    }

    .form-actions .btn {
      min-width: 220px;
    }

    @media (min-width: 720px) {
      .form-row.double {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .form-row.triple {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    label {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.3px;
      color: var(--muted);
    }

    input, select, textarea {
      margin-top: 6px;
      border-radius: 14px;
      border: 1px solid rgba(31, 41, 55, 0.14);
      background: rgba(255, 255, 255, 0.9);
      color: var(--ink);
      padding: 12px;
      font-size: 16px;
      font-family: inherit;
    }

    input:focus, select:focus, textarea:focus {
      outline: 2px solid rgba(212, 162, 76, 0.55);
      outline-offset: 1px;
    }

    .status {
      border-radius: 16px;
      padding: 14px 16px;
      font-size: 14px;
      background: rgba(31, 41, 55, 0.04);
      border: 1px solid rgba(31, 41, 55, 0.12);
      color: var(--ink);
    }

    .status.success {
      background: rgba(122, 157, 146, 0.18);
      border-color: rgba(122, 157, 146, 0.5);
      color: #2f4f4f;
    }

    .status.error {
      background: rgba(217, 83, 79, 0.12);
      border-color: rgba(217, 83, 79, 0.4);
      color: #7a1d1a;
    }

    .status a {
      color: var(--accent);
      word-break: break-all;
    }

    .inline-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .nav .inline-actions {
      margin-left: auto;
    }

    .inline-actions .btn {
      flex: none;
    }

    .section-head {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 24px;
      flex-wrap: wrap;
    }

    .section-head .lead {
      margin-bottom: 0;
    }

    .community-grid {
      margin-top: 32px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 24px;
    }

    .community-card {
      background: var(--card);
      border-radius: 20px;
      overflow: hidden;
      border: 1px solid rgba(31, 41, 55, 0.1);
      display: flex;
      flex-direction: column;
      min-height: 100%;
      box-shadow: 0 20px 36px rgba(31, 41, 55, 0.14);
    }

    .manage-card {
      display: grid;
      gap: 24px;
    }

    .manage-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 6px;
      border-radius: 18px;
      background: rgba(212, 162, 76, 0.08);
      border: 1px solid rgba(212, 162, 76, 0.24);
    }

    .manage-tab {
      flex: 1 1 160px;
      border: none;
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
    }

    .manage-tab:focus-visible {
      outline: 2px solid rgba(212, 162, 76, 0.55);
      outline-offset: 2px;
    }

    .manage-tab.is-active {
      background: linear-gradient(135deg, rgba(212, 162, 76, 0.85), rgba(122, 157, 146, 0.65));
      color: #fff;
      box-shadow: 0 12px 24px rgba(212, 162, 76, 0.26);
    }

    .tab-panels {
      position: relative;
    }

    .tab-panel {
      display: grid;
      gap: 18px;
      animation: fadeIn 0.35s ease;
    }

    .tab-panel[hidden] {
      display: none;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .community-media {
      position: relative;
      width: 100%;
      padding-top: 60%;
      background: linear-gradient(135deg, rgba(244, 220, 184, 0.65), rgba(218, 229, 223, 0.6));
    }

    .community-media img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .community-initial {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      font-weight: 700;
      letter-spacing: 1px;
      color: rgba(31, 41, 55, 0.35);
      text-transform: uppercase;
    }

    .community-body {
      padding: 22px 22px 24px;
      display: grid;
      gap: 14px;
    }

    .community-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 12px;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      color: var(--muted);
    }

    .community-meta span {
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(31, 41, 55, 0.06);
    }

    .community-body h3 {
      margin: 0;
      font-size: 20px;
      line-height: 1.3;
    }

    .community-body p {
      margin: 0;
      color: var(--muted);
      font-size: 15px;
    }

    .community-progress {
      display: grid;
      gap: 10px;
    }

    .progress-bar {
      height: 8px;
      border-radius: 999px;
      background: rgba(31, 41, 55, 0.1);
      overflow: hidden;
    }

    .progress-bar div {
      height: 100%;
      border-radius: inherit;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
    }

    .progress-meta {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      color: var(--muted);
    }

    .community-actions {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .community-actions .btn {
      flex: none;
    }

    .community-profile {
      font-size: 13px;
      color: var(--muted);
    }

    .community-status {
      font-size: 12px;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      color: var(--muted);
    }

    .community-status.goal-met {
      color: var(--accent-2);
    }

    footer {
      margin-top: 60px;
      padding: 40px 0 60px;
      text-align: center;
      color: var(--muted);
      font-size: 14px;
      border-top: 1px solid rgba(31, 41, 55, 0.1);
      background: rgba(255, 255, 255, 0.9);
    }

    @media (max-width: 900px) {
      .nav {
        padding: 16px;
        gap: 14px;
      }

      .inline-actions {
        width: 100%;
        justify-content: flex-start;
      }
    }

    @media (max-width: 720px) {
      main {
        padding: 20px 16px 70px;
        gap: 42px;
      }

      .hero {
        gap: 18px;
      }

      .hero h1 {
        font-size: clamp(30px, 9vw, 44px);
      }

      .hero p {
        font-size: 16px;
        margin: 12px 0 20px;
      }

      .hero-media {
        border-radius: 22px;
        min-height: 220px;
      }

      .hero-list li {
        font-size: 15px;
        align-items: flex-start;
      }

      .section-head {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }

      .region-slide {
        padding: 20px;
        grid-template-columns: 1fr;
      }

      .region-meta {
        grid-template-columns: 1fr;
        gap: 18px;
      }

      .region-heading {
        grid-column: 1;
      }

      .region-details {
        grid-template-columns: 1fr;
        gap: 18px;
      }

      .region-meta h3 {
        font-size: 22px;
      }

      .currency-row {
        flex-direction: column;
        align-items: stretch;
      }

      .currency-list {
        width: 100%;
        gap: 16px;
      }

      .currency-item {
        width: 100%;
        justify-content: flex-start;
      }

      .currency-item img {
        height: 64px;
        max-width: 140px;
      }

      .currency-item span {
        text-align: left;
      }

      .sector-grid {
        grid-template-columns: 1fr;
      }

      .community-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 600px) {
      header {
        position: sticky;
      }

      .nav {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }

      .brand {
        justify-content: space-between;
        width: 100%;
      }

      .inline-actions,
      .nav .btn,
      .inline-actions .btn {
        width: 100%;
      }

      .inline-actions {
        flex-direction: column;
        gap: 10px;
      }

      .btn {
        width: 100%;
      }

      .form-card {
        padding: 20px;
      }

      .form-actions {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }

      .form-actions .btn {
        min-width: 0;
      }

      .community-actions {
        flex-direction: column;
        align-items: stretch;
      }

      .community-actions .btn {
        width: 100%;
      }

      .slider-controls {
        padding: 0 16px;
        bottom: 12px;
      }

      .slider-btn {
        width: 36px;
        height: 36px;
      }

      .slider-dots {
        bottom: 12px;
      }

      footer {
        padding: 30px 0 40px;
      }
    }

    .result-block {
      margin-top: 12px;
      padding: 16px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.12);
      display: grid;
      gap: 8px;
    }

    .result-block pre {
      margin: 0;
      font-family: "JetBrains Mono", Consolas, monospace;
      font-size: 12px;
      color: var(--muted);
      white-space: pre-wrap;
      word-break: break-word;
    }

    .empty-note {
      color: var(--muted);
      font-size: 14px;
    }

    @keyframes animate {
      0% {
        transform: translate(-25%, -75%) rotate(0);
      }
      100% {
        transform: translate(-25%, -75%) rotate(360deg);
      }
    }

    @keyframes holographicFlow {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    @media (max-width: 720px) {
      .nav {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
      }

      .nav .inline-actions {
        width: 100%;
        justify-content: center;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      }

      .hero {
        text-align: center;
      }

      .hero .inline-actions {
        justify-content: center;
      }

      .form-card {
        padding: 22px;
      }

      .form-actions {
        justify-content: center;
      }

      .form-actions .btn {
        width: min(100%, 320px);
      }
    }

    @media (max-width: 540px) {
      .manage-tabs {
        gap: 10px;
      }

      .manage-tab {
        flex: 1 1 100%;
        text-align: center;
      }
    }

    @media (min-width: 960px) {
      main {
        gap: 72px;
      }

      .hero {
        grid-template-columns: minmax(0, 1.05fr) minmax(0, 0.95fr);
        gap: 36px;
      }

      .region-media {
        height: 260px;
      }
    }

    @media (min-width: 1280px) {
      main {
        padding: 60px 32px 140px;
        gap: 96px;
      }

      .hero {
        grid-template-columns: 1.1fr 0.9fr;
      }
    }

    @media (max-width: 640px) {
      .hero-media {
        min-height: 200px;
      }

      .region-slide {
        padding: 20px;
      }

      .slider-controls {
        display: none;
      }
    }
  </style>
</head>
<body>
<header>
  <nav class="nav">
    <div class="brand">
      <strong>Orbital Collective</strong>
      <span>Multi-faith giving platform</span>
    </div>
    <div class="inline-actions">
      <a class="btn ghost" href="#regions">Explore regions</a>
      <a class="btn liquid" href="#give">
        <span>Start giving</span>
        <div class="liquid"></div>
      </a>
      <a class="btn ghost" href="multifaith-campaign-create.html">Start receiving</a>
    </div>
  </nav>
</header>

<main>
  <section class="hero">
    <div>
      <h1>One place to give, across every faith community.</h1>
      <p>Launch fully-configured donation flows for churches, mosques, synagogues, temples, and sanghas in minutes. No waiting for a build plan—connect your organizations, publish campaigns, and accept gifts right now.</p>
      <div class="inline-actions">
        <a class="btn liquid" href="#give">
          <span>Create a donation</span>
          <div class="liquid"></div>
        </a>
        <a class="btn ghost" href="#manage">Manage organizations</a>
        <a class="btn ghost" href="multifaith-campaign-create.html">Share my story</a>
      </div>
    </div>
    <div class="hero-media">
      <ul class="hero-list">
        <li><span>1</span> Multi-region currency, tax, and receipt language out of the box.</li>
        <li><span>2</span> Faith-specific donation types with calculators and metadata.</li>
        <li><span>3</span> Instant Stripe Payment Links you can share the moment you hit submit.</li>
      </ul>
    </div>
  </section>

  <section id="regions">
    <h2>Regional gallery</h2>
    <p class="lead">Preview the localized experience for every launch territory. Each slide shows live copy, receipt preferences, and sector highlights donors will see.</p>
    <div class="region-slider">
      <div class="region-track" id="region-track"></div>
      <div class="region-transition" id="region-transition" aria-hidden="true">
        <div class="transition-scene" data-scene="current" id="transition-current"></div>
        <div class="transition-scene" data-scene="next" id="transition-next"></div>
      </div>
      <div class="slider-controls">
        <button class="slider-btn" id="prev-slide" type="button" aria-label="Previous region">‹</button>
        <button class="slider-btn" id="next-slide" type="button" aria-label="Next region">›</button>
      </div>
      <div class="slider-dots" id="slider-dots"></div>
    </div>
  </section>

  <section id="sectors">
    <h2>Sectors we fund together</h2>
    <p class="lead">Pair every gift with a sector so donors understand the impact: community relief, education, food security, and more. Sectors appear on receipts and in compliance exports automatically.</p>
    <div class="sector-grid" id="sector-grid"></div>
  </section>

  <section id="community">
    <div class="section-head">
      <div>
        <h2>Community campaigns in motion</h2>
        <p class="lead">Browse stories submitted by individuals and small groups who are actively raising support right now.</p>
      </div>
      <a class="btn ghost" href="multifaith-campaign-create.html">Start receiving donations</a>
    </div>
    <div class="community-grid" id="community-campaigns"></div>
    <p class="empty-note" id="community-empty" hidden>No community campaigns have launched yet. Share yours to be featured here.</p>
  </section>

  <section id="give">
    <h2>Give right now</h2>
    <p class="lead">Use the form below to choose a faith tradition, region, campaign, and sector. Submit to mint a secure Stripe checkout link instantly.</p>
    <div class="form-card">
      <h3>Donation builder</h3>
      <form id="donation-form">
        <div class="form-row double">
          <label>Region
            <select id="donation-region" required></select>
          </label>
          <label>Faith tradition
            <select id="donation-faith" required></select>
          </label>
        </div>
        <div class="form-row double">
          <label>Organization
            <select id="donation-org" required></select>
          </label>
          <label>Campaign
            <select id="donation-campaign" required></select>
          </label>
        </div>
        <div class="form-row double">
          <label>Sector / Fund focus
            <select id="donation-sector" required></select>
          </label>
          <label>Donation type
            <select id="donation-type" required></select>
          </label>
        </div>
        <div class="form-row triple">
          <label>Amount (local currency)
            <input id="donation-amount" type="number" min="1" step="1" placeholder="50" required/>
          </label>
          <label>Frequency
            <select id="donation-frequency" required>
              <option value="one_time">One-time</option>
              <option value="week">Weekly</option>
              <option value="month" selected>Monthly</option>
              <option value="year">Annual</option>
            </select>
          </label>
          <label>Promo codes allowed?
            <select id="donation-promo" required>
              <option value="true" selected>Yes</option>
              <option value="false">No</option>
            </select>
          </label>
        </div>
        <div class="form-row double">
          <label>Donor name
            <input id="donation-name" type="text" placeholder="Jordan Malik" required/>
          </label>
          <label>Email for receipt
            <input id="donation-email" type="email" placeholder="jordan@example.org" required/>
          </label>
        </div>
        <div class="form-row">
          <label>Notes for receipt (optional)
            <textarea id="donation-notes" placeholder="Dedicate this gift to..."></textarea>
          </label>
        </div>
        <div class="form-actions">
          <button class="btn liquid" type="submit">
            <span>Generate secure checkout</span>
            <div class="liquid"></div>
          </button>
        </div>
      </form>
      <div class="status" id="donation-status" hidden></div>
      <div class="result-block" id="donation-result" hidden>
        <strong>Payment link</strong>
        <a id="donation-link" href="#" target="_blank" rel="noreferrer"></a>
        <pre id="donation-meta"></pre>
      </div>
      <div class="empty-note" id="org-empty" hidden>No organizations found yet. Add one below to start collecting gifts.</div>
    </div>
  </section>

  <section id="manage">
    <h2>Organization &amp; campaign management</h2>
    <p class="lead">Connect as many communities as you need. As soon as you save an organization and campaign, they are available in the donation builder.</p>
    <div class="form-card manage-card">
      <div class="manage-tabs" role="tablist" aria-label="Manage organizations and campaigns">
        <button class="manage-tab is-active" type="button" role="tab" aria-selected="true" aria-controls="panel-organization" id="tab-organization" data-tab-target="panel-organization">Organizations</button>
        <button class="manage-tab" type="button" role="tab" aria-selected="false" aria-controls="panel-campaign" id="tab-campaign" data-tab-target="panel-campaign">Campaigns</button>
      </div>
      <div class="tab-panels">
        <div class="tab-panel is-active" id="panel-organization" role="tabpanel" aria-labelledby="tab-organization">
          <h3>Add an organization</h3>
          <form id="setup-org-form">
            <div class="form-row double">
              <label>Organization name
                <input id="setup-org-name" type="text" placeholder="Bethany Center" required/>
              </label>
              <label>Region
                <select id="setup-org-region" required></select>
              </label>
            </div>
            <div class="form-row double">
              <label>Faith tradition
                <select id="setup-org-faith" required></select>
              </label>
              <label>Locales (comma separated)
                <input id="setup-org-locales" type="text" placeholder="en-US, es-US"/>
              </label>
            </div>
            <div class="form-row double">
              <label>Timezone
                <input id="setup-org-timezone" type="text" placeholder="America/New_York"/>
              </label>
              <label>Stripe Account ID (optional)
                <input id="setup-org-stripe" type="text" placeholder="acct_123"/>
              </label>
            </div>
            <div class="form-actions">
              <button class="btn ghost" type="submit">Save organization</button>
            </div>
          </form>
          <div class="status" id="setup-org-status" hidden></div>
        </div>
        <div class="tab-panel" id="panel-campaign" role="tabpanel" aria-labelledby="tab-campaign" hidden>
          <h3>Add a campaign</h3>
          <form id="setup-campaign-form">
            <div class="form-row double">
              <label>Organization
                <select id="setup-campaign-org" required></select>
              </label>
              <label>Campaign name
                <input id="setup-campaign-name" type="text" placeholder="Community Relief" required/>
              </label>
            </div>
            <div class="form-row double">
              <label>Campaign code (optional)
                <input id="setup-campaign-code" type="text" placeholder="community_relief"/>
              </label>
              <label>Donation types (comma separated)
                <input id="setup-campaign-types" type="text" placeholder="tithe, zakat, dana"/>
              </label>
            </div>
            <div class="form-actions">
              <button class="btn liquid" type="submit">
                <span>Save campaign</span>
                <div class="liquid"></div>
              </button>
            </div>
          </form>
          <div class="status" id="setup-campaign-status" hidden></div>
        </div>
      </div>
    </div>
  </section>
</main>

<footer>
  © <span id="year"></span> Orbital Collective. Multi-faith donations, ready the moment you sign in.
</footer>

<script>
  const SLIDES = [
    {
      id: 'NA',
      name: 'North America',
      religion: 'christian',
      copy: 'US and Canada support ACH, cards, Apple Pay, and bilingual receipts with IRS and CRA-compliant summaries.',
      sectors: ['Community relief & shelters', 'Food security networks', 'Youth programming', 'Capital campaigns'],
      currencies: ['USD', 'CAD']
    },
    {
      id: 'EU',
      name: 'Europe',
      religion: 'jewish',
      copy: 'Localized SEPA payments with automatic Gift Aid statements and multilingual GDPR consent flows.',
      sectors: ['Refugee welcome centers', 'Cultural preservation', 'Winter energy assistance', 'Education bursaries'],
      currencies: ['EUR', 'GBP', 'SEK']
    },
    {
      id: 'MENA',
      name: 'Middle East & North Africa',
      religion: 'islam',
      copy: 'Arabic-first experiences with Ramadan scheduling, zakat calculators, and regional banking partners.',
      sectors: ['Ramadan food parcels', 'Water & sanitation', 'Scholarships for girls', 'Mosque restoration'],
      currencies: ['AED', 'SAR', 'EGP']
    },
    {
      id: 'SA',
      name: 'South Asia',
      religion: 'hindu',
      copy: 'Handle INR, LKR, and NPR gifts with PAN capture, festival campaign presets, and WhatsApp confirmations.',
      sectors: ['Disaster recovery', 'Temple seva programs', 'Health outreach', 'Education for children'],
      currencies: ['INR', 'LKR', 'NPR']
    },
    {
      id: 'APAC',
      name: 'Asia Pacific',
      religion: 'buddhist',
      copy: 'From Singapore to Sydney: cards, BECS, and PayNow support with retreat management baked in.',
      sectors: ['Retreat scholarships', 'Environmental care', 'Elder support services', 'Community kitchens'],
      currencies: ['AUD', 'SGD', 'NZD']
    }
  ];

  const CURRENCIES = new Map([
    ['USD', { code: 'USD', name: 'United States dollar', src: 'image/money/money_usd.jpg' }],
    ['CAD', { code: 'CAD', name: 'Canadian dollar', src: 'image/money/money_cad.jpg' }],
    ['EUR', { code: 'EUR', name: 'Euro', src: 'image/money/money_eur.jpg' }],
    ['GBP', { code: 'GBP', name: 'Pound sterling', src: 'image/money/money_gbp.jpg' }],
    ['SEK', { code: 'SEK', name: 'Swedish krona', src: 'image/money/money_sek.jpg' }],
    ['AED', { code: 'AED', name: 'United Arab Emirates dirham', src: 'image/money/money_aed_2.jpg' }],
    ['SAR', { code: 'SAR', name: 'Saudi riyal', src: 'image/money/money_sar.jpg' }],
    ['EGP', { code: 'EGP', name: 'Egyptian pound', src: 'image/money/money_egp.jpg' }],
    ['INR', { code: 'INR', name: 'Indian rupee', src: 'image/money/money_inr.jpg' }],
    ['LKR', { code: 'LKR', name: 'Sri Lankan rupee', src: 'image/money/money_lkr.jpg' }],
    ['NPR', { code: 'NPR', name: 'Nepalese rupee', src: 'image/money/money_npr.jpg' }],
    ['AUD', { code: 'AUD', name: 'Australian dollar', src: 'image/money/money_aud.jpg' }],
    ['SGD', { code: 'SGD', name: 'Singapore dollar', src: 'image/money/money_sgd.jpg' }],
    ['NZD', { code: 'NZD', name: 'New Zealand dollar', src: 'image/money/money_nzd.jpg' }]
  ]);

  const SECTORS = [
    { value: 'relief', title: 'Community Relief', desc: 'Rapid response funds for housing, energy, and crisis needs.' },
    { value: 'education', title: 'Education', desc: 'Scholarships, after-school programs, and language classes.' },
    { value: 'health', title: 'Health & Wellness', desc: 'Clinics, counseling, and elder care tailored to each faith.' },
    { value: 'food', title: 'Food Security', desc: 'Food banks, Ramadan baskets, langar kitchens, and pantry drives.' },
    { value: 'youth', title: 'Youth & Families', desc: 'Child check-in, camps, and youth mentorship funding.' },
    { value: 'capital', title: 'Facilities & Capital', desc: 'Building restoration, accessibility upgrades, and mortgages.' }
  ];

  const REGION_CURRENCY_LOOKUP = new Map([
    ['NA', 'usd'],
    ['EU', 'eur'],
    ['MENA', 'aed'],
    ['SA', 'inr'],
    ['APAC', 'sgd']
  ]);

  const DEFAULT_ORGS = [
    {
      _id: 'org_dreamworld',
      name: 'Dreamworld',
      region: 'APAC',
      religion: 'buddhist',
      locales: ['en-SG', 'zh-SG'],
      timezone: 'Asia/Singapore'
    },
    {
      _id: 'org_dreamworld_point_bank',
      name: 'Dreamworld Point Bank',
      region: 'NA',
      religion: 'jewish',
      locales: ['en-US', 'he-IL'],
      timezone: 'America/New_York'
    },
    {
      _id: 'org_one_brain_world',
      name: 'One Brain World',
      region: 'NA',
      religion: 'christian',
      locales: ['en-US', 'es-US'],
      timezone: 'America/Los_Angeles'
    },
    {
      _id: 'org_new_bright_water',
      name: 'New Bright Water',
      region: 'MENA',
      religion: 'islam',
      locales: ['en-AE', 'ar-AE'],
      timezone: 'Asia/Dubai'
    },
    {
      _id: 'org_paperwork',
      name: 'Paperwork',
      region: 'SA',
      religion: 'hindu',
      locales: ['en-IN', 'hi-IN'],
      timezone: 'Asia/Kolkata'
    }
  ];

  const DEFAULT_CAMPAIGNS = new Map([
    ['org_dreamworld', [
      {
        _id: 'camp_dreamworld_retreat',
        orgId: 'org_dreamworld',
        name: 'Retreat Scholarships · Education Fund',
        sectorFocus: 'education',
        currency: 'sgd',
        donationTypes: ['dana', 'retreat']
      },
      {
        _id: 'camp_dreamworld_environment',
        orgId: 'org_dreamworld',
        name: 'Environmental Care · Health & Wellness',
        sectorFocus: 'health',
        currency: 'sgd',
        donationTypes: ['dana']
      },
      {
        _id: 'camp_dreamworld_kitchens',
        orgId: 'org_dreamworld',
        name: 'Community Kitchens · Food Security',
        sectorFocus: 'food',
        currency: 'sgd',
        donationTypes: ['dana']
      }
    ]],
    ['org_one_brain_world', [
      {
        _id: 'camp_one_brain_relief',
        orgId: 'org_one_brain_world',
        name: 'Community Relief · Neighbor Support',
        sectorFocus: 'relief',
        currency: 'usd',
        donationTypes: ['tithe', 'offering']
      },
      {
        _id: 'camp_one_brain_youth',
        orgId: 'org_one_brain_world',
        name: 'Youth & Families · Mentorship Fund',
        sectorFocus: 'youth',
        currency: 'usd',
        donationTypes: ['pledge', 'offering']
      },
      {
        _id: 'camp_one_brain_capital',
        orgId: 'org_one_brain_world',
        name: 'Facilities & Capital · Renewal Campaign',
        sectorFocus: 'capital',
        currency: 'usd',
        donationTypes: ['pledge']
      }
    ]],
    ['org_new_bright_water', [
      {
        _id: 'camp_new_bright_relief',
        orgId: 'org_new_bright_water',
        name: 'Ramadan Food Parcels · Food Security',
        sectorFocus: 'food',
        currency: 'aed',
        donationTypes: ['zakat', 'sadaqah']
      },
      {
        _id: 'camp_new_bright_scholarship',
        orgId: 'org_new_bright_water',
        name: 'Scholarships for Girls · Education Access',
        sectorFocus: 'education',
        currency: 'aed',
        donationTypes: ['zakat']
      },
      {
        _id: 'camp_new_bright_restoration',
        orgId: 'org_new_bright_water',
        name: 'Mosque Restoration · Facilities & Capital',
        sectorFocus: 'capital',
        currency: 'aed',
        donationTypes: ['zakat', 'sadaqah']
      }
    ]],
    ['org_dreamworld_point_bank', [
      {
        _id: 'camp_dreamworld_point_bank_emergency',
        orgId: 'org_dreamworld_point_bank',
        name: 'Emergency Relief · Tzedakah Collective',
        sectorFocus: 'relief',
        currency: 'usd',
        donationTypes: ['tzedakah']
      },
      {
        _id: 'camp_dreamworld_point_bank_learning',
        orgId: 'org_dreamworld_point_bank',
        name: 'Learning Circles · Scholarship Fund',
        sectorFocus: 'education',
        currency: 'usd',
        donationTypes: ['tzedakah', 'maaser']
      },
      {
        _id: 'camp_dreamworld_point_bank_families',
        orgId: 'org_dreamworld_point_bank',
        name: 'Family Support · Community Chest',
        sectorFocus: 'youth',
        currency: 'usd',
        donationTypes: ['maaser']
      }
    ]],
    ['org_paperwork', [
      {
        _id: 'camp_paperwork_prasadam',
        orgId: 'org_paperwork',
        name: 'Temple Meals · Prasadam Kitchen',
        sectorFocus: 'food',
        currency: 'inr',
        donationTypes: ['daan', 'seva']
      },
      {
        _id: 'camp_paperwork_education',
        orgId: 'org_paperwork',
        name: 'Youth Education · Gurukul Program',
        sectorFocus: 'education',
        currency: 'inr',
        donationTypes: ['daan', 'dakshina']
      },
      {
        _id: 'camp_paperwork_health',
        orgId: 'org_paperwork',
        name: 'Health Outreach · Seva Clinics',
        sectorFocus: 'health',
        currency: 'inr',
        donationTypes: ['seva']
      }
    ]]
  ]);

  const FAITH_TYPES = {
    christian: ['tithe', 'offering', 'pledge', 'mission'],
    islam: ['zakat', 'sadaqah', 'fidya', 'zakat-al-fitr'],
    hindu: ['daan', 'dakshina', 'seva'],
    buddhist: ['dana', 'retreat', 'merit'],
    jewish: ['tzedakah', 'maaser', 'aliyah', 'yahrzeit']
  };

  const FAITH_OPTIONS = [
    { value: 'christian', label: 'Christianity' },
    { value: 'islam', label: 'Islam' },
    { value: 'hindu', label: 'Hinduism' },
    { value: 'buddhist', label: 'Buddhism' },
    { value: 'jewish', label: 'Judaism' }
  ];

  const RELIGION_SYMBOLS = new Map([
    ['christian', { label: 'Christianity', src: 'religion/christianity-symbol.png' }],
    ['islam', { label: 'Islam', src: 'religion/islam-symbol.png' }],
    ['hindu', { label: 'Hinduism', src: 'religion/hinduism-symbol.png' }],
    ['buddhist', { label: 'Buddhism', src: 'religion/buddhism-symbol.png' }],
    ['jewish', { label: 'Judaism', src: 'religion/judaism-symbol.PNG' }]
  ]);

  const RELIGION_IMAGE_POOLS = new Map([
    ['christian', [
      'religion/christianity1.jpg',
      'religion/christianity2.jpg',
      'religion/christianity3.jpg',
      'religion/christianity4.jpg',
      'religion/christianity5.jpg',
      'religion/christianity6.jpg',
      'religion/christianity7.png',
      'religion/christianity8.png',
      'religion/christianity9.png'
    ]],
    ['jewish', [
      'religion/judaism1.jpg',
      'religion/judaism2.jpg',
      'religion/judaism3.png',
      'religion/judaism4.png',
      'religion/judaism5.png',
      'religion/judaism6.png',
      'religion/judaism7.png',
      'religion/judaism8.png'
    ]],
    ['islam', [
      'religion/islam1.jpg',
      'religion/islam2.jpg',
      'religion/islam3.png',
      'religion/islam4.jpg',
      'religion/islam5.jpg',
      'religion/islam6.jpg',
      'religion/islam7.jpg',
      'religion/islam8.jpg',
      'religion/islam9.png',
      'religion/islam10.jpg',
      'religion/islam11.png'
    ]],
    ['hindu', [
      'religion/hinduism1.jpg',
      'religion/hinduism2.jpg',
      'religion/hinduism3.jpg',
      'religion/hinduism4.jpg',
      'religion/hinduism5.jpg',
      'religion/hinduism6.jpg',
      'religion/hinduism7.jpg'
    ]],
    ['buddhist', [
      'religion/buddhism1.jpg',
      'religion/buddhism2.jpg',
      'religion/buddhism3.jpg',
      'religion/buddhism4.jpg',
      'religion/buddhism5.jpg',
      'religion/buddhism6.jpg',
      'religion/buddhism7.jpg',
      'religion/buddhism8.jpg',
      'religion/buddhism9.jpg'
    ]]
  ]);

  const MAX_FAITH_SYMBOL_TILT = 10;

  const state = {
    orgs: [],
    campaignsByOrg: new Map(),
    campaignFetchAttempts: new Set(),
    communityCampaigns: [],
    slideIndex: 0,
    autoTimer: null,
    slideImages: new Map(),
    lastSlideImage: new Map(),
    hasRenderedInitialSlide: false,
    isTransitioning: false,
    preloadedSlideId: null
  };

  const SECTOR_TITLE_LOOKUP = new Map(SECTORS.map(sector => [sector.value, sector.title]));

  const els = {
    regionSlider: document.querySelector('.region-slider'),
    regionTrack: document.getElementById('region-track'),
    regionTransition: document.getElementById('region-transition'),
    transitionCurrent: document.getElementById('transition-current'),
    transitionNext: document.getElementById('transition-next'),
    sliderDots: document.getElementById('slider-dots'),
    prevSlide: document.getElementById('prev-slide'),
    nextSlide: document.getElementById('next-slide'),
    sectorGrid: document.getElementById('sector-grid'),
    donationForm: document.getElementById('donation-form'),
    donationRegion: document.getElementById('donation-region'),
    donationFaith: document.getElementById('donation-faith'),
    donationOrg: document.getElementById('donation-org'),
    donationCampaign: document.getElementById('donation-campaign'),
    donationSector: document.getElementById('donation-sector'),
    donationType: document.getElementById('donation-type'),
    donationAmount: document.getElementById('donation-amount'),
    donationFrequency: document.getElementById('donation-frequency'),
    donationPromo: document.getElementById('donation-promo'),
    donationName: document.getElementById('donation-name'),
    donationEmail: document.getElementById('donation-email'),
    donationNotes: document.getElementById('donation-notes'),
    donationStatus: document.getElementById('donation-status'),
    donationResult: document.getElementById('donation-result'),
    donationLink: document.getElementById('donation-link'),
    donationMeta: document.getElementById('donation-meta'),
    orgEmpty: document.getElementById('org-empty'),
    setupOrgForm: document.getElementById('setup-org-form'),
    setupOrgStatus: document.getElementById('setup-org-status'),
    setupOrgName: document.getElementById('setup-org-name'),
    setupOrgRegion: document.getElementById('setup-org-region'),
    setupOrgFaith: document.getElementById('setup-org-faith'),
    setupOrgLocales: document.getElementById('setup-org-locales'),
    setupOrgTimezone: document.getElementById('setup-org-timezone'),
    setupOrgStripe: document.getElementById('setup-org-stripe'),
    setupCampaignForm: document.getElementById('setup-campaign-form'),
    setupCampaignStatus: document.getElementById('setup-campaign-status'),
    setupCampaignOrg: document.getElementById('setup-campaign-org'),
    setupCampaignName: document.getElementById('setup-campaign-name'),
    setupCampaignCode: document.getElementById('setup-campaign-code'),
    setupCampaignTypes: document.getElementById('setup-campaign-types'),
    communityGrid: document.getElementById('community-campaigns'),
    communityEmpty: document.getElementById('community-empty'),
    manageCard: document.querySelector('.manage-card')
  };

  const HTML_ESCAPE_LOOKUP = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;'
  };

  function escapeHtml(value) {
    return String(value ?? '').replace(/[&<>"']/g, ch => HTML_ESCAPE_LOOKUP[ch] || ch);
  }

  function titleize(value) {
    const str = String(value ?? '').replace(/[_-]+/g, ' ').trim();
    if (!str) return '';
    return str.replace(/\b\w/g, ch => ch.toUpperCase());
  }

  function initialsFromName(value) {
    const parts = String(value ?? '')
      .trim()
      .split(/\s+/)
      .filter(Boolean)
      .map(part => part[0]);
    if (!parts.length) return '∎';
    return parts.slice(0, 2).join('').toUpperCase();
  }

  function truncate(value, max = 160) {
    const str = String(value ?? '').trim();
    if (str.length <= max) return str;
    return `${str.slice(0, Math.max(0, max - 1))}…`;
  }

  function formatCurrency(amount, currency = 'usd') {
    const numeric = Number(amount || 0);
    const code = String(currency || 'usd').toUpperCase();
    if (!Number.isFinite(numeric)) return '';
    try {
      return new Intl.NumberFormat(undefined, { style: 'currency', currency: code }).format(numeric);
    } catch (err) {
      return `${code} ${numeric.toFixed(2)}`;
    }
  }

  function getCurrencyForRegion(region) {
    return REGION_CURRENCY_LOOKUP.get(region) || 'usd';
  }

  function setStatus(el, message, type = 'info') {
    if (!el) return;
    el.hidden = false;
    el.textContent = message;
    el.classList.remove('success', 'error');
    if (type === 'success') el.classList.add('success');
    if (type === 'error') el.classList.add('error');
  }

  function clearStatus(el) {
    if (!el) return;
    el.hidden = true;
    el.textContent = '';
    el.classList.remove('success', 'error');
  }

  function option(label, value) {
    const opt = document.createElement('option');
    opt.value = value;
    opt.textContent = label;
    return opt;
  }

  function getImagePoolForReligion(religion) {
    return RELIGION_IMAGE_POOLS.get(religion) || [];
  }

  function pickRandomImage(pool, exclude, forceDifferent = true) {
    if (!pool.length) return null;
    const unique = forceDifferent ? pool.filter(src => src !== exclude) : pool.slice();
    const options = unique.length ? unique : pool;
    const index = Math.floor(Math.random() * options.length);
    return options[index];
  }

  function setRandomSlideImage(slideId, religion, forceDifferent = true) {
    const imgEl = state.slideImages.get(slideId);
    if (!imgEl) return;
    const pool = getImagePoolForReligion(religion);
    const previous = state.lastSlideImage.get(slideId);
    const next = pickRandomImage(pool, previous, forceDifferent);
    if (next && next !== previous) {
      imgEl.src = next;
      state.lastSlideImage.set(slideId, next);
    } else if (!imgEl.src && next) {
      imgEl.src = next;
      state.lastSlideImage.set(slideId, next);
    }
  }

  function handleFaithSymbolPointerMove(event) {
    const el = event.currentTarget;
    const rect = el.getBoundingClientRect();
    const x = (event.clientX - rect.left) / rect.width - 0.5;
    const y = (event.clientY - rect.top) / rect.height - 0.5;
    const rotateX = Math.max(-MAX_FAITH_SYMBOL_TILT, Math.min(MAX_FAITH_SYMBOL_TILT, -y * MAX_FAITH_SYMBOL_TILT));
    const rotateY = Math.max(-MAX_FAITH_SYMBOL_TILT, Math.min(MAX_FAITH_SYMBOL_TILT, x * MAX_FAITH_SYMBOL_TILT));
    el.style.transform = `perspective(600px) rotateX(${rotateX.toFixed(2)}deg) rotateY(${rotateY.toFixed(2)}deg)`;
  }

  function handleFaithSymbolPointerLeave(event) {
    const el = event.currentTarget;
    el.style.transform = 'perspective(600px) rotateX(0deg) rotateY(0deg)';
  }

  function attachFaithSymbolTilt() {
    const symbols = document.querySelectorAll('.faith-symbol');
    symbols.forEach(symbol => {
      if (symbol.dataset.tiltBound === 'true') return;
      symbol.dataset.tiltBound = 'true';
      symbol.addEventListener('pointermove', handleFaithSymbolPointerMove);
      symbol.addEventListener('pointerleave', handleFaithSymbolPointerLeave);
      symbol.addEventListener('pointerup', handleFaithSymbolPointerLeave);
      symbol.addEventListener('pointercancel', handleFaithSymbolPointerLeave);
    });
  }

  function getSlideMediaBounds(index) {
    const slider = els.regionSlider;
    const track = els.regionTrack;
    if (!slider || !track) return null;
    const slideEl = track.children?.[index];
    const mediaEl = slideEl?.querySelector('.region-media');
    if (!mediaEl) return null;
    const sliderRect = slider.getBoundingClientRect();
    const mediaRect = mediaEl.getBoundingClientRect();
    return {
      top: mediaRect.top - sliderRect.top,
      left: mediaRect.left - sliderRect.left,
      width: mediaRect.width,
      height: mediaRect.height
    };
  }

  function updateTransitionOverlayForIndex(index) {
    const overlay = els.regionTransition;
    if (!overlay) return;
    const bounds = getSlideMediaBounds(index);
    if (!bounds) {
      overlay.style.removeProperty('--transition-top');
      overlay.style.removeProperty('--transition-left');
      overlay.style.removeProperty('--transition-width');
      overlay.style.removeProperty('--transition-height');
      return;
    }
    overlay.style.setProperty('--transition-top', `${bounds.top}px`);
    overlay.style.setProperty('--transition-left', `${bounds.left}px`);
    overlay.style.setProperty('--transition-width', `${bounds.width}px`);
    overlay.style.setProperty('--transition-height', `${bounds.height}px`);
  }

  function renderSlides() {
    els.regionTrack.innerHTML = '';
    els.sliderDots.innerHTML = '';
    state.slideImages.clear();
    state.lastSlideImage.clear();
    state.slideIndex = 0;
    state.hasRenderedInitialSlide = false;
    state.isTransitioning = false;
    state.preloadedSlideId = null;
    if (els.regionTransition) {
      els.regionTransition.classList.remove('is-active');
    }
    SLIDES.forEach((slide, index) => {
      const slideEl = document.createElement('article');
      slideEl.className = 'region-slide';
      slideEl.dataset.index = index;
      const symbol = RELIGION_SYMBOLS.get(slide.religion);
      const identity = symbol
        ? `<div class="faith-identity" data-religion="${slide.religion}"><div class="faith-symbol" aria-hidden="true" style="--symbol-image: url('${symbol.src}')"></div><span class="faith-label">${escapeHtml(symbol.label)}</span></div>`
        : '';
      const currencyMarkup = Array.isArray(slide.currencies) && slide.currencies.length
        ? `<div class="currency-row"><strong>Currencies:</strong><ul class="currency-list" aria-label="Supported currencies">${slide.currencies
            .map(code => {
              const normalized = typeof code === 'string' ? code.trim().toUpperCase() : '';
              if (!normalized) return '';
              const currency = CURRENCIES.get(normalized);
              if (currency) {
                return `<li class="currency-item" data-code="${escapeHtml(currency.code)}"><img src="${currency.src}" alt="${escapeHtml(currency.name)}" loading="lazy" decoding="async"/><span>${escapeHtml(currency.code)}</span></li>`;
              }
              return `<li class="currency-item" data-code="${escapeHtml(normalized)}"><span>${escapeHtml(normalized)}</span></li>`;
            })
            .join('')}</ul></div>`
        : '';
      slideEl.innerHTML = `
        <div class="region-media">
          <img class="region-image" alt="${slide.name} faith communities" loading="lazy"/>
        </div>
        <div class="region-meta">
          <div class="region-heading">
            ${identity}
            <h3>${slide.name}</h3>
            <p>${slide.copy}</p>
          </div>
          <div class="region-details">
            ${currencyMarkup}
            <ul>
              ${slide.sectors.map(item => `<li>${item}</li>`).join('')}
            </ul>
          </div>
        </div>
      `;
      slideEl.classList.add(index % 2 === 0 ? 'pan-up' : 'pan-down');
      const imgEl = slideEl.querySelector('.region-image');
      if (imgEl) {
        state.slideImages.set(slide.id, imgEl);
        setRandomSlideImage(slide.id, slide.religion, false);
      }
      els.regionTrack.appendChild(slideEl);

      const dot = document.createElement('div');
      dot.className = 'slider-dot';
      dot.dataset.index = index;
      dot.addEventListener('click', () => showSlide(index, true));
      els.sliderDots.appendChild(dot);
    });
    if (els.transitionCurrent) {
      els.transitionCurrent.style.backgroundImage = 'none';
    }
    if (els.transitionNext) {
      els.transitionNext.style.backgroundImage = 'none';
      els.transitionNext.style.setProperty('--transition-mask-image', 'none');
    }
    showSlide(0, false, true);
    attachFaithSymbolTilt();
    updateTransitionOverlayForIndex(0);
  }

  function showSlide(index, manual = false, skipTransition = false) {
    if (state.isTransitioning) return;
    const nextIndex = (index + SLIDES.length) % SLIDES.length;
    const currentIndex = state.slideIndex;
    const shouldAnimate = !skipTransition && state.hasRenderedInitialSlide && nextIndex !== currentIndex;
    if (shouldAnimate && els.regionTransition && els.transitionCurrent && els.transitionNext) {
      startSlideTransition(currentIndex, nextIndex, manual);
      return;
    }
    finalizeSlideChange(nextIndex, manual);
  }

  function startSlideTransition(currentIndex, nextIndex, manual) {
    const overlay = els.regionTransition;
    const currentScene = els.transitionCurrent;
    const nextScene = els.transitionNext;
    const currentSlide = SLIDES[currentIndex];
    const nextSlideData = SLIDES[nextIndex];
    if (!overlay || !currentScene || !nextScene || !currentSlide || !nextSlideData) {
      finalizeSlideChange(nextIndex, manual);
      return;
    }

    state.isTransitioning = true;
    setRandomSlideImage(nextSlideData.id, nextSlideData.religion);
    const currentImg = state.slideImages.get(currentSlide.id);
    const nextImg = state.slideImages.get(nextSlideData.id);
    const currentSrc = currentImg?.src || '';
    const nextSrc = nextImg?.src || '';
    currentScene.style.backgroundImage = currentSrc ? `url("${currentSrc}")` : 'none';
    nextScene.style.backgroundImage = nextSrc ? `url("${nextSrc}")` : 'none';
    const symbol = RELIGION_SYMBOLS.get(nextSlideData.religion);
    if (symbol?.src) {
      nextScene.style.setProperty('--transition-mask-image', `url("${symbol.src}")`);
    } else {
      nextScene.style.setProperty('--transition-mask-image', 'none');
    }
    const duration = 1800;
    overlay.style.setProperty('--transition-duration', `${duration}ms`);
    updateTransitionOverlayForIndex(currentIndex);
    state.preloadedSlideId = nextSlideData.id;

    // Reset animation state to allow retriggering
    currentScene.style.animation = 'none';
    nextScene.style.animation = 'none';
    void overlay.offsetWidth;
    currentScene.style.animation = '';
    nextScene.style.animation = '';

    overlay.classList.add('is-active');

    let finished = false;
    let fallbackTimer = null;
    const timerHost = typeof window !== 'undefined' ? window : globalThis;
    const finish = () => {
      if (finished) return;
      finished = true;
      if (fallbackTimer) {
        timerHost.clearTimeout(fallbackTimer);
      }
      finalizeSlideChange(nextIndex, manual);
      overlay.classList.remove('is-active');
      currentScene.style.backgroundImage = 'none';
      nextScene.style.backgroundImage = 'none';
      nextScene.style.setProperty('--transition-mask-image', 'none');
      state.isTransitioning = false;
      updateTransitionOverlayForIndex(state.slideIndex);
    };

    fallbackTimer = timerHost.setTimeout(finish, duration + 250);
    nextScene.addEventListener('animationend', finish, { once: true });
  }

  function finalizeSlideChange(newIndex, manual) {
    state.slideIndex = newIndex;
    const offset = -state.slideIndex * 100;
    els.regionTrack.style.transform = `translateX(${offset}%)`;
    const slides = Array.from(els.regionTrack.children);
    slides.forEach((slideEl, idx) => {
      const isActive = idx === state.slideIndex;
      slideEl.classList.toggle('active', isActive);
      if (isActive) {
        const img = slideEl.querySelector('.region-image');
        if (img) {
          img.style.animation = 'none';
          void img.offsetHeight;
          img.style.animation = '';
        }
      }
    });
    Array.from(els.sliderDots.children).forEach((dot, idx) => {
      dot.classList.toggle('active', idx === state.slideIndex);
    });
    const slide = SLIDES[state.slideIndex];
    if (slide) {
      if (state.preloadedSlideId === slide.id) {
        state.preloadedSlideId = null;
      } else {
        setRandomSlideImage(slide.id, slide.religion);
      }
    }
    updateTransitionOverlayForIndex(state.slideIndex);
    if (manual) {
      resetAutoSlide();
    }
    if (!state.hasRenderedInitialSlide) {
      state.hasRenderedInitialSlide = true;
    }
  }

  function nextSlide(manual = false) {
    if (state.isTransitioning) return;
    showSlide(state.slideIndex + 1, manual);
  }

  function prevSlide() {
    if (state.isTransitioning) return;
    showSlide(state.slideIndex - 1, true);
  }

  function resetAutoSlide() {
    if (state.autoTimer) {
      clearInterval(state.autoTimer);
    }
    state.autoTimer = setInterval(nextSlide, 8000);
  }

  function renderSectors() {
    els.sectorGrid.innerHTML = '';
    SECTORS.forEach(sector => {
      const card = document.createElement('article');
      card.className = 'sector-card';
      card.innerHTML = `<h3>${sector.title}</h3><p>${sector.desc}</p>`;
      els.sectorGrid.appendChild(card);
    });
  }

  function renderCommunityCampaigns(campaigns) {
    if (!els.communityGrid) return;
    els.communityGrid.innerHTML = '';
    const list = Array.isArray(campaigns) ? campaigns : [];
    if (!list.length) {
      if (els.communityEmpty) {
        els.communityEmpty.hidden = false;
        els.communityEmpty.textContent = 'No community campaigns have launched yet. Share yours to be featured here.';
      }
      return;
    }

    if (els.communityEmpty) {
      els.communityEmpty.hidden = true;
    }

    list.forEach(campaign => {
      const card = document.createElement('article');
      card.className = 'community-card';
      const goal = Number(campaign.goalAmount || 0);
      const raised = Number(campaign.amountRaised || 0);
      const currency = campaign.currency || getCurrencyForRegion(campaign.region);
      const progressPercent = goal > 0 ? Math.min(100, Math.round((raised / goal) * 100)) : 0;
      const goalReached = goal > 0 && raised >= goal;
      const statusMessage = goal > 0
        ? goalReached
          ? 'Goal reached'
          : `${Math.max(0, 100 - progressPercent)}% to goal`
        : 'Open goal';
      const religionLabel = titleize(campaign.religion || '');
      const regionLabel = String(campaign.region || '').toUpperCase();
      const withdrawalLabel = campaign.allowEarlyWithdrawal ? 'Flexible withdrawals' : 'Goal release';
      const metaParts = [religionLabel, regionLabel, withdrawalLabel].filter(Boolean);
      const metaHtml = (metaParts.length ? metaParts : ['Community']).map(part => `<span>${escapeHtml(part)}</span>`).join('');
      const description = truncate(campaign.description || '', 190);
      const paymentLink = campaign?.paymentLink?.url
        ? `<a class="btn" href="${escapeHtml(campaign.paymentLink.url)}" target="_blank" rel="noreferrer">Give now</a>`
        : '';
      const profileDisplay = campaign.profileName ? escapeHtml(campaign.profileName) : 'Anonymous';
      const imageContent = campaign.imageUrl
        ? `<img src="${escapeHtml(campaign.imageUrl)}" alt="${escapeHtml(campaign.profileName || campaign.campaignName || 'Community campaign')}" loading="lazy"/>`
        : `<div class="community-initial">${escapeHtml(initialsFromName(campaign.profileName || campaign.campaignName))}</div>`;
      const raisedLabel = escapeHtml(formatCurrency(raised, currency));
      const goalLabel = escapeHtml(goal > 0 ? `of ${formatCurrency(goal, currency)}` : 'No goal set');
      card.innerHTML = `
        <div class="community-media">${imageContent}</div>
        <div class="community-body">
          <div class="community-meta">${metaHtml}</div>
          <h3>${escapeHtml(campaign.campaignName || '')}</h3>
          <p>${escapeHtml(description)}</p>
          <div class="community-progress">
            <div class="progress-bar"><div style="width:${progressPercent}%"></div></div>
            <div class="progress-meta">
              <span>${raisedLabel}</span>
              <span>${goalLabel}</span>
            </div>
            <span class="community-status${goalReached ? ' goal-met' : ''}">${escapeHtml(statusMessage)}</span>
          </div>
          <div class="community-actions">
            ${paymentLink}
            <span class="community-profile">by ${profileDisplay}</span>
          </div>
        </div>`;
      card.dataset.campaignId = campaign.id || campaign._id || '';
      els.communityGrid.appendChild(card);
    });
  }

  async function loadCommunityCampaigns() {
    if (!els.communityGrid) return;
    try {
      const data = await fetchJSON('/api/giving/community-campaigns');
      const campaigns = Array.isArray(data) ? data : data.campaigns ?? data.data ?? [];
      state.communityCampaigns = campaigns;
      renderCommunityCampaigns(campaigns);
    } catch (err) {
      console.warn('Unable to load community campaigns', err);
      if (els.communityEmpty) {
        els.communityEmpty.hidden = false;
        els.communityEmpty.textContent = 'Unable to load community campaigns right now. Please try again soon.';
      }
    }
  }

  function populateSelect(select, values, placeholder) {
    if (!select) return;
    const current = select.value;
    select.innerHTML = '';
    if (placeholder) {
      const opt = option(placeholder, '');
      opt.disabled = true;
      opt.selected = true;
      select.appendChild(opt);
    }
    values.forEach(item => {
      if (typeof item === 'string') {
        select.appendChild(option(item, item));
      } else if (item && typeof item === 'object') {
        const opt = option(item.label ?? item.name ?? item.value, item.value ?? item._id);
        if (item._id) {
          opt.dataset.json = JSON.stringify(item);
        }
        select.appendChild(opt);
      }
    });
    if (current && Array.from(select.options).some(o => o.value === current)) {
      select.value = current;
    }
  }

  function cloneDefaultCampaigns(list) {
    return list.map(campaign => ({
      ...campaign,
      donationTypes: Array.isArray(campaign.donationTypes) ? [...campaign.donationTypes] : undefined
    }));
  }

  function ensureDefaultOrganizations() {
    const seen = new Set(state.orgs.map(org => (org && (org._id ? `id:${org._id}` : `name:${(org.name || '').toLowerCase()}:${org.region || ''}`))));
    DEFAULT_ORGS.forEach(org => {
      const key = org._id ? `id:${org._id}` : `name:${(org.name || '').toLowerCase()}:${org.region || ''}`;
      if (!seen.has(key)) {
        state.orgs.push({
          ...org,
          locales: Array.isArray(org.locales) ? [...org.locales] : []
        });
        seen.add(key);
      }
      if (org._id && DEFAULT_CAMPAIGNS.has(org._id) && !state.campaignsByOrg.has(org._id)) {
        state.campaignsByOrg.set(org._id, cloneDefaultCampaigns(DEFAULT_CAMPAIGNS.get(org._id)));
      }
    });
  }

  function populateFaithSelects() {
    populateSelect(els.donationFaith, FAITH_OPTIONS.map(f => ({ label: f.label, value: f.value })), 'Choose a faith');
    populateSelect(els.setupOrgFaith, FAITH_OPTIONS.map(f => ({ label: f.label, value: f.value })), 'Choose a faith');
  }

  function populateRegionSelects() {
    const regions = SLIDES.map(slide => ({ label: `${slide.name}`, value: slide.id }));
    populateSelect(els.donationRegion, regions, 'Choose a region');
    populateSelect(els.setupOrgRegion, regions, 'Choose a region');
  }

  function populateSectorSelects() {
    populateSelect(els.donationSector, SECTORS.map(s => ({ label: s.title, value: s.value })), 'Select a sector');
  }

  function setDonationTypeOptions(religion) {
    const values = FAITH_TYPES[religion] ?? [];
    const items = values.length ? values : ['general'];
    populateSelect(els.donationType, items.map(v => ({ label: v.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase()), value: v })), 'Select donation type');
  }

  function updateOrgOptions() {
    const region = els.donationRegion.value;
    const faith = els.donationFaith.value;
    const list = state.orgs.filter(org => {
      const regionMatch = !region || org.region === region;
      const faithMatch = !faith || org.religion === faith;
      return regionMatch && faithMatch;
    });
    populateSelect(els.donationOrg, list.map(org => ({ ...org, label: `${org.name} · ${org.region}/${org.religion}`, value: org._id })), 'Choose an organization');
    populateSelect(els.setupCampaignOrg, state.orgs.map(org => ({ ...org, label: `${org.name} (${org.region})`, value: org._id })), 'Choose an organization');
    els.orgEmpty.hidden = list.length > 0 || state.orgs.length === 0;
  }

  function updateCampaignOptions(orgId) {
    const campaigns = state.campaignsByOrg.get(orgId) ?? [];
    populateSelect(
      els.donationCampaign,
      campaigns.map(campaign => ({
        ...campaign,
        label: campaign.sectorFocus
          ? `${campaign.name} (${SECTOR_TITLE_LOOKUP.get(campaign.sectorFocus) || campaign.sectorFocus})`
          : campaign.name,
        value: campaign._id
      })),
      'Choose a campaign'
    );
  }

  function hydrateDonationTypesFromCampaign(campaign) {
    if (!campaign) return;
    const donationTypes = Array.isArray(campaign.donationTypes) && campaign.donationTypes.length ? campaign.donationTypes : undefined;
    if (donationTypes) {
      populateSelect(els.donationType, donationTypes.map(v => ({ label: v.replace(/_/g, ' ').replace(/\b\w/g, ch => ch.toUpperCase()), value: v })), 'Select donation type');
    }
    if (campaign.sectorFocus) {
      const hasSectorOption = Array.from(els.donationSector.options).some(opt => opt.value === campaign.sectorFocus);
      if (hasSectorOption) {
        els.donationSector.value = campaign.sectorFocus;
      }
    }
  }

  async function fetchJSON(url) {
    const res = await fetch(url, { headers: { 'Accept': 'application/json' } });
    if (!res.ok) {
      throw new Error(res.statusText || 'Request failed');
    }
    return res.json();
  }

  async function postJSON(url, payload) {
    const res = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      body: JSON.stringify(payload)
    });
    if (!res.ok) {
      const text = await res.text();
      throw new Error(text || res.statusText || 'Request failed');
    }
    return res.json();
  }

  async function loadOrganizations() {
    try {
      const data = await fetchJSON('/api/giving/organizations');
      const orgs = Array.isArray(data) ? data : data.organizations ?? data.data ?? [];
      if (Array.isArray(orgs)) {
        state.orgs = orgs.slice();
      }
    } catch (err) {
      console.warn('Unable to load organizations', err);
      state.orgs = [];
    }
    ensureDefaultOrganizations();
    updateOrgOptions();
  }

  async function loadCampaigns(orgId) {
    if (!orgId) return;
    if (!state.campaignsByOrg.has(orgId) && DEFAULT_CAMPAIGNS.has(orgId)) {
      state.campaignsByOrg.set(orgId, cloneDefaultCampaigns(DEFAULT_CAMPAIGNS.get(orgId)));
    }
    if (state.campaignFetchAttempts.has(orgId)) return;
    state.campaignFetchAttempts.add(orgId);
    try {
      const data = await fetchJSON(`/api/giving/campaigns?orgId=${encodeURIComponent(orgId)}`);
      const campaigns = Array.isArray(data) ? data : data.campaigns ?? data.data ?? [];
      if (Array.isArray(campaigns)) {
        state.campaignsByOrg.set(orgId, campaigns);
      }
    } catch (err) {
      console.warn('Unable to load campaigns', err);
      if (!state.campaignsByOrg.has(orgId) || !state.campaignsByOrg.get(orgId)?.length) {
        state.campaignsByOrg.set(orgId, cloneDefaultCampaigns(DEFAULT_CAMPAIGNS.get(orgId) ?? []));
      }
    }
  }

  function handleOrgSelection() {
    const select = els.donationOrg;
    const option = select.options[select.selectedIndex];
    if (option?.dataset?.json) {
      try {
        const org = JSON.parse(option.dataset.json);
        if (org.region) {
          els.donationRegion.value = org.region;
        }
        if (org.religion) {
          els.donationFaith.value = org.religion;
          setDonationTypeOptions(org.religion);
        }
      } catch (err) {
        console.warn('Unable to parse organization option', err);
      }
    }
  }

  function extractCampaignFromSelect() {
    const select = els.donationCampaign;
    const option = select.options[select.selectedIndex];
    if (option?.dataset?.json) {
      try {
        return JSON.parse(option.dataset.json);
      } catch (err) {
        console.warn('Unable to parse campaign option', err);
      }
    }
    return null;
  }

  function prepareDonationPayload() {
    const orgId = els.donationOrg.value;
    const campaignId = els.donationCampaign.value;
    if (!orgId || !campaignId) {
      throw new Error('Select an organization and campaign.');
    }
    const frequency = els.donationFrequency.value;
    const interval = frequency === 'one_time' ? undefined : frequency;
    const amount = Number(els.donationAmount.value);
    if (!amount || Number.isNaN(amount)) {
      throw new Error('Enter a donation amount.');
    }
    const org = state.orgs.find(item => item?._id === orgId);
    const campaign = extractCampaignFromSelect();
    const currency = (campaign?.currency || org?.currency || getCurrencyForRegion(els.donationRegion.value));
    const payload = {
      orgId,
      campaignId,
      region: els.donationRegion.value,
      religion: els.donationFaith.value,
      donationType: els.donationType.value,
      sector: els.donationSector.value,
      amount,
      interval,
      currency,
      campaignName: campaign?.name,
      orgName: org?.name,
      description: campaign?.description,
      allowPromo: els.donationPromo.value === 'true',
      donor: {
        name: els.donationName.value,
        email: els.donationEmail.value,
        notes: els.donationNotes.value.trim() || undefined
      }
    };
    return payload;
  }

  function attachEvents() {
    els.prevSlide.addEventListener('click', () => prevSlide());
    els.nextSlide.addEventListener('click', () => { nextSlide(true); });
    resetAutoSlide();

    els.donationFaith.addEventListener('change', () => {
      setDonationTypeOptions(els.donationFaith.value);
      updateOrgOptions();
    });
    els.donationRegion.addEventListener('change', () => {
      updateOrgOptions();
    });
    els.donationOrg.addEventListener('change', async () => {
      handleOrgSelection();
      const orgId = els.donationOrg.value;
      await loadCampaigns(orgId);
      updateCampaignOptions(orgId);
    });
    els.donationCampaign.addEventListener('change', () => {
      const campaign = extractCampaignFromSelect();
      hydrateDonationTypesFromCampaign(campaign);
    });

    els.donationForm.addEventListener('submit', async event => {
      event.preventDefault();
      clearStatus(els.donationStatus);
      els.donationResult.hidden = true;
      try {
        const payload = prepareDonationPayload();
        setStatus(els.donationStatus, 'Generating Stripe checkout…');
        const data = await postJSON('/api/giving/payment-link', payload);
        const url = data?.url;
        if (!url) {
          throw new Error('Payment link not returned.');
        }
        setStatus(els.donationStatus, 'Payment link ready!', 'success');
        els.donationLink.href = url;
        els.donationLink.textContent = url;
        els.donationMeta.textContent = JSON.stringify(data.meta ?? payload, null, 2);
        els.donationResult.hidden = false;
        try {
          window.open(url, '_blank', 'noopener');
        } catch (err) {
          console.warn('Popup blocked', err);
        }
      } catch (err) {
        setStatus(els.donationStatus, err.message || 'Unable to generate payment link', 'error');
      }
    });

    els.setupOrgForm.addEventListener('submit', async event => {
      event.preventDefault();
      clearStatus(els.setupOrgStatus);
      try {
        const payload = {
          name: els.setupOrgName.value,
          region: els.setupOrgRegion.value,
          religion: els.setupOrgFaith.value,
          locales: els.setupOrgLocales.value.split(',').map(x => x.trim()).filter(Boolean),
          timezone: els.setupOrgTimezone.value || undefined,
          stripeAccountId: els.setupOrgStripe.value || undefined
        };
        setStatus(els.setupOrgStatus, 'Saving organization…');
        const data = await postJSON('/api/giving/organizations', payload);
        const org = data?.organization ?? data;
        if (!org?._id) {
          throw new Error('Organization was not returned.');
        }
        state.orgs.push(org);
        updateOrgOptions();
        setStatus(els.setupOrgStatus, `${org.name} is ready for donations.`, 'success');
        els.setupOrgForm.reset();
      } catch (err) {
        setStatus(els.setupOrgStatus, err.message || 'Unable to save organization', 'error');
      }
    });

    els.setupCampaignForm.addEventListener('submit', async event => {
      event.preventDefault();
      clearStatus(els.setupCampaignStatus);
      try {
        const orgId = els.setupCampaignOrg.value;
        if (!orgId) {
          throw new Error('Select an organization first.');
        }
        const donationTypes = els.setupCampaignTypes.value.split(',').map(x => x.trim()).filter(Boolean);
        const payload = {
          orgId,
          name: els.setupCampaignName.value,
          code: els.setupCampaignCode.value || undefined,
          donationTypes: donationTypes.length ? donationTypes : undefined
        };
        setStatus(els.setupCampaignStatus, 'Saving campaign…');
        const data = await postJSON('/api/giving/campaigns', payload);
        const campaign = data?.campaign ?? data;
        if (!campaign?._id) {
          throw new Error('Campaign was not returned.');
        }
        const list = state.campaignsByOrg.get(orgId) ?? [];
        list.push(campaign);
        state.campaignsByOrg.set(orgId, list);
        updateCampaignOptions(orgId);
        setStatus(els.setupCampaignStatus, `${campaign.name} is ready for donors.`, 'success');
        els.setupCampaignForm.reset();
      } catch (err) {
        setStatus(els.setupCampaignStatus, err.message || 'Unable to save campaign', 'error');
      }
    });
  }

  function setupManagementTabs() {
    const container = els.manageCard;
    if (!container) return;
    const buttons = Array.from(container.querySelectorAll('[data-tab-target]'));
    if (!buttons.length) return;
    const panels = new Map();
    buttons.forEach(button => {
      const targetId = button.dataset.tabTarget;
      if (targetId) {
        const panel = document.getElementById(targetId);
        if (panel) {
          panels.set(targetId, panel);
        }
      }
    });

    function activate(button) {
      const targetId = button.dataset.tabTarget;
      if (!targetId || !panels.has(targetId)) return;
      buttons.forEach(btn => {
        const isActive = btn === button;
        btn.classList.toggle('is-active', isActive);
        btn.setAttribute('aria-selected', String(isActive));
        btn.tabIndex = isActive ? 0 : -1;
      });
      panels.forEach((panel, id) => {
        const isActive = id === targetId;
        panel.hidden = !isActive;
        panel.classList.toggle('is-active', isActive);
      });
    }

    buttons.forEach((button, index) => {
      button.addEventListener('click', () => activate(button));
      button.addEventListener('keydown', event => {
        if (event.key !== 'ArrowRight' && event.key !== 'ArrowLeft') return;
        event.preventDefault();
        const offset = event.key === 'ArrowRight' ? 1 : -1;
        const nextIndex = (index + offset + buttons.length) % buttons.length;
        const nextButton = buttons[nextIndex];
        if (nextButton) {
          nextButton.focus();
          activate(nextButton);
        }
      });
    });

    const initial = buttons.find(btn => btn.classList.contains('is-active')) ?? buttons[0];
    if (initial) {
      activate(initial);
    }
  }

  function init() {
    renderSlides();
    if (typeof window !== 'undefined') {
      window.addEventListener('resize', () => updateTransitionOverlayForIndex(state.slideIndex));
    }
    renderSectors();
    populateRegionSelects();
    populateFaithSelects();
    populateSectorSelects();
    setDonationTypeOptions(els.donationFaith.value);
    setupManagementTabs();
    attachEvents();
    ensureDefaultOrganizations();
    updateOrgOptions();
    loadOrganizations();
    loadCommunityCampaigns();
    document.getElementById('year').textContent = new Date().getFullYear();
  }

  init();
</script>
</body>
</html>
