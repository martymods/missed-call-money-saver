<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Multi-Faith Giving Platform</title>
  <meta name="description" content="Give and manage faith-specific donations across every region with a single secure platform."/>
  <style>
    @font-face {
      font-family: 'Faithfully';
      src: url('fonts/Faithfully.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    :root {
      --bg: #f8f6f1;
      --bg-soft: #ffffff;
      --bg-glass: rgba(255, 255, 255, 0.75);
      --card: #ffffff;
      --ink: #1f2933;
      --muted: #5f6b7d;
      --accent: #d4a24c;
      --accent-2: #7a9d92;
      --accent-3: #e2c184;
      --danger: #d9534f;
      font-family: 'Faithfully', 'Inter', system-ui, -apple-system, 'Segoe UI', sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.92), transparent 55%), var(--bg);
      color: var(--ink);
      font: 16px/1.6 'Faithfully', 'Inter', system-ui, -apple-system, 'Segoe UI', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }

    img {
      max-width: 100%;
      display: block;
    }

    a {
      color: var(--accent);
    }

    a:hover {
      color: var(--accent-2);
    }

    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(255, 255, 255, 0.94);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(31, 41, 55, 0.08);
    }

    .mobile-app-bar {
      display: none;
    }

    .nav {
      width: min(100%, 1200px);
      margin: 0 auto;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 18px;
      justify-content: space-between;
      flex-wrap: wrap;
      color: var(--ink);
    }

    .brand {
      display: flex;
      align-items: baseline;
      gap: 10px;
      font-weight: 800;
      letter-spacing: 0.6px;
      text-transform: uppercase;
      color: var(--ink);
    }

    .brand span {
      font-size: 13px;
      color: var(--muted);
    }

    .nav a.btn {
      text-decoration: none;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 11px 18px;
      border-radius: 12px;
      font-weight: 700;
      color: #fff;
      background: linear-gradient(135deg, var(--accent), var(--accent-3));
      border: 1px solid rgba(212, 162, 76, 0.35);
      box-shadow: 0 10px 26px rgba(212, 162, 76, 0.25);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: box-shadow 0.2s ease, transform 0.2s ease;
      min-height: 48px;
      touch-action: manipulation;
    }

    .btn.liquid {
      padding: 0;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.85);
      border: 1px solid rgba(212, 162, 76, 0.5);
      box-shadow: 0 12px 30px rgba(225, 192, 128, 0.3);
      text-transform: uppercase;
      letter-spacing: 0.6px;
      min-width: 0;
    }

    .btn.liquid span {
      position: relative;
      z-index: 1;
      padding: 14px 36px;
      color: var(--ink);
    }

    .btn.liquid .liquid {
      position: absolute;
      inset: -80px 0 auto;
      height: 220px;
      background: linear-gradient(135deg, rgba(212, 162, 76, 0.65), rgba(226, 193, 132, 0.7), rgba(122, 157, 146, 0.65));
      background-size: 200% 200%;
      animation: holographicFlow 8s ease-in-out infinite;
      box-shadow: inset 0 0 40px rgba(255, 255, 255, 0.45);
      z-index: 0;
      transition: 0.6s ease;
    }

    .btn.liquid .liquid::after,
    .btn.liquid .liquid::before {
      content: '';
      position: absolute;
      width: 200%;
      height: 200%;
      top: 0;
      left: 0;
      transform: translate(-25%, -75%);
      border-radius: 45%;
    }

    .btn.liquid .liquid::after {
      background: rgba(255, 255, 255, 0.76);
      box-shadow: 0 0 12px 6px rgba(212, 162, 76, 0.45), inset 0 0 8px rgba(226, 193, 132, 0.42);
      animation: animate 5s linear infinite;
      opacity: 0.85;
    }

    .btn.liquid .liquid::before {
      background: rgba(255, 255, 255, 0.35);
      box-shadow: 0 0 12px rgba(226, 193, 132, 0.4), inset 0 0 6px rgba(226, 193, 132, 0.35);
      animation: animate 7s linear infinite;
    }

    .btn.liquid:hover .liquid {
      top: -140px;
    }

    .btn.liquid:hover {
      box-shadow: 0 0 8px rgba(212, 162, 76, 0.6), inset 0 0 6px rgba(212, 162, 76, 0.55);
      transform: translateY(-2px);
    }

    .btn.ghost {
      background: #fff;
      color: var(--accent);
      border-color: rgba(212, 162, 76, 0.35);
      box-shadow: none;
    }

    .btn.ghost:hover {
      background: rgba(212, 162, 76, 0.1);
      color: var(--ink);
    }

    main {
      width: min(100%, 1200px);
      margin: 0 auto;
      padding: 24px 18px 90px;
      display: grid;
      gap: 56px;
      flex: 1 0 auto;
    }

    .hero {
      display: grid;
      gap: 24px;
      align-items: center;
      grid-template-columns: minmax(0, 1fr);
    }

    .hero h1 {
      margin: 0;
      font-size: clamp(36px, 6vw, 58px);
      line-height: 1.1;
      font-weight: 900;
      letter-spacing: -0.5px;
    }

    .hero p {
      margin: 14px 0 26px;
      color: var(--muted);
      font-size: 18px;
      max-width: 580px;
    }

    .hero-media {
      position: relative;
      border-radius: 30px;
      overflow: hidden;
      background: var(--card);
      box-shadow: 0 18px 44px rgba(31, 41, 55, 0.15);
      min-height: 260px;
    }

    .hero-media:before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(212, 162, 76, 0.28), transparent 55%);
      pointer-events: none;
    }

    .hero-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 12px;
    }

    .hero-list li {
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(31, 41, 55, 0.05);
      border-radius: 16px;
      padding: 14px 16px;
      border: 1px solid rgba(31, 41, 55, 0.08);
      font-weight: 600;
      color: var(--ink);
    }

    .hero-list li span {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background: rgba(212, 162, 76, 0.18);
      color: var(--accent);
      font-weight: 700;
    }

    section h2 {
      margin: 0 0 18px;
      font-size: clamp(28px, 4vw, 36px);
      font-weight: 900;
      letter-spacing: -0.3px;
    }

    section p.lead {
      margin: 0 0 24px;
      color: var(--muted);
      max-width: 720px;
      font-size: 17px;
    }

    .region-slider {
      position: relative;
      background: var(--bg-soft);
      border-radius: 24px;
      border: 1px solid rgba(31, 41, 55, 0.12);
      overflow: hidden;
      box-shadow: 0 18px 38px rgba(31, 41, 55, 0.12);
      max-width: 960px;
      margin: 0 auto;
    }

    .region-track {
      display: flex;
      transition: transform 0.6s ease;
      width: 100%;
      position: relative;
      z-index: 0;
    }

    .region-transition {
      position: absolute;
      top: var(--transition-top, 0);
      left: var(--transition-left, 0);
      width: var(--transition-width, 100%);
      height: var(--transition-height, 100%);
      pointer-events: none;
      opacity: 0;
      z-index: 1;
      transition: opacity 0.28s ease;
      border-radius: inherit;
      overflow: hidden;
    }

    .region-transition.is-active {
      opacity: 1;
    }

    .transition-scene {
      position: absolute;
      inset: 0;
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
    }

    .region-transition.is-active .transition-scene[data-scene="current"] {
      animation: regionSceneDim var(--transition-duration, 1400ms) cubic-bezier(1, 0, 1, 1) forwards;
    }

    .transition-scene[data-scene="next"] {
      filter: brightness(0%);
      -webkit-mask-image: var(--transition-mask-image, none);
      mask-image: var(--transition-mask-image, none);
      -webkit-mask-size: 6%;
      mask-size: 6%;
      -webkit-mask-position: center;
      mask-position: center;
      -webkit-mask-repeat: no-repeat;
      mask-repeat: no-repeat;
    }

    .region-transition.is-active .transition-scene[data-scene="next"] {
      animation: regionSceneReveal var(--transition-duration, 1400ms) cubic-bezier(1, 0, 1, 1) forwards;
    }

    .region-slide {
      min-width: 100%;
      padding: 26px;
      display: grid;
      gap: 20px;
      grid-template-columns: minmax(280px, 1fr) minmax(260px, 0.8fr);
      grid-template-areas:
        'media meta'
        'curr tags';
      align-items: start;
    }

    .region-media {
      grid-area: media;
      position: relative;
      width: 100%;
      height: 220px;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 16px 28px rgba(31, 41, 55, 0.18);
    }

    .region-media::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      box-shadow: inset 0 0 0 1px rgba(31, 41, 55, 0.08);
      pointer-events: none;
    }

    .region-slide .region-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      will-change: transform;
      transform: scale(1.04);
      animation-duration: 14s;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
      animation-play-state: paused;
    }

    .region-slide.pan-up .region-image {
      animation-name: regionPanUp;
      transform-origin: center bottom;
    }

    .region-slide.pan-down .region-image {
      animation-name: regionPanDown;
      transform-origin: center top;
    }

    .region-slide.active .region-image {
      animation-play-state: running;
    }

    @keyframes regionPanUp {
      0% {
        transform: scale(1.05) translateY(12%);
      }
      100% {
        transform: scale(1.05) translateY(-12%);
      }
    }

    @keyframes regionPanDown {
      0% {
        transform: scale(1.05) translateY(-12%);
      }
      100% {
        transform: scale(1.05) translateY(12%);
      }
    }

    @keyframes regionSceneReveal {
      0% {
        filter: brightness(0%);
        -webkit-mask-size: 6%;
        mask-size: 6%;
      }
      12% {
        filter: brightness(55%);
        -webkit-mask-size: 12%;
        mask-size: 12%;
      }
      28% {
        filter: brightness(100%);
      }
      100% {
        filter: brightness(100%);
        -webkit-mask-size: 1600%;
        mask-size: 1600%;
      }
    }

    @keyframes regionSceneDim {
      0% {
        filter: brightness(100%);
      }
      100% {
        filter: brightness(40%);
      }
    }

    .region-meta {
      grid-area: meta;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .region-meta h3 {
      margin: 0;
      font-size: 26px;
      font-weight: 800;
      color: var(--ink);
    }

    .region-followers {
      display: inline-flex;
      flex-direction: column;
      gap: 4px;
      align-self: flex-start;
      padding: 12px 16px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.86);
      border: 1px solid rgba(31, 41, 55, 0.12);
      box-shadow: 0 12px 24px rgba(31, 41, 55, 0.12);
      max-width: 260px;
      min-width: 0;
    }

    .region-followers__label {
      font-size: 12px;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      color: var(--muted);
    }

    .region-followers__value {
      font-size: 22px;
      font-weight: 800;
      color: var(--ink);
      line-height: 1.1;
    }

    .region-followers--loading .region-followers__value {
      color: var(--muted);
    }

    .region-currencies {
      grid-area: curr;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-self: start;
    }

    .region-currencies__label {
      font-size: 15px;
      letter-spacing: 0.35px;
      color: var(--accent);
      text-transform: uppercase;
    }

    .region-currency-list {
      margin: 0;
      padding: 0;
      list-style: none;
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
    }

    .region-currency-item {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      padding: 12px 18px;
      border-radius: 16px;
      background: #ffffff;
      border: 1px solid rgba(31, 41, 55, 0.12);
      box-shadow: 0 10px 20px rgba(31, 41, 55, 0.15);
      justify-content: space-between;
      min-width: 220px;
      flex: 1 1 220px;
    }

    .region-currency-name {
      font-size: 15px;
      font-weight: 600;
      color: var(--ink);
    }

    .region-currency-image {
      width: 72px;
      height: 48px;
      border-radius: 10px;
      object-fit: contain;
      object-position: center;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(243, 246, 248, 0.9));
      box-shadow: inset 0 0 0 1px rgba(31, 41, 55, 0.12);
    }

    .region-currency-code {
      font-size: 14px;
      font-weight: 700;
      color: var(--accent);
      letter-spacing: 0.5px;
    }

    .region-tags {
      grid-area: tags;
      margin: 0;
      padding: 0;
      list-style: none;
      display: flex;
      flex-wrap: wrap;
      gap: 18px;
      align-self: start;
      perspective: 1000px;
      transform-style: preserve-3d;
    }

    .region-tag {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 0 18px;
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.92), rgba(214, 219, 229, 0.9), rgba(245, 246, 250, 0.95));
      background-size: 220% 220%;
      animation: regionTagSheen 9s ease-in-out infinite;
      border: 1px solid rgba(180, 188, 204, 0.4);
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.7), 0 12px 28px rgba(75, 89, 110, 0.18);
      color: var(--ink);
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.35px;
      line-height: 1.25;
      white-space: normal;
      transform: perspective(800px) rotateY(0deg) translateZ(0);
      transform-style: preserve-3d;
      transition: transform 0.5s ease, box-shadow 0.5s ease, background-position 0.6s ease, color 0.5s ease;
      overflow: hidden;
      gap: 6px;
    }

    .region-tag::after {
      content: '';
      position: absolute;
      inset: 10%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.95), transparent 65%);
      mix-blend-mode: screen;
      opacity: 0.8;
      transition: opacity 0.5s ease;
      pointer-events: none;
    }

    .region-tags:hover .region-tag,
    .region-tags:focus-within .region-tag,
    .region-tags:active .region-tag {
      transform: perspective(800px) rotateY(25deg);
    }

    .region-tag:hover,
    .region-tag:focus,
    .region-tag:active {
      background-position: 80% 20%;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.8), 0 18px 40px rgba(75, 89, 110, 0.24);
      color: var(--accent);
      transform: perspective(900px) rotateY(0deg) translateZ(16px);
    }

    .region-tag:hover::after,
    .region-tag:focus::after,
    .region-tag:active::after {
      opacity: 1;
    }

    .region-tag:hover ~ .region-tag,
    .region-tag:focus ~ .region-tag,
    .region-tag:active ~ .region-tag {
      transform: perspective(800px) rotateY(-25deg);
    }

    .region-tag-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    .region-tag-metric {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(22, 78, 99, 0.12);
      color: var(--accent);
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.45px;
      text-transform: uppercase;
      transition: opacity 0.3s ease;
    }

    .region-tag.region-tag--loading .region-tag-metric {
      opacity: 0.6;
      background: rgba(148, 163, 184, 0.18);
      color: rgba(15, 23, 42, 0.65);
    }

    @keyframes regionTagSheen {
      0%,
      100% {
        background-position: 15% 20%;
      }
      40% {
        background-position: 85% 80%;
      }
      70% {
        background-position: 25% 60%;
      }
    }

    .faith-identity {
      display: inline-flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 12px;
    }

    .faith-label {
      font-weight: 700;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      font-size: 13px;
      color: var(--accent);
    }

    .faith-symbol {
      position: relative;
      width: 66px;
      height: 66px;
      border-radius: 22px;
      background: linear-gradient(135deg, rgba(245, 214, 148, 0.95), rgba(255, 238, 207, 0.85), rgba(205, 220, 212, 0.9));
      background-size: 200% 200%;
      animation: holographicFlow 9s ease-in-out infinite;
      mask-image: var(--symbol-image);
      mask-repeat: no-repeat;
      mask-position: center;
      mask-size: 70%;
      -webkit-mask-image: var(--symbol-image);
      -webkit-mask-repeat: no-repeat;
      -webkit-mask-position: center;
      -webkit-mask-size: 70%;
      box-shadow: 0 12px 28px rgba(212, 162, 76, 0.32);
      transition: transform 0.18s ease, box-shadow 0.2s ease;
      transform: perspective(600px) rotateX(0deg) rotateY(0deg);
      transform-style: preserve-3d;
      pointer-events: auto;
    }

    .faith-symbol::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      box-shadow: inset 0 0 18px rgba(255, 255, 255, 0.25);
      opacity: 0.6;
      pointer-events: none;
    }

    .faith-symbol:hover {
      box-shadow: 0 16px 40px rgba(212, 162, 76, 0.35);
    }

    .slider-controls {
      position: absolute;
      inset: auto 0 18px 0;
      display: flex;
      justify-content: space-between;
      padding: 0 22px;
      pointer-events: none;
      z-index: 2;
    }

    .slider-btn {
      pointer-events: all;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      border: 1px solid rgba(31, 41, 55, 0.14);
      background: rgba(255, 255, 255, 0.9);
      color: var(--ink);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(31, 41, 55, 0.14);
    }

    .slider-btn:hover {
      background: var(--accent);
      color: #fff;
    }

    .slider-dots {
      position: absolute;
      left: 50%;
      bottom: 24px;
      transform: translateX(-50%);
      display: inline-flex;
      gap: 10px;
      z-index: 2;
    }

    .slider-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(31, 41, 55, 0.16);
      cursor: pointer;
    }

    .slider-dot.active {
      background: var(--accent);
    }

    .sector-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
    }

    .sector-card {
      background: var(--card);
      padding: 20px;
      border-radius: 18px;
      border: 1px solid rgba(31, 41, 55, 0.08);
      display: grid;
      gap: 10px;
      box-shadow: 0 12px 28px rgba(31, 41, 55, 0.12);
    }

    .sector-card h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 800;
      color: var(--ink);
    }

    .sector-card p {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    form {
      display: grid;
      gap: 18px;
    }

    .form-card {
      background: var(--card);
      border-radius: 24px;
      border: 1px solid rgba(31, 41, 55, 0.1);
      padding: 24px;
      box-shadow: 0 18px 40px rgba(31, 41, 55, 0.14);
    }

    .form-card h3 {
      margin: 0 0 14px;
      font-size: 22px;
      font-weight: 800;
    }

    .form-row {
      display: grid;
      gap: 16px;
    }

    .form-actions {
      display: flex;
      justify-content: flex-start;
      flex-wrap: wrap;
    }

    .form-actions .btn {
      min-width: 220px;
    }

    @media (min-width: 720px) {
      .form-row.double {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .form-row.triple {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    label {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.3px;
      color: var(--muted);
    }

    input, select, textarea {
      margin-top: 6px;
      border-radius: 14px;
      border: 1px solid rgba(31, 41, 55, 0.14);
      background: rgba(255, 255, 255, 0.9);
      color: var(--ink);
      padding: 12px;
      font-size: 16px;
      font-family: inherit;
    }

    input:focus, select:focus, textarea:focus {
      outline: 2px solid rgba(212, 162, 76, 0.55);
      outline-offset: 1px;
    }

    .status {
      border-radius: 16px;
      padding: 14px 16px;
      font-size: 14px;
      background: rgba(31, 41, 55, 0.04);
      border: 1px solid rgba(31, 41, 55, 0.12);
      color: var(--ink);
    }

    .status.success {
      background: rgba(122, 157, 146, 0.18);
      border-color: rgba(122, 157, 146, 0.5);
      color: #2f4f4f;
    }

    .status.error {
      background: rgba(217, 83, 79, 0.12);
      border-color: rgba(217, 83, 79, 0.4);
      color: #7a1d1a;
    }

    .status a {
      color: var(--accent);
      word-break: break-all;
    }

    .inline-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .nav .inline-actions {
      margin-left: auto;
    }

    .inline-actions .btn {
      flex: none;
    }

    .section-head {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 24px;
      flex-wrap: wrap;
    }

    .section-head .lead {
      margin-bottom: 0;
    }

    .community-grid {
      margin-top: 32px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 24px;
    }

    .community-card {
      background: var(--card);
      border-radius: 20px;
      overflow: hidden;
      border: 1px solid rgba(31, 41, 55, 0.1);
      display: flex;
      flex-direction: column;
      min-height: 100%;
      box-shadow: 0 20px 36px rgba(31, 41, 55, 0.14);
    }

    .manage-card {
      display: grid;
      gap: 24px;
    }

    .quick-stripe-section {
      display: grid;
      gap: 28px;
    }

    .quick-stripe-card {
      background: linear-gradient(145deg, rgba(212, 162, 76, 0.22), rgba(122, 157, 146, 0.18));
      border-radius: 28px;
      border: 1px solid rgba(212, 162, 76, 0.28);
      padding: 32px;
      display: grid;
      gap: 26px;
      box-shadow: 0 28px 46px rgba(31, 41, 55, 0.18);
      position: relative;
      overflow: hidden;
    }

    .quick-stripe-card::before {
      content: '';
      position: absolute;
      inset: -40% 35% auto -20%;
      height: 260px;
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.65), transparent 70%);
      opacity: 0.75;
      pointer-events: none;
    }

    .quick-stripe-card > * {
      position: relative;
      z-index: 1;
    }

    .quick-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding: 8px;
      border-radius: 18px;
      background: rgba(255, 255, 255, 0.4);
      border: 1px solid rgba(212, 162, 76, 0.32);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.45);
    }

    .quick-tabs .manage-tab {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 14px 18px;
      flex: 1 1 160px;
      background: transparent;
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
      color: var(--muted);
      border: 1px solid transparent;
    }

    .quick-tabs .manage-tab .quick-tab-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.6);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.65);
    }

    .quick-tabs .manage-tab svg {
      width: 20px;
      height: 20px;
    }

    .quick-tabs .manage-tab.is-active {
      color: #fff;
      border-color: rgba(255, 255, 255, 0.45);
      box-shadow: 0 18px 32px rgba(212, 162, 76, 0.35);
    }

    .quick-tabs .manage-tab.is-active .quick-tab-icon {
      background: rgba(255, 255, 255, 0.9);
    }

    .quick-panel {
      display: grid;
      gap: 24px;
    }

    .quick-faith-intro {
      display: flex;
      flex-wrap: wrap;
      gap: 16px 24px;
      align-items: center;
      justify-content: space-between;
    }

    .quick-faith-heading {
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.4px;
    }

    .quick-faith-heading span {
      display: block;
      font-size: 15px;
      font-weight: 500;
      color: rgba(31, 41, 55, 0.75);
    }

    .quick-faith-icon {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.65);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }

    .quick-faith-icon svg {
      width: 38px;
      height: 38px;
    }

    .quick-amounts {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    }

    .quick-amount {
      border: 1px solid rgba(31, 41, 55, 0.08);
      border-radius: 18px;
      padding: 18px;
      background: rgba(255, 255, 255, 0.75);
      font-weight: 700;
      display: grid;
      gap: 6px;
      justify-items: start;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    }

    .quick-amount span {
      font-size: 13px;
      font-weight: 500;
      color: var(--muted);
    }

    .quick-amount.is-selected {
      transform: translateY(-2px);
      box-shadow: 0 16px 28px rgba(31, 41, 55, 0.18);
      border-color: rgba(212, 162, 76, 0.55);
    }

    .quick-slider-wrapper {
      display: grid;
      gap: 12px;
    }

    .quick-slider-hint {
      font-size: 13px;
      color: rgba(31, 41, 55, 0.68);
      margin: -6px 0 10px;
    }

    .quick-slider-track {
      position: relative;
      width: 100%;
      height: 12px;
      background: rgba(255, 255, 255, 0.55);
      border-radius: 999px;
      border: 1px solid rgba(31, 41, 55, 0.08);
      overflow: hidden;
    }

    .quick-slider-progress {
      position: absolute;
      inset: 0 auto 0 0;
      width: 0%;
      background: linear-gradient(117deg, rgba(212, 162, 76, 0.95) 0%, rgba(122, 157, 146, 0.95) 100%);
      border-radius: inherit;
      transition: width 0.2s ease;
    }

    .quick-slider-thumb {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 72px;
      height: 48px;
      border-radius: 999px;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.92);
      border: 2px solid rgba(212, 162, 76, 0.45);
      box-shadow:
        0 0 0 3px rgba(255, 255, 255, 0.55),
        0 12px 28px rgba(31, 41, 55, 0.22);
      overflow: hidden;
      transition: transform 0.18s ease, background 0.18s ease, box-shadow 0.18s ease;
    }

    .quick-slider-thumb::before,
    .quick-slider-thumb::after {
      content: '';
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .quick-slider-thumb::before {
      background: rgba(255, 255, 255, 0.2);
    }

    .quick-slider-thumb::after {
      background: linear-gradient(135deg, rgba(212, 162, 76, 0.35), rgba(122, 157, 146, 0.28));
      mix-blend-mode: screen;
    }

    .quick-slider-thumb-filter,
    .quick-slider-thumb-overlay,
    .quick-slider-thumb-specular {
      position: absolute;
      inset: 0;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .quick-slider-thumb-filter {
      backdrop-filter: blur(0.6px);
      -webkit-backdrop-filter: blur(0.6px);
      filter: url(#quick-liquid-lens);
    }

    .quick-slider-thumb-overlay {
      background: rgba(255, 255, 255, 0.1);
    }

    .quick-slider-thumb-specular {
      border-radius: inherit;
      box-shadow:
        inset 1px 1px 0 rgba(212, 162, 76, 0.22),
        inset 1px 3px 0 rgba(28, 63, 90, 0.08),
        inset 0 0 22px rgba(255, 255, 255, 0.6),
        inset -1px -1px 0 rgba(212, 162, 76, 0.18);
    }

    .quick-slider-thumb.active {
      transform: translate(-50%, -50%) scale(1.04);
      box-shadow:
        0 0 0 4px rgba(212, 162, 76, 0.22),
        0 18px 38px rgba(31, 41, 55, 0.32);
      background: rgba(255, 255, 255, 0.78);
    }

    .quick-slider-thumb.active .quick-slider-thumb-filter,
    .quick-slider-thumb.active .quick-slider-thumb-overlay,
    .quick-slider-thumb.active .quick-slider-thumb-specular {
      opacity: 1;
    }

    .quick-slider-value {
      font-size: 14px;
      font-weight: 600;
      color: rgba(31, 41, 55, 0.8);
    }

    .quick-summary {
      display: flex;
      flex-wrap: wrap;
      gap: 16px 24px;
      align-items: center;
      justify-content: space-between;
      padding: 18px 20px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.6);
      border: 1px solid rgba(31, 41, 55, 0.08);
    }

    .quick-summary strong {
      font-size: 18px;
    }

    .quick-summary span {
      color: var(--muted);
      font-size: 14px;
    }

    .quick-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px 20px;
      width: 100%;
      margin-top: 4px;
    }

    .quick-metric {
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding: 12px 14px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.04);
      border: 1px solid rgba(15, 23, 42, 0.08);
      min-height: 68px;
    }

    .quick-metric-label {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.35px;
      color: rgba(15, 23, 42, 0.72);
      text-transform: uppercase;
    }

    .quick-metric-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent);
      letter-spacing: 0.4px;
    }

    .quick-metric.is-loading .quick-metric-value {
      color: rgba(15, 23, 42, 0.6);
    }

    .quick-metrics-updated {
      font-size: 12px;
      color: rgba(15, 23, 42, 0.6);
      letter-spacing: 0.3px;
      flex-basis: 100%;
      text-align: right;
      margin-top: -4px;
    }

    .quick-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: flex-end;
    }

    .quick-status-block {
      display: grid;
      gap: 10px;
      width: 100%;
    }

    .quick-result {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .quick-result a {
      color: var(--accent);
      font-weight: 600;
      word-break: break-all;
      text-decoration: none;
    }

    .quick-result a:hover {
      text-decoration: underline;
    }

    .quick-copy {
      padding: 8px 14px;
      border-radius: 12px;
      border: 1px solid rgba(212, 162, 76, 0.4);
      background: rgba(255, 255, 255, 0.92);
      color: var(--accent);
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .quick-copy:hover:not(:disabled) {
      background: rgba(212, 162, 76, 0.12);
      color: var(--ink);
    }

    .quick-copy:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .manage-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 6px;
      border-radius: 18px;
      background: rgba(212, 162, 76, 0.08);
      border: 1px solid rgba(212, 162, 76, 0.24);
    }

    .manage-tab {
      flex: 1 1 160px;
      border: none;
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
    }

    .manage-tab:focus-visible {
      outline: 2px solid rgba(212, 162, 76, 0.55);
      outline-offset: 2px;
    }

    .manage-tab.is-active {
      background: linear-gradient(135deg, rgba(212, 162, 76, 0.85), rgba(122, 157, 146, 0.65));
      color: #fff;
      box-shadow: 0 12px 24px rgba(212, 162, 76, 0.26);
    }

    .tab-panels {
      position: relative;
    }

    .tab-panel {
      display: grid;
      gap: 18px;
      animation: fadeIn 0.35s ease;
    }

    .tab-panel[hidden] {
      display: none;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .community-media {
      position: relative;
      width: 100%;
      padding-top: 60%;
      background: linear-gradient(135deg, rgba(244, 220, 184, 0.65), rgba(218, 229, 223, 0.6));
    }

    .community-media img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .community-initial {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      font-weight: 700;
      letter-spacing: 1px;
      color: rgba(31, 41, 55, 0.35);
      text-transform: uppercase;
    }

    .community-body {
      padding: 22px 22px 24px;
      display: grid;
      gap: 14px;
    }

    .community-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 12px;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      color: var(--muted);
    }

    .community-meta span {
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(31, 41, 55, 0.06);
    }

    .community-body h3 {
      margin: 0;
      font-size: 20px;
      line-height: 1.3;
    }

    .community-body p {
      margin: 0;
      color: var(--muted);
      font-size: 15px;
    }

    .community-progress {
      display: grid;
      gap: 10px;
    }

    .progress-bar {
      height: 8px;
      border-radius: 999px;
      background: rgba(31, 41, 55, 0.1);
      overflow: hidden;
    }

    .progress-bar div {
      height: 100%;
      border-radius: inherit;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
    }

    .progress-meta {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      color: var(--muted);
    }

    .community-actions {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .community-actions .btn {
      flex: none;
    }

    .community-profile {
      font-size: 13px;
      color: var(--muted);
    }

    .community-status {
      font-size: 12px;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      color: var(--muted);
    }

    .community-status.goal-met {
      color: var(--accent-2);
    }

    footer {
      margin-top: 60px;
      padding: 40px 0 60px;
      text-align: center;
      color: var(--muted);
      font-size: 14px;
      border-top: 1px solid rgba(31, 41, 55, 0.1);
      background: rgba(255, 255, 255, 0.9);
    }

    @media (max-width: 900px) {
      .nav {
        padding: 16px;
        gap: 14px;
      }

      .inline-actions {
        width: 100%;
        justify-content: flex-start;
      }
    }

    @media (max-width: 720px) {
      main {
        padding: 20px 16px 70px;
        gap: 42px;
      }

      .hero {
        gap: 18px;
      }

      .hero h1 {
        font-size: clamp(30px, 9vw, 44px);
      }

      .hero p {
        font-size: 16px;
        margin: 12px 0 20px;
      }

      .quick-stripe-card {
        padding: 24px;
        border-radius: 22px;
      }

      .quick-tabs {
        gap: 6px;
      }

      .quick-tabs .manage-tab {
        flex: 1 1 140px;
        font-size: 13px;
        padding: 12px 14px;
      }

      .quick-faith-heading {
        flex-direction: column;
        align-items: flex-start;
      }

      .quick-faith-icon {
        width: 52px;
        height: 52px;
      }

      .quick-faith-icon svg {
        width: 30px;
        height: 30px;
      }

      .quick-amounts {
        grid-template-columns: 1fr;
      }

      .quick-summary {
        flex-direction: column;
        align-items: flex-start;
        gap: 18px;
      }

      .quick-metrics {
        grid-template-columns: 1fr;
      }

      .quick-metrics-updated {
        text-align: left;
        margin-top: 0;
      }

      .hero-media {
        border-radius: 22px;
        min-height: 220px;
      }

      .hero-list li {
        font-size: 15px;
        align-items: flex-start;
      }

      .section-head {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }

      .region-slide {
        padding: 20px;
        grid-template-columns: 1fr;
        grid-template-areas:
          'media'
          'meta'
          'curr'
          'tags';
      }

      .region-meta h3 {
        font-size: 22px;
      }

      .region-currencies {
        gap: 10px;
      }

      .region-currency-list {
        gap: 12px;
      }

      .region-currency-item {
        width: 100%;
        justify-content: space-between;
      }

      .region-tags {
        justify-content: center;
      }

      .region-tag {
        width: 120px;
        height: 120px;
        padding: 0 16px;
      }

      .sector-grid {
        grid-template-columns: 1fr;
      }

      .community-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 600px) {
      header {
        position: sticky;
      }

      .region-tags {
        grid-template-columns: 1fr;
      }

      .nav {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }

      .brand {
        justify-content: space-between;
        width: 100%;
      }

      .inline-actions,
      .nav .btn,
      .inline-actions .btn {
        width: 100%;
      }

      .inline-actions {
        flex-direction: column;
        gap: 10px;
      }

      .btn {
        width: 100%;
      }

      .form-card {
        padding: 20px;
      }

      .form-actions {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }

      .form-actions .btn {
        min-width: 0;
      }

      .community-actions {
        flex-direction: column;
        align-items: stretch;
      }

      .community-actions .btn {
        width: 100%;
      }

      .slider-controls {
        padding: 0 16px;
        bottom: 12px;
      }

      .slider-btn {
        width: 36px;
        height: 36px;
      }

      .slider-dots {
        bottom: 12px;
      }

      footer {
        padding: 30px 0 40px;
      }
    }

    .result-block {
      margin-top: 12px;
      padding: 16px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.12);
      display: grid;
      gap: 8px;
    }

    .result-block pre {
      margin: 0;
      font-family: "JetBrains Mono", Consolas, monospace;
      font-size: 12px;
      color: var(--muted);
      white-space: pre-wrap;
      word-break: break-word;
    }

    .empty-note {
      color: var(--muted);
      font-size: 14px;
    }

    @keyframes animate {
      0% {
        transform: translate(-25%, -75%) rotate(0);
      }
      100% {
        transform: translate(-25%, -75%) rotate(360deg);
      }
    }

    @keyframes holographicFlow {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    @media (max-width: 720px) {
      .nav {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
      }

      .nav .inline-actions {
        width: 100%;
        justify-content: center;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      }

      .hero {
        text-align: center;
      }

      .hero .inline-actions {
        justify-content: center;
      }

      .form-card {
        padding: 22px;
      }

      .form-actions {
        justify-content: center;
      }

      .form-actions .btn {
        width: min(100%, 320px);
      }
    }

    @media (max-width: 540px) {
      .manage-tabs {
        gap: 10px;
      }

      .manage-tab {
        flex: 1 1 100%;
        text-align: center;
      }
    }

    @media (min-width: 960px) {
      main {
        gap: 72px;
      }

      .hero {
        grid-template-columns: minmax(0, 1.05fr) minmax(0, 0.95fr);
        gap: 36px;
      }

      .region-media {
        height: 260px;
      }
    }

    @media (min-width: 1280px) {
      main {
        padding: 60px 32px 140px;
        gap: 96px;
      }

      .hero {
        grid-template-columns: 1.1fr 0.9fr;
      }
    }

    @media (max-width: 640px) {
      .hero-media {
        min-height: 200px;
      }

      .region-slide {
        padding: 20px;
      }

      .slider-controls {
        display: none;
      }
    }

    @media screen and (max-width: 430px) {
      body {
        font-size: 17px;
        line-height: 1.65;
        touch-action: manipulation;
      }

      header {
        border-bottom-width: 0;
      }

      .nav {
        padding: 14px 16px;
        gap: 12px;
      }

      .brand {
        gap: 8px;
      }

      .brand strong {
        font-size: 20px;
      }

      .brand span {
        font-size: 13px;
      }

      main {
        padding: 18px 16px 64px;
        gap: 36px;
      }

      .inline-actions {
        gap: 12px;
      }

      .inline-actions .btn,
      .nav .btn,
      .btn {
        font-size: 16px;
        padding: 13px 16px;
      }

      .hero {
        gap: 16px;
        text-align: left;
      }

      .hero h1 {
        font-size: clamp(30px, 9vw, 40px);
      }

      .hero p {
        font-size: 17px;
        margin-bottom: 18px;
      }

      .hero-media {
        margin: 0 -4px;
        border-radius: 20px;
        min-height: 210px;
      }

      .hero-list {
        gap: 10px;
      }

      .hero-list li {
        font-size: 16px;
        padding: 12px 14px;
      }

      .section-head {
        gap: 14px;
      }

      .region-slider {
        margin-inline: -2px;
        border-radius: 20px;
      }

      .region-slide {
        padding: 18px;
        gap: 16px;
      }

      .region-meta h3 {
        font-size: 21px;
      }

      .region-meta p {
        font-size: 16px;
      }

      .region-currencies {
        gap: 12px;
      }

      .region-currency-list {
        gap: 10px;
      }

      .region-currency-item {
        flex: 1 1 calc(50% - 10px);
        min-width: 0;
        padding: 12px 14px;
      }

      .region-currency-image {
        width: 60px;
        height: 42px;
      }

      .region-tags {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }

      .region-tag {
        width: 100%;
        height: auto;
        border-radius: 20px;
        padding: 16px 18px;
        flex-direction: row;
        justify-content: flex-start;
        text-align: left;
        gap: 12px;
      }

      .region-tag::after {
        inset: 14%;
      }

      .region-tag-label {
        font-size: 14px;
      }

      .region-tag-metric {
        align-self: flex-start;
        font-size: 12px;
      }

      .sector-grid,
      .community-grid {
        gap: 20px;
      }

      .quick-stripe-card {
        padding: 22px 18px;
        border-radius: 20px;
        gap: 22px;
      }

      .quick-tabs {
        flex-direction: column;
        gap: 8px;
      }

      .quick-tabs .manage-tab {
        width: 100%;
      }

      .quick-faith-intro {
        gap: 12px;
        align-items: flex-start;
      }

      .quick-faith-heading {
        font-size: 18px;
        align-items: flex-start;
        gap: 10px;
      }

      .quick-faith-heading span {
        font-size: 14px;
      }

      .quick-faith-icon {
        width: 52px;
        height: 52px;
      }

      .quick-summary {
        padding: 16px;
        gap: 14px;
      }

      .quick-summary strong {
        font-size: 17px;
      }

      .quick-metrics {
        gap: 10px;
      }

      .quick-actions {
        width: 100%;
        justify-content: stretch;
      }

      .quick-actions .btn,
      .form-actions .btn {
        width: 100%;
      }

      .manage-tabs {
        flex-direction: column;
      }

      .manage-tab {
        width: 100%;
      }

      .form-card {
        padding: 20px 18px;
      }

      .form-row {
        gap: 14px;
      }

      footer {
        padding: 30px 0 50px;
        font-size: 13px;
      }
    }

    @media (max-width: 760px) {
      body {
        background: linear-gradient(160deg, rgba(248, 246, 241, 0.96) 0%, rgba(226, 193, 132, 0.32) 45%, rgba(122, 157, 146, 0.28) 100%);
      }

      header {
        display: none;
      }

      .mobile-app-bar {
        position: sticky;
        top: 0;
        z-index: 120;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 18px;
        margin: 0 16px;
        border-radius: 18px;
        background: rgba(255, 255, 255, 0.85);
        border: 1px solid rgba(212, 162, 76, 0.35);
        box-shadow: 0 16px 28px rgba(31, 41, 55, 0.14);
        backdrop-filter: blur(10px);
      }

      .mobile-brand {
        display: flex;
        flex-direction: column;
        gap: 4px;
        font-weight: 800;
        letter-spacing: 0.5px;
        color: var(--ink);
        text-transform: uppercase;
      }

      .mobile-brand span:last-child {
        font-size: 12px;
        color: var(--muted);
        font-weight: 600;
        letter-spacing: 0.35px;
      }

      .mobile-cta {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 11px 20px;
        border-radius: 999px;
        font-weight: 700;
        text-decoration: none;
        color: var(--ink);
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(212, 162, 76, 0.5);
        background: rgba(255, 255, 255, 0.86);
      }

      .mobile-cta::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, rgba(212, 162, 76, 0.6), rgba(226, 193, 132, 0.55), rgba(122, 157, 146, 0.5));
        opacity: 0.8;
        mix-blend-mode: multiply;
        animation: holographicFlow 8s ease-in-out infinite;
      }

      .mobile-cta span {
        position: relative;
        z-index: 1;
      }

      main {
        padding: 18px 0 90px;
        gap: 32px;
        background: transparent;
      }

      main > section {
        margin: 0 16px;
        border-radius: 26px;
        padding: 28px 24px;
        background: rgba(255, 255, 255, 0.82);
        border: 1px solid rgba(212, 162, 76, 0.25);
        box-shadow: 0 30px 56px rgba(31, 41, 55, 0.18);
        position: relative;
        overflow: hidden;
      }

      main > section::before {
        content: '';
        position: absolute;
        inset: -30% 35% auto -20%;
        height: 220px;
        background: radial-gradient(circle at top, rgba(212, 162, 76, 0.35), transparent 70%);
        opacity: 0.6;
        pointer-events: none;
      }

      main > section > * {
        position: relative;
        z-index: 1;
      }

      .hero {
        display: grid;
        gap: 26px;
        background: linear-gradient(145deg, rgba(212, 162, 76, 0.18), rgba(122, 157, 146, 0.2));
        border: 1px solid rgba(212, 162, 76, 0.35);
        box-shadow: 0 28px 48px rgba(122, 157, 146, 0.22);
      }

      .hero::before {
        inset: -30% 10% auto -40%;
      }

      .hero h1 {
        font-size: clamp(30px, 9vw, 40px);
        line-height: 1.15;
      }

      .hero p {
        font-size: 17px;
        color: rgba(31, 41, 55, 0.75);
      }

      .hero .inline-actions {
        display: grid;
        gap: 12px;
      }

      .hero .inline-actions .btn {
        width: 100%;
      }

      .hero-media {
        background: transparent;
        box-shadow: none;
        border-radius: 20px;
        padding: 4px 0;
      }

      .hero-list {
        display: flex;
        gap: 14px;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        padding-bottom: 6px;
      }

      .hero-list li {
        min-width: 240px;
        scroll-snap-align: start;
        background: rgba(255, 255, 255, 0.92);
        border: 1px solid rgba(31, 41, 55, 0.08);
        box-shadow: 0 16px 30px rgba(31, 41, 55, 0.18);
      }

      .quick-stripe-section {
        display: grid;
        gap: 24px;
      }

      .quick-stripe-section .lead {
        font-size: 16px;
      }

      .quick-tabs {
        overflow-x: auto;
        padding: 6px;
        gap: 10px;
        scroll-snap-type: x mandatory;
      }

      .quick-tabs .manage-tab {
        flex: 0 0 160px;
        scroll-snap-align: start;
        background: rgba(255, 255, 255, 0.72);
        border-radius: 18px;
        border: 1px solid rgba(212, 162, 76, 0.3);
      }

      .quick-panel {
        background: rgba(255, 255, 255, 0.82);
        border-radius: 22px;
        padding: 22px;
        box-shadow: inset 0 0 0 1px rgba(212, 162, 76, 0.2);
      }

      .quick-summary {
        border-radius: 20px;
        padding: 16px 18px;
        background: rgba(248, 246, 241, 0.85);
        box-shadow: inset 0 0 0 1px rgba(212, 162, 76, 0.2);
      }

      .region-slider {
        margin: 0;
        border-radius: 26px;
        box-shadow: 0 30px 50px rgba(31, 41, 55, 0.2);
      }

      .region-slide {
        gap: 18px;
        padding: 22px;
      }

      .region-media {
        border-radius: 22px;
        height: 200px;
      }

      .region-currency-list {
        flex-direction: column;
      }

      .region-currency-item {
        width: 100%;
      }

      .region-tags {
        justify-content: stretch;
        gap: 16px;
      }

      .region-tag {
        width: 100%;
        border-radius: 18px;
        flex-direction: row;
        height: auto;
        padding: 18px;
        justify-content: space-between;
      }

      .sector-grid,
      .community-grid {
        gap: 18px;
      }

      .form-card {
        padding: 22px;
        border-radius: 24px;
        background: rgba(255, 255, 255, 0.86);
        box-shadow: 0 24px 44px rgba(31, 41, 55, 0.18);
      }

      .form-actions {
        gap: 16px;
        flex-direction: column;
      }

      .form-actions .btn {
        width: 100%;
        min-width: 0;
      }

      footer {
        margin: 40px 0 30px;
        padding: 24px 16px;
        font-size: 13px;
        border: none;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 20px;
        box-shadow: 0 18px 40px rgba(31, 41, 55, 0.16);
        width: calc(100% - 32px);
        margin-left: auto;
        margin-right: auto;
      }
    }
  </style>
</head>
<body>
<header>
  <nav class="nav">
    <div class="brand">
      <strong>New Bright Water</strong>
      <span>Multi-faith giving platform</span>
    </div>
    <div class="inline-actions">
      <a class="btn ghost" href="#regions">Explore regions</a>
      <a class="btn liquid" href="#give">
        <span>Start giving</span>
        <div class="liquid"></div>
      </a>
      <a class="btn ghost" href="multifaith-campaign-create.html">Start receiving</a>
    </div>
  </nav>
</header>

<div class="mobile-app-bar">
  <div class="mobile-brand">
    <span>New Bright Water</span>
    <span>Giving Platform</span>
  </div>
  <a class="mobile-cta" href="#give">
    <span>Start</span>
  </a>
</div>

<main>
  <section class="hero">
    <div>
      <h1>One place to give, across every faith community.</h1>
      <p>Launch fully-configured donation flows for churches, mosques, synagogues, temples, and sanghas in minutes. No waiting for a build plan—connect your organizations, publish campaigns, and accept gifts right now.</p>
      <div class="inline-actions">
        <a class="btn liquid" href="#give">
          <span>Create a donation</span>
          <div class="liquid"></div>
        </a>
        <a class="btn ghost" href="#manage">Manage organizations</a>
        <a class="btn ghost" href="multifaith-campaign-create.html">Share my story</a>
      </div>
    </div>
    <div class="hero-media">
      <ul class="hero-list">
        <li><span>1</span> Multi-region currency, tax, and receipt language out of the box.</li>
        <li><span>2</span> Faith-specific donation types with calculators and metadata.</li>
        <li><span>3</span> Instant Stripe Payment Links you can share the moment you hit submit.</li>
      </ul>
    </div>
  </section>

  <section id="quick-stripe" class="quick-stripe-section">
    <h2>Quick Stripe payment lanes</h2>
    <p class="lead">Drop into a tradition, lock in a preset gift, and spin up a secure Stripe checkout without any typing. Pick a lane, tune the amplifier, and tap the button to move funds right now.</p>
    <div class="quick-stripe-card">
      <div class="quick-tabs" role="tablist" aria-label="Faith traditions for instant payments">
        <button class="manage-tab is-active" type="button" role="tab" aria-selected="true" aria-controls="quick-panel" id="quick-tab-christian" data-faith="christian">
          <span class="quick-tab-icon" aria-hidden="true">
            <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" focusable="false">
              <g fill="none" stroke="currentColor" stroke-width="6" stroke-linecap="round" stroke-linejoin="round">
                <path d="M32 8v48"/>
                <path d="M18 20h28"/>
              </g>
            </svg>
          </span>
          Christian
        </button>
        <button class="manage-tab" type="button" role="tab" aria-selected="false" aria-controls="quick-panel" id="quick-tab-islam" data-faith="islam">
          <span class="quick-tab-icon" aria-hidden="true">
            <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" focusable="false">
              <path d="M40 8a20 20 0 1 0 0 48 22 22 0 1 1 0-48z" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="m46 32 10 4-10 4 6 9-10-4-2 11-2-11-10 4 6-9-10-4 10-4-6-9 10 4 2-11 2 11 10-4z" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          Islamic
        </button>
        <button class="manage-tab" type="button" role="tab" aria-selected="false" aria-controls="quick-panel" id="quick-tab-jewish" data-faith="jewish">
          <span class="quick-tab-icon" aria-hidden="true">
            <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" focusable="false">
              <path d="m32 6 10 18h-20l10-18zm0 52-10-18h20l-10 18zm-22-18 10-18 10 18H10zm44 0H34l10-18 10 18z" fill="none" stroke="currentColor" stroke-width="4" stroke-linejoin="round"/>
            </svg>
          </span>
          Jewish
        </button>
        <button class="manage-tab" type="button" role="tab" aria-selected="false" aria-controls="quick-panel" id="quick-tab-hindu" data-faith="hindu">
          <span class="quick-tab-icon" aria-hidden="true">
            <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" focusable="false">
              <path d="M20 24c0-6.627 5.373-12 12-12s12 5.373 12 12-5.373 12-12 12" fill="none" stroke="currentColor" stroke-width="4"/>
              <path d="M32 36c-6 0-11 3.582-11 8s5 8 11 8 11-3.582 11-8" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
              <path d="M30 18c0-3.314 2.239-6 5-6 2.209 0 4 1.791 4 4 0 1.657-1.343 3-3 3" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
              <path d="M14 24h12M38 24h12" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            </svg>
          </span>
          Hindu
        </button>
        <button class="manage-tab" type="button" role="tab" aria-selected="false" aria-controls="quick-panel" id="quick-tab-buddhist" data-faith="buddhist">
          <span class="quick-tab-icon" aria-hidden="true">
            <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" focusable="false">
              <circle cx="32" cy="32" r="8" fill="none" stroke="currentColor" stroke-width="4"/>
              <g fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round">
                <path d="M32 8v10"/>
                <path d="M32 46v10"/>
                <path d="M8 32h10"/>
                <path d="M46 32h10"/>
                <path d="m14 14 7 7"/>
                <path d="m43 43 7 7"/>
                <path d="m14 50 7-7"/>
                <path d="m43 21 7-7"/>
              </g>
            </svg>
          </span>
          Buddhist
        </button>
      </div>
      <div class="quick-panel" id="quick-panel" role="tabpanel" aria-labelledby="quick-tab-christian">
        <div class="quick-faith-intro">
          <div class="quick-faith-heading">
            <div class="quick-faith-icon" id="quick-faith-icon" aria-hidden="true">
              <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <g fill="none" stroke="currentColor" stroke-width="6" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M32 8v48"/>
                  <path d="M18 20h28"/>
                </g>
              </svg>
            </div>
            <div>
              <strong id="quick-faith-title">Christian ministries</strong>
              <span id="quick-faith-subtitle">Direct support for parish life, community meals, and global missions.</span>
            </div>
          </div>
          <div class="quick-slider-value">Multiplier: <span id="quick-multiplier-label">1.0×</span></div>
        </div>
        <div class="quick-amounts" id="quick-amounts">
          <button class="quick-amount is-selected" type="button" data-index="0">
            <strong id="quick-amount-0">$75</strong>
            <span id="quick-amount-desc-0">Launch midweek meals</span>
          </button>
          <button class="quick-amount" type="button" data-index="1">
            <strong id="quick-amount-1">$150</strong>
            <span id="quick-amount-desc-1">Fuel regional outreach</span>
          </button>
          <button class="quick-amount" type="button" data-index="2">
            <strong id="quick-amount-2">$300</strong>
            <span id="quick-amount-desc-2">Underwrite community care</span>
          </button>
        </div>
        <div class="quick-slider-wrapper">
          <div class="quick-slider-track" id="quick-slider" role="slider" aria-valuemin="75" aria-valuemax="250" aria-valuenow="100" aria-label="Donation multiplier" aria-describedby="quick-slider-hint" tabindex="0">
            <div class="quick-slider-progress" id="quick-slider-progress"></div>
            <div class="quick-slider-thumb" id="quick-slider-thumb">
              <div class="quick-slider-thumb-filter"></div>
              <div class="quick-slider-thumb-overlay"></div>
              <div class="quick-slider-thumb-specular"></div>
            </div>
          </div>
        </div>
        <p class="quick-slider-hint" id="quick-slider-hint">Drag the glowing handle to raise or soften your multiplier.</p>
        <div class="quick-summary">
          <div>
            <strong id="quick-total">$225 ready for checkout</strong>
            <span id="quick-total-detail">Split across worship, meals, and relief in this lane.</span>
          </div>
          <div class="quick-metrics" id="quick-metrics">
            <div class="quick-metric is-loading" data-role="followers">
              <span class="quick-metric-label" id="quick-metric-followers-label">Global adherents</span>
              <span class="quick-metric-value" id="quick-metric-followers">Loading metrics…</span>
            </div>
            <div class="quick-metric is-loading" data-role="actions">
              <span class="quick-metric-label" id="quick-metric-actions-label">Active community projects</span>
              <span class="quick-metric-value" id="quick-metric-actions">Loading metrics…</span>
            </div>
          </div>
          <div class="quick-metrics-updated" id="quick-metrics-updated">Metrics loading…</div>
          <div class="quick-actions">
            <button class="btn liquid" type="button" id="quick-generate">
              <span>Generate secure checkout</span>
              <div class="liquid"></div>
            </button>
            <button class="btn liquid" type="button" id="quick-share">
              <span>Create a donation link</span>
              <div class="liquid"></div>
            </button>
          </div>
          <div class="quick-status-block">
            <div class="status" id="quick-status" role="status" hidden></div>
            <div class="quick-result" id="quick-result" hidden>
              <a id="quick-link" href="#" target="_blank" rel="noreferrer noopener"></a>
              <button class="quick-copy" type="button" id="quick-copy">Copy link</button>
            </div>
          </div>
        </div>
      </div>
      <svg width="0" height="0" aria-hidden="true">
        <filter id="quick-liquid-lens" x="-50%" y="-50%" width="200%" height="200%">
          <feImage x="0" y="0" result="normalMap" xlink:href="data:image/svg+xml;utf8,&lt;svg xmlns='http://www.w3.org/2000/svg' width='300' height='300'&gt;&lt;radialGradient id='invmap' cx='50%' cy='50%' r='75%'&gt;&lt;stop offset='0%' stop-color='rgb(128,128,255)'/&gt;&lt;stop offset='90%' stop-color='rgb(255,255,255)'/&gt;&lt;/radialGradient&gt;&lt;rect width='100%' height='100%' fill='url(#invmap)'/&gt;&lt;/svg>"/>
          <feDisplacementMap in="SourceGraphic" in2="normalMap" scale="-220" xChannelSelector="R" yChannelSelector="G" result="displaced"/>
          <feMerge>
            <feMergeNode in="displaced"/>
          </feMerge>
        </filter>
      </svg>
    </div>
  </section>

  <section id="regions">
    <h2>Regional gallery</h2>
    <p class="lead">Preview the localized experience for every launch territory. Each slide shows live copy, receipt preferences, and sector highlights donors will see.</p>
    <div class="region-slider">
      <div class="region-track" id="region-track"></div>
      <div class="region-transition" id="region-transition" aria-hidden="true">
        <div class="transition-scene" data-scene="current" id="transition-current"></div>
        <div class="transition-scene" data-scene="next" id="transition-next"></div>
      </div>
      <div class="slider-controls">
        <button class="slider-btn" id="prev-slide" type="button" aria-label="Previous region">‹</button>
        <button class="slider-btn" id="next-slide" type="button" aria-label="Next region">›</button>
      </div>
      <div class="slider-dots" id="slider-dots"></div>
    </div>
  </section>

  <section id="sectors">
    <h2>Sectors we fund together</h2>
    <p class="lead">Pair every gift with a sector so donors understand the impact: community relief, education, food security, and more. Sectors appear on receipts and in compliance exports automatically.</p>
    <div class="sector-grid" id="sector-grid"></div>
  </section>

  <section id="community">
    <div class="section-head">
      <div>
        <h2>Community campaigns in motion</h2>
        <p class="lead">Browse stories submitted by individuals and small groups who are actively raising support right now.</p>
      </div>
      <a class="btn ghost" href="multifaith-campaign-create.html">Start receiving donations</a>
    </div>
    <div class="community-grid" id="community-campaigns"></div>
    <p class="empty-note" id="community-empty" hidden>No community campaigns have launched yet. Share yours to be featured here.</p>
  </section>

  <section id="give">
    <h2>Give right now</h2>
    <p class="lead">Use the form below to choose a faith tradition, region, campaign, and sector. Submit to mint a secure Stripe checkout link instantly.</p>
    <div class="form-card">
      <h3>Donation builder</h3>
      <form id="donation-form">
        <div class="form-row double">
          <label>Region
            <select id="donation-region" required></select>
          </label>
          <label>Faith tradition
            <select id="donation-faith" required></select>
          </label>
        </div>
        <div class="form-row double">
          <label>Organization
            <select id="donation-org" required></select>
          </label>
          <label>Campaign
            <select id="donation-campaign" required></select>
          </label>
        </div>
        <div class="form-row double">
          <label>Sector / Fund focus
            <select id="donation-sector" required></select>
          </label>
          <label>Donation type
            <select id="donation-type" required></select>
          </label>
        </div>
        <div class="form-row triple">
          <label>Amount (local currency)
            <input id="donation-amount" type="number" min="1" max="999999999999" step="1" placeholder="50" required/>
          </label>
          <label>Frequency
            <select id="donation-frequency" required>
              <option value="one_time">One-time</option>
              <option value="week">Weekly</option>
              <option value="month" selected>Monthly</option>
              <option value="year">Annual</option>
            </select>
          </label>
          <label>Promo codes allowed?
            <select id="donation-promo" required>
              <option value="true" selected>Yes</option>
              <option value="false">No</option>
            </select>
          </label>
        </div>
        <div class="form-row double">
          <label>Donor name
            <input id="donation-name" type="text" placeholder="Jordan Malik" required/>
          </label>
          <label>Email for receipt
            <input id="donation-email" type="email" placeholder="jordan@example.org" required/>
          </label>
        </div>
        <div class="form-row">
          <label>Notes for receipt (optional)
            <textarea id="donation-notes" placeholder="Dedicate this gift to..."></textarea>
          </label>
        </div>
        <div class="form-actions">
          <button class="btn liquid" type="submit">
            <span>Generate secure checkout</span>
            <div class="liquid"></div>
          </button>
        </div>
      </form>
      <div class="status" id="donation-status" hidden></div>
      <div class="result-block" id="donation-result" hidden>
        <strong>Payment link</strong>
        <a id="donation-link" href="#" target="_blank" rel="noreferrer"></a>
        <pre id="donation-meta"></pre>
      </div>
      <div class="empty-note" id="org-empty" hidden>No organizations found yet. Add one below to start collecting gifts.</div>
    </div>
  </section>

  <section id="manage">
    <h2>Organization &amp; campaign management</h2>
    <p class="lead">Connect as many communities as you need. As soon as you save an organization and campaign, they are available in the donation builder.</p>
    <div class="form-card manage-card">
      <div class="manage-tabs" role="tablist" aria-label="Manage organizations and campaigns">
        <button class="manage-tab is-active" type="button" role="tab" aria-selected="true" aria-controls="panel-organization" id="tab-organization" data-tab-target="panel-organization">Organizations</button>
        <button class="manage-tab" type="button" role="tab" aria-selected="false" aria-controls="panel-campaign" id="tab-campaign" data-tab-target="panel-campaign">Campaigns</button>
      </div>
      <div class="tab-panels">
        <div class="tab-panel is-active" id="panel-organization" role="tabpanel" aria-labelledby="tab-organization">
          <h3>Add an organization</h3>
          <form id="setup-org-form">
            <div class="form-row double">
              <label>Organization name
                <input id="setup-org-name" type="text" placeholder="Bethany Center" required/>
              </label>
              <label>Region
                <select id="setup-org-region" required></select>
              </label>
            </div>
            <div class="form-row double">
              <label>Faith tradition
                <select id="setup-org-faith" required></select>
              </label>
              <label>Locales (comma separated)
                <input id="setup-org-locales" type="text" placeholder="en-US, es-US"/>
              </label>
            </div>
            <div class="form-row double">
              <label>Timezone
                <input id="setup-org-timezone" type="text" placeholder="America/New_York"/>
              </label>
              <label>Stripe Account ID (optional)
                <input id="setup-org-stripe" type="text" placeholder="acct_123"/>
              </label>
            </div>
            <div class="form-actions">
              <button class="btn ghost" type="submit">Save organization</button>
            </div>
          </form>
          <div class="status" id="setup-org-status" hidden></div>
        </div>
        <div class="tab-panel" id="panel-campaign" role="tabpanel" aria-labelledby="tab-campaign" hidden>
          <h3>Add a campaign</h3>
          <form id="setup-campaign-form">
            <div class="form-row double">
              <label>Organization
                <select id="setup-campaign-org" required></select>
              </label>
              <label>Campaign name
                <input id="setup-campaign-name" type="text" placeholder="Community Relief" required/>
              </label>
            </div>
            <div class="form-row double">
              <label>Campaign code (optional)
                <input id="setup-campaign-code" type="text" placeholder="community_relief"/>
              </label>
              <label>Donation types (comma separated)
                <input id="setup-campaign-types" type="text" placeholder="tithe, zakat, dana"/>
              </label>
            </div>
            <div class="form-actions">
              <button class="btn liquid" type="submit">
                <span>Save campaign</span>
                <div class="liquid"></div>
              </button>
            </div>
          </form>
          <div class="status" id="setup-campaign-status" hidden></div>
        </div>
      </div>
    </div>
  </section>
</main>

<footer>
  © <span id="year"></span> New Bright Water. Multi-faith donations, ready the moment you sign in.
</footer>

<script>
  const QUICK_FAITHS = [
    {
      key: 'christian',
      title: 'Christian ministries',
      subtitle: 'Direct support for parish life, community meals, and global missions.',
      detail: 'Split across worship, meals, and relief in this lane.',
      currency: 'USD',
      locale: 'en-US',
      gradient: 'linear-gradient(135deg, rgba(212, 162, 76, 0.95), rgba(122, 157, 146, 0.95))',
      cardGradient: 'linear-gradient(145deg, rgba(212, 162, 76, 0.22), rgba(122, 157, 146, 0.18))',
      borderColor: 'rgba(212, 162, 76, 0.45)',
      summaryBorder: 'rgba(212, 162, 76, 0.4)',
      shadow: '0 18px 32px rgba(212, 162, 76, 0.35)',
      summaryShadow: '0 14px 28px rgba(212, 162, 76, 0.25)',
      amounts: [
        { base: 75, label: 'Launch midweek meals' },
        { base: 150, label: 'Fuel regional outreach' },
        { base: 300, label: 'Underwrite community care' }
      ],
      icon: '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><g fill="none" stroke="currentColor" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"><path d="M32 8v48"/><path d="M18 20h28"/></g></svg>',
      ctaGenerate: 'Generate secure checkout',
      ctaShare: 'Create a donation link',
      metrics: {
        followersLabel: 'Global adherents',
        actionsLabel: 'Tracked community projects',
        actionSectors: ['relief', 'food', 'youth', 'capital']
      }
    },
    {
      key: 'islam',
      title: 'Masjid & zakat partners',
      subtitle: 'Elevate Ramadan hampers, zakat distribution, and daily prayers.',
      detail: 'Balances zakat, sadaqah, and masjid operations in one sweep.',
      currency: 'AED',
      locale: 'en-AE',
      gradient: 'linear-gradient(135deg, rgba(91, 153, 136, 0.95), rgba(64, 126, 110, 0.95))',
      cardGradient: 'linear-gradient(145deg, rgba(91, 153, 136, 0.24), rgba(64, 126, 110, 0.2))',
      borderColor: 'rgba(91, 153, 136, 0.5)',
      summaryBorder: 'rgba(91, 153, 136, 0.45)',
      shadow: '0 18px 32px rgba(64, 126, 110, 0.32)',
      summaryShadow: '0 14px 28px rgba(64, 126, 110, 0.26)',
      amounts: [
        { base: 200, label: 'Stock Eid food parcels' },
        { base: 350, label: 'Sponsor zakat disbursement' },
        { base: 600, label: 'Fund masjid restoration' }
      ],
      icon: '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path d="M40 8a20 20 0 1 0 0 48 22 22 0 1 1 0-48z" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="m46 32 10 4-10 4 6 9-10-4-2 11-2-11-10 4 6-9-10-4 10-4-6-9 10 4 2-11 2 11 10-4z" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>',
      ctaGenerate: 'Launch masjid checkout',
      ctaShare: 'Share zakat link',
      metrics: {
        followersLabel: 'Global adherents',
        actionsLabel: 'Relief & zakat actions tracked',
        actionSectors: ['ramadan_food', 'water', 'education', 'infrastructure']
      }
    },
    {
      key: 'jewish',
      title: 'Synagogues & federations',
      subtitle: 'Back Hebrew schools, security training, and cultural preservation.',
      detail: 'Allocates toward education, safety, and cultural life at once.',
      currency: 'ILS',
      locale: 'he-IL',
      gradient: 'linear-gradient(135deg, rgba(73, 131, 196, 0.95), rgba(36, 96, 172, 0.95))',
      cardGradient: 'linear-gradient(145deg, rgba(73, 131, 196, 0.24), rgba(36, 96, 172, 0.22))',
      borderColor: 'rgba(73, 131, 196, 0.5)',
      summaryBorder: 'rgba(73, 131, 196, 0.45)',
      shadow: '0 18px 32px rgba(36, 96, 172, 0.32)',
      summaryShadow: '0 14px 28px rgba(36, 96, 172, 0.26)',
      amounts: [
        { base: 180, label: 'Sponsor Hebrew school supplies' },
        { base: 360, label: 'Underwrite security detail' },
        { base: 720, label: 'Preserve cultural archives' }
      ],
      icon: '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path d="m32 6 10 18h-20l10-18zm0 52-10-18h20l-10 18zm-22-18 10-18 10 18H10zm44 0H34l10-18 10 18z" fill="none" stroke="currentColor" stroke-width="4" stroke-linejoin="round"/></svg>',
      ctaGenerate: 'Send synagogue checkout',
      ctaShare: 'Share federation link',
      metrics: {
        followersLabel: 'Global adherents',
        actionsLabel: 'Active communal projects',
        actionSectors: ['refugee', 'culture', 'energy', 'education']
      }
    },
    {
      key: 'hindu',
      title: 'Temple seva circles',
      subtitle: 'Keep aarti, prasadam kitchens, and youth satsangs thriving.',
      detail: 'Energizes seva teams, annadanam, and temple upkeep together.',
      currency: 'INR',
      locale: 'en-IN',
      gradient: 'linear-gradient(135deg, rgba(226, 153, 73, 0.95), rgba(199, 98, 35, 0.95))',
      cardGradient: 'linear-gradient(145deg, rgba(226, 153, 73, 0.26), rgba(199, 98, 35, 0.22))',
      borderColor: 'rgba(226, 153, 73, 0.55)',
      summaryBorder: 'rgba(226, 153, 73, 0.48)',
      shadow: '0 18px 32px rgba(199, 98, 35, 0.32)',
      summaryShadow: '0 14px 28px rgba(199, 98, 35, 0.28)',
      amounts: [
        { base: 3500, label: 'Prepare daily prasadam' },
        { base: 6500, label: 'Sponsor festival seva teams' },
        { base: 12000, label: 'Restore garbhagriha artistry' }
      ],
      icon: '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path d="M20 24c0-6.627 5.373-12 12-12s12 5.373 12 12-5.373 12-12 12" fill="none" stroke="currentColor" stroke-width="4"/><path d="M32 36c-6 0-11 3.582-11 8s5 8 11 8 11-3.582 11-8" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"/><path d="M30 18c0-3.314 2.239-6 5-6 2.209 0 4 1.791 4 4 0 1.657-1.343 3-3 3" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"/><path d="M14 24h12M38 24h12" stroke="currentColor" stroke-width="4" stroke-linecap="round"/></svg>',
      ctaGenerate: 'Launch temple checkout',
      ctaShare: 'Share seva link',
      metrics: {
        followersLabel: 'Global adherents',
        actionsLabel: 'Tracked seva initiatives',
        actionSectors: ['disaster', 'seva', 'health', 'education']
      }
    },
    {
      key: 'buddhist',
      title: 'Sangha retreats & relief',
      subtitle: 'Resource meditation halls, dana kitchens, and elder care.',
      detail: 'Streams dana across retreats, monastics, and community care.',
      currency: 'SGD',
      locale: 'en-SG',
      gradient: 'linear-gradient(135deg, rgba(122, 157, 146, 0.95), rgba(88, 136, 128, 0.95))',
      cardGradient: 'linear-gradient(145deg, rgba(122, 157, 146, 0.24), rgba(88, 136, 128, 0.22))',
      borderColor: 'rgba(122, 157, 146, 0.5)',
      summaryBorder: 'rgba(122, 157, 146, 0.45)',
      shadow: '0 18px 32px rgba(88, 136, 128, 0.32)',
      summaryShadow: '0 14px 28px rgba(88, 136, 128, 0.26)',
      amounts: [
        { base: 220, label: 'Sponsor dana meal service' },
        { base: 420, label: 'Support retreat scholarships' },
        { base: 880, label: 'Fund monastic healthcare' }
      ],
      icon: '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><circle cx="32" cy="32" r="8" fill="none" stroke="currentColor" stroke-width="4"/><g fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><path d="M32 8v10"/><path d="M32 46v10"/><path d="M8 32h10"/><path d="M46 32h10"/><path d="m14 14 7 7"/><path d="m43 43 7 7"/><path d="m14 50 7-7"/><path d="m43 21 7-7"/></g></svg>',
      ctaGenerate: 'Send sangha checkout',
      ctaShare: 'Share dana link',
      metrics: {
        followersLabel: 'Global adherents',
        actionsLabel: 'Meditation & relief efforts',
        actionSectors: ['retreats', 'environment', 'elder', 'kitchen']
      }
    }
  ];

  const state = {
    orgs: [],
    campaignsByOrg: new Map(),
    campaignFetchAttempts: new Set(),
    communityCampaigns: [],
    slideIndex: 0,
    autoTimer: null,
    slideImages: new Map(),
    lastSlideImage: new Map(),
    hasRenderedInitialSlide: false,
    isTransitioning: false,
    preloadedSlideId: null,
    metricsByFaith: new Map(),
    metricsUpdatedAt: null
  };

  const QUICK_FAITH_MAP = new Map(QUICK_FAITHS.map((faith) => [faith.key, faith]));

  const STRIPE_MAX_AMOUNT = 999999999999;

  const quickStripeCard = document.querySelector('.quick-stripe-card');
  let updateQuickMetricsDisplay = () => {};

  if (quickStripeCard) {
    const quickTabs = Array.from(quickStripeCard.querySelectorAll('.manage-tab'));
    const quickAmounts = Array.from(quickStripeCard.querySelectorAll('.quick-amount'));
    const quickFaithIcon = document.getElementById('quick-faith-icon');
    const quickFaithTitle = document.getElementById('quick-faith-title');
    const quickFaithSubtitle = document.getElementById('quick-faith-subtitle');
    const quickMultiplierLabel = document.getElementById('quick-multiplier-label');
    const quickSliderTrack = document.getElementById('quick-slider');
    const quickSliderProgress = document.getElementById('quick-slider-progress');
    const quickSliderThumb = document.getElementById('quick-slider-thumb');
    const quickTotal = document.getElementById('quick-total');
    const quickTotalDetail = document.getElementById('quick-total-detail');
    const quickSummary = quickStripeCard.querySelector('.quick-summary');
    const quickGenerateBtn = document.getElementById('quick-generate');
    const quickShareBtn = document.getElementById('quick-share');
    const quickGenerateLabel = quickGenerateBtn ? quickGenerateBtn.querySelector('span') : null;
    const quickShareLabel = quickShareBtn ? quickShareBtn.querySelector('span') : null;
    const quickStatus = document.getElementById('quick-status');
    const quickResult = document.getElementById('quick-result');
    const quickLink = document.getElementById('quick-link');
    const quickCopyBtn = document.getElementById('quick-copy');
    const quickMetricsContainer = document.getElementById('quick-metrics');
    const quickMetricsFollowersLabel = document.getElementById('quick-metric-followers-label');
    const quickMetricsFollowersValue = document.getElementById('quick-metric-followers');
    const quickMetricsActionsLabel = document.getElementById('quick-metric-actions-label');
    const quickMetricsActionsValue = document.getElementById('quick-metric-actions');
    const quickMetricsUpdated = document.getElementById('quick-metrics-updated');

    function resetQuickCopyButton() {
      if (quickCopyBtn) {
        quickCopyBtn.disabled = false;
        quickCopyBtn.textContent = 'Copy link';
      }
    }

    function clearQuickCheckoutFeedback() {
      if (quickResult) {
        quickResult.hidden = true;
      }
      if (quickLink) {
        quickLink.textContent = '';
        quickLink.removeAttribute('href');
      }
      resetQuickCopyButton();
      clearStatus(quickStatus);
    }

    if (quickSliderTrack && quickSliderProgress && quickSliderThumb && quickMultiplierLabel && quickTotal) {
      const QUICK_SLIDER_MIN = 0.75;
      const QUICK_SLIDER_MAX = 2.5;
      const QUICK_SLIDER_STEP = 0.01;
      const QUICK_PERCENT_STEP = 3.5;
      const QUICK_PERCENT_FINE = 1.5;

      const amountFormatters = new Map();
      const metricValueFormatters = new Map();

      const quickState = {
        faith: QUICK_FAITHS[0]?.key ?? null,
        multiplier: 1,
        selectedIndex: 0
      };

      let quickSliderRect = quickSliderTrack.getBoundingClientRect();
      let quickSliderPercent = 0;
      let quickSliderDragging = false;

      quickSliderTrack.setAttribute('aria-valuemin', String(Math.round(QUICK_SLIDER_MIN * 100)));
      quickSliderTrack.setAttribute('aria-valuemax', String(Math.round(QUICK_SLIDER_MAX * 100)));

      function formatAmount(value, currency, locale) {
        const key = `${locale}-${currency}`;
        if (!amountFormatters.has(key)) {
          amountFormatters.set(
            key,
            new Intl.NumberFormat(locale, {
              style: 'currency',
              currency,
              maximumFractionDigits: 0,
              minimumFractionDigits: 0
            })
          );
        }
        return amountFormatters.get(key).format(Math.max(0, Math.round(value)));
      }

      function formatQuickMetric(value, locale) {
        if (!Number.isFinite(value)) return null;
        const key = `${locale || 'default'}`;
        if (!metricValueFormatters.has(key)) {
          try {
            metricValueFormatters.set(
              key,
              new Intl.NumberFormat(locale || undefined, {
                notation: 'compact',
                maximumFractionDigits: 1
              })
            );
          } catch (err) {
            metricValueFormatters.set(key, null);
          }
        }
        const formatter = metricValueFormatters.get(key);
        if (formatter && typeof formatter.format === 'function') {
          return formatter.format(value);
        }
        return formatMetricNumber(value, locale) || String(Math.round(value));
      }

      function formatMultiplier(value) {
        const fixed = value.toFixed(2);
        return `${fixed.replace(/0+$/, '').replace(/\.$/, '')}×`;
      }

      function percentToMultiplier(percent) {
        return QUICK_SLIDER_MIN + (Math.max(0, Math.min(100, percent)) / 100) * (QUICK_SLIDER_MAX - QUICK_SLIDER_MIN);
      }

      function multiplierToPercent(multiplier) {
        const clamped = Math.max(QUICK_SLIDER_MIN, Math.min(QUICK_SLIDER_MAX, multiplier));
        return ((clamped - QUICK_SLIDER_MIN) / (QUICK_SLIDER_MAX - QUICK_SLIDER_MIN)) * 100;
      }

      function applySliderPosition() {
        quickSliderProgress.style.width = `${quickSliderPercent}%`;
        quickSliderThumb.style.left = `${quickSliderPercent}%`;
        const ariaValue = Math.round(quickState.multiplier * 100);
        quickSliderTrack.setAttribute('aria-valuenow', String(ariaValue));
        quickSliderTrack.setAttribute('aria-valuetext', `${quickState.multiplier.toFixed(2)} times base gift`);
        quickMultiplierLabel.textContent = formatMultiplier(quickState.multiplier);
      }

      function updateQuickAmounts() {
        clearQuickCheckoutFeedback();
        const config = QUICK_FAITH_MAP.get(quickState.faith);
        if (!config) return;

        quickAmounts.forEach((button, index) => {
          const amountConfig = config.amounts[index] ?? config.amounts[config.amounts.length - 1];
          const scaled = Math.round(amountConfig.base * quickState.multiplier / 5) * 5;
          button.dataset.index = String(index);
          button.dataset.amountValue = String(Math.max(0, scaled));
          const valueLabel = button.querySelector('strong');
          const descLabel = button.querySelector('span');
          if (valueLabel) {
            valueLabel.textContent = formatAmount(scaled, config.currency, config.locale);
          }
          if (descLabel) {
            descLabel.textContent = amountConfig.label;
          }
          button.classList.toggle('is-selected', index === quickState.selectedIndex);
        });

        const activeButton = quickAmounts[quickState.selectedIndex];
        const activeAmount = activeButton ? Number(activeButton.dataset.amountValue ?? 0) : 0;
        quickTotal.textContent = `${formatAmount(activeAmount, config.currency, config.locale)} ready for checkout`;
      }

      function updateQuickVisuals() {
        const config = QUICK_FAITH_MAP.get(quickState.faith);
        if (!config) return;

        if (quickFaithIcon) {
          quickFaithIcon.innerHTML = config.icon;
        }
        if (quickFaithTitle) {
          quickFaithTitle.textContent = config.title;
        }
        if (quickFaithSubtitle) {
          quickFaithSubtitle.textContent = config.subtitle;
        }
        if (quickTotalDetail) {
          quickTotalDetail.textContent = config.detail;
        }
        if (quickGenerateLabel) {
          quickGenerateLabel.textContent = config.ctaGenerate;
        }
        if (quickShareLabel) {
          quickShareLabel.textContent = config.ctaShare;
        }

        quickStripeCard.style.backgroundImage = config.cardGradient;
        quickStripeCard.style.borderColor = config.borderColor;
        quickSliderProgress.style.backgroundImage = config.gradient;
        if (quickSummary) {
          quickSummary.style.borderColor = config.summaryBorder;
          quickSummary.style.boxShadow = config.summaryShadow;
        }

        quickTabs.forEach((tab) => {
          const isActive = tab.dataset.faith === quickState.faith;
          tab.classList.toggle('is-active', isActive);
          tab.setAttribute('aria-selected', isActive ? 'true' : 'false');
          tab.style.background = isActive ? config.gradient : 'transparent';
          tab.style.color = isActive ? '#fff' : '';
          tab.style.boxShadow = isActive ? config.shadow : '';
        });

        updateQuickMetricsDisplay();
        updateQuickAmounts();
      }

      updateQuickMetricsDisplay = function updateQuickMetricsDisplay() {
        if (!quickMetricsContainer) return;
        const followersCard = quickMetricsContainer.querySelector('[data-role="followers"]');
        const actionsCard = quickMetricsContainer.querySelector('[data-role="actions"]');
        const config = QUICK_FAITH_MAP.get(quickState.faith);
        if (quickMetricsFollowersLabel) {
          quickMetricsFollowersLabel.textContent = config?.metrics?.followersLabel || 'Global adherents';
        }
        if (quickMetricsActionsLabel) {
          quickMetricsActionsLabel.textContent = config?.metrics?.actionsLabel || 'Active community projects';
        }
        const metrics = getMetricsForFaith(quickState.faith);
        if (!metrics) {
          if (quickMetricsFollowersValue) quickMetricsFollowersValue.textContent = 'Loading metrics…';
          if (quickMetricsActionsValue) quickMetricsActionsValue.textContent = 'Loading metrics…';
          if (followersCard) followersCard.classList.add('is-loading');
          if (actionsCard) actionsCard.classList.add('is-loading');
          if (quickMetricsUpdated) quickMetricsUpdated.textContent = 'Metrics loading…';
          return;
        }

        if (quickMetricsUpdated) {
          if (state.metricsUpdatedAt) {
            const updatedDate = new Date(state.metricsUpdatedAt);
            if (!Number.isNaN(updatedDate.getTime())) {
              quickMetricsUpdated.textContent = `Last updated ${updatedDate.toLocaleString(undefined, {
                month: 'short',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit'
              })}`;
            } else {
              quickMetricsUpdated.textContent = '';
            }
          } else {
            quickMetricsUpdated.textContent = 'Live metrics';
          }
        }

        const followersValue = metrics?.followers?.value;
        if (Number.isFinite(followersValue)) {
          const formattedFollowers = formatQuickMetric(followersValue, config?.locale) || String(Math.round(followersValue));
          const yearSuffix = metrics.followers?.year ? ` (${metrics.followers.year})` : '';
          if (quickMetricsFollowersValue) {
            quickMetricsFollowersValue.textContent = `${formattedFollowers}${yearSuffix}`;
          }
          if (followersCard) followersCard.classList.remove('is-loading');
        } else {
          if (quickMetricsFollowersValue) quickMetricsFollowersValue.textContent = '—';
          if (followersCard) followersCard.classList.add('is-loading');
        }

        const actionKeys = Array.isArray(config?.metrics?.actionSectors) && config.metrics.actionSectors.length
          ? config.metrics.actionSectors
          : Object.keys(metrics.sectors || {});
        let actionsTotal = 0;
        let hasActionData = false;
        actionKeys.forEach(key => {
          const value = metrics?.sectors?.[key]?.value;
          if (Number.isFinite(value)) {
            actionsTotal += value;
            hasActionData = true;
          }
        });
        if (!hasActionData && Number.isFinite(metrics?.totals?.sectorActions)) {
          actionsTotal = metrics.totals.sectorActions;
          hasActionData = true;
        }

        if (hasActionData) {
          const formattedActions = formatQuickMetric(actionsTotal, config?.locale) || String(Math.round(actionsTotal));
          if (quickMetricsActionsValue) {
            quickMetricsActionsValue.textContent = `${formattedActions} actions`;
          }
          if (actionsCard) actionsCard.classList.remove('is-loading');
        } else {
          if (quickMetricsActionsValue) quickMetricsActionsValue.textContent = '—';
          if (actionsCard) actionsCard.classList.add('is-loading');
        }
      };

      function setQuickFaith(key) {
        if (!QUICK_FAITH_MAP.has(key)) return;
        quickState.faith = key;
        quickState.selectedIndex = 0;
        updateQuickVisuals();
      }

      function setQuickPercent(percent) {
        const clamped = Math.max(0, Math.min(100, percent));
        quickSliderPercent = clamped;
        const rawMultiplier = percentToMultiplier(clamped);
        const roundedMultiplier = Math.round(rawMultiplier / QUICK_SLIDER_STEP) * QUICK_SLIDER_STEP;
        quickState.multiplier = Math.max(QUICK_SLIDER_MIN, Math.min(QUICK_SLIDER_MAX, Number(roundedMultiplier.toFixed(2))));
        applySliderPosition();
        updateQuickAmounts();
      }

      function updateQuickFromClient(clientX) {
        if (!quickSliderRect || quickSliderRect.width === 0) return;
        const offset = clientX - quickSliderRect.left;
        const percent = (offset / quickSliderRect.width) * 100;
        setQuickPercent(percent);
      }

      function startSliderDrag(clientX) {
        quickSliderDragging = true;
        quickSliderRect = quickSliderTrack.getBoundingClientRect();
        quickSliderThumb.classList.add('active');
        updateQuickFromClient(clientX);
      }

      function stopSliderDrag() {
        if (!quickSliderDragging) return;
        quickSliderDragging = false;
        quickSliderThumb.classList.remove('active');
      }

      quickTabs.forEach((tab) => {
        tab.addEventListener('click', () => {
          setQuickFaith(tab.dataset.faith);
        });
      });

      quickAmounts.forEach((button) => {
        button.addEventListener('click', () => {
          const index = Number(button.dataset.index ?? 0);
          quickState.selectedIndex = index;
          updateQuickAmounts();
        });
      });

      quickSliderThumb.addEventListener('mousedown', (event) => {
        event.preventDefault();
        startSliderDrag(event.clientX);
      });

      quickSliderTrack.addEventListener('mousedown', (event) => {
        event.preventDefault();
        startSliderDrag(event.clientX);
      });

      document.addEventListener('mousemove', (event) => {
        if (!quickSliderDragging) return;
        updateQuickFromClient(event.clientX);
      });

      document.addEventListener('mouseup', stopSliderDrag);

      quickSliderThumb.addEventListener(
        'touchstart',
        (event) => {
          event.preventDefault();
          const touch = event.touches[0];
          if (touch) {
            startSliderDrag(touch.clientX);
          }
        },
        { passive: false }
      );

      quickSliderTrack.addEventListener(
        'touchstart',
        (event) => {
          const touch = event.touches[0];
          if (touch) {
            startSliderDrag(touch.clientX);
          }
        },
        { passive: true }
      );

      document.addEventListener(
        'touchmove',
        (event) => {
          if (!quickSliderDragging) return;
          const touch = event.touches[0];
          if (touch) {
            event.preventDefault();
            updateQuickFromClient(touch.clientX);
          }
        },
        { passive: false }
      );

      document.addEventListener('touchend', stopSliderDrag);
      document.addEventListener('touchcancel', stopSliderDrag);

      quickSliderTrack.addEventListener('keydown', (event) => {
        let handled = false;
        if (event.key === 'ArrowRight' || event.key === 'ArrowUp') {
          const step = event.shiftKey ? QUICK_PERCENT_FINE : QUICK_PERCENT_STEP;
          setQuickPercent(quickSliderPercent + step);
          handled = true;
        } else if (event.key === 'ArrowLeft' || event.key === 'ArrowDown') {
          const step = event.shiftKey ? QUICK_PERCENT_FINE : QUICK_PERCENT_STEP;
          setQuickPercent(quickSliderPercent - step);
          handled = true;
        } else if (event.key === 'Home') {
          setQuickPercent(0);
          handled = true;
        } else if (event.key === 'End') {
          setQuickPercent(100);
          handled = true;
        }

        if (handled) {
          event.preventDefault();
        }
      });

      const quickElements = {
        status: quickStatus,
        result: quickResult,
        link: quickLink,
        copy: quickCopyBtn,
        amountButtons: quickAmounts,
        generateBtn: quickGenerateBtn,
        shareBtn: quickShareBtn
      };

      if (quickGenerateBtn) {
        quickGenerateBtn.addEventListener('click', () => {
          performQuickCheckout('checkout', quickState, quickElements);
        });
      }

      if (quickShareBtn) {
        quickShareBtn.addEventListener('click', () => {
          performQuickCheckout('link', quickState, quickElements);
        });
      }

      if (quickCopyBtn) {
        quickCopyBtn.addEventListener('click', async () => {
          if (!quickLink || !quickLink.href) return;
          if (!navigator?.clipboard?.writeText) {
            setStatus(quickStatus, 'Copy not supported here—use the link above instead.', 'info');
            return;
          }
          try {
            await navigator.clipboard.writeText(quickLink.href);
            setStatus(quickStatus, 'Donation link copied to your clipboard!', 'success');
            quickCopyBtn.disabled = true;
            quickCopyBtn.textContent = 'Copied!';
            setTimeout(() => {
              quickCopyBtn.disabled = false;
              quickCopyBtn.textContent = 'Copy link';
            }, 2400);
          } catch (err) {
            console.warn('Clipboard copy failed', err);
            setStatus(quickStatus, 'Copy not supported here—use the link above instead.', 'info');
          }
        });
      }

      window.addEventListener('resize', () => {
        quickSliderRect = quickSliderTrack.getBoundingClientRect();
        applySliderPosition();
      });

      quickSliderPercent = multiplierToPercent(quickState.multiplier);
      applySliderPosition();
      updateQuickVisuals();
    }
  }

  const SLIDES = [
    {
      id: 'NA',
      name: 'North America',
      religion: 'christian',
      copy: 'US and Canada support ACH, cards, Apple Pay, and bilingual receipts with IRS and CRA-compliant summaries.',
      sectors: [
        { label: 'Community relief & shelters', metric: 'relief' },
        { label: 'Food security networks', metric: 'food' },
        { label: 'Youth programming', metric: 'youth' },
        { label: 'Capital campaigns', metric: 'capital' }
      ],
      currencies: ['USD', 'CAD']
    },
    {
      id: 'EU',
      name: 'Europe',
      religion: 'jewish',
      copy: 'Localized SEPA payments with automatic Gift Aid statements and multilingual GDPR consent flows.',
      sectors: [
        { label: 'Refugee welcome centers', metric: 'refugee' },
        { label: 'Cultural preservation', metric: 'culture' },
        { label: 'Winter energy assistance', metric: 'energy' },
        { label: 'Education bursaries', metric: 'education' }
      ],
      currencies: ['EUR', 'GBP', 'SEK']
    },
    {
      id: 'MENA',
      name: 'Middle East & North Africa',
      religion: 'islam',
      copy: 'Arabic-first experiences with Ramadan scheduling, zakat calculators, and regional banking partners.',
      sectors: [
        { label: 'Ramadan food parcels', metric: 'ramadan_food' },
        { label: 'Water & sanitation', metric: 'water' },
        { label: 'Scholarships for girls', metric: 'education' },
        { label: 'Mosque restoration', metric: 'infrastructure' }
      ],
      currencies: ['AED', 'SAR', 'EGP']
    },
    {
      id: 'SA',
      name: 'South Asia',
      religion: 'hindu',
      copy: 'Handle INR, LKR, and NPR gifts with PAN capture, festival campaign presets, and WhatsApp confirmations.',
      sectors: [
        { label: 'Disaster recovery', metric: 'disaster' },
        { label: 'Temple seva programs', metric: 'seva' },
        { label: 'Health outreach', metric: 'health' },
        { label: 'Education for children', metric: 'education' }
      ],
      currencies: ['INR', 'LKR', 'NPR']
    },
    {
      id: 'APAC',
      name: 'Asia Pacific',
      religion: 'buddhist',
      copy: 'From Singapore to Sydney: cards, BECS, and PayNow support with retreat management baked in.',
      sectors: [
        { label: 'Retreat scholarships', metric: 'retreats' },
        { label: 'Environmental care', metric: 'environment' },
        { label: 'Elder support services', metric: 'elder' },
        { label: 'Community kitchens', metric: 'kitchen' }
      ],
      currencies: ['AUD', 'SGD', 'NZD']
    }
  ];

  const CURRENCIES = new Map([
    ['USD', { code: 'USD', name: 'United States dollar', src: 'image/money/money_usd.jpg' }],
    ['CAD', { code: 'CAD', name: 'Canadian dollar', src: 'image/money/money_cad.jpg' }],
    ['EUR', { code: 'EUR', name: 'Euro', src: 'image/money/money_eur.jpg' }],
    ['GBP', { code: 'GBP', name: 'Pound sterling', src: 'image/money/money_gbp.jpg' }],
    ['SEK', { code: 'SEK', name: 'Swedish krona', src: 'image/money/money_sek.jpg' }],
    ['AED', { code: 'AED', name: 'United Arab Emirates dirham', src: 'image/money/money_aed_2.jpg' }],
    ['SAR', { code: 'SAR', name: 'Saudi riyal', src: 'image/money/money_sar.jpg' }],
    ['EGP', { code: 'EGP', name: 'Egyptian pound', src: 'image/money/money_egp.jpg' }],
    ['INR', { code: 'INR', name: 'Indian rupee', src: 'image/money/money_inr.jpg' }],
    ['LKR', { code: 'LKR', name: 'Sri Lankan rupee', src: 'image/money/money_lkr.jpg' }],
    ['NPR', { code: 'NPR', name: 'Nepalese rupee', src: 'image/money/money_npr.jpg' }],
    ['AUD', { code: 'AUD', name: 'Australian dollar', src: 'image/money/money_aud.jpg' }],
    ['SGD', { code: 'SGD', name: 'Singapore dollar', src: 'image/money/money_sgd.jpg' }],
    ['NZD', { code: 'NZD', name: 'New Zealand dollar', src: 'image/money/money_nzd.jpg' }]
  ]);

  const SECTORS = [
    { value: 'relief', title: 'Community Relief', desc: 'Rapid response funds for housing, energy, and crisis needs.' },
    { value: 'education', title: 'Education', desc: 'Scholarships, after-school programs, and language classes.' },
    { value: 'health', title: 'Health & Wellness', desc: 'Clinics, counseling, and elder care tailored to each faith.' },
    { value: 'food', title: 'Food Security', desc: 'Food banks, Ramadan baskets, langar kitchens, and pantry drives.' },
    { value: 'youth', title: 'Youth & Families', desc: 'Child check-in, camps, and youth mentorship funding.' },
    { value: 'capital', title: 'Facilities & Capital', desc: 'Building restoration, accessibility upgrades, and mortgages.' }
  ];

  const REGION_CURRENCY_LOOKUP = new Map([
    ['NA', 'usd'],
    ['EU', 'eur'],
    ['MENA', 'aed'],
    ['SA', 'inr'],
    ['APAC', 'sgd']
  ]);

  const DEFAULT_ORGS = [
    {
      _id: 'org_dreamworld',
      name: 'Dreamworld',
      region: 'APAC',
      religion: 'buddhist',
      locales: ['en-SG', 'zh-SG'],
      timezone: 'Asia/Singapore'
    },
    {
      _id: 'org_dreamworld_point_bank',
      name: 'Dreamworld Point Bank',
      region: 'NA',
      religion: 'jewish',
      locales: ['en-US', 'he-IL'],
      timezone: 'America/New_York'
    },
    {
      _id: 'org_one_brain_world',
      name: 'One Brain World',
      region: 'NA',
      religion: 'christian',
      locales: ['en-US', 'es-US'],
      timezone: 'America/Los_Angeles'
    },
    {
      _id: 'org_new_bright_water',
      name: 'New Bright Water',
      region: 'MENA',
      religion: 'islam',
      locales: ['en-AE', 'ar-AE'],
      timezone: 'Asia/Dubai'
    },
    {
      _id: 'org_paperwork',
      name: 'Paperwork',
      region: 'SA',
      religion: 'hindu',
      locales: ['en-IN', 'hi-IN'],
      timezone: 'Asia/Kolkata'
    }
  ];

  const DEFAULT_CAMPAIGNS = new Map([
    ['org_dreamworld', [
      {
        _id: 'camp_dreamworld_retreat',
        orgId: 'org_dreamworld',
        name: 'Retreat Scholarships · Education Fund',
        sectorFocus: 'education',
        currency: 'sgd',
        donationTypes: ['dana', 'retreat']
      },
      {
        _id: 'camp_dreamworld_environment',
        orgId: 'org_dreamworld',
        name: 'Environmental Care · Health & Wellness',
        sectorFocus: 'health',
        currency: 'sgd',
        donationTypes: ['dana']
      },
      {
        _id: 'camp_dreamworld_kitchens',
        orgId: 'org_dreamworld',
        name: 'Community Kitchens · Food Security',
        sectorFocus: 'food',
        currency: 'sgd',
        donationTypes: ['dana']
      }
    ]],
    ['org_one_brain_world', [
      {
        _id: 'camp_one_brain_relief',
        orgId: 'org_one_brain_world',
        name: 'Community Relief · Neighbor Support',
        sectorFocus: 'relief',
        currency: 'usd',
        donationTypes: ['tithe', 'offering']
      },
      {
        _id: 'camp_one_brain_youth',
        orgId: 'org_one_brain_world',
        name: 'Youth & Families · Mentorship Fund',
        sectorFocus: 'youth',
        currency: 'usd',
        donationTypes: ['pledge', 'offering']
      },
      {
        _id: 'camp_one_brain_capital',
        orgId: 'org_one_brain_world',
        name: 'Facilities & Capital · Renewal Campaign',
        sectorFocus: 'capital',
        currency: 'usd',
        donationTypes: ['pledge']
      }
    ]],
    ['org_new_bright_water', [
      {
        _id: 'camp_new_bright_relief',
        orgId: 'org_new_bright_water',
        name: 'Ramadan Food Parcels · Food Security',
        sectorFocus: 'food',
        currency: 'aed',
        donationTypes: ['zakat', 'sadaqah']
      },
      {
        _id: 'camp_new_bright_scholarship',
        orgId: 'org_new_bright_water',
        name: 'Scholarships for Girls · Education Access',
        sectorFocus: 'education',
        currency: 'aed',
        donationTypes: ['zakat']
      },
      {
        _id: 'camp_new_bright_restoration',
        orgId: 'org_new_bright_water',
        name: 'Mosque Restoration · Facilities & Capital',
        sectorFocus: 'capital',
        currency: 'aed',
        donationTypes: ['zakat', 'sadaqah']
      }
    ]],
    ['org_dreamworld_point_bank', [
      {
        _id: 'camp_dreamworld_point_bank_emergency',
        orgId: 'org_dreamworld_point_bank',
        name: 'Emergency Relief · Tzedakah Collective',
        sectorFocus: 'relief',
        currency: 'usd',
        donationTypes: ['tzedakah']
      },
      {
        _id: 'camp_dreamworld_point_bank_learning',
        orgId: 'org_dreamworld_point_bank',
        name: 'Learning Circles · Scholarship Fund',
        sectorFocus: 'education',
        currency: 'usd',
        donationTypes: ['tzedakah', 'maaser']
      },
      {
        _id: 'camp_dreamworld_point_bank_families',
        orgId: 'org_dreamworld_point_bank',
        name: 'Family Support · Community Chest',
        sectorFocus: 'youth',
        currency: 'usd',
        donationTypes: ['maaser']
      }
    ]],
    ['org_paperwork', [
      {
        _id: 'camp_paperwork_prasadam',
        orgId: 'org_paperwork',
        name: 'Temple Meals · Prasadam Kitchen',
        sectorFocus: 'food',
        currency: 'inr',
        donationTypes: ['daan', 'seva']
      },
      {
        _id: 'camp_paperwork_education',
        orgId: 'org_paperwork',
        name: 'Youth Education · Gurukul Program',
        sectorFocus: 'education',
        currency: 'inr',
        donationTypes: ['daan', 'dakshina']
      },
      {
        _id: 'camp_paperwork_health',
        orgId: 'org_paperwork',
        name: 'Health Outreach · Seva Clinics',
        sectorFocus: 'health',
        currency: 'inr',
        donationTypes: ['seva']
      }
    ]]
  ]);

  const FAITH_TYPES = {
    christian: ['tithe', 'offering', 'pledge', 'mission'],
    islam: ['zakat', 'sadaqah', 'fidya', 'zakat-al-fitr'],
    hindu: ['daan', 'dakshina', 'seva'],
    buddhist: ['dana', 'retreat', 'merit'],
    jewish: ['tzedakah', 'maaser', 'aliyah', 'yahrzeit']
  };

  const FAITH_OPTIONS = [
    { value: 'christian', label: 'Christianity' },
    { value: 'islam', label: 'Islam' },
    { value: 'hindu', label: 'Hinduism' },
    { value: 'buddhist', label: 'Buddhism' },
    { value: 'jewish', label: 'Judaism' }
  ];

  const RELIGION_SYMBOLS = new Map([
    ['christian', { label: 'Christianity', src: 'religion/christianity-symbol.png' }],
    ['islam', { label: 'Islam', src: 'religion/islam-symbol.png' }],
    ['hindu', { label: 'Hinduism', src: 'religion/hinduism-symbol.png' }],
    ['buddhist', { label: 'Buddhism', src: 'religion/buddhism-symbol.png' }],
    ['jewish', { label: 'Judaism', src: 'religion/judaism-symbol.PNG' }]
  ]);

  const RELIGION_IMAGE_POOLS = new Map([
    ['christian', [
      'religion/christianity1.jpg',
      'religion/christianity2.jpg',
      'religion/christianity3.jpg',
      'religion/christianity4.jpg',
      'religion/christianity5.jpg',
      'religion/christianity6.jpg',
      'religion/christianity7.png',
      'religion/christianity8.png',
      'religion/christianity9.png'
    ]],
    ['jewish', [
      'religion/judaism1.jpg',
      'religion/judaism2.jpg',
      'religion/judaism3.png',
      'religion/judaism4.png',
      'religion/judaism5.png',
      'religion/judaism6.png',
      'religion/judaism7.png',
      'religion/judaism8.png'
    ]],
    ['islam', [
      'religion/islam1.jpg',
      'religion/islam2.jpg',
      'religion/islam3.png',
      'religion/islam4.jpg',
      'religion/islam5.jpg',
      'religion/islam6.jpg',
      'religion/islam7.jpg',
      'religion/islam8.jpg',
      'religion/islam9.png',
      'religion/islam10.jpg',
      'religion/islam11.png'
    ]],
    ['hindu', [
      'religion/hinduism1.jpg',
      'religion/hinduism2.jpg',
      'religion/hinduism3.jpg',
      'religion/hinduism4.jpg',
      'religion/hinduism5.jpg',
      'religion/hinduism6.jpg',
      'religion/hinduism7.jpg'
    ]],
    ['buddhist', [
      'religion/buddhism1.jpg',
      'religion/buddhism2.jpg',
      'religion/buddhism3.jpg',
      'religion/buddhism4.jpg',
      'religion/buddhism5.jpg',
      'religion/buddhism6.jpg',
      'religion/buddhism7.jpg',
      'religion/buddhism8.jpg',
      'religion/buddhism9.jpg'
    ]]
  ]);

  const MAX_FAITH_SYMBOL_TILT = 10;

  const SECTOR_TITLE_LOOKUP = new Map(SECTORS.map(sector => [sector.value, sector.title]));

  const els = {
    regionSlider: document.querySelector('.region-slider'),
    regionTrack: document.getElementById('region-track'),
    regionTransition: document.getElementById('region-transition'),
    transitionCurrent: document.getElementById('transition-current'),
    transitionNext: document.getElementById('transition-next'),
    sliderDots: document.getElementById('slider-dots'),
    prevSlide: document.getElementById('prev-slide'),
    nextSlide: document.getElementById('next-slide'),
    sectorGrid: document.getElementById('sector-grid'),
    donationForm: document.getElementById('donation-form'),
    donationRegion: document.getElementById('donation-region'),
    donationFaith: document.getElementById('donation-faith'),
    donationOrg: document.getElementById('donation-org'),
    donationCampaign: document.getElementById('donation-campaign'),
    donationSector: document.getElementById('donation-sector'),
    donationType: document.getElementById('donation-type'),
    donationAmount: document.getElementById('donation-amount'),
    donationFrequency: document.getElementById('donation-frequency'),
    donationPromo: document.getElementById('donation-promo'),
    donationName: document.getElementById('donation-name'),
    donationEmail: document.getElementById('donation-email'),
    donationNotes: document.getElementById('donation-notes'),
    donationStatus: document.getElementById('donation-status'),
    donationResult: document.getElementById('donation-result'),
    donationLink: document.getElementById('donation-link'),
    donationMeta: document.getElementById('donation-meta'),
    orgEmpty: document.getElementById('org-empty'),
    setupOrgForm: document.getElementById('setup-org-form'),
    setupOrgStatus: document.getElementById('setup-org-status'),
    setupOrgName: document.getElementById('setup-org-name'),
    setupOrgRegion: document.getElementById('setup-org-region'),
    setupOrgFaith: document.getElementById('setup-org-faith'),
    setupOrgLocales: document.getElementById('setup-org-locales'),
    setupOrgTimezone: document.getElementById('setup-org-timezone'),
    setupOrgStripe: document.getElementById('setup-org-stripe'),
    setupCampaignForm: document.getElementById('setup-campaign-form'),
    setupCampaignStatus: document.getElementById('setup-campaign-status'),
    setupCampaignOrg: document.getElementById('setup-campaign-org'),
    setupCampaignName: document.getElementById('setup-campaign-name'),
    setupCampaignCode: document.getElementById('setup-campaign-code'),
    setupCampaignTypes: document.getElementById('setup-campaign-types'),
    communityGrid: document.getElementById('community-campaigns'),
    communityEmpty: document.getElementById('community-empty'),
    manageCard: document.querySelector('.manage-card')
  };

  const HTML_ESCAPE_LOOKUP = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;'
  };

  function escapeHtml(value) {
    return String(value ?? '').replace(/[&<>"']/g, ch => HTML_ESCAPE_LOOKUP[ch] || ch);
  }

  function titleize(value) {
    const str = String(value ?? '').replace(/[_-]+/g, ' ').trim();
    if (!str) return '';
    return str.replace(/\b\w/g, ch => ch.toUpperCase());
  }

  function initialsFromName(value) {
    const parts = String(value ?? '')
      .trim()
      .split(/\s+/)
      .filter(Boolean)
      .map(part => part[0]);
    if (!parts.length) return '∎';
    return parts.slice(0, 2).join('').toUpperCase();
  }

  function truncate(value, max = 160) {
    const str = String(value ?? '').trim();
    if (str.length <= max) return str;
    return `${str.slice(0, Math.max(0, max - 1))}…`;
  }

  function formatCurrency(amount, currency = 'usd') {
    const numeric = Number(amount || 0);
    const code = String(currency || 'usd').toUpperCase();
    if (!Number.isFinite(numeric)) return '';
    try {
      return new Intl.NumberFormat(undefined, { style: 'currency', currency: code }).format(numeric);
    } catch (err) {
      return `${code} ${numeric.toFixed(2)}`;
    }
  }

  function formatMetricNumber(value, locale) {
    if (!Number.isFinite(value)) return null;
    try {
      return new Intl.NumberFormat(locale || undefined, {
        notation: 'compact',
        maximumFractionDigits: 1
      }).format(value);
    } catch (err) {
      return String(Math.round(value));
    }
  }

  function getMetricsForFaith(faith) {
    if (!faith) return null;
    if (state.metricsByFaith instanceof Map) {
      return state.metricsByFaith.get(faith) || null;
    }
    if (state.metricsByFaith && typeof state.metricsByFaith === 'object') {
      return state.metricsByFaith[faith] || null;
    }
    return null;
  }

  function getCurrencyForRegion(region) {
    return REGION_CURRENCY_LOOKUP.get(region) || 'usd';
  }

  function setStatus(el, message, type = 'info') {
    if (!el) return;
    el.hidden = false;
    el.textContent = message;
    el.classList.remove('success', 'error');
    if (type === 'success') el.classList.add('success');
    if (type === 'error') el.classList.add('error');
  }

  function clearStatus(el) {
    if (!el) return;
    el.hidden = true;
    el.textContent = '';
    el.classList.remove('success', 'error');
  }

  function option(label, value) {
    const opt = document.createElement('option');
    opt.value = value;
    opt.textContent = label;
    return opt;
  }

  function getImagePoolForReligion(religion) {
    return RELIGION_IMAGE_POOLS.get(religion) || [];
  }

  function pickRandomImage(pool, exclude, forceDifferent = true) {
    if (!pool.length) return null;
    const unique = forceDifferent ? pool.filter(src => src !== exclude) : pool.slice();
    const options = unique.length ? unique : pool;
    const index = Math.floor(Math.random() * options.length);
    return options[index];
  }

  function setRandomSlideImage(slideId, religion, forceDifferent = true) {
    const imgEl = state.slideImages.get(slideId);
    if (!imgEl) return;
    const pool = getImagePoolForReligion(religion);
    const previous = state.lastSlideImage.get(slideId);
    const next = pickRandomImage(pool, previous, forceDifferent);
    if (next && next !== previous) {
      imgEl.src = next;
      state.lastSlideImage.set(slideId, next);
    } else if (!imgEl.src && next) {
      imgEl.src = next;
      state.lastSlideImage.set(slideId, next);
    }
  }

  function handleFaithSymbolPointerMove(event) {
    const el = event.currentTarget;
    const rect = el.getBoundingClientRect();
    const x = (event.clientX - rect.left) / rect.width - 0.5;
    const y = (event.clientY - rect.top) / rect.height - 0.5;
    const rotateX = Math.max(-MAX_FAITH_SYMBOL_TILT, Math.min(MAX_FAITH_SYMBOL_TILT, -y * MAX_FAITH_SYMBOL_TILT));
    const rotateY = Math.max(-MAX_FAITH_SYMBOL_TILT, Math.min(MAX_FAITH_SYMBOL_TILT, x * MAX_FAITH_SYMBOL_TILT));
    el.style.transform = `perspective(600px) rotateX(${rotateX.toFixed(2)}deg) rotateY(${rotateY.toFixed(2)}deg)`;
  }

  function handleFaithSymbolPointerLeave(event) {
    const el = event.currentTarget;
    el.style.transform = 'perspective(600px) rotateX(0deg) rotateY(0deg)';
  }

  function attachFaithSymbolTilt() {
    const symbols = document.querySelectorAll('.faith-symbol');
    symbols.forEach(symbol => {
      if (symbol.dataset.tiltBound === 'true') return;
      symbol.dataset.tiltBound = 'true';
      symbol.addEventListener('pointermove', handleFaithSymbolPointerMove);
      symbol.addEventListener('pointerleave', handleFaithSymbolPointerLeave);
      symbol.addEventListener('pointerup', handleFaithSymbolPointerLeave);
      symbol.addEventListener('pointercancel', handleFaithSymbolPointerLeave);
    });
  }

  function getSlideMediaBounds(index) {
    const slider = els.regionSlider;
    const track = els.regionTrack;
    if (!slider || !track) return null;
    const slideEl = track.children?.[index];
    const mediaEl = slideEl?.querySelector('.region-media');
    if (!mediaEl) return null;
    const sliderRect = slider.getBoundingClientRect();
    const mediaRect = mediaEl.getBoundingClientRect();
    return {
      top: mediaRect.top - sliderRect.top,
      left: mediaRect.left - sliderRect.left,
      width: mediaRect.width,
      height: mediaRect.height
    };
  }

  function updateTransitionOverlayForIndex(index) {
    const overlay = els.regionTransition;
    if (!overlay) return;
    const bounds = getSlideMediaBounds(index);
    if (!bounds) {
      overlay.style.removeProperty('--transition-top');
      overlay.style.removeProperty('--transition-left');
      overlay.style.removeProperty('--transition-width');
      overlay.style.removeProperty('--transition-height');
      return;
    }
    overlay.style.setProperty('--transition-top', `${bounds.top}px`);
    overlay.style.setProperty('--transition-left', `${bounds.left}px`);
    overlay.style.setProperty('--transition-width', `${bounds.width}px`);
    overlay.style.setProperty('--transition-height', `${bounds.height}px`);
  }

  function renderSlides() {
    els.regionTrack.innerHTML = '';
    els.sliderDots.innerHTML = '';
    state.slideImages.clear();
    state.lastSlideImage.clear();
    state.slideIndex = 0;
    state.hasRenderedInitialSlide = false;
    state.isTransitioning = false;
    state.preloadedSlideId = null;
    if (els.regionTransition) {
      els.regionTransition.classList.remove('is-active');
    }
    SLIDES.forEach((slide, index) => {
      const slideEl = document.createElement('article');
      slideEl.className = 'region-slide';
      slideEl.dataset.index = index;
      const config = QUICK_FAITH_MAP.get(slide.religion);
      const symbol = RELIGION_SYMBOLS.get(slide.religion);
      const identity = symbol
        ? `<div class="faith-identity" data-religion="${slide.religion}"><div class="faith-symbol" aria-hidden="true" style="--symbol-image: url('${symbol.src}')"></div><span class="faith-label">${escapeHtml(symbol.label)}</span></div>`
        : '';
      const followersLabel = config?.metrics?.followersLabel || 'Global adherents';
      const followersMarkup = `<div class="region-followers region-followers--loading" data-faith="${escapeHtml(slide.religion)}" data-label="${escapeHtml(followersLabel)}">
          <span class="region-followers__label">${escapeHtml(followersLabel)}</span>
          <span class="region-followers__value" aria-live="polite">Loading…</span>
        </div>`;
      const currencyMarkup = Array.isArray(slide.currencies) && slide.currencies.length
        ? `<div class="region-currencies">
            <span class="region-currencies__label">Currencies</span>
            <ul class="region-currency-list" aria-label="Supported currencies">${slide.currencies
              .map(code => {
                const normalized = typeof code === 'string' ? code.trim().toUpperCase() : '';
                if (!normalized) return '';
                const currency = CURRENCIES.get(normalized);
                if (currency) {
                  return `<li class="region-currency-item" data-code="${escapeHtml(currency.code)}"><img class="region-currency-image" src="${escapeHtml(currency.src)}" alt="${escapeHtml(currency.name)}" loading="lazy"/><span class="region-currency-code">${escapeHtml(currency.code)}</span></li>`;
                }
                return `<li class="region-currency-item" data-code="${escapeHtml(normalized)}"><span class="region-currency-name">${escapeHtml(normalized)}</span></li>`;
              })
              .join('')}</ul>
          </div>`
        : '';
      const sectorsMarkup = Array.isArray(slide.sectors) && slide.sectors.length
        ? `<ul class="region-tags" aria-label="Regional focus areas">
            ${slide.sectors
              .map(item => {
                const sector = typeof item === 'string' ? { label: item } : item || {};
                const label = escapeHtml(sector.label || '');
                const metricKey = sector.metric ? String(sector.metric).trim() : '';
                const hasMetric = Boolean(metricKey);
                const metricAttr = hasMetric ? ` data-metric="${escapeHtml(metricKey)}"` : '';
                const faithAttr = hasMetric ? ` data-faith="${escapeHtml(slide.religion)}"` : '';
                const metricMarkup = hasMetric
                  ? '<span class="region-tag-metric">Loading metrics…</span>'
                  : '';
                const loadingClass = hasMetric ? ' region-tag--loading' : '';
                return `<li class="region-tag${loadingClass}"${faithAttr}${metricAttr}><span class="region-tag-label">${label}</span>${metricMarkup}</li>`;
              })
              .join('')}
          </ul>`
        : '';
      slideEl.innerHTML = `
        <div class="region-media">
          <img class="region-image" alt="${slide.name} faith communities" loading="lazy"/>
        </div>
        <div class="region-meta">
          ${identity}
          <h3>${slide.name}</h3>
          ${followersMarkup}
          <p>${slide.copy}</p>
        </div>
        ${currencyMarkup}
        ${sectorsMarkup}
      `;
      slideEl.classList.add(index % 2 === 0 ? 'pan-up' : 'pan-down');
      const imgEl = slideEl.querySelector('.region-image');
      if (imgEl) {
        state.slideImages.set(slide.id, imgEl);
        setRandomSlideImage(slide.id, slide.religion, false);
      }
      els.regionTrack.appendChild(slideEl);

      const dot = document.createElement('div');
      dot.className = 'slider-dot';
      dot.dataset.index = index;
      dot.addEventListener('click', () => showSlide(index, true));
      els.sliderDots.appendChild(dot);
    });
    if (els.transitionCurrent) {
      els.transitionCurrent.style.backgroundImage = 'none';
    }
    if (els.transitionNext) {
      els.transitionNext.style.backgroundImage = 'none';
      els.transitionNext.style.setProperty('--transition-mask-image', 'none');
    }
    showSlide(0, false, true);
    updateSlideMetrics();
    attachFaithSymbolTilt();
    updateTransitionOverlayForIndex(0);
  }

  function updateSlideMetrics() {
    const followerNodes = document.querySelectorAll('.region-followers[data-faith]');
    followerNodes.forEach(node => {
      const faith = node.getAttribute('data-faith');
      const valueEl = node.querySelector('.region-followers__value');
      if (!faith || !valueEl) return;
      const metrics = getMetricsForFaith(faith);
      if (!metrics) {
        valueEl.textContent = 'Loading…';
        valueEl.removeAttribute('title');
        valueEl.removeAttribute('aria-label');
        node.classList.add('region-followers--loading');
        return;
      }
      const followersEntry = metrics.followers || {};
      const followersValue = followersEntry.value;
      if (Number.isFinite(followersValue)) {
        const config = QUICK_FAITH_MAP.get(faith);
        const formatted = formatMetricNumber(followersValue, config?.locale) || String(Math.round(followersValue));
        const yearSuffix = followersEntry.year ? ` (${followersEntry.year})` : '';
        valueEl.textContent = `${formatted}${yearSuffix}`;
        const label = node.dataset.label || 'Global adherents';
        let precise = '';
        try {
          precise = new Intl.NumberFormat(config?.locale || undefined).format(followersValue);
        } catch (err) {
          precise = String(Math.round(followersValue));
        }
        const descriptive = label ? `${label}` : 'Global adherents';
        valueEl.setAttribute('title', `${precise}${yearSuffix || ''} · ${descriptive}`);
        valueEl.setAttribute('aria-label', `${formatted}${yearSuffix} ${descriptive}`);
        node.classList.remove('region-followers--loading');
      } else {
        valueEl.textContent = '—';
        valueEl.removeAttribute('title');
        const label = node.dataset.label || 'Global adherents';
        valueEl.setAttribute('aria-label', `Metric unavailable for ${label}`);
        node.classList.add('region-followers--loading');
      }
    });
    const nodes = document.querySelectorAll('.region-tag[data-faith][data-metric]');
    nodes.forEach(node => {
      const faith = node.getAttribute('data-faith');
      const metricKey = node.getAttribute('data-metric');
      const metricEl = node.querySelector('.region-tag-metric');
      if (!metricEl) return;
      const metrics = getMetricsForFaith(faith);
      if (!metrics) {
        metricEl.textContent = 'Loading metrics…';
        node.classList.add('region-tag--loading');
        return;
      }
      const sector = metrics?.sectors?.[metricKey];
      if (sector && Number.isFinite(sector.value)) {
        const config = QUICK_FAITH_MAP.get(faith);
        const formatted = formatMetricNumber(sector.value, config?.locale);
        const valueLabel = formatted ?? String(Math.round(sector.value));
        metricEl.textContent = `${valueLabel} active`;
        metricEl.setAttribute('aria-label', `${valueLabel} active initiatives`);
        node.classList.remove('region-tag--loading');
      } else if (sector && Object.prototype.hasOwnProperty.call(metrics.sectors || {}, metricKey)) {
        metricEl.textContent = '—';
        metricEl.setAttribute('aria-label', 'Metric unavailable');
        node.classList.add('region-tag--loading');
      } else {
        metricEl.textContent = '—';
        metricEl.setAttribute('aria-label', 'Metric unavailable');
        node.classList.add('region-tag--loading');
      }
    });
  }

  function showSlide(index, manual = false, skipTransition = false) {
    if (state.isTransitioning) return;
    const nextIndex = (index + SLIDES.length) % SLIDES.length;
    const currentIndex = state.slideIndex;
    const shouldAnimate = !skipTransition && state.hasRenderedInitialSlide && nextIndex !== currentIndex;
    if (shouldAnimate && els.regionTransition && els.transitionCurrent && els.transitionNext) {
      startSlideTransition(currentIndex, nextIndex, manual);
      return;
    }
    finalizeSlideChange(nextIndex, manual);
  }

  function startSlideTransition(currentIndex, nextIndex, manual) {
    const overlay = els.regionTransition;
    const currentScene = els.transitionCurrent;
    const nextScene = els.transitionNext;
    const currentSlide = SLIDES[currentIndex];
    const nextSlideData = SLIDES[nextIndex];
    if (!overlay || !currentScene || !nextScene || !currentSlide || !nextSlideData) {
      finalizeSlideChange(nextIndex, manual);
      return;
    }

    state.isTransitioning = true;
    setRandomSlideImage(nextSlideData.id, nextSlideData.religion);
    const currentImg = state.slideImages.get(currentSlide.id);
    const nextImg = state.slideImages.get(nextSlideData.id);
    const currentSrc = currentImg?.src || '';
    const nextSrc = nextImg?.src || '';
    currentScene.style.backgroundImage = currentSrc ? `url("${currentSrc}")` : 'none';
    nextScene.style.backgroundImage = nextSrc ? `url("${nextSrc}")` : 'none';
    const symbol = RELIGION_SYMBOLS.get(nextSlideData.religion);
    if (symbol?.src) {
      nextScene.style.setProperty('--transition-mask-image', `url("${symbol.src}")`);
    } else {
      nextScene.style.setProperty('--transition-mask-image', 'none');
    }
    const duration = 1800;
    overlay.style.setProperty('--transition-duration', `${duration}ms`);
    updateTransitionOverlayForIndex(currentIndex);
    state.preloadedSlideId = nextSlideData.id;

    // Reset animation state to allow retriggering
    currentScene.style.animation = 'none';
    nextScene.style.animation = 'none';
    void overlay.offsetWidth;
    currentScene.style.animation = '';
    nextScene.style.animation = '';

    overlay.classList.add('is-active');

    let finished = false;
    let fallbackTimer = null;
    const timerHost = typeof window !== 'undefined' ? window : globalThis;
    const finish = () => {
      if (finished) return;
      finished = true;
      if (fallbackTimer) {
        timerHost.clearTimeout(fallbackTimer);
      }
      finalizeSlideChange(nextIndex, manual);
      overlay.classList.remove('is-active');
      currentScene.style.backgroundImage = 'none';
      nextScene.style.backgroundImage = 'none';
      nextScene.style.setProperty('--transition-mask-image', 'none');
      state.isTransitioning = false;
      updateTransitionOverlayForIndex(state.slideIndex);
    };

    fallbackTimer = timerHost.setTimeout(finish, duration + 250);
    nextScene.addEventListener('animationend', finish, { once: true });
  }

  function finalizeSlideChange(newIndex, manual) {
    state.slideIndex = newIndex;
    const offset = -state.slideIndex * 100;
    els.regionTrack.style.transform = `translateX(${offset}%)`;
    const slides = Array.from(els.regionTrack.children);
    slides.forEach((slideEl, idx) => {
      const isActive = idx === state.slideIndex;
      slideEl.classList.toggle('active', isActive);
      if (isActive) {
        const img = slideEl.querySelector('.region-image');
        if (img) {
          img.style.animation = 'none';
          void img.offsetHeight;
          img.style.animation = '';
        }
      }
    });
    Array.from(els.sliderDots.children).forEach((dot, idx) => {
      dot.classList.toggle('active', idx === state.slideIndex);
    });
    const slide = SLIDES[state.slideIndex];
    if (slide) {
      if (state.preloadedSlideId === slide.id) {
        state.preloadedSlideId = null;
      } else {
        setRandomSlideImage(slide.id, slide.religion);
      }
    }
    updateTransitionOverlayForIndex(state.slideIndex);
    if (manual) {
      resetAutoSlide();
    }
    if (!state.hasRenderedInitialSlide) {
      state.hasRenderedInitialSlide = true;
    }
  }

  function nextSlide(manual = false) {
    if (state.isTransitioning) return;
    showSlide(state.slideIndex + 1, manual);
  }

  function prevSlide() {
    if (state.isTransitioning) return;
    showSlide(state.slideIndex - 1, true);
  }

  function resetAutoSlide() {
    if (state.autoTimer) {
      clearInterval(state.autoTimer);
    }
    state.autoTimer = setInterval(nextSlide, 8000);
  }

  function renderSectors() {
    els.sectorGrid.innerHTML = '';
    SECTORS.forEach(sector => {
      const card = document.createElement('article');
      card.className = 'sector-card';
      card.innerHTML = `<h3>${sector.title}</h3><p>${sector.desc}</p>`;
      els.sectorGrid.appendChild(card);
    });
  }

  function renderCommunityCampaigns(campaigns) {
    if (!els.communityGrid) return;
    els.communityGrid.innerHTML = '';
    const list = Array.isArray(campaigns) ? campaigns : [];
    if (!list.length) {
      if (els.communityEmpty) {
        els.communityEmpty.hidden = false;
        els.communityEmpty.textContent = 'No community campaigns have launched yet. Share yours to be featured here.';
      }
      return;
    }

    if (els.communityEmpty) {
      els.communityEmpty.hidden = true;
    }

    list.forEach(campaign => {
      const card = document.createElement('article');
      card.className = 'community-card';
      const goal = Number(campaign.goalAmount || 0);
      const raised = Number(campaign.amountRaised || 0);
      const currency = campaign.currency || getCurrencyForRegion(campaign.region);
      const progressPercent = goal > 0 ? Math.min(100, Math.round((raised / goal) * 100)) : 0;
      const goalReached = goal > 0 && raised >= goal;
      const statusMessage = goal > 0
        ? goalReached
          ? 'Goal reached'
          : `${Math.max(0, 100 - progressPercent)}% to goal`
        : 'Open goal';
      const religionLabel = titleize(campaign.religion || '');
      const regionLabel = String(campaign.region || '').toUpperCase();
      const withdrawalLabel = campaign.allowEarlyWithdrawal ? 'Flexible withdrawals' : 'Goal release';
      const metaParts = [religionLabel, regionLabel, withdrawalLabel].filter(Boolean);
      const metaHtml = (metaParts.length ? metaParts : ['Community']).map(part => `<span>${escapeHtml(part)}</span>`).join('');
      const description = truncate(campaign.description || '', 190);
      const paymentLink = campaign?.paymentLink?.url
        ? `<a class="btn" href="${escapeHtml(campaign.paymentLink.url)}" target="_blank" rel="noreferrer">Give now</a>`
        : '';
      const profileDisplay = campaign.profileName ? escapeHtml(campaign.profileName) : 'Anonymous';
      const imageContent = campaign.imageUrl
        ? `<img src="${escapeHtml(campaign.imageUrl)}" alt="${escapeHtml(campaign.profileName || campaign.campaignName || 'Community campaign')}" loading="lazy"/>`
        : `<div class="community-initial">${escapeHtml(initialsFromName(campaign.profileName || campaign.campaignName))}</div>`;
      const raisedLabel = escapeHtml(formatCurrency(raised, currency));
      const goalLabel = escapeHtml(goal > 0 ? `of ${formatCurrency(goal, currency)}` : 'No goal set');
      card.innerHTML = `
        <div class="community-media">${imageContent}</div>
        <div class="community-body">
          <div class="community-meta">${metaHtml}</div>
          <h3>${escapeHtml(campaign.campaignName || '')}</h3>
          <p>${escapeHtml(description)}</p>
          <div class="community-progress">
            <div class="progress-bar"><div style="width:${progressPercent}%"></div></div>
            <div class="progress-meta">
              <span>${raisedLabel}</span>
              <span>${goalLabel}</span>
            </div>
            <span class="community-status${goalReached ? ' goal-met' : ''}">${escapeHtml(statusMessage)}</span>
          </div>
          <div class="community-actions">
            ${paymentLink}
            <span class="community-profile">by ${profileDisplay}</span>
          </div>
        </div>`;
      card.dataset.campaignId = campaign.id || campaign._id || '';
      els.communityGrid.appendChild(card);
    });
  }

  async function loadCommunityCampaigns() {
    if (!els.communityGrid) return;
    try {
      const data = await fetchJSON('/api/giving/community-campaigns');
      const campaigns = Array.isArray(data) ? data : data.campaigns ?? data.data ?? [];
      state.communityCampaigns = campaigns;
      renderCommunityCampaigns(campaigns);
    } catch (err) {
      console.warn('Unable to load community campaigns', err);
      if (els.communityEmpty) {
        els.communityEmpty.hidden = false;
        els.communityEmpty.textContent = 'Unable to load community campaigns right now. Please try again soon.';
      }
    }
  }

  async function loadFaithMetrics(forceRefresh = false) {
    const url = forceRefresh ? '/api/giving/faith-metrics?refresh=1' : '/api/giving/faith-metrics';
    try {
      const data = await fetchJSON(url);
      const payload = data?.faiths ?? data?.metrics ?? {};
      const metricsMap = new Map();
      if (payload instanceof Map) {
        payload.forEach((value, key) => metricsMap.set(key, value));
      } else if (Array.isArray(payload)) {
        payload.forEach(entry => {
          if (entry && typeof entry === 'object') {
            const key = entry.key || entry.faith || entry.id;
            if (key) {
              metricsMap.set(key, entry.value ?? entry.metrics ?? entry);
            }
          }
        });
      } else {
        Object.entries(payload).forEach(([key, value]) => {
          metricsMap.set(key, value);
        });
      }
      state.metricsByFaith = metricsMap;
      state.metricsUpdatedAt = data?.updatedAt || null;
    } catch (error) {
      console.warn('Unable to load faith metrics', error);
      if (!(state.metricsByFaith instanceof Map)) {
        state.metricsByFaith = new Map();
      }
    } finally {
      updateQuickMetricsDisplay();
      updateSlideMetrics();
    }
  }

  function populateSelect(select, values, placeholder) {
    if (!select) return;
    const current = select.value;
    select.innerHTML = '';
    if (placeholder) {
      const opt = option(placeholder, '');
      opt.disabled = true;
      opt.selected = true;
      select.appendChild(opt);
    }
    values.forEach(item => {
      if (typeof item === 'string') {
        select.appendChild(option(item, item));
      } else if (item && typeof item === 'object') {
        const opt = option(item.label ?? item.name ?? item.value, item.value ?? item._id);
        if (item._id) {
          opt.dataset.json = JSON.stringify(item);
        }
        select.appendChild(opt);
      }
    });
    if (current && Array.from(select.options).some(o => o.value === current)) {
      select.value = current;
    }
  }

  function cloneDefaultCampaigns(list) {
    return list.map(campaign => ({
      ...campaign,
      donationTypes: Array.isArray(campaign.donationTypes) ? [...campaign.donationTypes] : undefined
    }));
  }

  function ensureDefaultOrganizations() {
    const seen = new Set(state.orgs.map(org => (org && (org._id ? `id:${org._id}` : `name:${(org.name || '').toLowerCase()}:${org.region || ''}`))));
    DEFAULT_ORGS.forEach(org => {
      const key = org._id ? `id:${org._id}` : `name:${(org.name || '').toLowerCase()}:${org.region || ''}`;
      if (!seen.has(key)) {
        state.orgs.push({
          ...org,
          locales: Array.isArray(org.locales) ? [...org.locales] : []
        });
        seen.add(key);
      }
      if (org._id && DEFAULT_CAMPAIGNS.has(org._id) && !state.campaignsByOrg.has(org._id)) {
        state.campaignsByOrg.set(org._id, cloneDefaultCampaigns(DEFAULT_CAMPAIGNS.get(org._id)));
      }
    });
  }

  function populateFaithSelects() {
    populateSelect(els.donationFaith, FAITH_OPTIONS.map(f => ({ label: f.label, value: f.value })), 'Choose a faith');
    populateSelect(els.setupOrgFaith, FAITH_OPTIONS.map(f => ({ label: f.label, value: f.value })), 'Choose a faith');
  }

  function populateRegionSelects() {
    const regions = SLIDES.map(slide => ({ label: `${slide.name}`, value: slide.id }));
    populateSelect(els.donationRegion, regions, 'Choose a region');
    populateSelect(els.setupOrgRegion, regions, 'Choose a region');
  }

  function populateSectorSelects() {
    populateSelect(els.donationSector, SECTORS.map(s => ({ label: s.title, value: s.value })), 'Select a sector');
  }

  function setDonationTypeOptions(religion) {
    const values = FAITH_TYPES[religion] ?? [];
    const items = values.length ? values : ['general'];
    populateSelect(els.donationType, items.map(v => ({ label: v.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase()), value: v })), 'Select donation type');
  }

  function updateOrgOptions() {
    const region = els.donationRegion.value;
    const faith = els.donationFaith.value;
    const list = state.orgs.filter(org => {
      const regionMatch = !region || org.region === region;
      const faithMatch = !faith || org.religion === faith;
      return regionMatch && faithMatch;
    });
    populateSelect(els.donationOrg, list.map(org => ({ ...org, label: `${org.name} · ${org.region}/${org.religion}`, value: org._id })), 'Choose an organization');
    populateSelect(els.setupCampaignOrg, state.orgs.map(org => ({ ...org, label: `${org.name} (${org.region})`, value: org._id })), 'Choose an organization');
    els.orgEmpty.hidden = list.length > 0 || state.orgs.length === 0;
  }

  function updateCampaignOptions(orgId) {
    const campaigns = state.campaignsByOrg.get(orgId) ?? [];
    populateSelect(
      els.donationCampaign,
      campaigns.map(campaign => ({
        ...campaign,
        label: campaign.sectorFocus
          ? `${campaign.name} (${SECTOR_TITLE_LOOKUP.get(campaign.sectorFocus) || campaign.sectorFocus})`
          : campaign.name,
        value: campaign._id
      })),
      'Choose a campaign'
    );
  }

  function hydrateDonationTypesFromCampaign(campaign) {
    if (!campaign) return;
    const donationTypes = Array.isArray(campaign.donationTypes) && campaign.donationTypes.length ? campaign.donationTypes : undefined;
    if (donationTypes) {
      populateSelect(els.donationType, donationTypes.map(v => ({ label: v.replace(/_/g, ' ').replace(/\b\w/g, ch => ch.toUpperCase()), value: v })), 'Select donation type');
    }
    if (campaign.sectorFocus) {
      const hasSectorOption = Array.from(els.donationSector.options).some(opt => opt.value === campaign.sectorFocus);
      if (hasSectorOption) {
        els.donationSector.value = campaign.sectorFocus;
      }
    }
  }

  async function fetchJSON(url) {
    const res = await fetch(url, { headers: { 'Accept': 'application/json' } });
    if (!res.ok) {
      throw new Error(res.statusText || 'Request failed');
    }
    return res.json();
  }

  async function postJSON(url, payload) {
    const res = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      body: JSON.stringify(payload)
    });
    if (!res.ok) {
      const text = await res.text();
      throw new Error(text || res.statusText || 'Request failed');
    }
    return res.json();
  }

  async function loadOrganizations() {
    try {
      const data = await fetchJSON('/api/giving/organizations');
      const orgs = Array.isArray(data) ? data : data.organizations ?? data.data ?? [];
      if (Array.isArray(orgs)) {
        state.orgs = orgs.slice();
      }
    } catch (err) {
      console.warn('Unable to load organizations', err);
      state.orgs = [];
    }
    ensureDefaultOrganizations();
    updateOrgOptions();
  }

  async function loadCampaigns(orgId) {
    if (!orgId) return;
    if (!state.campaignsByOrg.has(orgId) && DEFAULT_CAMPAIGNS.has(orgId)) {
      state.campaignsByOrg.set(orgId, cloneDefaultCampaigns(DEFAULT_CAMPAIGNS.get(orgId)));
    }
    if (state.campaignFetchAttempts.has(orgId)) return;
    state.campaignFetchAttempts.add(orgId);
    try {
      const data = await fetchJSON(`/api/giving/campaigns?orgId=${encodeURIComponent(orgId)}`);
      const campaigns = Array.isArray(data) ? data : data.campaigns ?? data.data ?? [];
      if (Array.isArray(campaigns)) {
        state.campaignsByOrg.set(orgId, campaigns);
      }
    } catch (err) {
      console.warn('Unable to load campaigns', err);
      if (!state.campaignsByOrg.has(orgId) || !state.campaignsByOrg.get(orgId)?.length) {
        state.campaignsByOrg.set(orgId, cloneDefaultCampaigns(DEFAULT_CAMPAIGNS.get(orgId) ?? []));
      }
    }
  }

  function findQuickOrgForFaith(faith) {
    if (!faith) return null;
    const match = state.orgs.find(org => org?.religion === faith);
    if (match) return match;
    return DEFAULT_ORGS.find(org => org.religion === faith) || null;
  }

  function findQuickCampaignForOrg(orgId) {
    if (!orgId) return null;
    const list = state.campaignsByOrg.get(orgId);
    if (Array.isArray(list) && list.length) {
      return list[0];
    }
    const fallback = DEFAULT_CAMPAIGNS.get(orgId);
    if (Array.isArray(fallback) && fallback.length) {
      return fallback[0];
    }
    return null;
  }

  async function performQuickCheckout(mode, quickState, elements) {
    if (!quickState || !elements) return;
    const { status, result, link, copy, amountButtons, generateBtn, shareBtn } = elements;

    const toggleBusy = (disabled) => {
      [generateBtn, shareBtn].forEach((btn) => {
        if (btn) {
          btn.disabled = disabled;
        }
      });
    };

    if (result) {
      result.hidden = true;
    }
    if (link) {
      link.textContent = '';
      link.removeAttribute('href');
    }
    if (copy) {
      copy.disabled = false;
      copy.textContent = 'Copy link';
    }
    clearStatus(status);

    try {
      const config = QUICK_FAITH_MAP.get(quickState.faith);
      if (!config) {
        throw new Error('Pick a tradition to start a checkout.');
      }

      const activeButton = amountButtons?.[quickState.selectedIndex];
      const amount = Number(activeButton?.dataset.amountValue ?? 0);
      if (!Number.isFinite(amount) || amount <= 0) {
        throw new Error('Choose an amount first.');
      }
      if (amount > STRIPE_MAX_AMOUNT) {
        throw new Error('Stripe supports donations up to 999,999,999,999 in your currency. Try a smaller gift.');
      }

      const org = findQuickOrgForFaith(quickState.faith);
      if (!org || !org._id) {
        throw new Error('No organization is available for this lane yet. Add one in the management tab.');
      }

      await loadCampaigns(org._id);
      const campaign = findQuickCampaignForOrg(org._id);
      if (!campaign || !campaign._id) {
        throw new Error('No campaign is ready for this organization yet. Create one to continue.');
      }

      const donationTypes = Array.isArray(campaign.donationTypes) ? campaign.donationTypes : [];
      const payload = {
        orgId: org._id,
        campaignId: campaign._id,
        region: org.region,
        religion: quickState.faith,
        donationType: donationTypes[0] || 'general',
        sector: campaign.sectorFocus,
        amount,
        currency: campaign.currency || config.currency || getCurrencyForRegion(org.region),
        interval: undefined,
        allowPromo: true,
        campaignName: campaign.name,
        orgName: org.name,
        description: campaign.description
      };

      setStatus(status, mode === 'checkout' ? 'Preparing your checkout…' : 'Generating a shareable link…');
      toggleBusy(true);
      const data = await postJSON('/api/giving/payment-link', payload);
      const url = data?.url;
      if (!url) {
        throw new Error('Payment link not returned.');
      }

      if (link) {
        link.href = url;
        link.textContent = url;
      }
      if (result) {
        result.hidden = false;
      }

      let finalMessage = mode === 'checkout'
        ? 'Checkout ready! We opened it in a new tab.'
        : 'Donation link ready—copy it from below.';

      if (mode === 'checkout') {
        try {
          window.open(url, '_blank', 'noopener');
        } catch (err) {
          console.warn('Popup blocked', err);
          finalMessage = 'Checkout ready. Use the link below if the popup was blocked.';
        }
      } else if (navigator?.clipboard) {
        try {
          await navigator.clipboard.writeText(url);
          finalMessage = 'Donation link copied to your clipboard!';
          if (copy) {
            copy.disabled = true;
            copy.textContent = 'Copied!';
            setTimeout(() => {
              if (copy) {
                copy.disabled = false;
                copy.textContent = 'Copy link';
              }
            }, 2400);
          }
        } catch (err) {
          console.warn('Clipboard copy failed', err);
        }
      }

      setStatus(status, finalMessage, 'success');
    } catch (error) {
      setStatus(status, error?.message || 'Unable to generate checkout', 'error');
    } finally {
      toggleBusy(false);
    }
  }

  function handleOrgSelection() {
    const select = els.donationOrg;
    const option = select.options[select.selectedIndex];
    if (option?.dataset?.json) {
      try {
        const org = JSON.parse(option.dataset.json);
        if (org.region) {
          els.donationRegion.value = org.region;
        }
        if (org.religion) {
          els.donationFaith.value = org.religion;
          setDonationTypeOptions(org.religion);
        }
      } catch (err) {
        console.warn('Unable to parse organization option', err);
      }
    }
  }

  function extractCampaignFromSelect() {
    const select = els.donationCampaign;
    const option = select.options[select.selectedIndex];
    if (option?.dataset?.json) {
      try {
        return JSON.parse(option.dataset.json);
      } catch (err) {
        console.warn('Unable to parse campaign option', err);
      }
    }
    return null;
  }

  function prepareDonationPayload() {
    const orgId = els.donationOrg.value;
    const campaignId = els.donationCampaign.value;
    if (!orgId || !campaignId) {
      throw new Error('Select an organization and campaign.');
    }
    const frequency = els.donationFrequency.value;
    const interval = frequency === 'one_time' ? undefined : frequency;
    const amount = Number(els.donationAmount.value);
    if (!amount || Number.isNaN(amount)) {
      throw new Error('Enter a donation amount.');
    }
    if (amount > STRIPE_MAX_AMOUNT) {
      throw new Error('Stripe supports donations up to 999,999,999,999 in your currency. Enter a smaller amount.');
    }
    const org = state.orgs.find(item => item?._id === orgId);
    const campaign = extractCampaignFromSelect();
    const currency = (campaign?.currency || org?.currency || getCurrencyForRegion(els.donationRegion.value));
    const payload = {
      orgId,
      campaignId,
      region: els.donationRegion.value,
      religion: els.donationFaith.value,
      donationType: els.donationType.value,
      sector: els.donationSector.value,
      amount,
      interval,
      currency,
      campaignName: campaign?.name,
      orgName: org?.name,
      description: campaign?.description,
      allowPromo: els.donationPromo.value === 'true',
      donor: {
        name: els.donationName.value,
        email: els.donationEmail.value,
        notes: els.donationNotes.value.trim() || undefined
      }
    };
    return payload;
  }

  function attachEvents() {
    els.prevSlide.addEventListener('click', () => prevSlide());
    els.nextSlide.addEventListener('click', () => { nextSlide(true); });
    resetAutoSlide();

    els.donationFaith.addEventListener('change', () => {
      setDonationTypeOptions(els.donationFaith.value);
      updateOrgOptions();
    });
    els.donationRegion.addEventListener('change', () => {
      updateOrgOptions();
    });
    els.donationOrg.addEventListener('change', async () => {
      handleOrgSelection();
      const orgId = els.donationOrg.value;
      await loadCampaigns(orgId);
      updateCampaignOptions(orgId);
    });
    els.donationCampaign.addEventListener('change', () => {
      const campaign = extractCampaignFromSelect();
      hydrateDonationTypesFromCampaign(campaign);
    });

    els.donationForm.addEventListener('submit', async event => {
      event.preventDefault();
      clearStatus(els.donationStatus);
      els.donationResult.hidden = true;
      try {
        const payload = prepareDonationPayload();
        setStatus(els.donationStatus, 'Generating Stripe checkout…');
        const data = await postJSON('/api/giving/payment-link', payload);
        const url = data?.url;
        if (!url) {
          throw new Error('Payment link not returned.');
        }
        setStatus(els.donationStatus, 'Payment link ready!', 'success');
        els.donationLink.href = url;
        els.donationLink.textContent = url;
        els.donationMeta.textContent = JSON.stringify(data.meta ?? payload, null, 2);
        els.donationResult.hidden = false;
        try {
          window.open(url, '_blank', 'noopener');
        } catch (err) {
          console.warn('Popup blocked', err);
        }
      } catch (err) {
        setStatus(els.donationStatus, err.message || 'Unable to generate payment link', 'error');
      }
    });

    els.setupOrgForm.addEventListener('submit', async event => {
      event.preventDefault();
      clearStatus(els.setupOrgStatus);
      try {
        const payload = {
          name: els.setupOrgName.value,
          region: els.setupOrgRegion.value,
          religion: els.setupOrgFaith.value,
          locales: els.setupOrgLocales.value.split(',').map(x => x.trim()).filter(Boolean),
          timezone: els.setupOrgTimezone.value || undefined,
          stripeAccountId: els.setupOrgStripe.value || undefined
        };
        setStatus(els.setupOrgStatus, 'Saving organization…');
        const data = await postJSON('/api/giving/organizations', payload);
        const org = data?.organization ?? data;
        if (!org?._id) {
          throw new Error('Organization was not returned.');
        }
        state.orgs.push(org);
        updateOrgOptions();
        setStatus(els.setupOrgStatus, `${org.name} is ready for donations.`, 'success');
        els.setupOrgForm.reset();
      } catch (err) {
        setStatus(els.setupOrgStatus, err.message || 'Unable to save organization', 'error');
      }
    });

    els.setupCampaignForm.addEventListener('submit', async event => {
      event.preventDefault();
      clearStatus(els.setupCampaignStatus);
      try {
        const orgId = els.setupCampaignOrg.value;
        if (!orgId) {
          throw new Error('Select an organization first.');
        }
        const donationTypes = els.setupCampaignTypes.value.split(',').map(x => x.trim()).filter(Boolean);
        const payload = {
          orgId,
          name: els.setupCampaignName.value,
          code: els.setupCampaignCode.value || undefined,
          donationTypes: donationTypes.length ? donationTypes : undefined
        };
        setStatus(els.setupCampaignStatus, 'Saving campaign…');
        const data = await postJSON('/api/giving/campaigns', payload);
        const campaign = data?.campaign ?? data;
        if (!campaign?._id) {
          throw new Error('Campaign was not returned.');
        }
        const list = state.campaignsByOrg.get(orgId) ?? [];
        list.push(campaign);
        state.campaignsByOrg.set(orgId, list);
        updateCampaignOptions(orgId);
        setStatus(els.setupCampaignStatus, `${campaign.name} is ready for donors.`, 'success');
        els.setupCampaignForm.reset();
      } catch (err) {
        setStatus(els.setupCampaignStatus, err.message || 'Unable to save campaign', 'error');
      }
    });
  }

  function setupManagementTabs() {
    const container = els.manageCard;
    if (!container) return;
    const buttons = Array.from(container.querySelectorAll('[data-tab-target]'));
    if (!buttons.length) return;
    const panels = new Map();
    buttons.forEach(button => {
      const targetId = button.dataset.tabTarget;
      if (targetId) {
        const panel = document.getElementById(targetId);
        if (panel) {
          panels.set(targetId, panel);
        }
      }
    });

    function activate(button) {
      const targetId = button.dataset.tabTarget;
      if (!targetId || !panels.has(targetId)) return;
      buttons.forEach(btn => {
        const isActive = btn === button;
        btn.classList.toggle('is-active', isActive);
        btn.setAttribute('aria-selected', String(isActive));
        btn.tabIndex = isActive ? 0 : -1;
      });
      panels.forEach((panel, id) => {
        const isActive = id === targetId;
        panel.hidden = !isActive;
        panel.classList.toggle('is-active', isActive);
      });
    }

    buttons.forEach((button, index) => {
      button.addEventListener('click', () => activate(button));
      button.addEventListener('keydown', event => {
        if (event.key !== 'ArrowRight' && event.key !== 'ArrowLeft') return;
        event.preventDefault();
        const offset = event.key === 'ArrowRight' ? 1 : -1;
        const nextIndex = (index + offset + buttons.length) % buttons.length;
        const nextButton = buttons[nextIndex];
        if (nextButton) {
          nextButton.focus();
          activate(nextButton);
        }
      });
    });

    const initial = buttons.find(btn => btn.classList.contains('is-active')) ?? buttons[0];
    if (initial) {
      activate(initial);
    }
  }

  function init() {
    renderSlides();
    if (typeof window !== 'undefined') {
      window.addEventListener('resize', () => updateTransitionOverlayForIndex(state.slideIndex));
    }
    renderSectors();
    populateRegionSelects();
    populateFaithSelects();
    populateSectorSelects();
    setDonationTypeOptions(els.donationFaith.value);
    setupManagementTabs();
    attachEvents();
    ensureDefaultOrganizations();
    updateOrgOptions();
    loadOrganizations();
    loadCommunityCampaigns();
    loadFaithMetrics();
    document.getElementById('year').textContent = new Date().getFullYear();
  }

  init();
</script>
</body>
</html>
