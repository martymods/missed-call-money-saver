<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>DelcoTech Division — Xbox 360 Vault</title>
<meta name="description" content="Vintage Xbox 360 shop. $5 a game. 3D cases, trailers, and an addictive cart experience."/>
<style>
  :root{
    --ink:#e6ebff; --muted:#97a0c9; --bg:#0a0d1a; --panel:#0e1330; --edge:#141a3f;
    --brand:#41ff7a; --brand2:#00e5ff; --danger:#ff4571; --gold:#ffd166;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font:15px/1.5 Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;color:var(--ink);background:
    radial-gradient(1200px 600px at 10% -10%, rgba(65,255,122,.08), transparent 60%),
    radial-gradient(1200px 600px at 110% 10%, rgba(0,229,255,.08), transparent 60%),
    #070a16}
  a{color:var(--brand)}
  .wrap{max-width:1200px;margin:auto;padding:18px}
  header{display:flex;gap:14px;align-items:center;justify-content:space-between;margin-bottom:8px}
  .logo{display:flex;gap:10px;align-items:center}
.logo i{
  width:30px;height:30px;display:inline-block;border-radius:8px;
  background: linear-gradient(135deg, var(--brand), var(--brand2));
  box-shadow: 0 8px 28px rgba(0,229,255,.25);
}

  h1{font-size:22px;margin:0}
  .tag{font-size:12px;color:var(--muted)}
  .cartBtn{position:relative;border:1px solid #1d2452;background:linear-gradient(180deg,#121941,#0c1130);
    color:#fff;border-radius:12px;padding:10px 12px;display:flex;align-items:center;gap:10px;cursor:pointer;
    box-shadow:0 8px 28px rgba(0,0,0,.4)}
  .cartBtn .count{min-width:20px;height:20px;border-radius:999px;background:var(--danger);
    display:inline-flex;align-items:center;justify-content:center;font-size:12px;font-weight:800}
  .combo{font-weight:900;color:var(--gold);text-shadow:0 0 12px rgba(255,209,102,.5)}
  .hero{display:flex;gap:18px;flex-wrap:wrap;align-items:center;justify-content:space-between;
    border:1px solid var(--edge);background:linear-gradient(180deg,#0b0f26,#0b0e22);
    border-radius:16px;padding:14px;box-shadow:0 20px 50px rgba(0,10,40,.4)}
  .hero h2{margin:0;font-size:18px}
  .hero p{margin:4px 0 0;color:var(--muted)}
  .grid{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:14px;margin-top:18px}
  @media (max-width:1100px){ .grid{grid-template-columns:repeat(4,1fr)} }
  @media (max-width:900px){ .grid{grid-template-columns:repeat(3,1fr)} }
  @media (max-width:640px){ .grid{grid-template-columns:repeat(2,1fr)} }

  /* 3D case card */
  .card{position:relative;border:1px solid var(--edge);background:linear-gradient(180deg,#0e1433,#0a1029);
    border-radius:16px;padding:12px;overflow:hidden;box-shadow:0 16px 40px rgba(0,0,0,.45)}
  .caseWrap{perspective:800px;height:220px;position:relative}
  .case{width:100%;height:100%;position:relative;transform-style:preserve-3d;transform:rotateY(-14deg);
    transition:transform .25s ease}
  .card:hover .case{transform:rotateY(-4deg) translateZ(0)}
  .cover{position:absolute;inset:0;border-radius:8px;overflow:hidden;transform:translateZ(18px)}
  .cover img{width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.05) contrast(1.05)}
  .spine{position:absolute;top:0;left:-8px;height:100%;width:18px;border-radius:6px;transform:rotateY(90deg) translateZ(9px);
    transform-origin:left center;background:linear-gradient(90deg,#a5ffbf 0%,#4bff85 20%,#1f9c3e 100%);}
  .shine{pointer-events:none;position:absolute;inset:-40%;background:linear-gradient(75deg,transparent 40%,rgba(255,255,255,.12) 46%,transparent 54%);
    transform:translateX(-80%) rotateZ(8deg);animation:shine 3.5s ease infinite}
  @keyframes shine{0%{transform:translateX(-80%) rotateZ(8deg)} 100%{transform:translateX(80%) rotateZ(8deg)}}

  .meta{margin-top:10px;display:flex;align-items:center;justify-content:space-between;gap:10px}
  .title{font-weight:900;font-size:14px}
  .price{font-weight:800;color:var(--brand)}
  .actions{display:flex;gap:8px}
  .btn{cursor:pointer;border:1px solid #1e2550;background:#121941;color:#fff;border-radius:10px;padding:9px 10px;font-weight:800}
  .btn.buy{background:linear-gradient(180deg,#23ff8f,#00e3ff);color:#06111a;border:0}
  .btn.ghost{background:transparent;color:var(--muted)}

  /* Fly-to-cart animation clone */
  .fly{position:fixed;z-index:9999;pointer-events:none;transition:transform .65s cubic-bezier(.22,.9,.24,1), opacity .65s}
  /* Mini toasts */
  .toast{position:fixed;right:18px;bottom:78px;background:#0f1642;border:1px solid #26306b;border-radius:12px;padding:10px 12px;
    color:#dfe6ff;font-weight:800;box-shadow:0 12px 34px rgba(0,0,0,.4);opacity:0;transform:translateY(8px);
    animation:toast .9s ease forwards}
  @keyframes toast{0%{opacity:0;transform:translateY(8px)}10%{opacity:1;transform:none}80%{opacity:1}100%{opacity:0;transform:translateY(8px)}}

  /* Cart panel */
  .cart{position:fixed;right:18px;bottom:18px;width:340px;max-width:calc(100vw - 36px);
    background:linear-gradient(180deg,#0c1238,#0a0f2d);border:1px solid #1d2452;border-radius:16px;padding:12px;display:none;z-index:9998;
    box-shadow:0 18px 54px rgba(0,0,0,.6)}
  .cart.show{display:block}
  .cart h3{margin:0 0 6px 0;font-size:16px}
  .cart .line{display:flex;align-items:center;gap:10px;padding:8px 6px;border-radius:10px}
  .cart .line:hover{background:#0f1743}
  .thumb{width:44px;height:44px;border-radius:6px;overflow:hidden;border:1px solid #28306a}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .grow{flex:1}
  .qty{display:flex;gap:6px;align-items:center}
  .qbtn{width:28px;height:28px;border-radius:8px;border:1px solid #2a3470;background:#121941;color:#fff;font-weight:900;cursor:pointer}
  .sum{display:flex;align-items:center;justify-content:space-between;margin-top:10px;padding-top:10px;border-top:1px dashed #26316d}
  .checkout{width:100%;margin-top:10px;background:linear-gradient(180deg,#23ff8f,#00e3ff);color:#06111a;border:0;padding:12px;border-radius:12px;font-weight:900;cursor:pointer}
  .empty{color:var(--muted);text-align:center;padding:14px 4px}
  .yt{border:1px solid #1e2550;border-radius:12px;overflow:hidden;margin-top:8px}

  /* Floating confetti bits (tiny + cheap) */
  .bits{position:fixed;pointer-events:none;inset:0;z-index:9997}
  .bit{position:absolute;width:6px;height:6px;background:var(--brand2);opacity:0;animation:pop .9s ease forwards}
  @keyframes pop{0%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(40px) rotate(90deg)}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo"><i></i><div>
        <h1>Xbox 360 Vault</h1>
        <div class="tag">$5 each • real discs • fast ship • addictive stacking</div>
      </div></div>
      <button id="openCart" class="cartBtn" aria-label="Open cart">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M6 6h14l-1.5 9h-11L5 4H2" stroke="white" stroke-width="2" stroke-linecap="round"/><circle cx="9" cy="20" r="1.6" fill="white"/><circle cx="17" cy="20" r="1.6" fill="white"/></svg>
        <span class="count" id="cartCount">0</span>
        <span class="combo" id="comboText"></span>
      </button>
    </header>

    <section class="hero">
      <div>
        <h2>Spin the cases. Stack your haul.</h2>
        <p>Every Xbox 360 game is <b>$5</b> right now. Tap a case → fly-to-cart → stack combos for dopamine hits.</p>
      </div>
      <div class="yt" style="width:360px;max-width:100%">
        <!-- Trailer embed (example — you can swap per-game in the modal later) -->
        <iframe width="360" height="202" src="https://www.youtube.com/embed/T9Ezd2FqxAU"
          title="Halo 3 Trailer" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen></iframe>
      </div>
    </section>

    <!-- Grid of games (seeded; wire to APIs later) -->
    <div id="grid" class="grid"></div>
  </div>

  <!-- Cart panel -->
  <div id="cart" class="cart" role="dialog" aria-label="Your cart">
    <h3>Your Stack</h3>
    <div id="lines"></div>
    <div class="sum">
      <div><b>Subtotal</b></div>
      <div id="subtotal">$0</div>
    </div>
    <button id="checkout" class="checkout">Checkout with Stripe</button>
    <div id="empty" class="empty" style="display:none">Cart is empty. Add a case ↑</div>
  </div>

  <div id="bits" class="bits"></div>

<script>
/** ---- Config & seed data (replace with API-fed list later) ---- **/
const PRICE_EACH = 5; // USD
// Minimal seed (cover URLs can be swapped to RAWG/IGDB later)
const GAMES = [
  { id:'halo-3',       title:'Halo 3',                cover:'https://m.media-amazon.com/images/I/71J8l+o4gAL._AC_UF894,1000_QL80_.jpg', yt:'T9Ezd2FqxAU' },
  { id:'gow2',         title:'Gears of War 2',        cover:'https://m.media-amazon.com/images/I/71c-5Wz3d0L._AC_UF894,1000_QL80_.jpg', yt:'Yk9G7OyU9CY' },
  { id:'fable-2',      title:'Fable II',              cover:'https://m.media-amazon.com/images/I/81wM8GZcTWL._AC_UF894,1000_QL80_.jpg', yt:'1Xh3ZrQK1k8' },
  { id:'skyrim',       title:'The Elder Scrolls V: Skyrim', cover:'https://m.media-amazon.com/images/I/61+PqVkC1ML._AC_UF894,1000_QL80_.jpg', yt:'JSRtYpNRoN0' },
  { id:'forza-4',      title:'Forza Motorsport 4',    cover:'https://m.media-amazon.com/images/I/71pD4qKqPlL._AC_UF894,1000_QL80_.jpg', yt:'6v2L2UGZJAM' },
  { id:'cod-mw2',      title:'Call of Duty: Modern Warfare 2', cover:'https://m.media-amazon.com/images/I/81cRr8b2FhL._AC_UF894,1000_QL80_.jpg', yt:'coiTJbr9m04' },
  { id:'red-dead',     title:'Red Dead Redemption',   cover:'https://m.media-amazon.com/images/I/91fTwJ0PsrL._AC_UF894,1000_QL80_.jpg', yt:'MemkzzlQJ6Y' },
  { id:'bioshock',     title:'BioShock',              cover:'https://m.media-amazon.com/images/I/81m9kUtLHJL._AC_UF894,1000_QL80_.jpg', yt:'2bZk3E3vSRA' },
  { id:'assassins',    title:'Assassin’s Creed II',   cover:'https://m.media-amazon.com/images/I/71O1yJ9D0rL._AC_UF894,1000_QL80_.jpg', yt:'mbahj7gSIU8' },
  { id:'nfss',         title:'Need for Speed: Shift', cover:'https://m.media-amazon.com/images/I/81vQy6s3bBL._AC_UF894,1000_QL80_.jpg', yt:'wq6vNusJygk' },
];

/** ---- State ---- **/
let cart = JSON.parse(localStorage.getItem('x360_cart')||'[]'); // [{id,qty}]
let lastAddTs = 0, combo = 0;

/** ---- Helpers ---- **/
const $ = sel => document.querySelector(sel);
function fmtUSD(n){ return '$' + n.toFixed(2); }
function save(){ localStorage.setItem('x360_cart', JSON.stringify(cart)); }
function gameById(id){ return GAMES.find(g=>g.id===id); }
function recalc(){
  const count = cart.reduce((a,b)=>a+b.qty,0);
  $('#cartCount').textContent = count;
  const subtotal = count * PRICE_EACH;
  $('#subtotal').textContent = fmtUSD(subtotal);
  $('#empty').style.display = count? 'none':'block';
}
function renderGrid(){
  const grid = $('#grid'); grid.innerHTML='';
  GAMES.forEach(g=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `
      <div class="caseWrap">
        <div class="case">
          <span class="spine"></span>
          <div class="cover"><img src="${g.cover}" alt="${g.title} cover"/></div>
          <div class="shine"></div>
        </div>
      </div>
      <div class="meta">
        <div class="title">${g.title}</div>
        <div class="price">$${PRICE_EACH}</div>
      </div>
      <div class="actions">
        <button class="btn ghost" data-yt="${g.yt}">Trailer</button>
        <button class="btn buy" data-id="${g.id}">Add</button>
      </div>
    `;
    grid.appendChild(card);
  });
}
function renderCart(){
  const lines = $('#lines'); lines.innerHTML='';
  cart.forEach(row=>{
    const g = gameById(row.id); if(!g) return;
    const div = document.createElement('div'); div.className='line';
    div.innerHTML = `
      <div class="thumb"><img src="${g.cover}" alt=""></div>
      <div class="grow">
        <div style="font-weight:800">${g.title}</div>
        <div class="tag">$${PRICE_EACH} each</div>
      </div>
      <div class="qty">
        <button class="qbtn" data-dec="${g.id}">−</button>
        <div style="min-width:20px;text-align:center">${row.qty}</div>
        <button class="qbtn" data-inc="${g.id}">+</button>
      </div>
    `;
    lines.appendChild(div);
  });
}
function showToast(text){
  const t = document.createElement('div'); t.className='toast'; t.textContent = text;
  document.body.appendChild(t);
  setTimeout(()=> t.remove(), 1000);
}
function bits(x,y){
  const wrap = $('#bits');
  for(let i=0;i<10;i++){
    const b = document.createElement('div'); b.className='bit';
    b.style.left = (x + (Math.random()*40-20))+'px';
    b.style.top  = (y + (Math.random()*10-5))+'px';
    b.style.background = i%2? 'var(--brand)':'var(--brand2)';
    b.style.animationDelay = (Math.random()*0.2)+'s';
    wrap.appendChild(b);
    setTimeout(()=> b.remove(), 900);
  }
}
function flyToCart(fromEl){
  const rect = fromEl.getBoundingClientRect();
  const cartBtn = $('#openCart').getBoundingClientRect();
  const clone = fromEl.cloneNode(true);
  clone.className='fly';
  clone.style.left = rect.left+'px';
  clone.style.top  = rect.top +'px';
  clone.style.width= rect.width+'px';
  clone.style.height= rect.height+'px';
  clone.style.borderRadius='10px';
  document.body.appendChild(clone);
  const dx = cartBtn.left - rect.left;
  const dy = cartBtn.top  - rect.top;
  requestAnimationFrame(()=>{
    clone.style.transform = `translate(${dx}px, ${dy}px) scale(.15)`;
    clone.style.opacity = '.2';
  });
  setTimeout(()=> clone.remove(), 700);
}

/** ---- Events ---- **/
function add(id, fromEl){
  const now = Date.now();
  if (now - lastAddTs < 1200) { combo++; } else { combo = 1; }
  lastAddTs = now;
  const row = cart.find(r=>r.id===id);
  if (row) row.qty++; else cart.push({id, qty:1});
  save(); renderCart(); recalc();

  if (fromEl) flyToCart(fromEl);
  $('#comboText').textContent = combo > 1 ? `x${combo}` : '';
  showToast(combo>1 ? `STACK COMBO x${combo}!` : `+1 added`);
  bits($('#openCart').getBoundingClientRect().left, $('#openCart').getBoundingClientRect().top);
}

function dec(id){ const i=cart.findIndex(r=>r.id===id); if(i>-1){ cart[i].qty--; if(cart[i].qty<=0) cart.splice(i,1); save(); renderCart(); recalc(); } }
function inc(id){ const i=cart.findIndex(r=>r.id===id); if(i>-1){ cart[i].qty++; save(); renderCart(); recalc(); } }

/** ---- Bootstrap ---- **/
renderGrid(); renderCart(); recalc();

document.addEventListener('click', (e)=>{
  const addBtn = e.target.closest('.btn.buy');
  if (addBtn){
    const id = addBtn.getAttribute('data-id');
    const card = addBtn.closest('.card').querySelector('.cover');
    add(id, card);
  }
  const trailer = e.target.closest('[data-yt]');
  if (trailer){
    const vid = trailer.getAttribute('data-yt');
    window.open(`https://www.youtube.com/watch?v=${vid}`,'_blank','noopener');
  }
  if (e.target.closest('#openCart')){
    $('#cart').classList.toggle('show');
  }
  const decBtn = e.target.closest('[data-dec]');
  if (decBtn){ dec(decBtn.getAttribute('data-dec')); }
  const incBtn = e.target.closest('[data-inc]');
  if (incBtn){ inc(incBtn.getAttribute('data-inc')); }
});

document.getElementById('checkout').onclick = async ()=>{
  if (!cart.length) { showToast('Add something first'); return; }
  // Build payload for server: explode into line_items ($5 each)
  const items = cart.flatMap(row => Array.from({length:row.qty}, ()=>({
      id: row.id, title: gameById(row.id)?.title || 'Xbox 360 Game', price: PRICE_EACH
  })));
  const r = await fetch('/api/store/checkout', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ items })
  }).then(r=>r.json()).catch(()=>null);
  if (r?.url) location.href = r.url; else showToast('Checkout failed');
};
</script>
</body>
</html>
