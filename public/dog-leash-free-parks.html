
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Leash-Free Dog Parks Finder | Off-Leash Parks Across the USA</title>
  <meta name="description" content="Search a curated directory of leash-free and off-leash dog parks across the United States. Filter by state, region, amenities, and fees to plan your next dog adventure."/>
  <style>
    :root{
      color-scheme: light dark;
      --bg:#0f172a;--surface:#162446;--ink:#f8fafc;--muted:#cbd5f5;
      --accent:#38bdf8;--accent-soft:rgba(56,189,248,.16);--border:rgba(255,255,255,.14);
      --shadow:0 20px 50px rgba(15,23,42,.32);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    *,*::before,*::after{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b1430 0%,#020617 65%);color:var(--ink);min-height:100vh;display:flex;flex-direction:column}
    header{position:sticky;top:0;z-index:20;background:rgba(8,14,30,.85);backdrop-filter:blur(16px);border-bottom:1px solid rgba(148,163,184,.15)}
    .wrap{max-width:1100px;margin:0 auto;padding:20px 18px}
    .hero{display:grid;gap:12px}
    h1{margin:0;font-size:2.2rem;font-weight:800;letter-spacing:-.02em}
    p.lead{margin:0;color:var(--muted)}
    .tag{display:inline-block;margin-top:8px;padding:6px 10px;border-radius:999px;background:var(--accent-soft);color:var(--accent);font-weight:700;font-size:.85rem}

    main{flex:1}
    .filters{margin-top:16px;display:grid;gap:14px;background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    .filters .inputs{display:grid;gap:14px}
    .field label{font-size:.8rem;text-transform:uppercase;letter-spacing:.08em;color:var(--muted);display:block;margin-bottom:6px}
    input[type="search"],select{padding:12px 14px;border-radius:12px;border:1px solid rgba(148,163,184,.2);background:rgba(15,23,42,.82);color:var(--ink)}
    .toggles{display:flex;flex-wrap:wrap;gap:10px}
    .toggle{display:flex;align-items:center;gap:8px;background:rgba(15,23,42,.72);border:1px solid rgba(148,163,184,.24);padding:8px 12px;border-radius:12px}
    .results-meta{margin:18px 0 10px;display:flex;flex-wrap:wrap;gap:10px;align-items:center;color:var(--muted)}

    .grid{display:grid;gap:18px}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:18px;padding:16px;box-shadow:var(--shadow);display:grid;gap:10px}
    .title{display:flex;gap:10px;align-items:center;justify-content:space-between}
    .card h2{margin:0;font-size:1.25rem}
    .meta{color:var(--muted);font-size:.95rem}
    .badges{display:flex;flex-wrap:wrap;gap:8px}
    .badge{background:rgba(148,163,184,.14);color:var(--muted);padding:5px 10px;border-radius:999px;font-size:.78rem;font-weight:600}

    /* media */
    .media{position:relative;border-radius:14px;overflow:hidden;aspect-ratio:16/9;background:linear-gradient(180deg,rgba(2,8,23,.5),rgba(2,8,23,.8))}
    .media img{width:100%;height:100%;object-fit:cover;display:block}
    .ph{position:absolute;inset:0;display:grid;place-items:center;color:var(--muted);font-size:.9rem;border:1px dashed rgba(148,163,184,.28)}
    .img-fade{opacity:0;transition:opacity .35s ease}
    .img-fade.loaded{opacity:1}

    /* small map chip */
    .chip{position:absolute;right:10px;bottom:10px;border:1px solid rgba(255,255,255,.35);border-radius:10px;overflow:hidden;box-shadow:0 8px 16px rgba(0,0,0,.35)}
    .chip img{width:160px;height:100px;object-fit:cover;display:block}

    .actions{display:flex;flex-wrap:wrap;gap:10px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:9px 12px;border-radius:12px;font-weight:600;font-size:.9rem;background:rgba(56,189,248,.16);color:#0ea5e9;border:1px solid rgba(56,189,248,.24);text-decoration:none}
    .btn.secondary{background:rgba(15,23,42,.68);border-color:rgba(148,163,184,.28);color:var(--muted)}
    footer{border-top:1px solid rgba(148,163,184,.2);padding:24px 18px;color:var(--muted);text-align:center;font-size:.85rem}

    @media (min-width:720px){
      .filters .inputs{grid-template-columns:repeat(4,minmax(0,1fr))}
      .grid{grid-template-columns:repeat(auto-fill,minmax(320px,1fr))}
      .card{padding:18px}
    }
    @media (prefers-color-scheme:light){
      :root{--bg:#f8fafc;--surface:#ffffff;--ink:#0f172a;--muted:#475569;--accent:#0284c7;--accent-soft:rgba(2,132,199,.12);--border:rgba(15,23,42,.10);--shadow:0 18px 50px rgba(15,23,42,.12)}
      body{background:linear-gradient(180deg,#e0f2fe 0%,#f8fafc 30%,#f1f5f9 100%)}
      header{background:rgba(248,250,252,.95)}
      input[type="search"],select{background:#f8fafc;color:#0f172a}
      .toggle{background:#f8fafc;border-color:rgba(148,163,184,.32)}
      .card{background:#ffffff}
      .btn.secondary{background:#f8fafc;color:#0f172a}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap hero">
      <div>
        <div class="tag">Nationwide directory • Updated from public open data</div>
        <h1>Find leash-free & off-leash dog parks</h1>
        <p class="lead">Filter by location, amenities, and fees. Always verify park rules before visiting.</p>
      </div>
      <div class="filters">
        <div class="inputs">
          <div class="field">
            <label for="search">Search</label>
            <input type="search" id="search" placeholder="Park name, city, amenity…"/>
          </div>
          <div class="field">
            <label for="state">State</label>
            <select id="state"></select>
          </div>
          <div class="field">
            <label for="region">Region</label>
            <select id="region">
              <option value="">All regions</option>
              <option value="Northeast">Northeast</option>
              <option value="South">South</option>
              <option value="Midwest">Midwest</option>
              <option value="West">West</option>
            </select>
          </div>
          <div class="field">
            <label for="sort">Sort by</label>
            <select id="sort">
              <option value="name">Name A–Z</option>
              <option value="state">State A–Z</option>
              <option value="size">Largest area</option>
            </select>
          </div>
        </div>
        <div class="toggles">
          <label class="toggle"><input type="checkbox" id="freeOnly"/> Only free parks</label>
          <label class="toggle"><input type="checkbox" id="waterOnly"/> Must have water access</label>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="results-meta">
      <div id="count">Loading parks…</div>
      <div style="margin-left:auto"><a class="btn secondary" href="./dog-off-leash-parks.json" download>Download JSON</a></div>
    </div>
    <div id="grid" class="grid" aria-live="polite"></div>
  </main>

  <footer>
    Photos via Openverse (Wikimedia/Flickr) + Unsplash fallback. Map thumbs via OpenStreetMap Static. Verify rules and hours with the official park. Corrections: info@delcotech.us
  </footer>

  <script>
    // --- Config ---
    const dataUrl = new URL('./dog-off-leash-parks.json', location.href).toString(); // same folder as HTML
    const MAX_CONCURRENCY = 6;
    const MAP_ZOOM = 16;

    // --- DOM ---
    const gridEl = document.getElementById('grid');
    const countEl = document.getElementById('count');
    const searchEl = document.getElementById('search');
    const stateEl  = document.getElementById('state');
    const regionEl = document.getElementById('region');
    const sortEl   = document.getElementById('sort');
    const freeOnlyEl  = document.getElementById('freeOnly');
    const waterOnlyEl = document.getElementById('waterOnly');

    // --- State ---
    let parks = [];
    let lastFiltered = [];
    const imgCache = JSON.parse(localStorage.getItem('parkPhotos') || '{}');

    // --- Init ---
    fetch(dataUrl, { cache: 'no-store' })
      .then(r => { if(!r.ok) throw new Error('Unable to load park data'); return r.json(); })
      .then(data => {
        parks = data;
        populateStates(parks);
        render();
      })
      .catch(err => { console.error(err); countEl.textContent = 'Park data failed to load.'; });

    function populateStates(data){
      const states = Array.from(new Set(data.map(d => d.state))).sort();
      stateEl.innerHTML = '<option value="">All states</option>' + states.map(s => `<option value="${s}">${s}</option>`).join('');
    }

    // --- Render ---
    function render(){
      const term = searchEl.value.trim().toLowerCase();
      const st   = stateEl.value;
      const reg  = regionEl.value;
      const free = freeOnlyEl.checked;
      const needWater = waterOnlyEl.checked;
      const sortBy = sortEl.value;

      let filtered = parks.filter(p => {
        const amenities = Array.isArray(p.amenities) ? p.amenities : [];
        const hay = `${p.name} ${p.city} ${p.state} ${p.notes} ${amenities.join(' ')}`.toLowerCase();
        const hasWater = /water|lake|beach|river|pond|stream|creek|shoreline|swim/i.test(`${p.notes} ${amenities.join(' ')}`);
        return (term? hay.includes(term):true)
          && (st? p.state===st:true)
          && (reg? p.region===reg:true)
          && (free? /free/i.test(p.fee):true)
          && (needWater? hasWater:true);
      });

      filtered.sort((a,b)=>{
        if (sortBy==='name') return a.name.localeCompare(b.name);
        if (sortBy==='state'){ const s=a.state.localeCompare(b.state); return s||a.name.localeCompare(b.name); }
        if (sortBy==='size') return (b.size_acres||0)-(a.size_acres||0);
        return 0;
      });

      lastFiltered = filtered;
      gridEl.innerHTML = filtered.map(renderCard).join('');
      countEl.textContent = `${filtered.length} ${filtered.length===1?'park':'parks'} shown`;

      hydrateImages(filtered);
    }

    function renderCard(p){
      const slug = slugify(`${p.name}-${p.city}-${p.state}`);
      const amenities = (p.amenities||[]);
      const badges = [`${p.city}, ${p.state}`, p.size_acres?`${p.size_acres} acres`:null].filter(Boolean).map(x=>`<span class="badge">${x}</span>`).join('');

      const osmThumb = (p.lat && p.lon)
        ? `https://staticmap.openstreetmap.de/staticmap.php?center=${p.lat},${p.lon}&zoom=${MAP_ZOOM}&size=320x200&markers=${p.lat},${p.lon},lightblue1`
        : null;

      const gmaps = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(p.name+' '+p.city+', '+p.state)}`;
      const amaps = (p.lat && p.lon) ? `https://maps.apple.com/?ll=${p.lat},${p.lon}&q=${encodeURIComponent(p.name)}` : gmaps;

      return `
        <article class="card" data-slug="${slug}">
          <div class="media">
            <div class="ph">Finding a good photo…</div>
            <img id="img-${slug}" class="img-fade" alt="${escapeHtml(p.name)} photo" loading="lazy" referrerpolicy="no-referrer"/>
            ${osmThumb ? `<a class="chip" href="${amaps}" target="_blank" rel="noopener"><img alt="Map" src="${osmThumb}"></a>`:''}
          </div>

          <div class="title"><h2>${p.name}</h2></div>
          <div class="meta">${p.city}, ${p.state} · ${p.region} · ${p.fee}</div>
          <div class="badges">${badges}</div>
          ${amenities.length? `<ul class="meta" style="margin:.2rem 0 0 1rem">${amenities.map(a=>`<li>${a}</li>`).join('')}</ul>`:''}
          <p class="meta" style="margin:.4rem 0 0">${p.notes||''}</p>

          <div class="actions" style="margin-top:6px">
            <a class="btn" href="${gmaps}" target="_blank" rel="noopener">📍 Google Maps</a>
            <a class="btn secondary" href="${amaps}" target="_blank" rel="noopener">🧭 Apple Maps</a>
            ${p.website? `<a class="btn secondary" href="${p.website}" target="_blank" rel="noopener">📑 Official site</a>`:''}
          </div>
        </article>
      `;
    }

    // --- Image pipeline: JSON override → Openverse → Wikimedia → Unsplash fallback ---
    async function hydrateImages(list){
      const q = list.slice();
      const workers = Array.from({length: Math.min(MAX_CONCURRENCY, q.length)}, ()=> worker());
      async function worker(){
        while(q.length){
          const p = q.shift();
          const slug = slugify(`${p.name}-${p.city}-${p.state}`);
          const img = document.getElementById(`img-${slug}`);
          const ph  = img?.previousElementSibling;
          try{
            const url = await getBestPhoto(p);
            if(img){
              img.addEventListener('load',()=>{ img.classList.add('loaded'); if(ph) ph.style.display='none'; }, {once:true});
              img.src = url;
            }
          }catch(e){
            if(ph) ph.textContent = 'No photo available';
            console.warn('Photo failed', p.name, e);
          }
        }
      }
      await Promise.all(workers);
    }

    async function getBestPhoto(p){
      const key = `${p.name}|${p.city}|${p.state}`;
      if (imgCache[key]) return imgCache[key];
      // 0) Manual override from JSON
      if (p.photo) return cache(key, p.photo);

      // 1) Openverse (no key, CC-friendly)
      try{
        const q = encodeURIComponent(`${p.name} ${p.city} ${p.state} dog park`);
        const ov = await fetch(`https://api.openverse.engineering/v1/images/?q=${q}&page_size=1&license_type=cc0,by&source=flickr,wikimedia,stocksnap`);
        if (ov.ok){
          const data = await ov.json();
          const hit = data?.results?.[0];
          const img = hit?.url || hit?.thumbnail;
          if (img) return cache(key, img);
        }
      }catch(e){}

      // 2) Wikimedia Commons by name (often has official/place images)
      try{
        const commons = `https://commons.wikimedia.org/w/api.php?origin=*&action=query&format=json&prop=imageinfo&generator=search&gsrnamespace=6&gsrlimit=1&gsrsearch=${encodeURIComponent(`${p.name} ${p.city} ${p.state} dog park`)}&iiprop=url|extmetadata&iiurlwidth=1200`;
        const res = await fetch(commons);
        if(res.ok){
          const j = await res.json();
          const pages = j?.query?.pages || {};
          const k = Object.keys(pages)[0];
          const image = k ? pages[k]?.imageinfo?.[0] : null;
          const candidate = image?.thumburl || image?.url;
          if(candidate) return cache(key, candidate);
        }
      }catch(e){}

      // 3) Unsplash Source fallback (fast, no key)
      return cache(key, `https://source.unsplash.com/1000x620/?dog,park,${encodeURIComponent(p.city)}`);
    }

    function cache(k, url){ imgCache[k]=url; try{localStorage.setItem('parkPhotos', JSON.stringify(imgCache));}catch(_){} return url; }

    // --- Helpers ---
    function slugify(s){ return s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    // events
    [searchEl,stateEl,regionEl,sortEl,freeOnlyEl,waterOnlyEl].forEach(el=>{
      el.addEventListener('input',render);
      el.addEventListener('change',render);
    });
  </script>
</body>
</html>
