<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
  <title>Real Estate Cold Caller + AI Concierge</title>
  <meta name="description" content="AI-assisted real estate cold calling desk: scrape leads, auto-dial, collect payments with Stripe, book live appointments, and handoff to closers."/>
  <link rel="icon" href="/favicon-32.png" sizes="32x32"/>
  <link rel="apple-touch-icon" href="/apple-touch-icon.png"/>
  <style>
    :root{
      --ink:#0c1220; --muted:#69708a; --bg:#040815; --card:#0c1327; --glass:rgba(255,255,255,.05);
      --accent:#46c2ff; --accent2:#5468ff; --hot:#f77066; --ok:#16d196; --line:rgba(255,255,255,.08);
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:radial-gradient(circle at top,#08112d 0%,#030614 55%,#01030b 100%);color:#f4f7ff;font:16px/1.65 "Inter",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;-webkit-font-smoothing:antialiased}
    a{color:#b6d4ff;text-decoration:none}
    img{max-width:100%;display:block}
    h1,h2,h3{margin:0;font-weight:800;color:#fff}
    p{margin:0;color:#dce2ff}
    button,input,select,textarea{font:inherit}
    input,select,textarea{font-size:16px}

    header{position:sticky;top:0;z-index:20;background:rgba(4,8,21,.88);backdrop-filter:blur(12px);border-bottom:1px solid var(--line)}
    .nav{max-width:1100px;margin:auto;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;gap:12px;align-items:center;font-weight:900;letter-spacing:.3px}
    .brand img{display:block;width:38px;height:38px;border-radius:12px;box-shadow:0 14px 30px rgba(70,108,255,.35);object-fit:cover}    .nav-links{display:flex;gap:16px;flex-wrap:wrap}
    .nav-links a{font-size:14px;color:rgba(214,222,255,.85)}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:12px 18px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:linear-gradient(135deg,var(--accent),var(--accent2));color:#00122a;font-weight:800;cursor:pointer;box-shadow:0 16px 35px rgba(59,102,255,.35);transition:transform .2s}
    .btn:hover{transform:translateY(-2px)}
    .btn.ghost{background:transparent;color:#e8ecff;border-color:rgba(255,255,255,.2);box-shadow:none}

    .wrap{max-width:1100px;margin:auto;padding:28px 18px}
    .hero{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:26px;padding:36px 0 22px}
    .hero-card{background:linear-gradient(180deg,rgba(84,104,255,.18),rgba(84,104,255,.04));border:1px solid rgba(255,255,255,.14);border-radius:20px;padding:22px;box-shadow:0 30px 70px rgba(9,16,43,.6);position:relative;overflow:hidden}
    .hero-card::after{content:"";position:absolute;inset:0;background:radial-gradient(circle at 15% 15%,rgba(70,194,255,.28),transparent 55%);mix-blend-mode:screen;pointer-events:none}
    .h1{font-size:34px;line-height:1.15;margin-bottom:14px}
    .sub{color:#b8c4f5;font-size:18px;max-width:520px}
    .hero-actions{display:flex;flex-wrap:wrap;gap:12px;margin-top:22px}
    .stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:14px;margin-top:26px}
    .stat{padding:16px;border-radius:16px;background:var(--card);border:1px solid var(--line);display:flex;flex-direction:column;gap:4px}
    .stat strong{font-size:22px;color:#fff}
    .stat span{font-size:13px;color:#9aa4c9;text-transform:uppercase;letter-spacing:.4px}

    .insight-section{margin-top:56px}
    .insight-grid{display:grid;gap:28px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));align-items:center}
    .insight-copy{background:linear-gradient(180deg,rgba(84,104,255,.22),rgba(84,104,255,.05));border:1px solid rgba(255,255,255,.16);border-radius:22px;padding:26px;position:relative;overflow:hidden;box-shadow:0 34px 80px rgba(8,14,40,.55)}
    .insight-copy::after{content:"";position:absolute;inset:auto -40% -60% -40%;height:160px;background:radial-gradient(circle at 50% 0,rgba(70,194,255,.45),transparent 70%);pointer-events:none}
    .insight-copy h2{font-size:30px;margin-bottom:12px}
    .insight-copy p{color:#cbd7ff;font-size:16px}
    .insight-points{list-style:none;margin:22px 0 0;padding:0;display:flex;flex-direction:column;gap:12px;color:#d8defc;font-size:15px}
    .insight-points li{display:flex;gap:10px;align-items:flex-start;line-height:1.5}
    .insight-points li::before{content:"";flex:none;width:10px;height:10px;margin-top:6px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 0 12px rgba(70,194,255,.5)}
    .insight-stack{position:relative;padding:36px 34px;background:radial-gradient(circle at 12% 18%,rgba(70,194,255,.28),transparent 65%);border-radius:28px;border:1px solid rgba(84,104,255,.28);box-shadow:0 40px 90px rgba(4,10,32,.65);display:flex;justify-content:center}
    .insight-visual{position:relative;border-radius:24px;overflow:hidden;border:1px solid rgba(255,255,255,.18);box-shadow:0 28px 60px rgba(9,16,43,.55);background:linear-gradient(180deg,rgba(9,16,43,.9),rgba(9,16,43,.4));max-width:480px}
    .insight-visual img{display:block;width:100%;height:auto}
    .insight-visual figcaption{position:absolute;left:18px;bottom:18px;padding:8px 12px;border-radius:999px;background:rgba(4,10,32,.7);border:1px solid rgba(255,255,255,.18);font-size:12px;font-weight:700;letter-spacing:.3px;text-transform:uppercase;color:#cfe3ff}
    .insight-visual.map{position:absolute;bottom:-42px;right:-24px;width:62%;min-width:220px;transform:rotate(-3deg);z-index:2}
    .insight-visual.map figcaption{left:auto;right:18px;background:rgba(9,18,44,.75)}

    .section{margin-top:58px}
    .section h2{font-size:28px;margin-bottom:14px}
    .section p.lead{font-size:17px;color:#cdd6ff;margin-bottom:22px}
    .grid{display:grid;gap:18px;grid-template-columns:repeat(auto-fit,minmax(230px,1fr))}
    .card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:20px;display:flex;flex-direction:column;gap:10px;position:relative;overflow:hidden}
    .card::after{content:"";position:absolute;inset:auto 12px -36px -12px;height:120px;background:linear-gradient(135deg,rgba(70,194,255,.16),transparent);pointer-events:none}
    .tag{display:inline-flex;align-items:center;gap:6px;padding:5px 10px;border-radius:999px;background:rgba(84,104,255,.12);border:1px solid rgba(84,104,255,.3);font-size:12px;font-weight:700;color:#c8d6ff;letter-spacing:.3px;text-transform:uppercase}
    ul{margin:0;padding-left:18px;color:#d8defc}
    li{margin-bottom:8px}

    .pricing-arena{margin-top:58px}
    .pricing-arena h2{font-size:30px;margin-bottom:12px}
    .pricing-arena .lead{max-width:720px;margin-bottom:26px}
    .pricing-grid{display:grid;gap:18px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));align-items:stretch}
    .plan-card{background:var(--card);border:1px solid var(--line);border-radius:22px;padding:24px;position:relative;display:flex;flex-direction:column;gap:16px;transition:transform .2s ease,box-shadow .2s ease,border-color .2s ease}
    .plan-card::before{content:"";position:absolute;inset:0;border-radius:inherit;background:radial-gradient(circle at 18% 15%,rgba(70,194,255,.22),transparent 65%);pointer-events:none;opacity:.6;transition:opacity .2s ease}
    .plan-card.active{transform:translateY(-4px);border-color:rgba(84,104,255,.45);box-shadow:0 26px 70px rgba(10,18,46,.6)}
    .plan-card.active::before{opacity:.95}
    .plan-card[data-featured="true"]{border-color:rgba(70,194,255,.55);box-shadow:0 30px 80px rgba(8,16,44,.72)}
    .plan-header{display:flex;flex-direction:column;gap:10px}
    .plan-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:rgba(84,104,255,.18);border:1px solid rgba(84,104,255,.35);color:#c6d6ff;font-size:11px;font-weight:700;letter-spacing:.32px;text-transform:uppercase}
    .plan-card h3{font-size:22px}
    .plan-sub{color:#c5ceff;font-size:15px;line-height:1.6}
    .plan-price{display:flex;flex-direction:column;gap:4px;margin-top:4px}
    .plan-price .plan-cost{font-size:26px;font-weight:800;color:#fff}
    .plan-price .plan-setup{font-size:13px;color:#8fa0d8}
    .plan-features{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:10px;color:#d9e3ff;font-size:14px}
    .plan-features li{display:flex;gap:8px;align-items:flex-start}
    .plan-features li::before{content:"";display:inline-block;width:8px;height:8px;border-radius:50%;margin-top:6px;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 0 12px rgba(70,194,255,.55)}
    .plan-card .btn{justify-content:center;margin-top:auto}
    .btn[data-loading="1"], .btn:disabled{opacity:.6;pointer-events:none}
    .lead-action{min-width:120px}

    .pipeline{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px;counter-reset:step}
    .pipeline .stage{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:20px;position:relative;display:flex;flex-direction:column;gap:8px;min-height:200px}
    .pipeline .stage::before{counter-increment:step;content:"0" counter(step);position:absolute;top:16px;right:16px;font-weight:900;font-size:32px;color:rgba(70,194,255,.16)}
    .stage span{font-size:13px;color:#8e97b6;text-transform:uppercase;letter-spacing:.3px}

    .leads-table{margin-top:22px;background:var(--card);border:1px solid var(--line);border-radius:18px;padding:20px}
    .table-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch;border-radius:12px}
    .filters{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:18px}
    .filters label{display:flex;flex-direction:column;font-size:12px;color:#8e97b6;text-transform:uppercase;letter-spacing:.3px;gap:6px}
    .filters select,.filters input{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.15);color:#f4f7ff;border-radius:10px;padding:8px 10px;min-width:160px}
    table{width:100%;border-collapse:collapse;font-size:14px;color:#dce2ff}
    thead{background:rgba(255,255,255,.04);text-transform:uppercase;letter-spacing:.4px;color:#9ea9d4}
    th,td{padding:12px 10px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left}
    tbody tr:hover{background:rgba(84,104,255,.08)}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .chip{display:inline-flex;align-items:center;padding:4px 9px;border-radius:999px;background:rgba(255,255,255,.07);font-size:12px;text-transform:uppercase;letter-spacing:.3px}

    .ai-lab{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:22px;margin-top:22px}
    .ai-lab form{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:20px;display:flex;flex-direction:column;gap:14px}
    .ai-lab label{font-size:13px;color:#9aa4c9;text-transform:uppercase;letter-spacing:.3px}
    .ai-lab input,.ai-lab select,.ai-lab textarea{width:100%;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.16);border-radius:10px;padding:10px;color:#f6f8ff;resize:vertical}
    .ai-lab textarea{min-height:180px}
    .phone-label .phone-control{margin-top:6px;display:flex;align-items:center;gap:10px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.16);border-radius:10px;padding:6px 10px}
    .phone-label .phone-control input{flex:1;background:transparent;border:none;color:#f6f8ff;padding:6px 0;font-size:16px;letter-spacing:.3px;font-variant-numeric:tabular-nums}
    .phone-label .phone-control input:focus{outline:none}
    .phone-label .phone-prefix{font-weight:700;color:#f6f8ff}
    .phone-label .phone-flag{font-size:18px;line-height:1}
    .phone-label .phone-hint{display:block;margin-top:6px;font-size:12px;color:#8fa0d8}
    .ai-output{background:linear-gradient(180deg,rgba(14,18,43,.65),rgba(14,18,43,.35));border:1px solid rgba(84,104,255,.28);border-radius:18px;padding:20px;display:flex;flex-direction:column;gap:14px}
    .ai-output-header{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .script-actions{display:flex;gap:8px;flex-wrap:wrap}
    .ai-output pre{margin:0;white-space:pre-wrap;word-break:break-word;font-family:"JetBrains Mono",Menlo,Consolas,monospace;font-size:14px;color:#d8e5ff}
    .status{font-size:13px;color:#8fa0d8}
    .copy-btn{align-self:flex-start;padding:10px 14px;border-radius:10px;background:rgba(70,194,255,.16);color:#cfe7ff;border:1px solid rgba(70,194,255,.4);cursor:pointer}
    .voice-btn{background:rgba(84,104,255,.24);border:1px solid rgba(84,104,255,.48)}

    .call-visual{position:relative;border-radius:18px;overflow:hidden;border:1px solid rgba(84,104,255,.28);background:linear-gradient(180deg,rgba(14,18,43,.65),rgba(14,18,43,.35));box-shadow:0 24px 60px rgba(5,12,34,.55);transition:box-shadow .3s ease,transform .3s ease;margin-top:-4px}
    .call-visual img{width:100%;display:block;transition:filter .35s ease,transform .35s ease}
    .call-visual.is-live img{filter:blur(8px) saturate(.8);transform:scale(1.02)}
    .call-visual-overlay{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;padding:24px;background:rgba(4,8,21,.55);backdrop-filter:blur(4px);opacity:0;pointer-events:none;transition:opacity .35s ease}
    .call-visual.is-live .call-visual-overlay{opacity:1;pointer-events:auto}
    .call-visual-spinner{width:46px;height:46px;border-radius:50%;border:3px solid rgba(143,160,216,.45);border-top-color:var(--accent);animation:spin 1s linear infinite}
    .call-visual-dialog{display:flex;flex-direction:column;gap:10px;width:100%;max-width:280px}
    .call-visual-line{opacity:0;transform:translateY(8px);background:rgba(5,12,34,.78);border:1px solid rgba(84,104,255,.4);border-radius:14px;padding:10px 12px;font-size:13px;color:#dbe4ff;line-height:1.45;box-shadow:0 18px 38px rgba(4,8,21,.45);transition:opacity .35s ease,transform .35s ease}
    .call-visual-line span{display:block;font-size:11px;letter-spacing:.32px;text-transform:uppercase;color:#94a4de;margin-bottom:4px}
    .call-visual-line.lead{margin-left:auto;background:rgba(70,194,255,.22);border-color:rgba(70,194,255,.4);color:#f3f7ff;box-shadow:0 18px 38px rgba(5,12,34,.55)}
    .call-visual-line.lead span{color:rgba(233,243,255,.88)}
    .call-visual-line.show{opacity:1;transform:translateY(0)}
    .call-visual-ended{position:absolute;bottom:18px;right:18px;padding:9px 16px;border-radius:999px;background:rgba(20,12,24,.82);border:1px solid rgba(247,112,102,.6);color:#fce3de;font-size:12px;font-weight:700;letter-spacing:.32px;text-transform:uppercase;opacity:0;transform:translateY(8px);transition:opacity .35s ease,transform .35s ease;pointer-events:none}
    .call-visual.is-ended .call-visual-ended{opacity:1;transform:translateY(0)}

    @keyframes spin{
      from{transform:rotate(0)}
      to{transform:rotate(360deg)}
    }

    .cta-panel{margin-top:48px;background:linear-gradient(135deg,rgba(70,194,255,.25),rgba(84,104,255,.35));border-radius:22px;padding:28px;border:1px solid rgba(255,255,255,.2);display:grid;gap:18px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));align-items:center}
    .cta-panel h3{font-size:26px}
    .cta-panel p{color:#0c1327;font-weight:600}
    .cta-panel .btn{box-shadow:0 20px 40px rgba(4, 13, 40, .45)}

    .tour-launch{display:flex;gap:12px;align-items:center}
    .tour-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:20px;z-index:100;pointer-events:none}
    .tour-overlay.active{display:flex;pointer-events:auto}
    .tour-backdrop{position:absolute;inset:0;background:rgba(4,8,21,.78);backdrop-filter:blur(6px);animation:fadeIn .3s ease forwards}
    .tour-card{position:relative;max-width:520px;width:100%;background:linear-gradient(180deg,rgba(11,19,45,.92),rgba(10,14,32,.95));border:1px solid rgba(84,104,255,.32);border-radius:22px;padding:26px;display:flex;flex-direction:column;gap:18px;box-shadow:0 30px 80px rgba(6,12,35,.65);transform:translateY(18px);opacity:0;animation:floatUp .4s ease forwards}
    .tour-card.show{animation:none;opacity:1;transform:translateY(0)}
    .tour-progress{font-size:13px;letter-spacing:.35px;text-transform:uppercase;color:#8fa0d8}
    .tour-card h3{font-size:24px}
    .tour-card p{color:#d6deff;font-size:16px}
    .tour-actions{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .tour-actions .btn{min-width:120px;justify-content:center}
    .tour-skip{background:transparent;border:none;color:#8fa0d8;font-size:14px;cursor:pointer;padding:8px}
    .tour-skip:hover{color:#c2cffd}
    .tour-highlight{position:relative;z-index:99;border-radius:18px;box-shadow:0 0 0 4px rgba(84,104,255,.45),0 24px 60px rgba(6,12,35,.55);animation:pulseGlow 2.4s ease-in-out infinite}

    @keyframes fadeIn{
      from{opacity:0}
      to{opacity:1}
    }

    @keyframes floatUp{
      from{opacity:0;transform:translateY(24px)}
      to{opacity:1;transform:translateY(0)}
    }

    @keyframes pulseGlow{
      0%,100%{box-shadow:0 0 0 4px rgba(84,104,255,.45),0 24px 60px rgba(6,12,35,.55)}
      50%{box-shadow:0 0 0 6px rgba(70,194,255,.6),0 28px 80px rgba(6,12,35,.7)}
    }

    footer{margin-top:60px;padding:30px 18px;border-top:1px solid rgba(255,255,255,.08);background:#040813;color:#8e97b6;font-size:13px}
    footer .footer-wrap{max-width:1100px;margin:auto;display:flex;flex-direction:column;gap:12px}

    @media (max-width:720px){
      .hero{padding-top:18px}
      .h1{font-size:30px}
      header{position:relative}
      .insight-copy h2{font-size:26px}
      .insight-stack{padding:24px}
      .insight-visual.map{position:relative;bottom:0;right:0;width:100%;min-width:0;transform:none;margin-top:18px}
      .insight-grid{grid-template-columns:1fr}
      .cta-panel{grid-template-columns:1fr;padding:26px}
      .pricing-grid{grid-template-columns:1fr}
      .table-wrap{overflow:visible}
      thead{display:none}
      table,tbody,tr,td{display:block;width:100%}
      tbody tr{margin-bottom:14px;padding:16px;border:1px solid rgba(255,255,255,.08);border-radius:14px;background:rgba(255,255,255,.02)}
      tbody tr:hover{background:rgba(84,104,255,.12)}
      td{border:none;padding:6px 0}
      td+td{margin-top:10px}
      td[data-label]{display:flex;flex-direction:column;gap:6px}
      td[data-label]::before{content:attr(data-label);font-size:11px;color:#8e97b6;text-transform:uppercase;letter-spacing:.35px}
      td[data-label="Lead"]{gap:4px}
      .actions{flex-direction:column;align-items:stretch}
      .actions .btn{width:100%;justify-content:center}
    }
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="brand"><img src="/image/Delco Tech Real Estate Logo.png" alt="Delco Tech Real Estate logo"> Real Estate Money Saver</div>
      <div class="nav-links">
        <a href="#workflow">Workflow</a>
        <a href="#leads">Lead Desk</a>
        <a href="#ai">AI Lab</a>
      </div>
      <div class="nav-links">
        <a class="btn ghost" href="/book">Book Live Strategist</a>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <div>
        <div class="tag">Cold-Calling Command Center</div>
        <h1 class="h1">AI-powered cold calling for agents who close</h1>
        <p class="sub">Scrape motivated buyer & seller lists from free public sources, launch compliant outreach, and drive every interested caller straight to payment, booking, or a live closer. Stripe, Calendly, and Twilio are already wired in.</p>
        <div class="hero-actions tour-launch">
          <button class="btn" type="button" data-realestate-checkout="signal">Launch Stripe Checkout</button>
          <a class="btn ghost" href="tel:+16105550123">Transfer to Live Floor</a>
          <button class="btn ghost" type="button" id="startTour">Guided tour</button>
        </div>
        <div class="stat-grid">
          <div class="stat"><strong>3x</strong><span>Faster list qualification</span></div>
          <div class="stat"><strong>&lt;90 sec</strong><span>To send pay link</span></div>
          <div class="stat"><strong>24/7</strong><span>AI concierge coverage</span></div>
        </div>
      </div>
      <div class="hero-card">
        <h3>Inbound rescue + outbound hustle</h3>
        <p>Missed call? We text back instantly with your Calendly. Fresh lead from Zillow or MLS expired feed? The dialer queues it, logs the call, and the AI concierge drafts the follow-up text in your voice.</p>
        <ul>
          <li>Imports CSV from Zillow, Redfin, county notice portals</li>
          <li>Works with your existing Twilio number & recordings</li>
          <li>Stripe Link & Apple Pay ready for reservation fees</li>
        </ul>
      </div>
    </section>

    <section class="section insight-section" aria-labelledby="insightTitle">
      <div class="insight-grid">
        <div class="insight-copy">
          <span class="tag">Market Intel</span>
          <h2 id="insightTitle">Visual lead scoring at a glance</h2>
          <p>Pair live buyer demographics with neighborhood heat mapping so your next dial is aimed at the highest-probability conversation.</p>
          <ul class="insight-points">
            <li>Household composition and education markers tell you who is ready to tour or invest.</li>
            <li>Value-per-square-foot bands surface fast-moving micro-markets before competitors see them.</li>
            <li>Analytics overlays plug straight into the dialer, updating call priorities in real time.</li>
          </ul>
        </div>
        <div class="insight-stack">
          <figure class="insight-visual">
            <img src="/image/realesatate_buyerinfo.png" alt="Buyer information dashboards with value estimates and achievement cards">
            <figcaption>Buyer profile dashboard</figcaption>
          </figure>
          <figure class="insight-visual map">
            <img src="/image/realestate_Map.png" alt="Neighborhood map heat map showing real estate value ranges">
            <figcaption>Live heat map</figcaption>
          </figure>
        </div>
      </div>
    </section>

    <section class="section pricing-arena" id="plans">
      <h2>Choose your command loadout</h2>
      <p class="lead">Select the kit that matches your pipeline. Every option includes Stripe pay links, Calendly booking, and Sheets loggingâ€”the upgrades add voice firepower when you need it.</p>
      <div class="pricing-grid">
        <article class="plan-card" id="plan-solo" data-plan="solo">
          <div class="plan-header">
            <span class="plan-badge">Tier 1</span>
            <h3 data-plan-name="solo">Solo Agent Sprint</h3>
            <p class="plan-sub" data-plan-description="solo">SMS-first follow up for agents who want quick replies without live dialing.</p>
          </div>
          <div class="plan-price" data-plan-price="solo">
            <div class="plan-cost" data-role="monthly">$159 / month</div>
            <div class="plan-setup" data-role="setup">$149 setup</div>
          </div>
          <ul class="plan-features" data-plan-features="solo">
            <li>SMS concierge + instant pay links</li>
            <li>Weekly public data drops</li>
            <li>Calendly + Sheets logging</li>
          </ul>
          <button class="btn" type="button" data-realestate-checkout="solo" data-plan-button="solo">Activate Solo Sprint</button>
        </article>
        <article class="plan-card" id="plan-signal" data-plan="signal" data-featured="true">
          <div class="plan-header">
            <span class="plan-badge">Tier 2</span>
            <h3 data-plan-name="signal">Signal Team Stack</h3>
            <p class="plan-sub" data-plan-description="signal">Add standard-voice dialing and instant script swaps for small teams.</p>
          </div>
          <div class="plan-price" data-plan-price="signal">
            <div class="plan-cost" data-role="monthly">$349 / month</div>
            <div class="plan-setup" data-role="setup">$299 setup</div>
          </div>
          <ul class="plan-features" data-plan-features="signal">
            <li>Non-premium AI voice dialer</li>
            <li>Shared script vault + objection swaps</li>
            <li>Instant text &amp; email recaps</li>
          </ul>
          <button class="btn" type="button" data-realestate-checkout="signal" data-plan-button="signal">Launch Signal Stack</button>
        </article>
        <article class="plan-card" id="plan-squadron" data-plan="squadron">
          <div class="plan-header">
            <span class="plan-badge">Tier 3</span>
            <h3 data-plan-name="squadron">Power Dial Squadron</h3>
            <p class="plan-sub" data-plan-description="squadron">Speech recognition branches, transfer logic, and script coaching for high-volume floors.</p>
          </div>
          <div class="plan-price" data-plan-price="squadron">
            <div class="plan-cost" data-role="monthly">$649 / month</div>
            <div class="plan-setup" data-role="setup">$449 setup</div>
          </div>
          <ul class="plan-features" data-plan-features="squadron">
            <li>Speech recognition + sentiment tags</li>
            <li>Round-robin queues &amp; transfers</li>
            <li>Live script coach adjustments</li>
          </ul>
          <button class="btn" type="button" data-realestate-checkout="squadron" data-plan-button="squadron">Deploy Power Dial</button>
        </article>
        <article class="plan-card" id="plan-enterprise" data-plan="enterprise">
          <div class="plan-header">
            <span class="plan-badge">Tier 4</span>
            <h3 data-plan-name="enterprise">Enterprise Command</h3>
            <p class="plan-sub" data-plan-description="enterprise">Premium voice cloning, multilingual routing, and custom integrations for brokerage HQs.</p>
          </div>
          <div class="plan-price" data-plan-price="enterprise">
            <div class="plan-cost" data-role="monthly">$1,299 / month</div>
            <div class="plan-setup" data-role="setup">$699 setup</div>
          </div>
          <ul class="plan-features" data-plan-features="enterprise">
            <li>Premium cloned voices &amp; personas</li>
            <li>Multilingual speech + translation</li>
            <li>Custom CRM and Slack automations</li>
          </ul>
          <button class="btn" type="button" data-realestate-checkout="enterprise" data-plan-button="enterprise">Secure Enterprise Command</button>
        </article>
      </div>
    </section>

    <section class="section" id="live-caller">
      <h2>Lifelike AI cold caller</h2>
      <p class="lead">Launch a concierge-style call right from this page. Add your lead, outline the goal, drop in talking points, and press start when youâ€™re ready for the system to dial.</p>
      <div class="ai-lab">
        <form id="callerForm">
          <label>Lead name
            <input name="leadName" type="text" placeholder="e.g. Dana Investor"/>
          </label>
          <label class="phone-label">Lead phone (E.164)
            <div class="phone-control">
              <span class="phone-flag" aria-hidden="true">ðŸ‡ºðŸ‡¸</span>
              <span class="phone-prefix">+1</span>
              <input name="toLocal" type="tel" inputmode="tel" autocomplete="tel" placeholder="6105550123" maxlength="10" required aria-label="US phone number without country code"/>
            </div>
            <span class="phone-hint">U.S. numbers only. We'll format +1 E.164 for Twilio automatically.</span>
          </label>
          <label>Goal of the call
            <input name="goal" type="text" placeholder="Secure a listing consultation"/>
          </label>
          <label>Opening line
            <textarea name="intro" placeholder="Hi Dana, this is Alex from Delco Realty. Thanks for requesting a valuation."></textarea>
          </label>
          <label>Talking points (one per line)
            <textarea name="script" placeholder="We found three buyers already active nearby.
Your consultation holds your price for 48 hours.
Can I send the booking link to lock your time?" rows="5"></textarea>
          </label>
          <label>Voice preset
            <select name="voice">
              <option value="warm">Warm &amp; friendly (ElevenLabs)</option>
              <option value="bold">Bold &amp; confident (ElevenLabs)</option>
              <option value="calm">Calm &amp; precise (ElevenLabs)</option>
            </select>
          </label>
          <label>Optional live handoff number
            <input name="handoffNumber" type="tel" placeholder="Team mate number"/>
          </label>
          <button class="btn" type="submit">Start live call</button>
          <div class="status" id="callerStatus">Idle. Configure the call details and press start.</div>
          <div class="call-visual" id="callVisual">
            <img src="/image/lifelike%20AI%20cold%20caller.png" alt="Animated concierge preparing to place a call" loading="lazy"/>
            <div class="call-visual-overlay" id="callVisualOverlay" aria-hidden="true">
              <div class="call-visual-spinner" aria-hidden="true"></div>
              <div class="call-visual-dialog" id="callVisualDialog" aria-live="polite"></div>
            </div>
            <div class="call-visual-ended" id="callVisualEnded" aria-hidden="true">Call ended</div>
          </div>
        </form>
        <div class="ai-output call-feed">
          <div class="ai-output-header">
            <h3 style="font-size:20px">Live call storyboard</h3>
          </div>
          <pre id="callerPreview">Adjust the lead details to see the live call storyboard, from dial to voicemail.</pre>
          <div class="status" id="callerMeta">Warm &amp; friendly (ElevenLabs). No live handoff configured yet. Calls originate from your configured TWILIO_NUMBER.</div>
        </div>
      </div>
    </section>

    <section class="section" id="workflow">
      <h2>Free-first lead engine</h2>
      <p class="lead">Start with public data: FSBO listings, saved searches, probate and pre-foreclosure rolls, and social signals. Our fetchers respect rate limits, dedupe duplicates, and score leads for motivation.</p>
      <div class="grid">
        <div class="card">
          <span class="tag">Leads</span>
          <h3>Scrape + sync</h3>
          <p>Connect saved-search RSS feeds, Craigslist FSBO pages, or government CSV drops. We normalize phone numbers, add DNC status, and push the hottest records to the dialer first.</p>
        </div>
        <div class="card">
          <span class="tag">Dial</span>
          <h3>Power hour queue</h3>
          <p>Auto-create call sheets with scripts, objections, and SMS follow-ups. Every contact can be moved to <em>booked</em>, <em>offer sent</em>, or <em>nurture</em> in two taps.</p>
        </div>
        <div class="card">
          <span class="tag">Collect</span>
          <h3>Stripe-ready</h3>
          <p>Charge reservation deposits, inspection retainers, or skip-trace fees right away with Link, Apple Pay, or ACHâ€”using the same Stripe Checkout already running across the Delco stack.</p>
        </div>
        <div class="card">
          <span class="tag">Assist</span>
          <h3>AI script coach</h3>
          <p>Feed the concierge a lead persona and it returns a compliant, high-converting talk track that gets to the appointment fast. Copy, edit, or fire it straight into your dialer.</p>
        </div>
      </div>
    </section>

    <section class="section" id="leads">
      <h2>Live lead desk</h2>
      <p class="lead">Filter the hottest prospects, click to call, and hand off to payments or booking in one view. Data below ships with the templateâ€”swap the JSON for your own feed or Google Sheet.</p>
      <div class="leads-table">
        <div class="filters">
          <label>Stage
            <select id="stageFilter">
              <option value="">All</option>
              <option>New</option>
              <option>Qualified</option>
              <option>Follow-up</option>
              <option>Research</option>
            </select>
          </label>
          <label>Source
            <select id="sourceFilter">
              <option value="">All</option>
              <option>Zillow saved search</option>
              <option>Craigslist FSBO</option>
              <option>Facebook marketplace</option>
              <option>Google pay-per-click</option>
              <option>Public notice list</option>
              <option>Google Business Profile</option>
              <option>MLS expired</option>
            </select>
          </label>
          <label>Search
            <input type="search" id="searchFilter" placeholder="City, name, motivation"/>
          </label>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Lead</th>
                <th>Source</th>
                <th>Stage</th>
                <th>Motivation</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="leadRows"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="section" id="ai">
      <h2>AI cold-call lab</h2>
      <p class="lead">Describe the lead, choose your vibe, and let the concierge draft a script that nudges them to pay, book, or talk live. Works with OpenAIâ€™s gpt-4o-miniâ€”no extra UI or API key input required.</p>
      <div class="ai-lab">
        <form id="scriptForm">
          <label>Lead type
            <select name="leadType">
              <option value="buyer">Buyer</option>
              <option value="seller">Seller</option>
              <option value="investor">Investor</option>
            </select>
          </label>
          <label>Market or neighborhood
            <input name="location" type="text" placeholder="e.g. Fishtown, 19125"/>
          </label>
          <label>Tone
            <select name="tone">
              <option value="friendly">Friendly</option>
              <option value="direct">Direct</option>
              <option value="consultative">Consultative</option>
              <option value="luxury">Luxury</option>
            </select>
          </label>
          <label>Focus
            <input name="focus" type="text" placeholder="What problem are we solving?"/>
          </label>
          <label>Next step CTA
            <select name="nextAction">
              <option value="checkout">Send Stripe payment link</option>
              <option value="book">Book a Calendly call</option>
              <option value="transfer">Transfer to live closer</option>
            </select>
          </label>
          <button class="btn" type="submit">Generate AI Script</button>
          <div class="status" id="scriptStatus">Idle. Submit details to generate.</div>
        </form>
        <div class="ai-output">
          <div class="ai-output-header">
            <h3 style="font-size:20px">Call script</h3>
            <div class="script-actions">
              <button type="button" class="copy-btn" id="copyScript">Copy to clipboard</button>
              <button type="button" class="copy-btn voice-btn" id="speakScript">Play voice demo</button>
            </div>
          </div>
          <pre id="scriptOutput">Add lead details to spin up a script that points prospects to pay, book, or talk live.</pre>
          <div class="status" id="scriptMeta"></div>
        </div>
      </div>
    </section>

    <section class="section" id="stack">
      <h2>How the stack closes deals</h2>
      <div class="pipeline">
        <div class="stage">
          <span>Step 1</span>
          <h3>Scrape & score</h3>
          <p>Daily cron jobs hit Zillow, Redfin, MLS expired feeds, probate PDFs, and Google Business reviews. We enrich each lead with comps, time-on-market, and estimated equity so you know whoâ€™s serious.</p>
        </div>
        <div class="stage">
          <span>Step 2</span>
          <h3>Auto-dial + SMS safety net</h3>
          <p>Twilio voice forwards to your floor. Missed call? Our SMS tree logs the lead in Sheets, asks for name + goal, and fires over the Calendly link.</p>
        </div>
        <div class="stage">
          <span>Step 3</span>
          <h3>Checkout & scheduling</h3>
          <p>Stripe Checkout handles earnest deposit or consultation fees. Clients choose Apple Pay, card, or Link. Success page pushes them right into the booking flow.</p>
        </div>
        <div class="stage">
          <span>Step 4</span>
          <h3>Live handoff</h3>
          <p>Agents get Slack/Discord alerts with transcript + AI summary. Tap to join live, text a payment link, or drop a DocuSign request.</p>
        </div>
      </div>
    </section>

    <section class="cta-panel">
      <div>
        <h3>Launch your next power hour</h3>
        <p>Queue fresh leads, copy the script, and drop your Stripe checkout link in under five minutes. All hosted on the Delco infrastructure you already trust.</p>
      </div>
      <div class="hero-actions">
        <button class="btn" type="button" data-realestate-checkout="signal">Collect a Reservation Fee</button>
        <a class="btn ghost" href="/book">Book Strategy Session</a>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-wrap">
      <div>Need custom data sources or more seats? Email <a href="mailto:rb@dreamworld.co">rb@dreamworld.co</a>.</div>
      <div>Payments powered by Stripe. Scheduling via Calendly. Voice/SMS via Twilio. AI copywriting by OpenAI.</div>
    </div>
  </footer>

  <div class="tour-overlay" id="tourOverlay" aria-hidden="true">
    <div class="tour-backdrop" id="tourBackdrop"></div>
    <div class="tour-card" id="tourCard" role="dialog" aria-modal="true" aria-labelledby="tourTitle">
      <div class="tour-progress" id="tourProgress">Step 1 of 5</div>
      <h3 id="tourTitle">Welcome</h3>
      <p id="tourBody">Follow the guided tour to see how every module accelerates deal flow.</p>
      <div class="tour-actions">
        <button type="button" class="tour-skip" id="tourSkip">Skip tour</button>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button type="button" class="btn ghost" id="tourPrev" disabled>Back</button>
          <button type="button" class="btn" id="tourNext">Next</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://js.stripe.com/v3/"></script>
  <script>
    const leadRows = document.getElementById('leadRows');
    const stageFilter = document.getElementById('stageFilter');
    const sourceFilter = document.getElementById('sourceFilter');
    const searchFilter = document.getElementById('searchFilter');
    const planCards = Array.from(document.querySelectorAll('.plan-card'));
    let leadData = [];
    let stripeClient = null;
    const API_BASE = window.DELCO_BACKEND_BASE || 'https://www.delcotechdivision.com';

    const PLAN_BUTTON_VERBS = {
      solo: 'Activate',
      signal: 'Launch',
      squadron: 'Deploy',
      enterprise: 'Secure',
    };

    function escapeHtml(str = ''){
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function escapeAttr(str = ''){
      return escapeHtml(str);
    }

    function formatCurrency(amount){
      if(typeof amount !== 'number' || Number.isNaN(amount)) return '';
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(amount);
    }

    function suggestPlanSlug(lead = {}){
      const preferred = String(lead.plan || lead.planSlug || '').toLowerCase();
      if(preferred) return preferred;
      const stage = String(lead.stage || '').toLowerCase();
      const motivation = String(lead.motivation || '').toLowerCase();
      const notes = String(lead.notes || '').toLowerCase();
      if(/enterprise|brokerage|multi|franchise/.test(stage) || /enterprise|portfolio|brokerage|multi|franchise/.test(motivation)){
        return 'enterprise';
      }
      if(/follow|qualified|warm/.test(stage) || /dial|call|team|volume|queue/.test(motivation) || /team/.test(notes)){
        return 'squadron';
      }
      if(/nurture|new/.test(stage) || /sms|text|drip/.test(motivation)){
        return 'solo';
      }
      return 'signal';
    }

    function setActivePlan(slug){
      if(!slug) return;
      planCards.forEach(card => {
        if(!card) return;
        const isMatch = card.dataset.plan === slug;
        card.classList.toggle('active', isMatch);
      });
    }

    function renderLeads(){
      if(!leadRows) return;
      const stageVal = (stageFilter?.value || '').toLowerCase();
      const sourceVal = (sourceFilter?.value || '').toLowerCase();
      const q = (searchFilter?.value || '').trim().toLowerCase();
      const rows = leadData.filter(lead => {
        const stageMatch = !stageVal || String(lead.stage || '').toLowerCase() === stageVal;
        const sourceMatch = !sourceVal || String(lead.source || '').toLowerCase() === sourceVal;
        const searchMatch = !q || [lead.name, lead.city, lead.motivation, lead.notes]
          .some(v => String(v || '').toLowerCase().includes(q));
        return stageMatch && sourceMatch && searchMatch;
      }).map(lead => {
        const phoneDigits = lead.phone ? lead.phone.replace(/[^+\d]/g,'') : '';
        const chips = [];
        if(lead.city) chips.push(`<div class="chip">${escapeHtml(lead.city)}</div>`);
        if(lead.leadType) chips.push(`<div class="chip">${escapeHtml(lead.leadType)}</div>`);
        const planSlug = suggestPlanSlug(lead);
        const planAttr = escapeAttr(planSlug);
        const nameAttr = escapeAttr(lead.name || '');
        const callControl = phoneDigits
          ? `<a class="btn ghost" style="padding:6px 10px;font-size:12px" href="tel:${phoneDigits}">Call</a>`
          : `<button class="btn ghost" style="padding:6px 10px;font-size:12px" type="button" disabled title="Add phone number">Call</button>`;
        const textControl = phoneDigits
          ? `<button type="button" class="btn ghost lead-action" style="padding:6px 10px;font-size:12px" data-action="text-link" data-phone="${phoneDigits}" data-name="${nameAttr}" data-plan="${planAttr}">Text link</button>`
          : `<button type="button" class="btn ghost lead-action" style="padding:6px 10px;font-size:12px" disabled title="Add phone number">Text link</button>`;
        const bookLink = `/book?lead=${encodeURIComponent(lead.name || '')}`;
        const bookControl = `<a class="btn ghost" style="padding:6px 10px;font-size:12px" href="${bookLink}">Book</a>`;
        return `<tr>
          <td data-label="Lead">
            <div><strong>${escapeHtml(lead.name || 'Lead')}</strong></div>
            ${chips.join('')}
          </td>
          <td data-label="Source">${escapeHtml(lead.source || '')}</td>
          <td data-label="Stage">${escapeHtml(lead.stage || '')}</td>
          <td data-label="Motivation">${escapeHtml(lead.motivation || '')}</td>
          <td data-label="Actions">
            <div class="actions">
              ${callControl}
              ${textControl}
              ${bookControl}
            </div>
          </td>
        </tr>`;
      }).join('');
      leadRows.innerHTML = rows || `<tr><td colspan="5" style="text-align:center;padding:30px;color:#8e97b6">No leads match right now. Try clearing filters.</td></tr>`;
    }

    function updatePlanCardFromConfig(plan){
      if(!plan || !plan.slug) return;
      const slug = plan.slug;
      const nameEl = document.querySelector(`[data-plan-name="${slug}"]`);
      if(nameEl && plan.name){
        nameEl.textContent = plan.name;
      }
      const descEl = document.querySelector(`[data-plan-description="${slug}"]`);
      if(descEl && plan.description){
        descEl.textContent = plan.description;
      }
      const priceEl = document.querySelector(`[data-plan-price="${slug}"]`);
      if(priceEl){
        const monthlyEl = priceEl.querySelector('[data-role="monthly"]');
        const setupEl = priceEl.querySelector('[data-role="setup"]');
        if(monthlyEl && typeof plan.monthly === 'number'){
          monthlyEl.textContent = `${formatCurrency(plan.monthly)} / month`;
        }
        if(setupEl && typeof plan.setup === 'number'){
          setupEl.textContent = `${formatCurrency(plan.setup)} setup`;
        }
      }
      const featuresEl = document.querySelector(`[data-plan-features="${slug}"]`);
      if(featuresEl && Array.isArray(plan.features) && plan.features.length){
        featuresEl.innerHTML = plan.features.map(feature => `<li>${escapeHtml(feature)}</li>`).join('');
      }
      const buttonEl = document.querySelector(`[data-plan-button="${slug}"]`);
      if(buttonEl){
        const verb = PLAN_BUTTON_VERBS[slug] || 'Start';
        buttonEl.textContent = `${verb} ${plan.name}`;
      }
    }

    async function startRealEstateCheckout(plan, source){
      if(!plan) return;
      const btn = source instanceof HTMLElement ? source : null;
      const originalText = btn ? btn.textContent : '';
      if(btn){
        btn.dataset.loading = '1';
        btn.disabled = true;
        btn.textContent = 'Loadingâ€¦';
      }

      try{
        const res = await fetch(`${API_BASE}/api/real-estate/checkout`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ plan })
        });
        const data = await res.json().catch(() => ({}));
        if(!res.ok){
          throw new Error(data?.error || 'checkout_unavailable');
        }

        if(data.url){
          window.location.href = data.url;
          return;
        }

        if(data.id && stripeClient){
          await stripeClient.redirectToCheckout({ sessionId: data.id });
          return;
        }

        throw new Error('missing_checkout_url');
      }catch(err){
        console.error('[ColdCaller] Unable to start checkout', err);
        alert('Unable to open Stripe checkout right now. Please try again or contact support.');
      }finally{
        if(btn){
          delete btn.dataset.loading;
          btn.disabled = false;
          btn.textContent = originalText;
        }
      }
    }

    async function sendLeadCheckoutLink(button){
      if(!button) return;
      const phone = button.getAttribute('data-phone');
      if(!phone){
        return;
      }
      const plan = button.getAttribute('data-plan') || '';
      const leadName = button.getAttribute('data-name') || '';
      const originalText = button.textContent;
      button.dataset.loading = '1';
      button.disabled = true;
      button.textContent = 'Textingâ€¦';

      try{
        const response = await fetch(`${API_BASE}/api/real-estate/text-link`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ phone, plan, lead: leadName })
        });
        const data = await response.json().catch(() => ({}));
        if(!response.ok || data?.ok !== true){
          throw new Error(data?.error || 'text_failed');
        }
        button.textContent = 'Text sent!';
        button.dataset.sent = '1';
      }catch(err){
        console.error('[ColdCaller] Text link failed', { message: err?.message || err });
        button.textContent = 'Retry text';
      }finally{
        window.setTimeout(() => {
          delete button.dataset.loading;
          button.disabled = false;
          if(button.dataset.sent === '1'){
            button.textContent = 'Text again';
          } else {
            button.textContent = originalText;
          }
          delete button.dataset.sent;
        }, 2000);
      }
    }

    fetch('/data/real-estate-leads.json')
      .then(res => res.json())
      .then(json => { leadData = json; renderLeads(); })
      .catch(() => {
        leadData = [
          { name: 'Template Lead', phone: '+12155550000', city: 'Sample City', leadType: 'buyer', source: 'Manual import', motivation: 'Demo data fallback', stage: 'New', notes: '' }
        ];
        renderLeads();
      });

    stageFilter?.addEventListener('change', renderLeads);
    sourceFilter?.addEventListener('change', renderLeads);
    searchFilter?.addEventListener('input', () => {
      window.clearTimeout(searchFilter._t);
      searchFilter._t = window.setTimeout(renderLeads, 150);
    });

    if(leadRows){
      leadRows.addEventListener('click', (event) => {
        const button = event.target.closest('[data-action="text-link"]');
        if(button){
          event.preventDefault();
          sendLeadCheckoutLink(button);
        }
      });
    }

    document.querySelectorAll('[data-realestate-checkout]').forEach(el => {
      el.addEventListener('click', event => {
        event.preventDefault();
        const plan = el.getAttribute('data-realestate-checkout');
        if(plan){
          setActivePlan(plan);
          startRealEstateCheckout(plan, el);
        }
      });
    });

    planCards.forEach(card => {
      card.addEventListener('mouseenter', () => setActivePlan(card.dataset.plan));
      card.addEventListener('focusin', () => setActivePlan(card.dataset.plan));
    });

    setActivePlan('signal');

    fetch(`${API_BASE}/config`).then(r => r.json()).then(cfg => {
      if(cfg?.stripePk && typeof Stripe === 'function'){
        stripeClient = Stripe(cfg.stripePk);
      }
      if(Array.isArray(cfg?.realEstatePlans)){
        cfg.realEstatePlans.forEach(updatePlanCardFromConfig);
      }
    }).catch(() => {});

    // AI script generator
    const scriptForm = document.getElementById('scriptForm');
    const scriptStatus = document.getElementById('scriptStatus');
    const scriptOutput = document.getElementById('scriptOutput');
    const scriptMeta = document.getElementById('scriptMeta');
    const copyBtn = document.getElementById('copyScript');
    const speakBtn = document.getElementById('speakScript');
    let activeAudio = null;
    let activeAudioSource = null;
    let activeAudioCleanup = null;
    let preferredVoiceVariant = 'warm';

    function resetVoiceButton(){
      if(!speakBtn) return;
      speakBtn.disabled = false;
      speakBtn.textContent = 'Play voice demo';
    }

    function stopActiveAudio(reason = 'stop'){
      if(activeAudio){
        try {
          activeAudio.pause();
          activeAudio.currentTime = 0;
        } catch (_) {}
      }
      const cleanup = activeAudioCleanup;
      activeAudio = null;
      activeAudioCleanup = null;
      activeAudioSource = null;
      if(typeof cleanup === 'function'){
        cleanup(reason);
      }
    }

    function stopVoicePreview(){
      const wasScript = activeAudioSource === 'script';
      stopActiveAudio('stop');
      if(!wasScript){
        resetVoiceButton();
      }
    }

    async function playElevenLabsVoice(text, options = {}){
      const trimmed = (text || '').trim();
      if(!trimmed) throw new Error('No text provided');
      const params = new URLSearchParams();
      params.set('t', trimmed.slice(0, 800));
      if(options.variant){
        params.set('variant', options.variant);
      }
      const audioUrl = `/audio/tts?${params.toString()}`;
      stopActiveAudio('interrupt');

      let objectUrl = null;
      let audio = null;

      try {
        console.info('[ColdCaller] Previewing ElevenLabs audio', {
          audioUrl,
          variant: options.variant || null,
          source: options.source || null,
        });
        const response = await fetch(audioUrl, { cache: 'no-store' });
        console.info('[ColdCaller] Preview response status', {
          audioUrl,
          status: response.status,
        });
        if(!response.ok){
          const message = await response.text().catch(() => '') || `HTTP ${response.status}`;
          console.error('[ColdCaller] Preview fetch rejected', {
            audioUrl,
            status: response.status,
            message,
          });
          const error = new Error(`ElevenLabs preview unavailable: ${message}`);
          error.status = response.status;
          throw error;
        }

        const blob = await response.blob();
        objectUrl = URL.createObjectURL(blob);
        audio = new Audio(objectUrl);
        activeAudio = audio;
        activeAudioSource = options.source || null;
        activeAudioCleanup = (reason) => {
          if(objectUrl){
            URL.revokeObjectURL(objectUrl);
            objectUrl = null;
          }
          if(reason === 'error'){
            options.onError?.();
          } else {
            options.onEnd?.();
          }
        };
        audio.addEventListener('ended', () => {
          if(activeAudio === audio){
            stopActiveAudio('ended');
          }
        });
        audio.addEventListener('error', () => {
          if(activeAudio === audio){
            stopActiveAudio('error');
          }
        });
        options.onStart?.();
        await audio.play();
        return audio;
      } catch (err) {
        if(audio && activeAudio === audio){
          stopActiveAudio('error');
        } else {
          if(objectUrl){
            URL.revokeObjectURL(objectUrl);
            objectUrl = null;
          }
          options.onError?.();
        }
        const errorDetails = {
          audioUrl,
          message: err?.message || err,
          status: err?.status || null,
        };
        if(!options.silentError){
          console.error('[ColdCaller] ElevenLabs preview failed', errorDetails);
        }
        throw err;
      }
    }

    function fallbackScript(payload){
      return `Intro: Hi, this is ${payload.tone === 'luxury' ? 'the concierge' : 'the acquisitions desk'} with Delco Tech, checking in about ${payload.focus || 'your real estate goals'} in ${payload.location || 'your area'}.\nDiscovery: Confirm timeline, financing, and any roadblocks.\nClose: Offer to ${payload.nextAction === 'checkout' ? 'text over a secure Stripe checkout link' : payload.nextAction === 'book' ? 'send my booking calendar' : 'transfer you to a senior closer now'}.`;
    }

    scriptForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      const formData = new FormData(scriptForm);
      const payload = Object.fromEntries(formData.entries());
      stopVoicePreview();
      scriptStatus.textContent = 'Generating with OpenAIâ€¦';
      scriptMeta.textContent = '';
      scriptOutput.textContent = '';
      try {
        const response = await fetch(`${API_BASE}/api/real-estate-script`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if(!response.ok) throw new Error('Bad response');
        const data = await response.json();
        scriptOutput.textContent = data.script || fallbackScript(payload);
        scriptStatus.textContent = 'AI script ready. Tweak and drop into your dialer.';
        scriptMeta.textContent = data.note ? data.note : `Lead type: ${payload.leadType} â€¢ Tone: ${payload.tone} â€¢ CTA: ${payload.nextAction}`;
        resetVoiceButton();
      } catch (err) {
        scriptStatus.textContent = 'OpenAI unavailable. Using fallback template below.';
        scriptOutput.textContent = fallbackScript(payload);
        scriptMeta.textContent = 'Tip: Add more detail about objections for a tighter script.';
        resetVoiceButton();
      }
    });

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(scriptOutput.textContent || '');
        copyBtn.textContent = 'Copied!';
        window.setTimeout(() => { copyBtn.textContent = 'Copy to clipboard'; }, 1800);
      } catch (err) {
        copyBtn.textContent = 'Press Ctrl+C';
        window.setTimeout(() => { copyBtn.textContent = 'Copy to clipboard'; }, 1800);
      }
    });

    // Live caller builder
    const callerForm = document.getElementById('callerForm');
    const callerPreview = document.getElementById('callerPreview');
    const callerStatus = document.getElementById('callerStatus');
    const callerMeta = document.getElementById('callerMeta');
    const callVisual = document.getElementById('callVisual');
    const callVisualOverlay = document.getElementById('callVisualOverlay');
    const callVisualDialog = document.getElementById('callVisualDialog');
    const callVisualEnded = document.getElementById('callVisualEnded');
    let callVisualTimers = [];
    let callVisualEndTimeout = null;

    function clearCallVisualTimers(){
      callVisualTimers.forEach((timer) => window.clearTimeout(timer));
      callVisualTimers = [];
      if(callVisualEndTimeout){
        window.clearTimeout(callVisualEndTimeout);
        callVisualEndTimeout = null;
      }
    }

    function resetCallVisual(){
      if(!callVisual) return;
      clearCallVisualTimers();
      callVisual.classList.remove('is-live', 'is-ended');
      if(callVisualOverlay){
        callVisualOverlay.setAttribute('aria-hidden', 'true');
      }
      if(callVisualDialog){
        callVisualDialog.innerHTML = '';
      }
      if(callVisualEnded){
        callVisualEnded.setAttribute('aria-hidden', 'true');
      }
    }

    function showCallEnded(){
      if(!callVisual) return;
      callVisual.classList.remove('is-live');
      callVisual.classList.add('is-ended');
      if(callVisualOverlay){
        callVisualOverlay.setAttribute('aria-hidden', 'true');
      }
      if(callVisualEnded){
        callVisualEnded.setAttribute('aria-hidden', 'false');
      }
      callVisualEndTimeout = window.setTimeout(() => {
        resetCallVisual();
      }, 2500);
    }

    function showCallInProgress(lines){
      if(!callVisual) return;
      clearCallVisualTimers();
      callVisual.classList.add('is-live');
      callVisual.classList.remove('is-ended');
      if(callVisualOverlay){
        callVisualOverlay.setAttribute('aria-hidden', 'false');
      }
      if(callVisualEnded){
        callVisualEnded.setAttribute('aria-hidden', 'true');
      }
      if(callVisualDialog){
        callVisualDialog.innerHTML = '';
        lines.forEach((line, index) => {
          const timer = window.setTimeout(() => {
            if(!callVisualDialog) return;
            const bubble = document.createElement('div');
            bubble.className = `call-visual-line ${line.role === 'lead' ? 'lead' : 'agent'}`;
            const label = document.createElement('span');
            label.textContent = line.label;
            bubble.appendChild(label);
            bubble.append(line.text);
            callVisualDialog.appendChild(bubble);
            window.requestAnimationFrame(() => {
              bubble.classList.add('show');
            });
          }, index * 900);
          callVisualTimers.push(timer);
        });
      }
      callVisualEndTimeout = window.setTimeout(() => {
        showCallEnded();
      }, Math.max((lines.length * 900) + 2200, 4600));
    }

    if(callerForm){
      const callerSubmit = callerForm.querySelector('button[type="submit"]');
      const voicePresets = {
        warm: { label: 'Warm & friendly (ElevenLabs)', variant: 'warm' },
        bold: { label: 'Bold & confident (ElevenLabs)', variant: 'bold' },
        calm: { label: 'Calm & precise (ElevenLabs)', variant: 'calm' }
      };
      const US_PREFIX = '+1';
      const phoneLocalInput = callerForm.querySelector('[name="toLocal"]');

      function sanitizeLocalDigits(value){
        let digits = String(value || '').replace(/[^\d]/g, '');
        if (digits.length === 11 && digits.startsWith('1')) {
          digits = digits.slice(1);
        }
        return digits.slice(0, 10);
      }

      function toE164(localDigits){
        const digits = sanitizeLocalDigits(localDigits);
        return digits ? `${US_PREFIX}${digits}` : '';
      }

      function formatDisplayPhone(value){
        const digits = sanitizeLocalDigits(value);
        if (!digits) return '';
        if (digits.length >= 10) {
          return `${US_PREFIX} (${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6, 10)}`;
        }
        return `${US_PREFIX} ${digits}`;
      }

      const fallbackCaller = {
        leadName: 'Roscoe',
        toLocal: '6105550123',
        goal: 'Secure a listing consultation',
        script: `We found three buyers already active nearby.\nYour consultation holds your price for 48 hours.\nCan I send the booking link to lock your time?`
      };
      fallbackCaller.to = toE164(fallbackCaller.toLocal);
      fallbackCaller.displayPhone = formatDisplayPhone(fallbackCaller.toLocal);

      function getCallerState(){
        const formData = new FormData(callerForm);
        const rawLocal = formData.get('toLocal') || '';
        const toLocal = sanitizeLocalDigits(rawLocal);
        if (phoneLocalInput && phoneLocalInput.value !== toLocal) {
          phoneLocalInput.value = toLocal;
        }
        const to = toE164(toLocal);
        return {
          leadName: (formData.get('leadName') || '').trim(),
          to,
          toLocal,
          goal: (formData.get('goal') || '').trim(),
          intro: (formData.get('intro') || '').trim(),
          script: (formData.get('script') || '').trim(),
          voice: formData.get('voice') || 'warm',
          handoffNumber: (formData.get('handoffNumber') || '').trim()
        };
      }

      function buildPreview(state){
        const preset = voicePresets[state.voice] || voicePresets.warm;
        const voiceLabel = preset.label || voicePresets.warm.label;
        const variant = preset.variant || state.voice || 'warm';
        const previewBase = `${window.location.origin}/audio/tts`;
        const toPreviewUrl = (text) => {
          const trimmed = (text || '').trim().slice(0, 800);
          if(!trimmed) return '';
          const params = new URLSearchParams();
          params.set('t', trimmed);
          params.set('variant', variant);
          return `${previewBase}?${params.toString()}`.replace(/&/g, '&amp;');
        };
        const leadName = state.leadName || fallbackCaller.leadName;
        const toNumber = state.to || fallbackCaller.to;
        const toLocal = state.toLocal || fallbackCaller.toLocal;
        const displayPhone = formatDisplayPhone(toLocal) || fallbackCaller.displayPhone || toNumber;
        const goal = state.goal || fallbackCaller.goal;
        const introLine = state.intro
          ? state.intro
          : (leadName
            ? `Hi ${leadName}, this is Alex from Delco Realty. Thanks for requesting a valuation.`
            : 'Hi there, this is Alex from Delco Realty. Thanks for requesting a valuation.');
        const scriptSource = state.script ? state.script : fallbackCaller.script;
        const scriptLines = scriptSource
          .split(/\r?\n/)
          .map(line => line.trim())
          .filter(Boolean);

        const gatherLines = [introLine, ...scriptLines];
        const gatherXml = gatherLines.map((line, index) => {
          const url = toPreviewUrl(line);
          if(!url) return '';
          const pause = index === gatherLines.length - 1 ? '' : `\n    <Pause length="1"/>`;
          return `    <Play>${url}</Play>${pause}`;
        }).filter(Boolean).join('\n');
        const connectUrl = toPreviewUrl('One moment while I connect you to a teammate.');
        const closingUrl = toPreviewUrl('Iâ€™ll text over the summary after this call. Talk soon!');
        const handoff = state.handoffNumber && connectUrl
          ? [`  <Play>${connectUrl}</Play>`, `  <Dial>${state.handoffNumber}</Dial>`]
          : (closingUrl ? [`  <Play>${closingUrl}</Play>`] : []);
        const twiml = `&lt;Response&gt;\n  &lt;Gather input="speech" timeout="4" speechTimeout="auto"&gt;\n${gatherXml}\n  &lt;/Gather&gt;\n${handoff.join('\n')}\n&lt;/Response&gt;`;

        const cleanGoal = goal.trim().replace(/\s+/g, ' ') || fallbackCaller.goal;
        const safeGoal = cleanGoal || fallbackCaller.goal;
        const goalSimple = safeGoal.replace(/\.$/, '');
        const goalSentence = goalSimple
          ? `We're calling to ${goalSimple.charAt(0).toLowerCase()}${goalSimple.slice(1)}.`
          : 'We\'re calling to secure a listing consultation.';

        const toTitle = (text) => text ? text.charAt(0).toUpperCase() + text.slice(1) : text;
        const leadTag = leadName ? toTitle(leadName) : 'Lead';
        const leadMid = leadName ? leadTag : 'the lead';
        const leadStart = leadName ? leadTag : 'The lead';
        const handoffDisplay = state.handoffNumber ? (formatDisplayPhone(state.handoffNumber) || state.handoffNumber) : '';
        const timeline = [
          `Twilio dials ${displayPhone || 'the lead phone'} from your configured number.`,
          `When ${leadMid} answers, the concierge uses the ${voiceLabel} voice powered by ElevenLabs to deliver the intro.`,
          'The system listens after each sentence with speech detection and a 4-second timeout.',
          state.handoffNumber
            ? `If ${leadMid} asks for a human, Twilio bridges ${handoffDisplay || state.handoffNumber} for a warm handoff.`
            : `${leadStart} hears every talking point before we promise a follow-up text.`,
          'All turns are logged so you can review the conversation or jump in live.'
        ];

        const dialogLines = [
          `Agent (${voiceLabel}): ${introLine}`,
          `${leadTag}: [Greets you back or confirms if now works.]`
        ];
        scriptLines.forEach((line, index) => {
          dialogLines.push(`Agent (${voiceLabel}): ${line}`);
          const responseHint = index === scriptLines.length - 1
            ? `${leadTag}: [Gives a yes/no so you can book, bill, or transfer.]`
            : `${leadTag}: [Shares details or objections â€” auto-transcribed in your call log.]`;
          dialogLines.push(responseHint);
        });

        const voicemailLine = `Hi ${leadName || 'there'}, it's Alex from Delco Realty. I spotted active buyers nearby and can hold your price for 48 hours. Call or text back and I'll send the booking link.`;

        const leadSummaryName = toTitle(leadName || '') || 'Not set';
        const leadSummaryPhone = displayPhone || 'Add phone in E.164';

        return [
          'Live call storyboard (auto-updating)',
          '-------------------------------------',
          `Lead: ${leadSummaryName} (${leadSummaryPhone})`,
          `Goal: ${safeGoal}`,
          `OpenAI summary: ${goalSentence}`,
          `Voice preset: ${voiceLabel}`,
          '',
          'Play-by-play:',
          ...timeline.map((line, idx) => `${idx + 1}. ${line}`),
          '',
          'Dialog rehearsal:',
          ...dialogLines,
          '',
          'If nobody picks up:',
          `Voicemail plan: ${voicemailLine}`,
          '',
          'Twilio instructions:',
          twiml
        ].join('\n');
      }

      function updateCallerPreview(){
        const state = getCallerState();
        const preset = voicePresets[state.voice] || voicePresets.warm;
        const voiceLabel = preset.label || voicePresets.warm.label;
        const variant = preset.variant || state.voice || 'warm';
        preferredVoiceVariant = variant;
        if(callerPreview){
          callerPreview.textContent = buildPreview(state);
        }
        if(callerMeta){
          const handoffDisplay = state.handoffNumber ? (formatDisplayPhone(state.handoffNumber) || state.handoffNumber) : '';
          const handoffText = state.handoffNumber
            ? `Warm handoff ready at ${handoffDisplay}.`
            : 'No live handoff configured yet â€” concierge stays on the line.';
          callerMeta.textContent = `${voiceLabel}. ${handoffText} Calls originate from your configured TWILIO_NUMBER. Adjust any field to redraw the storyboard.`;
        }
      }

      async function startCall(){
        const state = getCallerState();
        if(!state.to){
          callerStatus.textContent = 'Add a U.S. lead phone number (10 digits).';
          return;
        }
        const digitsOnly = state.to.replace(/[^\d]/g, '');
        if(digitsOnly.length !== 11){
          callerStatus.textContent = 'Enter a full 10-digit U.S. number so we can dial it as +1.';
          return;
        }
        resetCallVisual();
        const { toLocal, ...payload } = state;
        payload.origin = 'real-estate-cold-caller';
        const debugPayload = {
          to: payload.to,
          leadName: payload.leadName ? '[provided]' : '',
          goal: payload.goal ? `${payload.goal.slice(0, 120)}${payload.goal.length > 120 ? 'â€¦' : ''}` : '',
          intro: payload.intro ? `${payload.intro.slice(0, 120)}${payload.intro.length > 120 ? 'â€¦' : ''}` : '',
          script: payload.script ? `${payload.script.slice(0, 120)}${payload.script.length > 120 ? 'â€¦' : ''}` : '',
          voice: payload.voice,
          handoffNumber: payload.handoffNumber ? '[provided]' : '',
          origin: payload.origin,
        };
        console.info('[ColdCaller] Starting dial', debugPayload);
        callerStatus.textContent = 'Dialing via Twilioâ€¦';
        callerSubmit?.setAttribute('disabled', 'true');
        try {
          const response = await fetch(`${API_BASE}/api/cold-caller/dial`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          console.info('[ColdCaller] Dial response received', { status: response.status });
          const data = await response.json().catch(() => ({}));
          if(data?.error){
            console.error('[ColdCaller] Dial API error payload', data);
          }
          if(!response.ok || !data?.sid){
            const errMsg = data?.error ? ` (${data.error})` : '';
            throw new Error(`Unable to start call${errMsg}`);
          }
          callerStatus.textContent = `Call launched! Twilio SID ${data.sid}.`;
          console.info('[ColdCaller] Dial launched', { sid: data.sid });
          const agentLabel = 'Agent';
          const leadLabel = payload.leadName || 'Lead';
          const introLine = payload.intro?.trim() || 'Hi there, this is your concierge from Delco Realty.';
          const scriptLines = (payload.script || '').split(/\n+/).map((line) => line.trim()).filter(Boolean);
          const talkingPoint = scriptLines[0] || 'We found three buyers already active nearby.';
          const lines = [
            { role: 'agent', label: agentLabel, text: introLine },
            { role: 'lead', label: leadLabel, text: 'Sounds good â€” can you share what you found?' },
            { role: 'agent', label: agentLabel, text: talkingPoint }
          ];
          showCallInProgress(lines);
        } catch (error) {
          callerStatus.textContent = `Call failed: ${error.message}`;
          console.error('[ColdCaller] Dial request failed', {
            message: error?.message || error,
            stack: error?.stack || null,
          });
          resetCallVisual();
        } finally {
          callerSubmit?.removeAttribute('disabled');
        }
      }

      callerForm.addEventListener('input', updateCallerPreview);
      callerForm.addEventListener('change', updateCallerPreview);
      callerForm.addEventListener('submit', (event) => {
        event.preventDefault();
        startCall();
      });

      resetCallVisual();
      updateCallerPreview();
    }

    // Guided tour setup
    const startTourBtn = document.getElementById('startTour');
    const tourOverlay = document.getElementById('tourOverlay');
    const tourCard = document.getElementById('tourCard');
    const tourTitle = document.getElementById('tourTitle');
    const tourBody = document.getElementById('tourBody');
    const tourProgress = document.getElementById('tourProgress');
    const tourNext = document.getElementById('tourNext');
    const tourPrev = document.getElementById('tourPrev');
    const tourSkip = document.getElementById('tourSkip');
    const tourBackdrop = document.getElementById('tourBackdrop');
    const tourSteps = [
      {
        title: 'Welcome to the Real Estate Cold Caller',
        body: 'This dashboard runs like an app: launch a pay link, bounce to the live floor, or walk a caller through bookings without leaving the page.',
        narration: 'Welcome! This guided tour will show you how to spin up revenue from missed calls. You will see how to launch checkout links, route calls, and move faster than a traditional CRM.',
        focus: '.hero-card'
      },
      {
        title: 'Start with fresh lead data',
        body: 'Import FSBO lists, public notices, or portal exports. Filters make it easy to jump straight into the prospects who are ready now.',
        narration: 'First, sync the public data feeds or CSV drops you already collect. The filters keep you glued to the most motivated buyers and sellers.',
        focus: '#leads'
      },
      {
        title: 'Spin scripts with the AI lab',
        body: 'Describe the lead, pick a tone, and generate a tailored talk track. Copy it or play the audio to coach your callers in seconds.',
        narration: 'Next, the AI cold-call lab drafts a ready-to-read script. Choose your vibe, lock in the CTA, and your concierge creates compliant language you can send or speak instantly.',
        focus: '#ai'
      },
      {
        title: 'Collect payments instantly',
        body: 'Stripe Checkout and Link are baked in. Send reservation fees, inspection retainers, or consulting deposits without switching tabs.',
        narration: 'When a lead is hot, trigger the built-in Stripe checkout. Apple Pay, Link, and cards all work out of the box so you close financial commitment on the call.',
        focus: '.cta-panel'
      },
      {
        title: 'Hand off to humans anytime',
        body: 'Transfer a caller to the live floor, route them to Calendly, or escalate to a closer with one tap. Use automations or bring in your team on demand.',
        narration: 'Finally, tap the live floor or booking buttons for a seamless warm transfer. Automations keep working after hours, and humans jump in when you need them.',
        focus: '.hero-actions'
      }
    ];
    let tourIndex = 0;
    let highlightedEl = null;

    function clearHighlight(){
      if(highlightedEl){
        highlightedEl.classList.remove('tour-highlight');
        highlightedEl = null;
      }
    }

    function narrateTourStep(step){
      const narration = `${step.title}. ${step.narration || step.body}`;
      playElevenLabsVoice(narration, {
        variant: 'calm',
        source: 'tour',
        silentError: true,
        onError: () => {},
        onEnd: () => {}
      }).catch(() => {});
    }

    function showTourStep(index){
      const step = tourSteps[index];
      if(!step) return;
      tourIndex = index;
      tourTitle.textContent = step.title;
      tourBody.textContent = step.body;
      tourProgress.textContent = `Step ${index + 1} of ${tourSteps.length}`;
      clearHighlight();
      if(step.focus){
        const el = document.querySelector(step.focus);
        if(el){
          el.classList.add('tour-highlight');
          highlightedEl = el;
          el.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
        }
      }
      tourPrev.disabled = index === 0;
      tourNext.textContent = index === tourSteps.length - 1 ? 'Finish' : 'Next';
      tourCard.classList.remove('show');
      void tourCard.offsetWidth;
      tourCard.classList.add('show');
      narrateTourStep(step);
    }

    function openTour(){
      if(!tourOverlay) return;
      tourOverlay.classList.add('active');
      tourOverlay.setAttribute('aria-hidden', 'false');
      tourIndex = 0;
      showTourStep(0);
    }

    function closeTour(){
      if(!tourOverlay) return;
      clearHighlight();
      tourOverlay.classList.remove('active');
      tourOverlay.setAttribute('aria-hidden', 'true');
      stopActiveAudio('stop');
    }

    startTourBtn?.addEventListener('click', openTour);
    tourNext?.addEventListener('click', () => {
      if(tourIndex >= tourSteps.length - 1){
        closeTour();
        return;
      }
      showTourStep(tourIndex + 1);
    });
    tourPrev?.addEventListener('click', () => {
      if(tourIndex === 0) return;
      showTourStep(tourIndex - 1);
    });
    tourSkip?.addEventListener('click', closeTour);
    tourBackdrop?.addEventListener('click', closeTour);

    speakBtn?.addEventListener('click', async () => {
      if(activeAudio && activeAudioSource === 'script'){
        stopVoicePreview();
        return;
      }
      const text = (scriptOutput.textContent || '').trim();
      if(!text){
        speakBtn.textContent = 'Add script details first';
        window.setTimeout(resetVoiceButton, 2000);
        return;
      }
      speakBtn.disabled = true;
      speakBtn.textContent = 'Loading ElevenLabsâ€¦';
      try {
        await playElevenLabsVoice(text, {
          variant: preferredVoiceVariant || 'warm',
          source: 'script',
          onStart: () => {
            speakBtn.disabled = false;
            speakBtn.textContent = 'Playingâ€¦ Tap to stop';
          },
          onEnd: resetVoiceButton,
          onError: () => {
            speakBtn.disabled = false;
            speakBtn.textContent = 'Voice preview unavailable';
            window.setTimeout(resetVoiceButton, 2000);
          },
        });
      } catch (_) {}
    });
  </script>
</body>
</html>
