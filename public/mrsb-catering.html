<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mrs. B's Catering</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha512-mbLyon7FHheexM2WiwxupCSvJzpuG1HsfrNcrediOYM/qfNwCuWHa3gwxM/H2ymlk/wEYBLETymFcp2hWsyaw=="
    crossorigin=""
  >
  <style>
    :root {
      --primary-pink: #ff4db0;
      --deep-pink: #d70f64;
      --charcoal: #2b2b2d;
      --soft-gray: #f9f9fb;
    }

    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Raleway', sans-serif;
      background: var(--soft-gray);
      color: var(--charcoal);
      margin: 0;
      padding: 0;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    button {
      font-family: inherit;
    }

    .container {
      margin: 0 auto;
      max-width: 1200px;
      padding: 0 1.5rem;
      width: 100%;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      margin-left: -12px;
      margin-right: -12px;
    }

    .col {
      box-sizing: border-box;
      padding: 12px;
      flex: 0 0 100%;
      max-width: 100%;
    }

    .col.s12 {
      flex: 0 0 100%;
      max-width: 100%;
    }

    @media (min-width: 601px) {
      .col.m6 {
        flex: 0 0 50%;
        max-width: 50%;
      }
    }

    @media (min-width: 993px) {
      .col.l8 {
        flex: 0 0 66.6667%;
        max-width: 66.6667%;
      }

      .col.l4 {
        flex: 0 0 33.3333%;
        max-width: 33.3333%;
      }
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    .card-image img {
      border-radius: 12px;
      display: block;
      width: 100%;
    }

    .card-content {
      padding: 1.25rem;
    }

    .card-action {
      border-top: 1px solid rgba(0,0,0,0.08);
      padding: 1rem 1.25rem;
    }

    .card-title {
      left: 24px;
      position: absolute;
    }

    .btn {
      align-items: center;
      background: linear-gradient(135deg, var(--deep-pink), var(--primary-pink));
      border: none;
      border-radius: 999px;
      color: #ffffff;
      cursor: pointer;
      display: inline-flex;
      font-weight: 700;
      gap: 0.4rem;
      justify-content: center;
      letter-spacing: 0.05em;
      padding: 0.6rem 1.4rem;
      text-transform: uppercase;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .btn:hover,
    .btn:focus {
      box-shadow: 0 10px 25px rgba(215, 15, 100, 0.25);
      transform: translateY(-1px);
      outline: none;
    }

    .btn-large {
      font-size: 1rem;
      padding: 0.85rem 1.8rem;
    }

    .btn-flat {
      background: transparent;
      border: none;
      border-radius: 999px;
      color: var(--deep-pink);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-weight: 600;
      padding: 0.45rem 1rem;
      transition: background 0.2s ease;
    }

    .btn-flat:hover,
    .btn-flat:focus {
      background: rgba(215, 15, 100, 0.1);
      outline: none;
    }

    .waves-effect,
    .waves-light {
      position: relative;
    }

    .material-icons.left {
      margin-right: 0.4rem;
    }

    .material-icons.tiny {
      font-size: 1rem;
      vertical-align: middle;
    }

    .top-bar {
      background: #ffffff;
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
      position: sticky;
      top: 0;
      width: 100%;
      z-index: 1200;
    }

    .top-bar__inner {
      align-items: center;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.75rem;
      min-height: 58px;
      padding: 0 1rem;
    }

    .top-bar__brand img {
      height: 42px;
      width: auto;
    }

    .top-bar__actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
    }

    .fulfilment-switch {
      display: inline-flex;
      align-items: center;
      background: rgba(215, 15, 100, 0.08);
      border-radius: 999px;
      padding: 0.2rem;
      gap: 0.2rem;
    }

    .fulfilment-switch__btn {
      align-items: center;
      background: transparent;
      border: none;
      border-radius: 999px;
      color: var(--deep-pink);
      cursor: pointer;
      display: inline-flex;
      font-weight: 600;
      gap: 0.3rem;
      letter-spacing: 0.02em;
      padding: 0.3rem 0.9rem;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .fulfilment-switch__btn:hover,
    .fulfilment-switch__btn:focus {
      background: rgba(215, 15, 100, 0.16);
      outline: none;
    }

    .fulfilment-switch__btn.is-active {
      background: #ffffff;
      color: var(--deep-pink);
      box-shadow: 0 6px 16px rgba(215, 15, 100, 0.2);
    }

    .top-bar__link {
      align-items: center;
      background: none;
      border: none;
      border-radius: 999px;
      color: var(--deep-pink);
      cursor: pointer;
      display: inline-flex;
      font-weight: 600;
      gap: 0.35rem;
      letter-spacing: 0.04em;
      padding: 0.4rem 0.9rem;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .top-bar__link:hover,
    .top-bar__link:focus {
      background: rgba(215, 15, 100, 0.08);
      outline: none;
    }

    .top-bar__link .material-icons {
      font-size: 1.2rem;
    }

    .cart-count {
      background: linear-gradient(135deg, var(--deep-pink), var(--primary-pink));
      border-radius: 999px;
      color: #ffffff;
      display: inline-flex;
      font-size: 0.75rem;
      font-weight: 700;
      min-width: 22px;
      justify-content: center;
      padding: 0.15rem 0.4rem;
    }

    .top-bar__link[aria-disabled="true"] {
      cursor: default;
      opacity: 0.5;
    }

    .page-loader {
      align-items: center;
      background: #ffffff;
      display: flex;
      inset: 0;
      justify-content: center;
      position: fixed;
      transition: opacity 0.6s ease;
      z-index: 9999;
    }

    .page-loader.hidden {
      opacity: 0;
      pointer-events: none;
      visibility: hidden;
    }

    .loader-logo {
      max-width: 180px;
      width: 40vw;
      animation: pulse 1.6s ease-in-out infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.85; }
      100% { transform: scale(1); opacity: 1; }
    }

    header {
      text-align: center;
      padding: 3rem 1rem 1.5rem;
    }

    header h1 {
      margin-top: 1.2rem;
      font-weight: 700;
      color: var(--deep-pink);
      letter-spacing: 2px;
    }

    .menu-grid {
      display: flex;
      flex-wrap: wrap;
      margin-left: -12px;
      margin-right: -12px;
    }

    .menu-grid > .col {
      padding: 12px;
    }

    .menu-section {
      margin-bottom: 3rem;
    }

    .menu-section h2 {
      color: var(--deep-pink);
      font-weight: 700;
      letter-spacing: 1px;
      margin: 2rem 0 1rem;
      position: relative;
      text-transform: uppercase;
    }

    .menu-section h2::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: -8px;
      width: 80px;
      height: 4px;
      background: linear-gradient(90deg, var(--deep-pink), var(--primary-pink));
      border-radius: 4px;
    }

    .card.menu-card {
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 18px 40px rgba(215, 15, 100, 0.15);
    }

    .card.menu-card .card-image {
      position: relative;
      padding: 12px 12px 0;
    }

    .card.menu-card .card-image img {
      border-radius: 12px;
      height: 220px;
      object-fit: cover;
      cursor: pointer;
    }

    .menu-card .item-header {
      align-items: center;
      display: flex;
      gap: 0.75rem;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }

    .menu-card .item-name {
      color: var(--charcoal);
      font-size: 1.2rem;
      font-weight: 700;
      letter-spacing: 0.02em;
      flex: 1;
      margin: 0;
    }

    .badge-info {
      align-items: center;
      background: #ffffff;
      border-radius: 100px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      color: var(--deep-pink);
      display: inline-flex;
      font-weight: 600;
      gap: 6px;
      padding: 0.3rem 0.8rem;
      position: absolute;
      right: 24px;
      top: 24px;
    }

    .badge-info .badge-icon {
      font-size: 1.2rem;
    }

    .badge-info .badge-text {
      font-size: 0.85rem;
    }

    .upload-area {
      align-items: center;
      background: #ffffff;
      border: 1px solid rgba(215, 15, 100, 0.3);
      border-radius: 999px;
      color: var(--deep-pink);
      cursor: pointer;
      display: inline-flex;
      flex-shrink: 0;
      gap: 0.35rem;
      padding: 0.35rem 1rem;
      transition: box-shadow 0.2s ease, transform 0.2s ease;
      font-size: 0.85rem;
      font-weight: 600;
      white-space: nowrap;
    }

    .upload-container {
      align-items: center;
      display: flex;
      justify-content: flex-end;
    }

    .upload-area:hover,
    .upload-area:focus {
      box-shadow: 0 10px 25px rgba(215, 15, 100, 0.18);
      transform: translateY(-2px);
    }

    .upload-area .material-icons {
      font-size: 1rem;
    }

    .card-content ul {
      margin: 0;
      padding-left: 1.2rem;
    }

    .card-content li {
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .card-content li .material-icons {
      color: var(--deep-pink);
      margin-right: 0.35rem;
      vertical-align: middle;
    }

    .card-content .price {
      color: var(--deep-pink);
      font-weight: 700;
      font-size: 1.05rem;
    }

    .card-action {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1.5rem !important;
    }

    .rating-control {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 1.4rem;
      color: #ffc107;
    }

    .rating-control .material-icons {
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .rating-control .material-icons:hover {
      transform: scale(1.2);
    }

    .user-gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    .user-gallery img {
      border-radius: 8px;
      height: 70px;
      object-fit: cover;
      width: 70px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.12);
    }

    .cart-panel {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.12);
      margin-top: 3rem;
      padding: 2rem;
      position: sticky;
      top: 20px;
    }

    .cart-panel h3 {
      color: var(--deep-pink);
      font-weight: 700;
      margin-bottom: 1.2rem;
      text-transform: uppercase;
    }

    .fulfilment-panel {
      background: rgba(215, 15, 100, 0.06);
      border-radius: 16px;
      padding: 1.25rem;
      margin-bottom: 1.75rem;
    }

    .fulfilment-panel__label {
      font-weight: 700;
      margin: 0 0 0.75rem;
      text-transform: uppercase;
      color: var(--deep-pink);
      letter-spacing: 0.05em;
    }

    .fulfilment-panel__status {
      background: #ffffff;
      border-radius: 12px;
      padding: 0.75rem 1rem;
      box-shadow: 0 8px 18px rgba(215, 15, 100, 0.12);
      margin-bottom: 1rem;
      font-weight: 600;
      color: var(--charcoal);
    }

    .fulfilment-panel__status.is-closed {
      color: #d70f64;
    }

    .fulfilment-options {
      display: grid;
      gap: 0.65rem;
      margin-bottom: 1rem;
    }

    .radio-option {
      align-items: center;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      display: flex;
      gap: 0.6rem;
      padding: 0.6rem 0.75rem;
      font-weight: 600;
    }

    .radio-option input[type="radio"] {
      accent-color: var(--deep-pink);
      width: 18px;
      height: 18px;
    }

    .schedule-select {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: inset 0 0 0 1px rgba(215, 15, 100, 0.2);
      display: grid;
      gap: 0.4rem;
      padding: 0.75rem 0.9rem;
    }

    .schedule-select label {
      font-size: 0.85rem;
      font-weight: 600;
      color: rgba(0, 0, 0, 0.68);
    }

    .schedule-select select {
      border: 1px solid rgba(215, 15, 100, 0.4);
      border-radius: 999px;
      padding: 0.45rem 0.75rem;
      font-size: 0.95rem;
      font-family: inherit;
    }

    .delivery-fields {
      display: grid;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .delivery-fields[hidden] {
      display: none;
    }

    .delivery-note {
      margin: 0;
      font-size: 0.9rem;
      color: rgba(0, 0, 0, 0.7);
      font-weight: 600;
    }

    .field-group {
      display: grid;
      gap: 0.75rem;
    }

    .field-group.double {
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 0.75rem;
    }

    .field-group label {
      display: block;
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 0.3rem;
      color: rgba(0, 0, 0, 0.7);
    }

    .field-group input,
    .field-group textarea,
    .field-group select {
      border: 1px solid rgba(215, 15, 100, 0.3);
      border-radius: 10px;
      font-family: inherit;
      font-size: 0.95rem;
      padding: 0.55rem 0.7rem;
      width: 100%;
    }

    .field-group textarea {
      resize: vertical;
      min-height: 68px;
    }

    .delivery-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .delivery-actions .btn-flat {
      background: rgba(215, 15, 100, 0.12);
      color: var(--deep-pink);
      font-weight: 600;
    }

    .delivery-map-wrapper {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      display: grid;
      gap: 0.5rem;
      padding-bottom: 0.75rem;
    }

    .delivery-map-wrapper[hidden] {
      display: none;
    }

    #deliveryMap {
      height: 220px;
      width: 100%;
    }

    .delivery-distance-summary {
      font-weight: 600;
      padding: 0 1rem;
      color: var(--charcoal);
    }

    .delivery-distance-summary.is-error {
      color: #c0392b;
    }

    .delivery-distance-summary.is-success {
      color: #1e8449;
    }

    .delivery-distance-summary.is-warning {
      color: #e67e22;
    }

    .cart-empty {
      color: rgba(0, 0, 0, 0.55);
      font-weight: 600;
    }

    .cart-item {
      align-items: flex-start;
      display: flex;
      justify-content: space-between;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .cart-item .qty-controls {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .cart-details {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      max-width: 55%;
    }

    .cart-name {
      font-weight: 600;
    }

    .cart-modifiers {
      color: var(--deep-pink);
      font-size: 0.78rem;
      font-weight: 600;
      line-height: 1.3;
    }

    .cart-line-total {
      color: var(--deep-pink);
      font-weight: 700;
      white-space: nowrap;
    }

    .qty-btn {
      background: linear-gradient(135deg, var(--deep-pink), var(--primary-pink));
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      height: 28px;
      width: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .total-row {
      border-top: 1px solid rgba(0,0,0,0.08);
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      display: flex;
      justify-content: space-between;
      font-weight: 700;
      color: var(--charcoal);
    }

    .checkout-btn {
      background: linear-gradient(135deg, var(--deep-pink), var(--primary-pink));
      border-radius: 100px;
      display: inline-flex;
      justify-content: center;
      width: 100%;
      margin-top: 1.5rem;
      padding: 0.85rem 1.4rem;
    }

    .sides-grid {
      display: grid;
      gap: 0.75rem;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      margin: 1.25rem 0 0.5rem;
    }

    .drink-options {
      display: grid;
      gap: 0.75rem;
      margin: 1.25rem 0 0.5rem;
    }

    .side-option,
    .drink-option {
      align-items: center;
      background: rgba(255, 77, 176, 0.12);
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      gap: 0.6rem;
      padding: 0.75rem 0.9rem;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .side-option:hover,
    .side-option:focus-within,
    .drink-option:hover,
    .drink-option:focus-within {
      background: rgba(215, 15, 100, 0.18);
      transform: translateY(-1px);
    }

    .side-option input[type="checkbox"] {
      accent-color: var(--deep-pink);
    }

    .drink-option input[type="radio"] {
      accent-color: var(--deep-pink);
    }

    .side-option span {
      font-weight: 600;
    }

    .drink-option span {
      font-weight: 600;
    }

    .selection-warning {
      color: var(--deep-pink);
      font-size: 0.85rem;
      font-weight: 600;
      margin-top: 0.25rem;
    }

    .drink-warning {
      color: var(--deep-pink);
      font-size: 0.85rem;
      font-weight: 600;
      margin-top: 0.25rem;
      visibility: visible;
    }

    .modal-footer .btn.disabled {
      opacity: 0.6;
      pointer-events: none;
    }

    .modal-title {
      color: var(--deep-pink);
      font-weight: 700;
    }

    .modal-subtitle {
      margin-top: 0.4rem;
      margin-bottom: 0;
    }

    .modal {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 25px 60px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      left: 50%;
      max-height: 80vh;
      max-width: 540px;
      opacity: 0;
      pointer-events: none;
      position: fixed;
      top: 50%;
      transform: translate(-50%, -50%) scale(0.95);
      transition: opacity 0.3s ease, transform 0.3s ease;
      width: calc(100% - 2rem);
      z-index: 1301;
    }

    .modal.open {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -50%) scale(1);
    }

    .modal-content {
      overflow-y: auto;
      padding: 1.5rem 1.75rem;
    }

    .modal-footer {
      background: #f8f8fa;
      border-top: 1px solid rgba(0,0,0,0.06);
      border-bottom-left-radius: 16px;
      border-bottom-right-radius: 16px;
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      padding: 1rem 1.5rem 1.5rem;
    }

    .modal-backdrop {
      background: rgba(0,0,0,0.55);
      inset: 0;
      opacity: 0;
      pointer-events: none;
      position: fixed;
      transition: opacity 0.3s ease;
      z-index: 1300;
    }

    .modal-backdrop.visible {
      opacity: 1;
      pointer-events: auto;
    }

    body.modal-open {
      overflow: hidden;
    }

    .menu-tabs {
      display: inline-flex;
      gap: 0.5rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .menu-tab {
      align-items: center;
      background: rgba(255, 77, 176, 0.12);
      border: none;
      border-radius: 999px;
      color: var(--deep-pink);
      cursor: pointer;
      display: inline-flex;
      font-weight: 600;
      letter-spacing: 0.04em;
      padding: 0.35rem 1rem;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .menu-tab:hover,
    .menu-tab:focus {
      background: rgba(215, 15, 100, 0.22);
      transform: translateY(-1px);
      outline: none;
    }

    .doordash-reviews {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.08);
      margin-top: 2.25rem;
      padding: 1.85rem;
      position: relative;
    }

    .doordash-reviews::before {
      background: linear-gradient(135deg, rgba(215, 15, 100, 0.08), rgba(255, 77, 176, 0.12));
      border-radius: 16px;
      content: "";
      inset: 0;
      position: absolute;
      z-index: -1;
    }

    .doordash-reviews__header {
      align-items: center;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }

    .doordash-reviews__title {
      margin: 0;
    }

    .doordash-reviews__meta {
      color: rgba(43, 43, 45, 0.7);
      font-weight: 600;
      margin-top: 0.35rem;
    }

    .doordash-reviews__cta {
      align-items: center;
      display: flex;
      gap: 0.75rem;
    }

    .doordash-reviews__cta a {
      align-items: center;
      border-radius: 999px;
      color: var(--deep-pink);
      display: inline-flex;
      font-weight: 700;
      gap: 0.35rem;
      padding: 0.45rem 0.9rem;
      transition: background 0.2s ease;
    }

    .doordash-reviews__cta a:hover,
    .doordash-reviews__cta a:focus {
      background: rgba(215, 15, 100, 0.08);
      outline: none;
    }

    .doordash-rating {
      align-items: center;
      background: linear-gradient(135deg, rgba(215, 15, 100, 0.08), rgba(255, 77, 176, 0.14));
      border: 1px solid rgba(215, 15, 100, 0.15);
      border-radius: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
      padding: 1.1rem 1.5rem;
    }

    .doordash-rating__dial {
      align-items: center;
      background: radial-gradient(circle at center, #ffffff 0%, #fdf1f8 100%);
      border: 2px solid rgba(215, 15, 100, 0.12);
      border-radius: 50%;
      box-shadow: 0 12px 25px rgba(215, 15, 100, 0.15);
      color: var(--deep-pink);
      display: flex;
      flex-direction: column;
      font-weight: 700;
      height: 108px;
      justify-content: center;
      width: 108px;
    }

    .doordash-rating__dial span {
      line-height: 1.1;
    }

    .doordash-rating__dial .score {
      font-size: 2.75rem;
    }

    .doordash-rating__details {
      display: grid;
      gap: 0.55rem;
      min-width: 0;
    }

    .doordash-rating__details .stars {
      color: #e8c500;
      display: inline-flex;
      gap: 0.15rem;
    }

    .doordash-rating__note {
      align-items: center;
      background: rgba(255, 255, 255, 0.75);
      border-radius: 14px;
      display: flex;
      gap: 0.75rem;
      padding: 0.75rem 0.95rem;
      position: relative;
    }

    .doordash-rating__note::before {
      background: rgba(215, 15, 100, 0.12);
      border-radius: 12px;
      content: "";
      inset: 0;
      position: absolute;
      z-index: -1;
    }

    .doordash-rating__note-icon {
      align-items: center;
      background: linear-gradient(135deg, var(--deep-pink), var(--primary-pink));
      border-radius: 50%;
      color: #ffffff;
      display: inline-flex;
      font-size: 1.25rem;
      height: 38px;
      justify-content: center;
      width: 38px;
    }

    .doordash-rating__note-title {
      color: rgba(43, 43, 45, 0.8);
      font-size: 0.85rem;
      font-weight: 700;
      margin: 0;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .doordash-rating__note-text {
      color: rgba(43, 43, 45, 0.75);
      font-size: 0.85rem;
      line-height: 1.45;
      margin: 0.25rem 0 0;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .doordash-reviews__carousel {
      align-items: center;
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .review-viewport {
      flex: 1;
      overflow-x: auto;
      padding: 0.35rem 0.15rem;
      scroll-behavior: smooth;
      scroll-snap-type: x mandatory;
    }

    .review-viewport::-webkit-scrollbar {
      display: none;
    }

    .review-track {
      display: flex;
      gap: 1rem;
      min-height: 0;
    }

    .review-card {
      background: #ffffff;
      border: 1px solid rgba(43, 43, 45, 0.08);
      border-radius: 14px;
      box-shadow: 0 12px 22px rgba(0, 0, 0, 0.06);
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
      padding: 1.1rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .review-card:hover,
    .review-card:focus-within {
      box-shadow: 0 18px 36px rgba(0, 0, 0, 0.1);
      transform: translateY(-3px);
    }

    .review-card--compact {
      flex: 0 0 clamp(240px, 45vw, 320px);
      min-height: 150px;
      scroll-snap-align: start;
      padding: 0.95rem 1.1rem;
    }

    .review-card__header {
      align-items: center;
      display: flex;
      gap: 0.75rem;
    }

    .review-card__avatar {
      align-items: center;
      background: rgba(215, 15, 100, 0.1);
      border-radius: 50%;
      color: var(--deep-pink);
      display: inline-flex;
      font-weight: 700;
      height: 42px;
      justify-content: center;
      text-transform: uppercase;
      width: 42px;
    }

    .review-card__name {
      font-weight: 700;
      margin: 0;
    }

    .review-card__meta {
      color: rgba(43, 43, 45, 0.6);
      font-size: 0.85rem;
      margin-top: 0.15rem;
    }

    .review-card__rating {
      color: #e8c500;
      display: inline-flex;
      gap: 0.1rem;
    }

    .review-card__body {
      color: rgba(43, 43, 45, 0.85);
      font-size: 0.95rem;
      line-height: 1.55;
      margin: 0;
    }

    .review-card--compact .review-card__body {
      font-size: 0.9rem;
      line-height: 1.45;
      margin-top: 0.25rem;
      max-height: 4.5em;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 4;
      -webkit-box-orient: vertical;
    }

    .review-nav {
      align-items: center;
      background: #ffffff;
      border: none;
      border-radius: 50%;
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12);
      color: var(--deep-pink);
      cursor: pointer;
      display: inline-flex;
      height: 40px;
      justify-content: center;
      width: 40px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .review-nav:hover,
    .review-nav:focus {
      transform: translateY(-1px);
      box-shadow: 0 18px 34px rgba(215, 15, 100, 0.22);
      outline: none;
    }

    .review-nav[disabled] {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    @media (max-width: 768px) {
      .doordash-reviews {
        border-radius: 16px;
        box-shadow: 0 14px 32px rgba(0, 0, 0, 0.08);
        margin-top: 1.75rem;
        padding: 1.15rem 1.25rem;
      }

      .doordash-reviews__header {
        margin-bottom: 0.75rem;
      }

      .doordash-reviews__title {
        font-size: 1.35rem;
      }

      .doordash-reviews__meta {
        font-size: 0.82rem;
      }

      .doordash-rating {
        align-items: center;
        border-radius: 14px;
        flex-wrap: nowrap;
        gap: 1rem;
        margin-bottom: 1rem;
        padding: 0.85rem 1rem;
      }

      .doordash-rating__dial {
        height: 76px;
        width: 76px;
      }

      .doordash-rating__dial .score {
        font-size: 2.1rem;
      }

      .doordash-rating__details {
        gap: 0.45rem;
      }

      .doordash-rating__note {
        border-radius: 12px;
        gap: 0.6rem;
        padding: 0.6rem 0.75rem;
      }

      .doordash-rating__note-icon {
        height: 32px;
        width: 32px;
        font-size: 1.1rem;
      }

      .doordash-rating__note-title {
        font-size: 0.75rem;
        letter-spacing: 0.04em;
      }

      .doordash-rating__note-text {
        font-size: 0.8rem;
      }

      .doordash-reviews__carousel {
        align-items: center;
        flex-direction: row;
        gap: 0.65rem;
      }

      .review-viewport {
        width: 100%;
      }

      .review-track {
        gap: 0.75rem;
      }

      .review-card--compact {
        flex-basis: 80%;
        gap: 0.6rem;
        min-height: auto;
        padding: 0.8rem 0.9rem;
      }

      .review-card__header {
        gap: 0.6rem;
      }

      .review-card__avatar {
        height: 36px;
        width: 36px;
      }

      .review-card__meta {
        font-size: 0.8rem;
      }

      .review-card__body {
        font-size: 0.85rem;
        line-height: 1.4;
      }

      .review-nav {
        align-self: center;
        height: 36px;
        width: 36px;
      }
    }

    @media (max-width: 520px) {
      .doordash-reviews {
        padding: 1rem 1.1rem;
      }

      .doordash-rating {
        gap: 0.85rem;
        padding: 0.75rem 0.85rem;
      }

      .doordash-reviews__title {
        font-size: 1.22rem;
      }

      .doordash-reviews__meta {
        font-size: 0.78rem;
      }

      .doordash-rating__dial {
        height: 70px;
        width: 70px;
      }

      .doordash-rating__dial .score {
        font-size: 2rem;
      }

      .doordash-rating__note {
        padding: 0.5rem 0.65rem;
      }

      .doordash-rating__note-icon {
        height: 28px;
        width: 28px;
        font-size: 1rem;
      }

      .doordash-rating__note-title {
        font-size: 0.72rem;
      }

      .doordash-rating__note-text {
        font-size: 0.78rem;
      }

      .review-card--compact {
        flex-basis: 78%;
        padding: 0.75rem 0.85rem;
      }

      .review-card__body {
        font-size: 0.82rem;
        -webkit-line-clamp: 3;
      }
    }

    .highlight-section {
      margin: 2.5rem 0 2rem;
    }

    .highlight-header {
      align-items: baseline;
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .highlight-header h2 {
      color: var(--deep-pink);
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: 0.05em;
      margin: 0;
      text-transform: uppercase;
    }

    .highlight-header p {
      color: rgba(0, 0, 0, 0.6);
      font-size: 0.95rem;
      margin: 0;
    }

    .highlight-carousel {
      align-items: center;
      display: flex;
      gap: 1rem;
    }

    .highlight-viewport {
      flex: 1;
      overflow-x: auto;
      scroll-behavior: smooth;
      scroll-snap-type: x mandatory;
    }

    .highlight-viewport::-webkit-scrollbar {
      display: none;
    }

    .highlight-track {
      display: flex;
      gap: 1rem;
      padding: 0.25rem 0.1rem;
    }

    .highlight-card {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 18px 35px rgba(215, 15, 100, 0.12);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      flex: 0 0 clamp(200px, 60vw, 260px);
      min-width: 220px;
      overflow: hidden;
      scroll-snap-align: start;
      width: clamp(200px, 60vw, 260px);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .highlight-card:hover,
    .highlight-card:focus-within {
      box-shadow: 0 22px 45px rgba(215, 15, 100, 0.2);
      transform: translateY(-2px);
    }

    .highlight-card img {
      height: 160px;
      object-fit: cover;
      width: 100%;
      cursor: pointer;
    }

    .highlight-info {
      padding: 1rem 1.25rem 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .highlight-name {
      font-weight: 700;
    }

    .highlight-price {
      color: var(--deep-pink);
      font-weight: 700;
    }

    .highlight-add {
      border-radius: 0;
      border-top: 1px solid rgba(0,0,0,0.06);
      justify-content: center;
      text-transform: none;
      width: 100%;
    }

    .highlight-add .material-icons {
      font-size: 1.2rem;
    }

    .carousel-nav {
      align-items: center;
      background: #ffffff;
      border: none;
      border-radius: 50%;
      box-shadow: 0 12px 28px rgba(0,0,0,0.12);
      color: var(--deep-pink);
      cursor: pointer;
      display: inline-flex;
      height: 44px;
      justify-content: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      width: 44px;
    }

    .carousel-nav:hover,
    .carousel-nav:focus {
      box-shadow: 0 16px 36px rgba(215, 15, 100, 0.2);
      transform: translateY(-1px);
      outline: none;
    }

    .carousel-nav:disabled {
      box-shadow: none;
      cursor: default;
      opacity: 0.35;
      transform: none;
    }

    .add-to-cart {
      position: relative;
      overflow: hidden;
    }

    .add-to-cart.added::after {
      animation: ripple 0.6s ease;
      border-radius: 50%;
      content: '';
      inset: -20%;
      position: absolute;
      background: rgba(255, 255, 255, 0.35);
    }

    @keyframes ripple {
      0% { opacity: 0.9; transform: scale(0.1); }
      100% { opacity: 0; transform: scale(1); }
    }

    @media (max-width: 992px) {
      header {
        padding-top: 2.5rem;
      }

      .card.menu-card .card-image img {
        height: 200px;
      }

      .menu-card .item-header {
        align-items: flex-start;
        flex-direction: column;
        gap: 0.5rem;
      }

      .upload-container {
        justify-content: flex-start;
        width: 100%;
      }

      .cart-panel {
        position: static;
        margin-bottom: 2rem;
      }
    }

    @media (max-width: 600px) {
      .card.menu-card .card-image img {
        height: 180px;
      }

      .upload-area {
        border-radius: 999px;
        padding: 0.45rem 1.2rem;
      }

      .card-action {
        flex-direction: column;
        gap: 0.75rem;
        align-items: flex-start;
      }

      .highlight-carousel {
        gap: 0.5rem;
      }

      .carousel-nav {
        height: 36px;
        width: 36px;
      }
    }
  </style>
</head>
<body>
  <div class="page-loader" id="pageLoader">
    <img src="image/mrsB/mrsbscatering_logo_tran.png" alt="Mrs. B's Catering Logo" class="loader-logo">
  </div>

  <nav class="top-bar">
    <div class="top-bar__inner container">
      <a href="#pageTop" class="top-bar__brand" aria-label="Mrs. B's Catering Home">
        <img src="image/mrsB/mrsbscatering_logo_tran.png" alt="Mrs. B's Catering Logo small" />
      </a>
      <div class="top-bar__actions">
          <div class="fulfilment-switch" role="radiogroup" aria-label="Choose pickup or delivery">
            <button type="button" class="fulfilment-switch__btn is-active" data-fulfilment-mode="pickup" aria-pressed="true">
              <i class="material-icons" aria-hidden="true">storefront</i>
              <span>Pickup</span>
            </button>
            <button type="button" class="fulfilment-switch__btn" data-fulfilment-mode="delivery" aria-pressed="false">
              <i class="material-icons" aria-hidden="true">delivery_dining</i>
              <span>Delivery</span>
            </button>
          </div>
          <button type="button" class="top-bar__link menu-jump" data-target="menuTabsNav">
            <i class="material-icons" aria-hidden="true">restaurant_menu</i>
            Menu
          </button>
        <button type="button" class="top-bar__link cart-jump" data-target="cartPanel" aria-disabled="true">
          <i class="material-icons" aria-hidden="true">shopping_cart</i>
          <span class="cart-count">0</span>
        </button>
      </div>
    </div>
  </nav>

  <main id="pageTop">
    <div class="container">
      <header id="menuCategories">
        <h1>Mrs. B's Catering Menu</h1>
        <section class="highlight-section" id="highlightSection" aria-label="Featured menu picks">
          <div class="highlight-header">
            <h2>Chef's Highlights</h2>
            <p>Tap a favorite to add it straight to your cart.</p>
          </div>
          <div class="highlight-carousel">
            <button type="button" class="carousel-nav highlight-prev" aria-label="View previous highlights">
              <span class="material-icons" aria-hidden="true">chevron_left</span>
            </button>
            <div class="highlight-viewport">
              <div class="highlight-track" id="highlightTrack"></div>
            </div>
            <button type="button" class="carousel-nav highlight-next" aria-label="View more highlights">
              <span class="material-icons" aria-hidden="true">chevron_right</span>
            </button>
          </div>
        </section>
        <section class="doordash-reviews" aria-labelledby="doordashReviewsTitle">
          <div class="doordash-reviews__header">
            <div>
              <h2 id="doordashReviewsTitle" class="doordash-reviews__title">DoorDash Reviews</h2>
              <p class="doordash-reviews__meta">50+ ratings • 10+ public reviews</p>
            </div>
            <div class="doordash-reviews__cta">
              <button type="button" class="btn-flat" aria-label="Add a review on DoorDash">
                <i class="material-icons" aria-hidden="true">rate_review</i>
                Add Review
              </button>
              <a href="https://www.doordash.com/reviews/store/35300953/" target="_blank" rel="noopener noreferrer">
                See All
                <i class="material-icons" aria-hidden="true">north_east</i>
              </a>
            </div>
          </div>
          <div class="doordash-rating">
            <div class="doordash-rating__dial" aria-hidden="true">
              <span class="score">4.4</span>
              <span>of 5</span>
            </div>
            <div class="doordash-rating__details">
              <div class="stars" aria-label="Overall rating 4.4 out of 5 stars">
                <i class="material-icons" aria-hidden="true">star</i>
                <i class="material-icons" aria-hidden="true">star</i>
                <i class="material-icons" aria-hidden="true">star</i>
                <i class="material-icons" aria-hidden="true">star</i>
                <i class="material-icons" aria-hidden="true">star_half</i>
              </div>
              <p class="doordash-reviews__meta">Loved by DoorDash diners this month</p>
              <div class="doordash-rating__note">
                <span class="material-icons doordash-rating__note-icon" aria-hidden="true">auto_awesome</span>
                <div>
                  <p class="doordash-rating__note-title">Review highlights</p>
                  <p class="doordash-rating__note-text">Guests rave about the stuffed salmon, wing dings, and sweet sides that round out every plate.</p>
                </div>
              </div>
            </div>
          </div>
          <div class="doordash-reviews__carousel">
            <button type="button" class="carousel-nav review-nav review-prev" aria-label="View previous DoorDash review">
              <span class="material-icons" aria-hidden="true">chevron_left</span>
            </button>
            <div class="review-viewport" id="reviewsViewport" tabindex="0" role="list" aria-label="Recent DoorDash diner reviews">
              <div class="review-track" id="reviewsTrack">
                <article class="review-card review-card--compact" role="listitem">
                  <div class="review-card__header">
                    <span class="review-card__avatar" aria-hidden="true">B</span>
                    <div>
                      <p class="review-card__name">Ben H</p>
                      <p class="review-card__meta">3 contributions • DoorDash order • 10/21/25</p>
                    </div>
                  </div>
                  <div class="review-card__rating" aria-label="Rated 5 out of 5 stars">
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                  </div>
                  <p class="review-card__body">My second time ordering and it was amazing! The stuffed salmon and wing dings were both sooo flavorful! The baked mac and blueberry cornbread were so delicious! I can't wait to try more! The owner is so nice too and always has amazing deals.</p>
                </article>
                <article class="review-card review-card--compact" role="listitem">
                  <div class="review-card__header">
                    <span class="review-card__avatar" aria-hidden="true">J</span>
                    <div>
                      <p class="review-card__name">Jay T</p>
                      <p class="review-card__meta">2 contributions • DoorDash order • 10/22/25</p>
                    </div>
                  </div>
                  <div class="review-card__rating" aria-label="Rated 4.5 out of 5 stars">
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star_half</i>
                  </div>
                  <p class="review-card__body">The fish was so good—large portions and super fresh. We loved the rice and sides too! Only knocked a star because we received potato salad instead of seafood salad, but everything still tasted great.</p>
                </article>
                <article class="review-card review-card--compact" role="listitem">
                  <div class="review-card__header">
                    <span class="review-card__avatar" aria-hidden="true">P</span>
                    <div>
                      <p class="review-card__name">Patrice H</p>
                      <p class="review-card__meta">3 contributions • DoorDash order • 10/23/25</p>
                    </div>
                  </div>
                  <div class="review-card__rating" aria-label="Rated 4.5 out of 5 stars">
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star_half</i>
                  </div>
                  <p class="review-card__body">Second time ordering and the food was amazing again. The string beans and cabbage were perfect! I only docked a star because my salmon was a little overdone, but it was still delicious.</p>
                </article>
                <article class="review-card review-card--compact" role="listitem">
                  <div class="review-card__header">
                    <span class="review-card__avatar" aria-hidden="true">D</span>
                    <div>
                      <p class="review-card__name">Dominique B</p>
                      <p class="review-card__meta">4 contributions • DoorDash review • 09/25/25</p>
                    </div>
                  </div>
                  <div class="review-card__rating" aria-label="Rated 4.5 out of 5 stars">
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star_half</i>
                  </div>
                  <p class="review-card__body">I've been a fan since the Race Street days! Portions felt a little smaller this time but the turkey wings were tender and tasty. Yams are super sweet, so be ready for dessert-level goodness.</p>
                </article>
                <article class="review-card review-card--compact" role="listitem">
                  <div class="review-card__header">
                    <span class="review-card__avatar" aria-hidden="true">A</span>
                    <div>
                      <p class="review-card__name">Angela N</p>
                      <p class="review-card__meta">1 contribution • DoorDash order • 10/15/25</p>
                    </div>
                  </div>
                  <div class="review-card__rating" aria-label="Rated 5 out of 5 stars">
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                    <i class="material-icons" aria-hidden="true">star</i>
                  </div>
                  <p class="review-card__body">So glad I trusted the reviews! The hot chili wings with mac and sweet potatoes were incredible, and the fried catfish with greens and yellow rice was a hit with the whole family. We'll definitely be back.</p>
                </article>
              </div>
            </div>
            <button type="button" class="carousel-nav review-nav review-next" aria-label="View next DoorDash review">
              <span class="material-icons" aria-hidden="true">chevron_right</span>
            </button>
          </div>
        </section>
        <div class="menu-tabs" id="menuTabsNav" role="navigation" aria-label="Menu categories">
          <button type="button" class="menu-tab" data-target="entrees">Entrées</button>
          <button type="button" class="menu-tab" data-target="sides">Sides</button>
          <button type="button" class="menu-tab" data-target="drinks">Drinks</button>
          <button type="button" class="menu-tab" data-target="desserts">Desserts</button>
        </div>
      </header>

      <div class="row">
        <div class="col l8 s12">
          <section id="menuContainer"></section>
        </div>
        <div class="col l4 s12">
          <aside class="cart-panel" id="cartPanel" aria-live="polite">
            <h3>Your Plate</h3>
            <section class="fulfilment-panel" id="fulfilmentPanel" aria-labelledby="fulfilmentPanelLabel">
              <p class="fulfilment-panel__label" id="fulfilmentPanelLabel">Order type &amp; timing</p>
              <p class="fulfilment-panel__status" id="fulfilmentStatus">Checking store hours…</p>
              <div class="fulfilment-options" role="radiogroup" aria-label="Choose when you would like your order">
                <label class="radio-option">
                  <input type="radio" name="fulfilmentTimeOption" value="asap" checked>
                  <span>As soon as possible</span>
                </label>
                <label class="radio-option">
                  <input type="radio" name="fulfilmentTimeOption" value="schedule">
                  <span>Schedule ahead</span>
                </label>
              </div>
              <div class="schedule-select" id="scheduleContainer" hidden>
                <label for="scheduleSelect">Select a pickup or delivery time</label>
                <select id="scheduleSelect" aria-describedby="fulfilmentStatus"></select>
              </div>
              <div class="delivery-fields" id="deliveryFields" hidden>
                <p class="delivery-note">Delivery is available within 10 miles of 24 S Springfield Rd, Clifton Heights, PA.</p>
                <div class="field-group">
                  <label for="deliveryName">Full name</label>
                  <input type="text" id="deliveryName" name="deliveryName" autocomplete="name" placeholder="Your name">
                </div>
                <div class="field-group">
                  <label for="deliveryPhone">Phone number</label>
                  <input type="tel" id="deliveryPhone" name="deliveryPhone" autocomplete="tel" placeholder="(555) 555-5555">
                </div>
                <div class="field-group">
                  <label for="deliveryAddress1">Delivery address</label>
                  <input type="text" id="deliveryAddress1" name="deliveryAddress1" autocomplete="street-address" placeholder="Street address">
                </div>
                <div class="field-group double">
                  <div>
                    <label for="deliveryCity">City</label>
                    <input type="text" id="deliveryCity" name="deliveryCity" autocomplete="address-level2" placeholder="City">
                  </div>
                  <div>
                    <label for="deliveryZip">ZIP code</label>
                    <input type="text" id="deliveryZip" name="deliveryZip" autocomplete="postal-code" placeholder="ZIP">
                  </div>
                </div>
                <div class="field-group">
                  <label for="deliveryDropoff">Drop-off preference</label>
                  <select id="deliveryDropoff" name="deliveryDropoff">
                    <option value="door">Leave it at the door</option>
                    <option value="hand">Hand it to me</option>
                  </select>
                </div>
                <div class="field-group">
                  <label for="deliveryInstructions">Delivery instructions (optional)</label>
                  <textarea id="deliveryInstructions" name="deliveryInstructions" rows="2" placeholder="Apartment number, buzzer, etc."></textarea>
                </div>
                <div class="delivery-actions">
                  <button type="button" class="btn-flat" id="useLocationBtn">
                    <i class="material-icons" aria-hidden="true">my_location</i>
                    Use my location
                  </button>
                  <button type="button" class="btn-flat" id="calculateDeliveryBtn">
                    <i class="material-icons" aria-hidden="true">map</i>
                    Calculate delivery distance
                  </button>
                </div>
                <div class="delivery-map-wrapper" id="deliveryMapWrapper" hidden>
                  <div id="deliveryMap" aria-label="Delivery map showing the route"></div>
                  <p class="delivery-distance-summary" id="deliverySummary"></p>
                </div>
              </div>
            </section>
            <div id="cartItems"></div>
            <div class="total-row">
              <span>Total</span>
              <span id="cartTotal">$0.00</span>
            </div>
            <a href="checkout.html" class="waves-effect waves-light btn-large checkout-btn"><i class="material-icons left">shopping_cart</i>Proceed to Checkout</a>
          </aside>
        </div>
      </div>
    </div>
  </main>

  <template id="menuCardTemplate">
    <div class="menu-section">
      <h2 class="section-title"></h2>
      <div class="row menu-grid"></div>
    </div>
  </template>

  <template id="menuItemTemplate">
    <div class="col s12 m6">
      <div class="card menu-card">
        <div class="card-image">
          <img class="item-photo" alt="Food item image">
          <span class="badge-info" aria-live="polite"><i class="material-icons badge-icon" aria-hidden="true">schedule</i><span class="badge-text">Made to order</span></span>
        </div>
        <div class="card-content">
          <div class="item-header">
            <h3 class="item-name"></h3>
            <div class="upload-container">
              <div class="upload-area" role="button" tabindex="0">
                <i class="material-icons" aria-hidden="true">photo_camera</i>
                <span>Share plate</span>
              </div>
              <input type="file" class="user-upload" accept="image/*" hidden>
            </div>
          </div>
          <p class="item-description"></p>
          <ul>
            <li class="price"></li>
            <li><i class="material-icons tiny" aria-hidden="true">restaurant</i> <span class="item-category"></span></li>
          </ul>
          <div class="user-gallery"></div>
        </div>
        <div class="card-action">
          <div class="rating-control" aria-label="Rate this dish">
            <i class="material-icons" data-value="1">star_border</i>
            <i class="material-icons" data-value="2">star_border</i>
            <i class="material-icons" data-value="3">star_border</i>
            <i class="material-icons" data-value="4">star_border</i>
            <i class="material-icons" data-value="5">star_border</i>
            <span class="rating-count">(0)</span>
          </div>
          <button type="button" class="btn waves-effect waves-light add-to-cart"><i class="material-icons left">add</i>Add to Cart</button>
        </div>
      </div>
    </div>
  </template>

  <div id="entreeModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="entreeModalTitle" tabindex="-1">
    <div class="modal-content">
      <h4 class="modal-title" id="entreeModalTitle">Pick Two Sides</h4>
      <p class="modal-subtitle">Select two sides to complete <span class="modal-item-name"></span>.</p>
      <div class="sides-grid" role="group" aria-label="Available sides"></div>
      <p class="selection-warning">Choose any two sides to continue.</p>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn-flat cancel-entree">Cancel</button>
      <button type="button" class="btn waves-effect waves-light confirm-entree disabled" aria-disabled="true">Add to Cart</button>
    </div>
  </div>
  <div id="drinkModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="drinkModalTitle" tabindex="-1">
    <div class="modal-content">
      <h4 class="modal-title" id="drinkModalTitle">Pick Your Soda</h4>
      <p class="modal-subtitle">Choose one flavor to add to <span class="drink-modal-item-name"></span>.</p>
      <div class="drink-options" role="radiogroup" aria-label="Can soda selections"></div>
      <p class="drink-warning">Select a soda to continue.</p>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn-flat cancel-drink">Cancel</button>
      <button type="button" class="btn waves-effect waves-light confirm-drink disabled" aria-disabled="true">Add to Cart</button>
    </div>
  </div>
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha512-vuL0AklHtO4Zwzp1KimG++HjMATkUMlzUxr87hc7Z9eczsQnUnxE27XGr0C+MEY0S8NxV+UEi3x2hFifOLn1Pg=="
    crossorigin=""
  ></script>
  <script>
    const defaultImage = 'image/mrsB/mrsbscatering_logo_tran.png';
    const easternTimeZone = 'America/New_York';
    const minutesPerHour = 60;
    const scheduleLeadTimeMinutes = 45;
    const scheduleSlotIntervalMinutes = 30;
    const storeAddress = '24 S Springfield Rd, Clifton Heights, PA';

    const pickupHoursByDay = {
      0: null,
      1: { open: 13 * minutesPerHour, close: 19 * minutesPerHour },
      2: { open: 11 * minutesPerHour, close: 20 * minutesPerHour },
      3: { open: 12 * minutesPerHour, close: 19 * minutesPerHour },
      4: { open: 12 * minutesPerHour, close: 19 * minutesPerHour },
      5: { open: 12 * minutesPerHour, close: 20 * minutesPerHour + 30 },
      6: null,
    };

    const deliveryHoursByDay = {
      0: null,
      1: { open: 13 * minutesPerHour, close: 18 * minutesPerHour + 40 },
      2: { open: 11 * minutesPerHour, close: 19 * minutesPerHour + 40 },
      3: { open: 12 * minutesPerHour, close: 18 * minutesPerHour + 40 },
      4: { open: 12 * minutesPerHour, close: 18 * minutesPerHour + 40 },
      5: { open: 12 * minutesPerHour, close: 20 * minutesPerHour + 10 },
      6: null,
    };

    const DELIVERY_DISTANCE_LIMIT_MILES = 10;
    const DELIVERY_FEE_BRACKETS = [
      { max: 0.7, amount: 3 },
      { max: 2, amount: 5 },
      { max: 4, amount: 7.99 },
      { max: 6, amount: 11.99 },
      { max: 8, amount: 17.99 },
      { max: 10, amount: 25.99 },
    ];

    const menuData = [
      {
        category: 'Entrées',
        items: [
          {
            id: 'fried_catfish',
            name: 'Fried Catfish Dinner',
            price: 13.0,
            time: 'Ready in 30 minutes',
            description: 'Crispy seasoned catfish fillets served with house-made sides for a soul-soothing feast.',
            image: 'image/mrsB/fried_catfish.png',
            animatedImage: 'image/mrsB/fried_catfish.gif'
          },
          {
            id: 'turkey_wings_over_rice',
            name: 'Turkey Wings over Yellow Rice',
            price: 15.0,
            time: 'Ready in 45 minutes',
            description: 'Slow-roasted turkey wings smothered in rich gravy and served over fragrant yellow rice.',
            image: 'image/mrsB/turkey_wings_over_rice.png',
            animatedImage: 'image/mrsB/turkey_winng_0.gif'
          },
          {
            id: 'stuffed_salmon_over_rice',
            name: 'Stuffed Salmon over Rice',
            price: 17.0,
            time: 'Ready in 35 minutes',
            description: 'Tender salmon stuffed with herbs and seafood cream sauce, resting on buttery rice.',
            image: 'image/mrsB/stuffed_salmon_over_rice.png'
          },
          {
            id: 'fried_whtiting',
            name: 'Fried Whiting Plate',
            price: 12.0,
            time: 'Ready in 25 minutes',
            description: 'Golden fried whiting with Mrs. B’s signature blend of spices and a squeeze of lemon.',
            image: 'image/mrsB/fried_whtiting.png'
          },
          {
            id: 'fried_wingdings',
            name: 'Fried Wingdings',
            price: 11.0,
            time: 'Ready in 25 minutes',
            description: 'Crispy fried wings tossed in your choice of sauce, paired with classic sides.',
            image: 'image/mrsB/fried_wingdings.png',
            animatedImage: 'image/mrsB/fried_wingdings.gif'
          }
        ]
      },
      {
        category: 'Sides',
        items: [
          {
            id: 'greens',
            name: 'Seasoned Collard Greens',
            price: 5.5,
            time: 'Ready in 15 minutes',
            description: 'Slow-simmered greens infused with smoked turkey and savory spices.',
            image: 'image/mrsB/greens.png',
            animatedImage: 'image/mrsB/greens.gif'
          },
          {
            id: 'baked_mac_and_cheese',
            name: 'Baked Mac & Cheese',
            price: 5.5,
            time: 'Ready in 25 minutes',
            description: 'Creamy, cheesy macaroni baked until bubbling and topped with golden crust.',
            image: 'image/mrsB/baked_mac_and_cheese.png',
            animatedImage: 'image/mrsB/baked_mac_and_cheese.gif'
          },
          {
            id: 'sweet_potatoes',
            name: 'Candied Sweet Potatoes',
            price: 5.5,
            time: 'Ready in 20 minutes',
            description: 'Tender sweet potatoes glazed with brown sugar, butter, and warm spices.',
            image: 'image/mrsB/sweet_potatoes.png'
          },
          {
            id: 'seafood_salad',
            name: 'Seafood Pasta Salad',
            price: 8.0,
            time: 'Ready in 10 minutes',
            badge: {
              icon: 'ac_unit',
              text: 'Chilled'
            },
            description: 'Chilled pasta tossed with shrimp, peppers, and creamy herb dressing.',
            image: 'image/mrsB/seafood_salad.png'
          }
        ]
      },
      {
        category: 'Drinks',
        items: [
          {
            id: 'can_soda',
            name: 'Can Soda',
            price: 1.5,
            time: 'Ready now',
            description: 'Choose from Pepsi, Diet Pepsi, or Starry served ice cold.',
            image: defaultImage,
            imageOptions: [
              'image/mrsB/canSoda.png',
              'image/mrsB/canSoda0.PNG',
              'image/mrsB/canSoda1.PNG'
            ],
            variants: [
              { id: 'canSoda', label: 'Pepsi' },
              { id: 'canSoda0', label: 'Diet Pepsi' },
              { id: 'canSoda1', label: 'Starry' }
            ]
          },
          {
            id: 'bottled_water',
            name: 'Bottled Water',
            price: 1.25,
            badge: {
              icon: 'ac_unit',
              text: 'Ice cold'
            },
            description: 'Pure and refreshing bottled water.',
            image: 'image/mrsB/bottleWater.PNG'
          }
        ]
      },
      {
        category: 'Desserts',
        items: [
          {
            id: 'krazie_pudding_oreo',
            name: 'Krazie Pudding Oreo',
            price: 6.0,
            time: 'Ready in 10 minutes',
            description: 'Layers of creamy pudding, whipped topping, and crushed Oreo cookies.',
            image: defaultImage
          },
          {
            id: 'banana_pudding_kmaidson',
            name: 'Banana Pudding Kmaidson',
            price: 6.0,
            time: 'Ready in 10 minutes',
            description: 'Creamy and smooth pudding with hints of vanilla and fresh banana.',
            image: defaultImage
          },
          {
            id: 'cake',
            name: 'Seasonal Layer Cake',
            price: 6.0,
            time: 'Ready in 15 minutes',
            badge: {
              icon: 'cake',
              text: 'Baked today'
            },
            description: 'Layers of moist cake with rotating seasonal flavors and fillings.',
            image: defaultImage
          }
        ]
      }
    ];

    const applyDynamicAssets = () => {
      menuData.forEach((section) => {
        section.items.forEach((item) => {
          if (Array.isArray(item.imageOptions) && item.imageOptions.length) {
            const randomIndex = Math.floor(Math.random() * item.imageOptions.length);
            item.image = item.imageOptions[randomIndex];
          }
        });
      });
    };

    const initDrinkModal = () => {
      if (!drinkModalEl || !drinkConfirmBtn || !drinkOptionsGrid) return;

      ensureModalBackdrop();
      drinkModalEl.setAttribute('aria-hidden', 'true');

      const closeModal = () => {
        drinkModalEl.classList.remove('open');
        drinkModalEl.setAttribute('aria-hidden', 'true');
        drinkContext = null;
        resetDrinkModal();
        hideModalBackdropIfNone();
      };

      const openModal = () => {
        showModalBackdrop();
        drinkModalEl.classList.add('open');
        drinkModalEl.setAttribute('aria-hidden', 'false');
        setTimeout(() => {
          const focusTarget = drinkModalEl.querySelector('input[name="drink_option"]');
          (focusTarget || drinkConfirmBtn).focus();
        }, 50);
      };

      drinkModalInstance = {
        open: openModal,
        close: closeModal
      };

      drinkOptionsGrid.addEventListener('change', (event) => {
        if (event.target && event.target.name === 'drink_option') {
          updateDrinkSelectionState();
        }
      });

      drinkConfirmBtn.addEventListener('click', (event) => {
        event.preventDefault();
        if (!drinkContext) return;
        const selectedInput = drinkModalEl.querySelector('input[name="drink_option"]:checked');
        if (!selectedInput) return;
        const variantLabel = selectedInput.dataset.label || selectedInput.value;
        addMenuItemToCart(drinkContext.item, drinkContext.imageEl, drinkContext.addBtn, { variant: variantLabel });
        closeModal();
      });

      if (drinkCancelBtn) {
        drinkCancelBtn.addEventListener('click', (event) => {
          event.preventDefault();
          closeModal();
        });
      }

      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && drinkModalEl.classList.contains('open')) {
          closeModal();
        }
      });

      resetDrinkModal();
    };

    applyDynamicAssets();

    const menuContainer = document.getElementById('menuContainer');
    const cartItemsContainer = document.getElementById('cartItems');
    const cartTotalEl = document.getElementById('cartTotal');
    const navCartButton = document.querySelector('.cart-jump');
    const navCartCount = navCartButton ? navCartButton.querySelector('.cart-count') : null;
    const menuJumpButton = document.querySelector('.menu-jump');
    const menuTabs = document.querySelectorAll('.menu-tab');
    const fulfilmentSwitchButtons = document.querySelectorAll('[data-fulfilment-mode]');
    const fulfilmentStatusEl = document.getElementById('fulfilmentStatus');
    const fulfilmentPanel = document.getElementById('fulfilmentPanel');
    const fulfilmentTimeOptions = Array.from(document.querySelectorAll('input[name="fulfilmentTimeOption"]'));
    const scheduleContainer = document.getElementById('scheduleContainer');
    const scheduleSelect = document.getElementById('scheduleSelect');
    const deliveryFieldsEl = document.getElementById('deliveryFields');
    const deliveryNameInput = document.getElementById('deliveryName');
    const deliveryPhoneInput = document.getElementById('deliveryPhone');
    const deliveryAddressInput = document.getElementById('deliveryAddress1');
    const deliveryCityInput = document.getElementById('deliveryCity');
    const deliveryZipInput = document.getElementById('deliveryZip');
    const deliveryDropoffSelect = document.getElementById('deliveryDropoff');
    const deliveryInstructionsInput = document.getElementById('deliveryInstructions');
    const deliveryMapWrapper = document.getElementById('deliveryMapWrapper');
    const deliveryMapContainer = document.getElementById('deliveryMap');
    const deliverySummaryEl = document.getElementById('deliverySummary');
    const useLocationBtn = document.getElementById('useLocationBtn');
    const calculateDeliveryBtn = document.getElementById('calculateDeliveryBtn');
    const entreeModalEl = document.getElementById('entreeModal');
    const entreeModalName = entreeModalEl.querySelector('.modal-item-name');
    const entreeSidesGrid = entreeModalEl.querySelector('.sides-grid');
    const entreeConfirmBtn = entreeModalEl.querySelector('.confirm-entree');
    const cancelEntreeBtn = entreeModalEl.querySelector('.cancel-entree');
    const selectionWarning = entreeModalEl.querySelector('.selection-warning');
    const drinkModalEl = document.getElementById('drinkModal');
    const drinkModalName = drinkModalEl ? drinkModalEl.querySelector('.drink-modal-item-name') : null;
    const drinkOptionsGrid = drinkModalEl ? drinkModalEl.querySelector('.drink-options') : null;
    const drinkConfirmBtn = drinkModalEl ? drinkModalEl.querySelector('.confirm-drink') : null;
    const drinkCancelBtn = drinkModalEl ? drinkModalEl.querySelector('.cancel-drink') : null;
    const drinkWarning = drinkModalEl ? drinkModalEl.querySelector('.drink-warning') : null;
    const highlightTrack = document.getElementById('highlightTrack');
    const highlightViewport = document.querySelector('.highlight-viewport');
    const highlightPrev = document.querySelector('.highlight-prev');
    const highlightNext = document.querySelector('.highlight-next');
    let highlightAutoScrollTimer = null;
    let highlightAutoScrollStopped = false;

    const reviewsTrack = document.getElementById('reviewsTrack');
    const reviewViewport = document.getElementById('reviewsViewport');
    const reviewPrev = document.querySelector('.review-prev');
    const reviewNext = document.querySelector('.review-next');
    let reviewAutoScrollTimer = null;
    let reviewAutoScrollStopped = false;

    let entreeModalInstance;
    let entreeContext = null;
    let drinkModalInstance;
    let drinkContext = null;
    let modalBackdrop = null;

    const sidesOptions = menuData.find((section) => section.category === 'Sides')?.items || [];

    const loadStoredData = () => {
      const storedRatings = JSON.parse(localStorage.getItem('mrsb_ratings') || '{}');
      const storedUploads = JSON.parse(localStorage.getItem('mrsb_uploads') || '{}');
      const storedCart = JSON.parse(localStorage.getItem('mrsb_cart') || '[]');
      const storedFulfilment = JSON.parse(localStorage.getItem('mrsb_fulfilment') || 'null');
      return { storedRatings, storedUploads, storedCart, storedFulfilment };
    };

    const saveData = ({ ratings, uploads, cart }) => {
      localStorage.setItem('mrsb_ratings', JSON.stringify(ratings));
      localStorage.setItem('mrsb_uploads', JSON.stringify(uploads));
      localStorage.setItem('mrsb_cart', JSON.stringify(cart));
      localStorage.setItem('mrsb_fulfilment', JSON.stringify(fulfilmentState));
    };

    const state = {
      ratings: {},
      uploads: {},
      cart: []
    };

    const fulfilmentState = {
      mode: 'pickup',
      scheduleType: 'asap',
      scheduleValue: null,
      store: {
        address: storeAddress,
        lat: null,
        lng: null,
      },
      delivery: {
        name: '',
        phone: '',
        address1: '',
        city: '',
        zip: '',
        dropoff: 'door',
        instructions: '',
        lat: null,
        lng: null,
        accuracy: null,
        source: null,
      },
      deliveryQuote: {
        distanceMiles: null,
        fee: 0,
        withinRange: false,
        needsLocation: true,
      }
    };

    let currentScheduleOptions = [];
    let deliveryMapInstance = null;
    let deliveryStoreMarker = null;
    let deliveryUserMarker = null;
    let deliveryRouteLine = null;
    let deliveryMapReady = false;
    let pendingGeocodeController = null;
    const geocodeCache = new Map();

    const templates = {
      section: document.getElementById('menuCardTemplate'),
      item: document.getElementById('menuItemTemplate')
    };

    const slugify = (value) => value
      .normalize('NFD')
      .replace(/[\u0300-\u036f]/g, '')
      .toLowerCase()
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/(^-|-$)/g, '');

    const buildCartKey = (itemId, modifiers = []) => {
      const extras = modifiers.slice().sort().join('|');
      return extras ? `${itemId}::${extras}` : itemId;
    };

    const extractModifiers = (options = {}) => {
      const modifiers = [];
      if (Array.isArray(options.sides) && options.sides.length) {
        modifiers.push(...options.sides.map((side) => String(side)));
      }
      if (options.variant) {
        modifiers.push(String(options.variant));
      }
      return modifiers;
    };

    const formatPrice = (value) => `$${value.toFixed(2)}`;

    const getHoursByMode = (mode) => (mode === 'delivery' ? deliveryHoursByDay : pickupHoursByDay);

    const getEasternNow = () => {
      const localeString = new Date().toLocaleString('en-US', { timeZone: easternTimeZone });
      return new Date(localeString);
    };

    const minutesToDate = (baseDate, minutes) => {
      const startOfDay = new Date(baseDate);
      startOfDay.setHours(0, 0, 0, 0);
      return new Date(startOfDay.getTime() + (minutes * 60000));
    };

    const roundToInterval = (date, intervalMinutes) => {
      const millis = intervalMinutes * 60000;
      return new Date(Math.ceil(date.getTime() / millis) * millis);
    };

    const generateScheduleSlots = (mode) => {
      const hoursMap = getHoursByMode(mode);
      const now = getEasternNow();
      const slots = [];
      for (let offset = 0; offset < 10; offset += 1) {
        const candidate = new Date(now);
        candidate.setDate(now.getDate() + offset);
        const day = candidate.getDay();
        const window = hoursMap[day];
        if (!window) continue;
        const windowStart = minutesToDate(candidate, window.open);
        const windowEnd = minutesToDate(candidate, window.close);
        const lastPossibleStart = new Date(windowEnd.getTime() - scheduleSlotIntervalMinutes * 60000);
        let slotStart = windowStart;
        if (offset === 0) {
          const earliest = new Date(now.getTime() + scheduleLeadTimeMinutes * 60000);
          if (earliest > slotStart) {
            slotStart = roundToInterval(earliest, scheduleSlotIntervalMinutes);
          }
        }
        if (slotStart > lastPossibleStart) continue;
        while (slotStart <= lastPossibleStart) {
          const slotEnd = new Date(slotStart.getTime() + scheduleSlotIntervalMinutes * 60000);
          if (slotEnd > windowEnd) break;
          const label = slotStart.toLocaleString('en-US', {
            timeZone: easternTimeZone,
            weekday: 'short',
            month: 'short',
            day: 'numeric',
            hour: 'numeric',
            minute: '2-digit'
          });
          slots.push({ value: slotStart.toISOString(), label: `${label} ET` });
          slotStart = new Date(slotStart.getTime() + scheduleSlotIntervalMinutes * 60000);
        }
      }
      return slots;
    };

    const determineServiceStatus = (mode) => {
      const now = getEasternNow();
      const hoursMap = getHoursByMode(mode);
      const today = now.getDay();
      const currentMinutes = now.getHours() * minutesPerHour + now.getMinutes();
      const todaysHours = hoursMap[today];
      let isOpen = false;
      let closesAt = null;

      if (todaysHours && currentMinutes >= todaysHours.open && currentMinutes < todaysHours.close) {
        isOpen = true;
        closesAt = minutesToDate(now, todaysHours.close);
      }

      let nextOpen = null;
      for (let offset = 0; offset < 14; offset += 1) {
        const candidate = new Date(now);
        candidate.setDate(now.getDate() + offset);
        const day = candidate.getDay();
        const window = hoursMap[day];
        if (!window) continue;
        const start = minutesToDate(candidate, window.open);
        const end = minutesToDate(candidate, window.close);
        if (offset === 0 && end <= now) {
          continue;
        }
        if (offset === 0 && now < start) {
          nextOpen = start;
          break;
        }
        if (offset === 0 && isOpen) {
          nextOpen = now;
          break;
        }
        if (offset > 0) {
          nextOpen = start;
          break;
        }
      }

      return { isOpen, closesAt, nextOpen };
    };

    const determineDeliveryFee = (distanceMiles) => {
      if (!Number.isFinite(distanceMiles)) return 0;
      for (const bracket of DELIVERY_FEE_BRACKETS) {
        if (distanceMiles <= bracket.max) {
          return bracket.amount;
        }
      }
      return DELIVERY_FEE_BRACKETS[DELIVERY_FEE_BRACKETS.length - 1].amount;
    };

    const calculateDistanceMiles = (lat1, lon1, lat2, lon2) => {
      if (!Number.isFinite(lat1) || !Number.isFinite(lon1) || !Number.isFinite(lat2) || !Number.isFinite(lon2)) {
        return null;
      }
      const toRadians = (value) => (value * Math.PI) / 180;
      const earthRadiusMiles = 3958.8;
      const deltaLat = toRadians(lat2 - lat1);
      const deltaLon = toRadians(lon2 - lon1);
      const a = Math.sin(deltaLat / 2) ** 2 + Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) * Math.sin(deltaLon / 2) ** 2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return earthRadiusMiles * c;
    };

    const persistFulfilmentState = () => {
      localStorage.setItem('mrsb_fulfilment', JSON.stringify(fulfilmentState));
    };

    const fetchCoordinatesForQuery = async (query) => {
      if (!query) return null;
      const trimmed = query.trim();
      if (!trimmed) return null;
      if (geocodeCache.has(trimmed)) {
        return geocodeCache.get(trimmed);
      }
      try {
        const url = new URL('https://nominatim.openstreetmap.org/search');
        url.searchParams.set('format', 'jsonv2');
        url.searchParams.set('limit', '1');
        url.searchParams.set('addressdetails', '1');
        url.searchParams.set('q', trimmed);
        const response = await fetch(url.toString(), { headers: { Accept: 'application/json' } });
        if (!response.ok) {
          return null;
        }
        const data = await response.json();
        if (!Array.isArray(data) || !data.length) {
          return null;
        }
        const match = data[0];
        const lat = Number(match.lat);
        const lng = Number(match.lon);
        if (!Number.isFinite(lat) || !Number.isFinite(lng)) {
          return null;
        }
        const result = { lat, lng, displayName: match.display_name || trimmed };
        geocodeCache.set(trimmed, result);
        return result;
      } catch (error) {
        return null;
      }
    };

    const fetchAddressForCoordinates = async (lat, lng) => {
      if (!Number.isFinite(lat) || !Number.isFinite(lng)) {
        return null;
      }
      if (pendingGeocodeController) {
        pendingGeocodeController.abort();
      }
      const controller = new AbortController();
      pendingGeocodeController = controller;
      try {
        const url = new URL('https://nominatim.openstreetmap.org/reverse');
        url.searchParams.set('format', 'jsonv2');
        url.searchParams.set('lat', lat);
        url.searchParams.set('lon', lng);
        url.searchParams.set('addressdetails', '1');
        const response = await fetch(url.toString(), {
          headers: { Accept: 'application/json' },
          signal: controller.signal
        });
        if (!response.ok) {
          return null;
        }
        const data = await response.json();
        const address = data?.address || {};
        const street = [address.house_number, address.road || address.pedestrian || address.neighbourhood]
          .filter(Boolean)
          .join(' ')
          .trim();
        const city = address.city || address.town || address.village || address.hamlet || '';
        const zip = address.postcode || '';
        return { address1: street, city, zip };
      } catch (error) {
        if (controller.signal.aborted) {
          return null;
        }
        return null;
      } finally {
        if (pendingGeocodeController === controller) {
          pendingGeocodeController = null;
        }
      }
    };

    const ensureStoreCoordinates = async () => {
      if (Number.isFinite(fulfilmentState.store.lat) && Number.isFinite(fulfilmentState.store.lng)) {
        return fulfilmentState.store;
      }
      const result = await fetchCoordinatesForQuery(storeAddress);
      if (result) {
        fulfilmentState.store.lat = result.lat;
        fulfilmentState.store.lng = result.lng;
        persistFulfilmentState();
        updateDeliveryMap();
        refreshDeliveryQuote();
        updateDeliverySummary();
      }
      return fulfilmentState.store;
    };

    const ensureDeliveryMap = () => {
      if (!deliveryMapContainer || typeof L === 'undefined') {
        return null;
      }
      if (deliveryMapInstance) {
        return deliveryMapInstance;
      }
      deliveryMapInstance = L.map(deliveryMapContainer, {
        zoomControl: false,
        scrollWheelZoom: false,
        attributionControl: false
      });
      const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
      });
      tileLayer.addTo(deliveryMapInstance);
      deliveryMapReady = true;
      deliveryMapInstance.on('click', (event) => {
        const { lat, lng } = event.latlng || {};
        if (!Number.isFinite(lat) || !Number.isFinite(lng)) return;
        setDeliveryLocation({ lat, lng, source: 'map' });
      });
      return deliveryMapInstance;
    };

    const refreshDeliveryQuote = () => {
      const storeLat = fulfilmentState.store.lat;
      const storeLng = fulfilmentState.store.lng;
      const userLat = fulfilmentState.delivery.lat;
      const userLng = fulfilmentState.delivery.lng;
      if (!Number.isFinite(storeLat) || !Number.isFinite(storeLng)) {
        fulfilmentState.deliveryQuote.distanceMiles = null;
        fulfilmentState.deliveryQuote.fee = 0;
        fulfilmentState.deliveryQuote.withinRange = false;
        fulfilmentState.deliveryQuote.needsLocation = true;
        return fulfilmentState.deliveryQuote;
      }
      if (!Number.isFinite(userLat) || !Number.isFinite(userLng)) {
        fulfilmentState.deliveryQuote.distanceMiles = null;
        fulfilmentState.deliveryQuote.fee = 0;
        fulfilmentState.deliveryQuote.withinRange = true;
        fulfilmentState.deliveryQuote.needsLocation = true;
        return fulfilmentState.deliveryQuote;
      }
      const distance = calculateDistanceMiles(storeLat, storeLng, userLat, userLng);
      fulfilmentState.deliveryQuote.distanceMiles = distance;
      fulfilmentState.deliveryQuote.needsLocation = false;
      if (!Number.isFinite(distance) || distance > DELIVERY_DISTANCE_LIMIT_MILES) {
        fulfilmentState.deliveryQuote.fee = 0;
        fulfilmentState.deliveryQuote.withinRange = false;
      } else {
        fulfilmentState.deliveryQuote.fee = determineDeliveryFee(distance);
        fulfilmentState.deliveryQuote.withinRange = true;
      }
      return fulfilmentState.deliveryQuote;
    };

    const updateDeliverySummary = () => {
      if (!deliverySummaryEl) return;
      deliverySummaryEl.classList.remove('is-success', 'is-warning', 'is-error');
      if (!Number.isFinite(fulfilmentState.store.lat) || !Number.isFinite(fulfilmentState.store.lng)) {
        deliverySummaryEl.textContent = 'Loading store location…';
        deliverySummaryEl.classList.add('is-warning');
        return;
      }
      const quote = refreshDeliveryQuote();
      if (quote.needsLocation) {
        deliverySummaryEl.textContent = 'Share your address or use your location to calculate delivery distance.';
        deliverySummaryEl.classList.add('is-warning');
        return;
      }
      if (!quote.withinRange) {
        const distanceText = Number.isFinite(quote.distanceMiles)
          ? `${quote.distanceMiles.toFixed(2)} miles away`
          : 'outside our delivery range';
        deliverySummaryEl.textContent = `Delivery is available within ${DELIVERY_DISTANCE_LIMIT_MILES} miles. You're ${distanceText}.`;
        deliverySummaryEl.classList.add('is-error');
        return;
      }
      const distanceText = Number.isFinite(quote.distanceMiles)
        ? `${quote.distanceMiles.toFixed(2)} miles`
        : 'within range';
      deliverySummaryEl.textContent = `Approximately ${distanceText} from the store. Estimated delivery fee ${formatPrice(quote.fee)}.`;
      deliverySummaryEl.classList.add('is-success');
    };

    const updateDeliveryMap = () => {
      if (!deliveryMapWrapper || fulfilmentState.mode !== 'delivery') {
        return;
      }
      const map = ensureDeliveryMap();
      if (!map) return;
      const storeLat = fulfilmentState.store.lat;
      const storeLng = fulfilmentState.store.lng;
      const userLat = fulfilmentState.delivery.lat;
      const userLng = fulfilmentState.delivery.lng;
      const hasStore = Number.isFinite(storeLat) && Number.isFinite(storeLng);
      const hasUser = Number.isFinite(userLat) && Number.isFinite(userLng);

      if (hasStore) {
        const storeLatLng = [storeLat, storeLng];
        if (!deliveryStoreMarker) {
          deliveryStoreMarker = L.marker(storeLatLng, { title: "Mrs. B's Catering" }).addTo(map);
        } else {
          deliveryStoreMarker.setLatLng(storeLatLng);
        }
      }

      if (hasUser) {
        const userLatLng = [userLat, userLng];
        if (!deliveryUserMarker) {
          deliveryUserMarker = L.marker(userLatLng, { draggable: true, title: 'Delivery address' }).addTo(map);
          deliveryUserMarker.on('dragend', () => {
            const latLng = deliveryUserMarker.getLatLng();
            setDeliveryLocation({ lat: latLng.lat, lng: latLng.lng, source: 'pin' });
          });
        } else {
          deliveryUserMarker.setLatLng(userLatLng);
        }
      }

      if (deliveryStoreMarker && deliveryUserMarker) {
        const storeLatLng = deliveryStoreMarker.getLatLng();
        const userLatLng = deliveryUserMarker.getLatLng();
        if (!deliveryRouteLine) {
          deliveryRouteLine = L.polyline([storeLatLng, userLatLng], {
            color: '#d70f64',
            weight: 3,
            dashArray: '6 6'
          }).addTo(map);
        } else {
          deliveryRouteLine.setLatLngs([storeLatLng, userLatLng]);
        }
        const bounds = L.latLngBounds([storeLatLng, userLatLng]);
        map.fitBounds(bounds, { padding: [24, 32] });
        deliveryMapWrapper.hidden = false;
      } else {
        if (deliveryRouteLine) {
          map.removeLayer(deliveryRouteLine);
          deliveryRouteLine = null;
        }
        if (deliveryStoreMarker) {
          map.setView(deliveryStoreMarker.getLatLng(), 13);
        }
        deliveryMapWrapper.hidden = !hasUser;
      }

      if (deliveryMapReady) {
        setTimeout(() => map.invalidateSize(), 200);
      }
    };

    const updateDeliveryFieldsState = () => {
      if (!deliveryFieldsEl) return;
      const isDelivery = fulfilmentState.mode === 'delivery';
      deliveryFieldsEl.hidden = !isDelivery;
      if (isDelivery) {
        ensureStoreCoordinates();
        updateDeliveryMap();
      } else if (deliveryMapWrapper) {
        deliveryMapWrapper.hidden = true;
      }
      updateDeliverySummary();
    };

    const updateFulfilmentButtons = () => {
      fulfilmentSwitchButtons.forEach((button) => {
        const mode = button.dataset.fulfilmentMode;
        const isActive = mode === fulfilmentState.mode;
        button.classList.toggle('is-active', isActive);
        button.setAttribute('aria-pressed', isActive ? 'true' : 'false');
      });
    };

    const updateScheduleControls = () => {
      if (!scheduleSelect || !scheduleContainer) return;
      currentScheduleOptions = generateScheduleSlots(fulfilmentState.mode);
      scheduleSelect.innerHTML = '';
      currentScheduleOptions.forEach((slot) => {
        const option = document.createElement('option');
        option.value = slot.value;
        option.textContent = slot.label;
        scheduleSelect.appendChild(option);
      });

      let scheduleValueChanged = false;
      if (currentScheduleOptions.length) {
        scheduleSelect.disabled = false;
        if (!fulfilmentState.scheduleValue || !currentScheduleOptions.some((slot) => slot.value === fulfilmentState.scheduleValue)) {
          fulfilmentState.scheduleValue = currentScheduleOptions[0].value;
          scheduleValueChanged = true;
        }
        scheduleSelect.value = fulfilmentState.scheduleValue;
      } else {
        fulfilmentState.scheduleValue = null;
        const placeholder = document.createElement('option');
        placeholder.value = '';
        placeholder.textContent = 'No upcoming times available';
        scheduleSelect.appendChild(placeholder);
        scheduleSelect.value = '';
        scheduleSelect.disabled = true;
        scheduleValueChanged = true;
      }

      const status = determineServiceStatus(fulfilmentState.mode);
      const asapRadio = fulfilmentTimeOptions.find((input) => input.value === 'asap');
      let scheduleTypeChanged = false;
      if (asapRadio) {
        asapRadio.disabled = !status.isOpen;
        if (!status.isOpen && fulfilmentState.scheduleType !== 'schedule') {
          fulfilmentState.scheduleType = 'schedule';
          scheduleTypeChanged = true;
        }
      }

      fulfilmentTimeOptions.forEach((input) => {
        input.checked = input.value === fulfilmentState.scheduleType;
      });

      scheduleContainer.hidden = fulfilmentState.scheduleType !== 'schedule';

      if (scheduleTypeChanged || scheduleValueChanged) {
        persistFulfilmentState();
      }
    };

    const updateFulfilmentStatusDisplay = () => {
      if (!fulfilmentStatusEl) return;
      const status = determineServiceStatus(fulfilmentState.mode);
      fulfilmentStatusEl.classList.toggle('is-closed', !status.isOpen);
      const serviceLabel = fulfilmentState.mode === 'delivery' ? 'delivery' : 'pickup';
      if (status.isOpen) {
        const closeText = status.closesAt
          ? status.closesAt.toLocaleString('en-US', { timeZone: easternTimeZone, hour: 'numeric', minute: '2-digit' })
          : '';
        if (closeText) {
          fulfilmentStatusEl.textContent = `We're open for ${serviceLabel} until ${closeText} ET. Order now or schedule ahead.`;
        } else {
          fulfilmentStatusEl.textContent = `We're open for ${serviceLabel}!`;
        }
      } else if (currentScheduleOptions.length) {
        fulfilmentStatusEl.textContent = `We're currently closed for ${serviceLabel}. Schedule your order for ${currentScheduleOptions[0].label}.`;
      } else {
        fulfilmentStatusEl.textContent = `We're not accepting ${serviceLabel} orders at the moment. Check back soon.`;
      }
    };

    const updateFulfilmentUI = () => {
      updateFulfilmentButtons();
      updateScheduleControls();
      updateFulfilmentStatusDisplay();
      updateDeliveryFieldsState();
      if (fulfilmentState.mode === 'delivery') {
        ensureStoreCoordinates();
      }
    };

    const applyFulfilmentStateToInputs = () => {
      if (deliveryNameInput) deliveryNameInput.value = fulfilmentState.delivery.name || '';
      if (deliveryPhoneInput) deliveryPhoneInput.value = fulfilmentState.delivery.phone || '';
      if (deliveryAddressInput) deliveryAddressInput.value = fulfilmentState.delivery.address1 || '';
      if (deliveryCityInput) deliveryCityInput.value = fulfilmentState.delivery.city || '';
      if (deliveryZipInput) deliveryZipInput.value = fulfilmentState.delivery.zip || '';
      if (deliveryDropoffSelect) deliveryDropoffSelect.value = fulfilmentState.delivery.dropoff || 'door';
      if (deliveryInstructionsInput) deliveryInstructionsInput.value = fulfilmentState.delivery.instructions || '';
      if (scheduleSelect && fulfilmentState.scheduleValue && currentScheduleOptions.some((slot) => slot.value === fulfilmentState.scheduleValue)) {
        scheduleSelect.value = fulfilmentState.scheduleValue;
      }
      fulfilmentTimeOptions.forEach((input) => {
        input.checked = input.value === fulfilmentState.scheduleType;
      });
    };

    const setFulfilmentMode = (mode) => {
      const normalized = mode === 'delivery' ? 'delivery' : 'pickup';
      if (fulfilmentState.mode === normalized) return;
      fulfilmentState.mode = normalized;
      updateFulfilmentUI();
      persistFulfilmentState();
    };

    const setDeliveryLocation = ({ lat, lng, source = 'manual', accuracy = null }) => {
      if (!Number.isFinite(lat) || !Number.isFinite(lng)) return;
      fulfilmentState.delivery.lat = lat;
      fulfilmentState.delivery.lng = lng;
      fulfilmentState.delivery.source = source;
      fulfilmentState.delivery.accuracy = Number.isFinite(accuracy) ? accuracy : null;
      refreshDeliveryQuote();
      updateDeliverySummary();
      updateDeliveryMap();
      persistFulfilmentState();
      if (source !== 'manual') {
        fetchAddressForCoordinates(lat, lng)
          .then((address) => {
            if (!address) return;
            if (deliveryAddressInput && (!deliveryAddressInput.value || source !== 'address')) {
              deliveryAddressInput.value = address.address1 || deliveryAddressInput.value;
              fulfilmentState.delivery.address1 = deliveryAddressInput.value;
            }
            if (deliveryCityInput && (!deliveryCityInput.value || source !== 'address')) {
              deliveryCityInput.value = address.city || deliveryCityInput.value;
              fulfilmentState.delivery.city = deliveryCityInput.value;
            }
            if (deliveryZipInput && (!deliveryZipInput.value || source !== 'address')) {
              deliveryZipInput.value = address.zip || deliveryZipInput.value;
              fulfilmentState.delivery.zip = deliveryZipInput.value;
            }
            persistFulfilmentState();
          })
          .catch(() => {});
      }
    };

    const handleDeliveryAddressGeocode = async () => {
      const line1 = deliveryAddressInput?.value?.trim();
      const city = deliveryCityInput?.value?.trim();
      const zip = deliveryZipInput?.value?.trim();
      const pieces = [line1, city || 'Clifton Heights', zip, 'PA'];
      const query = pieces.filter(Boolean).join(', ');
      const result = await fetchCoordinatesForQuery(query);
      if (!result) {
        fulfilmentState.deliveryQuote.needsLocation = true;
        if (deliverySummaryEl) {
          deliverySummaryEl.classList.remove('is-success', 'is-warning');
          deliverySummaryEl.classList.add('is-error');
          deliverySummaryEl.textContent = 'We could not find that address. Please check and try again.';
        }
        return;
      }
      fulfilmentState.delivery.address1 = line1 || '';
      fulfilmentState.delivery.city = city || '';
      fulfilmentState.delivery.zip = zip || '';
      setDeliveryLocation({ lat: result.lat, lng: result.lng, source: 'address' });
      updateDeliveryFieldsState();
      persistFulfilmentState();
    };

    const handleUseLocation = () => {
      if (!navigator?.geolocation) {
        if (deliverySummaryEl) {
          deliverySummaryEl.classList.remove('is-success');
          deliverySummaryEl.classList.add('is-warning');
          deliverySummaryEl.textContent = 'Location services are not supported in this browser.';
        }
        return;
      }
      navigator.geolocation.getCurrentPosition(
        (position) => {
          setDeliveryLocation({
            lat: position.coords.latitude,
            lng: position.coords.longitude,
            accuracy: position.coords.accuracy,
            source: 'geolocation'
          });
          updateDeliveryFieldsState();
        },
        () => {
          if (deliverySummaryEl) {
            deliverySummaryEl.classList.remove('is-success');
            deliverySummaryEl.classList.add('is-error');
            deliverySummaryEl.textContent = 'We could not access your location. Please enter your address instead.';
          }
        },
        { enableHighAccuracy: true, maximumAge: 60000 }
      );
    };

    const initFulfilment = () => {
      updateFulfilmentUI();
      applyFulfilmentStateToInputs();

      fulfilmentSwitchButtons.forEach((button) => {
        button.addEventListener('click', () => {
          const mode = button.dataset.fulfilmentMode;
          setFulfilmentMode(mode);
        });
      });

      fulfilmentTimeOptions.forEach((input) => {
        input.addEventListener('change', () => {
          if (!input.checked) return;
          fulfilmentState.scheduleType = input.value === 'schedule' ? 'schedule' : 'asap';
          persistFulfilmentState();
          updateFulfilmentUI();
        });
      });

      if (scheduleSelect) {
        scheduleSelect.addEventListener('change', () => {
          fulfilmentState.scheduleValue = scheduleSelect.value || null;
          persistFulfilmentState();
        });
      }

      const bindDeliveryInput = (input, key) => {
        if (!input) return;
        input.addEventListener('input', () => {
          fulfilmentState.delivery[key] = input.value;
          persistFulfilmentState();
        });
      };

      bindDeliveryInput(deliveryNameInput, 'name');
      bindDeliveryInput(deliveryPhoneInput, 'phone');
      bindDeliveryInput(deliveryAddressInput, 'address1');
      bindDeliveryInput(deliveryCityInput, 'city');
      bindDeliveryInput(deliveryZipInput, 'zip');
      bindDeliveryInput(deliveryInstructionsInput, 'instructions');

      if (deliveryDropoffSelect) {
        deliveryDropoffSelect.addEventListener('change', () => {
          fulfilmentState.delivery.dropoff = deliveryDropoffSelect.value;
          persistFulfilmentState();
        });
      }

      if (calculateDeliveryBtn) {
        calculateDeliveryBtn.addEventListener('click', (event) => {
          event.preventDefault();
          handleDeliveryAddressGeocode();
        });
      }

      if (useLocationBtn) {
        useLocationBtn.addEventListener('click', (event) => {
          event.preventDefault();
          handleUseLocation();
        });
      }

      if (fulfilmentState.mode === 'delivery') {
        ensureStoreCoordinates();
      }
    };

    const resolveBadgeDetails = (item) => {
      if (!item) return null;
      const badge = item.badge || null;
      if (badge && badge.text) {
        return {
          icon: badge.icon || 'info',
          text: badge.text
        };
      }

      if (item.time) {
        return {
          icon: 'schedule',
          text: item.time
        };
      }

      return null;
    };

    const attachImageFallback = (imgEl) => {
      const handleError = () => {
        imgEl.removeEventListener('error', handleError);
        imgEl.src = defaultImage;
      };

      imgEl.addEventListener('error', handleError, { once: true });
      return handleError;
    };

    const buildAnimatedSources = (staticSrc, animatedHint) => {
      const sources = [];
      const seen = new Set();

      const addSource = (value) => {
        if (!value) return;
        if (seen.has(value)) return;
        seen.add(value);
        sources.push(value);
      };

      addSource(animatedHint);

      if (staticSrc) {
        const sanitizedStatic = staticSrc.split('?')[0];
        const extensionPattern = /\.(png|jpe?g|webp|avif)$/i;
        if (extensionPattern.test(sanitizedStatic)) {
          addSource(sanitizedStatic.replace(extensionPattern, '.gif'));
        }

        const lastSlash = sanitizedStatic.lastIndexOf('/');
        const baseDir = lastSlash >= 0 ? sanitizedStatic.slice(0, lastSlash + 1) : '';
        const fileName = lastSlash >= 0 ? sanitizedStatic.slice(lastSlash + 1) : sanitizedStatic;
        const baseName = fileName.replace(/\.[^/.]+$/, '');

        if (baseName) {
          addSource(`${baseDir}${baseName}.gif`);
          addSource(`${baseDir}${baseName}_animated.gif`);
          addSource(`${baseDir}${baseName}-animated.gif`);
          addSource(`${baseDir}${baseName}_0.gif`);
          addSource(`${baseDir}${baseName}-0.gif`);
          addSource(`image/mrsB/${baseName}.gif`);
          addSource(`${baseName}.gif`);
        }
      }

      return sources;
    };

    const applyAnimatedPreview = (imageEl, staticSrc, animatedSrc, initialErrorHandler) => {
      if (!imageEl || !animatedSrc) return;

      const candidates = buildAnimatedSources(staticSrc, animatedSrc);
      if (!candidates.length) return;

      let timerId = null;

      const restoreInitialHandler = () => {
        if (initialErrorHandler) {
          imageEl.addEventListener('error', initialErrorHandler, { once: true });
        }
      };

      const attemptSwap = (index) => {
        if (index >= candidates.length) {
          restoreInitialHandler();
          imageEl.src = staticSrc;
          return;
        }

        const candidate = candidates[index];

        const handleSwapError = () => {
          imageEl.removeEventListener('load', handleSwapLoad);
          attemptSwap(index + 1);
        };

        const handleSwapLoad = () => {
          imageEl.removeEventListener('error', handleSwapError);
        };

        imageEl.addEventListener('error', handleSwapError, { once: true });
        imageEl.addEventListener('load', handleSwapLoad, { once: true });
        imageEl.src = candidate;
      };

      const beginSwap = () => {
        if (timerId) return;
        timerId = setTimeout(() => {
          if (initialErrorHandler) {
            imageEl.removeEventListener('error', initialErrorHandler);
          }
          attemptSwap(0);
        }, 2000);
      };

      if (imageEl.complete && imageEl.naturalWidth > 0) {
        beginSwap();
      } else {
        imageEl.addEventListener('load', beginSwap, { once: true });
      }
    };

    const flattenMenuItems = () => menuData.flatMap((section) =>
      section.items.map((item) => ({ ...item, category: section.category }))
    );

    const shuffleArray = (source) => {
      const array = [...source];
      for (let i = array.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    };

    const smoothScrollTo = (id) => {
      const target = document.getElementById(id);
      if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    };

    const updateCartBadge = () => {
      if (!navCartCount || !navCartButton) return;
      const totalQty = state.cart.reduce((sum, item) => sum + item.quantity, 0);
      navCartCount.textContent = totalQty;
      navCartButton.setAttribute('aria-disabled', totalQty > 0 ? 'false' : 'true');
    };

    const normalizeStoredCart = (cartItems) => {
      if (!Array.isArray(cartItems)) return [];
      return cartItems.map((item) => {
        const modifiers = Array.isArray(item.modifiers) ? item.modifiers : (Array.isArray(item.sides) ? item.sides : []);
        let displayModifiers = modifiers.map((mod) => String(mod));
        let variant = typeof item.variant === 'string' && item.variant.trim() ? item.variant.trim() : null;
        if (!variant) {
          const sourceItem = flattenMenuItems().find((entry) => entry.id === item.id);
          if (sourceItem?.variants?.length) {
            const variantLabels = sourceItem.variants.map((opt) => opt.label);
            const variantIndex = displayModifiers.findIndex((mod) => variantLabels.includes(mod));
            if (variantIndex !== -1) {
              variant = displayModifiers[variantIndex];
              displayModifiers = displayModifiers.filter((_, idx) => idx !== variantIndex);
            }
          }
        }
        const keyModifiers = variant ? [...displayModifiers, variant] : [...displayModifiers];
        return {
          id: item.id,
          name: item.name,
          price: Number(item.price) || 0,
          quantity: Number(item.quantity) || 1,
          modifiers: displayModifiers,
          cartKey: item.cartKey || buildCartKey(item.id, keyModifiers),
          variant
        };
      });
    };

    const initState = () => {
      const { storedRatings, storedUploads, storedCart, storedFulfilment } = loadStoredData();
      state.ratings = storedRatings;
      state.uploads = storedUploads;
      state.cart = normalizeStoredCart(storedCart);
      if (storedFulfilment && typeof storedFulfilment === 'object') {
        fulfilmentState.mode = storedFulfilment.mode === 'delivery' ? 'delivery' : 'pickup';
        fulfilmentState.scheduleType = storedFulfilment.scheduleType === 'schedule' ? 'schedule' : 'asap';
        fulfilmentState.scheduleValue = storedFulfilment.scheduleValue || null;
        if (storedFulfilment.store) {
          fulfilmentState.store = { ...fulfilmentState.store, ...storedFulfilment.store };
        }
        if (storedFulfilment.delivery) {
          fulfilmentState.delivery = { ...fulfilmentState.delivery, ...storedFulfilment.delivery };
        }
        if (storedFulfilment.deliveryQuote) {
          fulfilmentState.deliveryQuote = { ...fulfilmentState.deliveryQuote, ...storedFulfilment.deliveryQuote };
        }
      }
    };

    const updateCartQty = (cartKey, newQty) => {
      const itemIndex = state.cart.findIndex((item) => item.cartKey === cartKey);
      if (itemIndex === -1) return;

      if (newQty <= 0) {
        state.cart.splice(itemIndex, 1);
      } else {
        state.cart[itemIndex].quantity = newQty;
      }
      updateCartDisplay();
    };

    const triggerFlyToCart = (imageEl) => {
      if (!imageEl || !navCartButton) return;
      const imageRect = imageEl.getBoundingClientRect();
      const cartRect = navCartButton.getBoundingClientRect();
      const clone = imageEl.cloneNode(true);
      clone.style.position = 'fixed';
      clone.style.left = `${imageRect.left}px`;
      clone.style.top = `${imageRect.top}px`;
      clone.style.width = `${imageRect.width}px`;
      clone.style.height = `${imageRect.height}px`;
      clone.style.borderRadius = getComputedStyle(imageEl).borderRadius || '12px';
      clone.style.transition = 'transform 0.7s ease, opacity 0.7s ease, width 0.7s ease, height 0.7s ease';
      clone.style.zIndex = '1200';
      clone.style.pointerEvents = 'none';
      document.body.appendChild(clone);

      requestAnimationFrame(() => {
        clone.style.transform = `translate(${cartRect.left - imageRect.left}px, ${cartRect.top - imageRect.top}px) scale(0.2)`;
        clone.style.opacity = '0.2';
        clone.style.width = '60px';
        clone.style.height = '60px';
      });

      setTimeout(() => clone.remove(), 700);
    };

    const animateAddButton = (button) => {
      if (!button) return;
      button.classList.add('added');
      setTimeout(() => button.classList.remove('added'), 500);
    };

    const addToCart = (menuItem, options = {}) => {
      const variantLabel = options.variant ? String(options.variant) : null;
      const normalizedMods = extractModifiers(options);
      const sideModifiers = Array.isArray(options.sides) ? options.sides.map((side) => String(side)) : [];
      const cartKey = buildCartKey(menuItem.id, normalizedMods);
      const existing = state.cart.find((item) => item.cartKey === cartKey);

      if (existing) {
        existing.quantity += 1;
      } else {
        state.cart.push({
          id: menuItem.id,
          name: menuItem.name,
          price: menuItem.price,
          quantity: 1,
          modifiers: sideModifiers,
          cartKey,
          variant: variantLabel
        });
      }

      updateCartDisplay();
    };

    const addMenuItemToCart = (menuItem, imageEl, addButton, options = {}) => {
      addToCart(menuItem, options);
      triggerFlyToCart(imageEl);
      animateAddButton(addButton);
    };

    const updateRatingUI = (ratingWrapper, itemId) => {
      const ratingData = state.ratings[itemId];
      const ratingValue = ratingData ? Math.round((ratingData.total / ratingData.count) * 2) / 2 : 0;
      const ratingCount = ratingData?.count || 0;
      const stars = ratingWrapper.querySelectorAll('.material-icons');
      stars.forEach((star) => {
        const starValue = Number(star.dataset.value);
        star.textContent = starValue <= Math.round(ratingValue) ? 'star' : 'star_border';
      });
      const countLabel = ratingWrapper.querySelector('.rating-count');
      countLabel.textContent = ratingCount ? `${ratingValue.toFixed(1)} (${ratingCount})` : '(0)';
    };

    const bindRatingEvents = (ratingWrapper, itemId) => {
      const stars = ratingWrapper.querySelectorAll('.material-icons');
      stars.forEach((star) => {
        star.addEventListener('click', () => {
          const selectedValue = Number(star.dataset.value);
          const current = state.ratings[itemId];
          if (!current) {
            state.ratings[itemId] = { total: selectedValue, count: 1 };
          } else {
            const newCount = current.count + 1;
            const newTotal = current.total + selectedValue;
            state.ratings[itemId] = { total: newTotal, count: newCount };
          }
          saveData({ ratings: state.ratings, uploads: state.uploads, cart: state.cart });
          updateRatingUI(ratingWrapper, itemId);
        });
      });
    };

    const bindUpload = (uploadInput, gallery, itemId, trigger) => {
      const openPicker = () => uploadInput.click();

      trigger.addEventListener('click', (event) => {
        event.preventDefault();
        event.stopPropagation();
        openPicker();
      });

      trigger.addEventListener('keypress', (event) => {
        if (event.key === 'Enter' || event.key === ' ') {
          event.preventDefault();
          openPicker();
        }
      });

      uploadInput.addEventListener('change', (event) => {
        const files = Array.from(event.target.files || []);
        if (!files.length) return;
        const readers = files.map((file) => new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = (e) => resolve(e.target.result);
          reader.readAsDataURL(file);
        }));

        Promise.all(readers).then((images) => {
          const existingUploads = state.uploads[itemId] || [];
          state.uploads[itemId] = [...existingUploads, ...images].slice(-12);
          saveData({ ratings: state.ratings, uploads: state.uploads, cart: state.cart });
          renderGallery(gallery, itemId);
          uploadInput.value = '';
        });
      });
    };

    const renderGallery = (gallery, itemId) => {
      gallery.innerHTML = '';
      const uploads = state.uploads[itemId] || [];
      uploads.forEach((src) => {
        const img = document.createElement('img');
        img.src = src;
        img.alt = 'Customer submitted';
        gallery.appendChild(img);
      });
    };

    const updateCartDisplay = () => {
      cartItemsContainer.innerHTML = '';
      if (!state.cart.length) {
        const emptyMsg = document.createElement('p');
        emptyMsg.className = 'cart-empty';
        emptyMsg.textContent = 'Your plate is empty. Tap any dish to add it.';
        cartItemsContainer.appendChild(emptyMsg);
      } else {
        state.cart.forEach((item) => {
          const cartItemEl = document.createElement('div');
          cartItemEl.className = 'cart-item';

          const detailWrap = document.createElement('div');
          detailWrap.className = 'cart-details';

          const nameEl = document.createElement('span');
          nameEl.className = 'cart-name';
          const displayName = item.variant ? `${item.name} - ${item.variant}` : item.name;
          nameEl.textContent = displayName;
          detailWrap.appendChild(nameEl);

          if (item.modifiers && item.modifiers.length) {
            const modifiersEl = document.createElement('span');
            modifiersEl.className = 'cart-modifiers';
            modifiersEl.textContent = `Includes: ${item.modifiers.join(', ')}`;
            detailWrap.appendChild(modifiersEl);
          }

          const qtyControls = document.createElement('div');
          qtyControls.className = 'qty-controls';

          const minusBtn = document.createElement('button');
          minusBtn.type = 'button';
          minusBtn.className = 'qty-btn';
          minusBtn.innerHTML = '<i class="material-icons" aria-hidden="true">remove</i>';
          minusBtn.addEventListener('click', () => updateCartQty(item.cartKey, item.quantity - 1));

          const qtyValue = document.createElement('span');
          qtyValue.textContent = item.quantity;

          const plusBtn = document.createElement('button');
          plusBtn.type = 'button';
          plusBtn.className = 'qty-btn';
          plusBtn.innerHTML = '<i class="material-icons" aria-hidden="true">add</i>';
          plusBtn.addEventListener('click', () => updateCartQty(item.cartKey, item.quantity + 1));

          qtyControls.append(minusBtn, qtyValue, plusBtn);

          const lineTotal = document.createElement('span');
          lineTotal.className = 'cart-line-total';
          lineTotal.textContent = formatPrice(item.price * item.quantity);

          cartItemEl.append(detailWrap, qtyControls, lineTotal);
          cartItemsContainer.appendChild(cartItemEl);
        });
      }

      const total = state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      cartTotalEl.textContent = formatPrice(total);
      saveData({ ratings: state.ratings, uploads: state.uploads, cart: state.cart });
      updateCartBadge();
    };

    const buildSidesOptions = () => {
      if (!entreeSidesGrid) return;
      entreeSidesGrid.innerHTML = '';
      sidesOptions.forEach((side) => {
        const label = document.createElement('label');
        label.className = 'side-option';
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.name = 'entree_side';
        checkbox.value = side.name;
        const text = document.createElement('span');
        text.textContent = side.name;
        label.appendChild(checkbox);
        label.appendChild(text);
        entreeSidesGrid.appendChild(label);
      });
    };

    const updateEntreeSelectionState = () => {
      if (!entreeConfirmBtn || !selectionWarning) return;
      const inputs = Array.from(entreeModalEl.querySelectorAll('input[name="entree_side"]'));
      const selected = inputs.filter((input) => input.checked);
      const count = selected.length;

      entreeConfirmBtn.classList.toggle('disabled', count !== 2);
      entreeConfirmBtn.setAttribute('aria-disabled', count !== 2 ? 'true' : 'false');
      selectionWarning.style.visibility = count === 2 ? 'hidden' : 'visible';

      inputs.forEach((input) => {
        if (!input.checked) {
          input.disabled = count >= 2;
        } else {
          input.disabled = false;
        }
      });
    };

    const resetEntreeModal = () => {
      if (!entreeModalEl) return;
      const inputs = entreeModalEl.querySelectorAll('input[name="entree_side"]');
      inputs.forEach((input) => {
        input.checked = false;
        input.disabled = false;
      });
      updateEntreeSelectionState();
    };

    const isAnyModalOpen = () => {
      const entreeOpen = entreeModalEl && entreeModalEl.classList.contains('open');
      const drinkOpen = drinkModalEl && drinkModalEl.classList.contains('open');
      return Boolean(entreeOpen || drinkOpen);
    };

    const showModalBackdrop = () => {
      ensureModalBackdrop();
      if (modalBackdrop) {
        modalBackdrop.classList.add('visible');
      }
      document.body.classList.add('modal-open');
    };

    const hideModalBackdropIfNone = () => {
      if (isAnyModalOpen()) return;
      if (modalBackdrop) {
        modalBackdrop.classList.remove('visible');
      }
      document.body.classList.remove('modal-open');
    };

    const ensureModalBackdrop = () => {
      if (!modalBackdrop) {
        modalBackdrop = document.createElement('div');
        modalBackdrop.className = 'modal-backdrop';
        modalBackdrop.addEventListener('click', () => {
          if (entreeModalInstance && entreeModalEl?.classList.contains('open')) {
            entreeModalInstance.close();
          }
          if (drinkModalInstance && drinkModalEl?.classList.contains('open')) {
            drinkModalInstance.close();
          }
        });
        document.body.appendChild(modalBackdrop);
      }
    };

    const updateDrinkSelectionState = () => {
      if (!drinkConfirmBtn || !drinkModalEl) return;
      const selected = drinkModalEl.querySelector('input[name="drink_option"]:checked');
      const hasSelection = Boolean(selected);
      drinkConfirmBtn.classList.toggle('disabled', !hasSelection);
      drinkConfirmBtn.setAttribute('aria-disabled', hasSelection ? 'false' : 'true');
      if (drinkWarning) {
        drinkWarning.style.visibility = hasSelection ? 'hidden' : 'visible';
      }
    };

    const buildDrinkOptions = (variants = []) => {
      if (!drinkOptionsGrid) return;
      drinkOptionsGrid.innerHTML = '';
      variants.forEach((variant, index) => {
        const label = document.createElement('label');
        label.className = 'drink-option';
        const input = document.createElement('input');
        input.type = 'radio';
        input.name = 'drink_option';
        const variantId = variant.id || `option-${index + 1}`;
        const variantLabel = variant.label || variant.name || variantId;
        input.value = variantId;
        input.dataset.label = variantLabel;
        const text = document.createElement('span');
        text.textContent = variantLabel;
        label.appendChild(input);
        label.appendChild(text);
        drinkOptionsGrid.appendChild(label);
      });
      updateDrinkSelectionState();
    };

    const resetDrinkModal = () => {
      if (!drinkModalEl) return;
      const inputs = drinkModalEl.querySelectorAll('input[name="drink_option"]');
      inputs.forEach((input) => {
        input.checked = false;
      });
      updateDrinkSelectionState();
    };

    const openEntreeModal = (itemData, imageEl, addBtn) => {
      if (!entreeModalInstance) return;
      entreeContext = { item: itemData, imageEl, addBtn };
      entreeModalName.textContent = itemData.name;
      resetEntreeModal();
      entreeModalInstance.open();
    };

    const openDrinkModal = (itemData, imageEl, addBtn) => {
      if (!drinkModalInstance) return;
      drinkContext = { item: itemData, imageEl, addBtn };
      if (drinkModalName) {
        drinkModalName.textContent = itemData.name;
      }
      buildDrinkOptions(itemData.variants || []);
      resetDrinkModal();
      drinkModalInstance.open();
    };

    const handleItemSelection = (menuItem, category, imageEl, triggerEl) => {
      if (category === 'Entrées') {
        openEntreeModal(menuItem, imageEl, triggerEl);
      } else if (menuItem?.variants?.length) {
        openDrinkModal(menuItem, imageEl, triggerEl);
      } else {
        addMenuItemToCart(menuItem, imageEl, triggerEl);
      }
    };

    const getReviewMaxScroll = () => {
      if (!reviewViewport) return 0;
      return Math.max(0, reviewViewport.scrollWidth - reviewViewport.clientWidth);
    };

    const clearReviewAutoScroll = () => {
      if (reviewAutoScrollTimer) {
        clearInterval(reviewAutoScrollTimer);
        reviewAutoScrollTimer = null;
      }
    };

    const stopReviewAutoScroll = () => {
      clearReviewAutoScroll();
      reviewAutoScrollStopped = true;
    };

    const ensureReviewAutoScroll = () => {
      if (!reviewViewport || reviewAutoScrollStopped || reviewAutoScrollTimer) return;
      if (getReviewMaxScroll() <= 0) return;

      reviewAutoScrollTimer = setInterval(() => {
        const maxScroll = getReviewMaxScroll();
        if (maxScroll <= 0) return;
        const nearEnd = reviewViewport.scrollLeft >= (maxScroll - 4);
        if (nearEnd) {
          reviewViewport.scrollTo({ left: 0, behavior: 'smooth' });
          requestAnimationFrame(updateReviewNav);
        } else {
          scrollReviews(1);
        }
      }, 3200);
    };

    const updateReviewNav = () => {
      if (!reviewViewport || !reviewPrev || !reviewNext) return;
      const maxScroll = getReviewMaxScroll();
      reviewPrev.disabled = reviewViewport.scrollLeft <= 0;
      reviewNext.disabled = reviewViewport.scrollLeft >= (maxScroll - 4);
    };

    const scrollReviews = (direction) => {
      if (!reviewViewport) return;
      const amount = reviewViewport.clientWidth * 0.85;
      reviewViewport.scrollBy({ left: direction * amount, behavior: 'smooth' });
      requestAnimationFrame(updateReviewNav);
    };

    const initReviewCarousel = () => {
      if (!reviewViewport) return;

      if (reviewPrev) {
        reviewPrev.addEventListener('click', () => {
          stopReviewAutoScroll();
          scrollReviews(-1);
        });
      }

      if (reviewNext) {
        reviewNext.addEventListener('click', () => {
          stopReviewAutoScroll();
          scrollReviews(1);
        });
      }

      if (reviewsTrack) {
        ['click', 'focusin', 'keydown'].forEach((eventName) => {
          reviewsTrack.addEventListener(eventName, stopReviewAutoScroll, { once: true });
        });
      }

      ['pointerdown', 'touchstart', 'wheel'].forEach((eventName) => {
        reviewViewport.addEventListener(eventName, stopReviewAutoScroll, { once: true });
      });

      ['focusin', 'keydown'].forEach((eventName) => {
        reviewViewport.addEventListener(eventName, stopReviewAutoScroll, { once: true });
      });

      reviewViewport.addEventListener('scroll', () => {
        requestAnimationFrame(updateReviewNav);
      });

      window.addEventListener('resize', () => {
        updateReviewNav();
        if (!reviewAutoScrollStopped) {
          clearReviewAutoScroll();
          ensureReviewAutoScroll();
        }
      });

      requestAnimationFrame(() => {
        updateReviewNav();
        ensureReviewAutoScroll();
      });
    };

    const getHighlightMaxScroll = () => {
      if (!highlightViewport) return 0;
      return Math.max(0, highlightViewport.scrollWidth - highlightViewport.clientWidth);
    };

    const clearHighlightAutoScroll = () => {
      if (highlightAutoScrollTimer) {
        clearInterval(highlightAutoScrollTimer);
        highlightAutoScrollTimer = null;
      }
    };

    const stopHighlightAutoScroll = () => {
      clearHighlightAutoScroll();
      highlightAutoScrollStopped = true;
    };

    const ensureHighlightAutoScroll = () => {
      if (!highlightViewport || highlightAutoScrollStopped || highlightAutoScrollTimer) return;
      if (getHighlightMaxScroll() <= 0) return;

      highlightAutoScrollTimer = setInterval(() => {
        const maxScroll = getHighlightMaxScroll();
        if (maxScroll <= 0) return;
        const nearEnd = highlightViewport.scrollLeft >= (maxScroll - 4);
        if (nearEnd) {
          highlightViewport.scrollTo({ left: 0, behavior: 'smooth' });
        } else {
          scrollHighlights(1);
        }
      }, 3000);
    };

    const updateHighlightNav = () => {
      if (!highlightViewport || !highlightPrev || !highlightNext) return;
      const maxScroll = getHighlightMaxScroll();
      highlightPrev.disabled = highlightViewport.scrollLeft <= 0;
      highlightNext.disabled = highlightViewport.scrollLeft >= (maxScroll - 4);
    };

    const scrollHighlights = (direction) => {
      if (!highlightViewport) return;
      const amount = highlightViewport.clientWidth * 0.9;
      highlightViewport.scrollBy({ left: direction * amount, behavior: 'smooth' });
      requestAnimationFrame(updateHighlightNav);
    };

    const renderHighlights = () => {
      if (!highlightTrack) return;
      clearHighlightAutoScroll();
      highlightTrack.innerHTML = '';
      const items = shuffleArray(flattenMenuItems()).slice(0, 10);

      items.forEach((item) => {
        const card = document.createElement('article');
        card.className = 'highlight-card';

        const image = document.createElement('img');
        image.className = 'highlight-image';
        const staticImageSrc = item.image || defaultImage;
        image.src = staticImageSrc;
        image.alt = item.name;
        const highlightErrorHandler = attachImageFallback(image);
        applyAnimatedPreview(image, staticImageSrc, item.animatedImage, highlightErrorHandler);
        image.tabIndex = 0;
        image.setAttribute('role', 'button');
        image.setAttribute('aria-label', `Add ${item.name} to cart`);

        const info = document.createElement('div');
        info.className = 'highlight-info';
        const name = document.createElement('span');
        name.className = 'highlight-name';
        name.textContent = item.name;
        const price = document.createElement('span');
        price.className = 'highlight-price';
        price.textContent = formatPrice(item.price);
        info.appendChild(name);
        info.appendChild(price);

        const button = document.createElement('button');
        button.type = 'button';
        button.className = 'btn highlight-add add-to-cart';
        const icon = document.createElement('i');
        icon.className = 'material-icons';
        icon.setAttribute('aria-hidden', 'true');
        icon.textContent = 'add';
        button.appendChild(icon);
        button.appendChild(document.createTextNode('Add to Cart'));

        const process = () => {
          stopHighlightAutoScroll();
          handleItemSelection(item, item.category, image, button);
        };

        button.addEventListener('click', (event) => {
          event.preventDefault();
          process();
        });

        image.addEventListener('click', process);
        image.addEventListener('keypress', (event) => {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            process();
          }
        });

        card.addEventListener('click', (event) => {
          if (event.target.closest('button')) return;
          process();
        });

        card.appendChild(image);
        card.appendChild(info);
        card.appendChild(button);

        highlightTrack.appendChild(card);
      });

      requestAnimationFrame(() => {
        updateHighlightNav();
        ensureHighlightAutoScroll();
      });
    };

    const initHighlightCarousel = () => {
      if (!highlightViewport) return;

      if (highlightPrev) {
        highlightPrev.addEventListener('click', () => {
          stopHighlightAutoScroll();
          scrollHighlights(-1);
        });
      }

      if (highlightNext) {
        highlightNext.addEventListener('click', () => {
          stopHighlightAutoScroll();
          scrollHighlights(1);
        });
      }

      if (highlightTrack) {
        ['click', 'focusin', 'keydown'].forEach((eventName) => {
          highlightTrack.addEventListener(eventName, stopHighlightAutoScroll, { once: true });
        });
      }

      ['pointerdown', 'touchstart', 'wheel'].forEach((eventName) => {
        highlightViewport.addEventListener(eventName, stopHighlightAutoScroll, { once: true });
      });

      highlightViewport.addEventListener('scroll', () => {
        requestAnimationFrame(updateHighlightNav);
      });

      window.addEventListener('resize', updateHighlightNav);
      updateHighlightNav();
    };

    const initializeMenuTabs = () => {
      menuTabs.forEach((tab) => {
        const targetSlug = slugify(tab.textContent);
        tab.dataset.target = targetSlug;
      });
    };

    const renderMenu = () => {
      menuContainer.innerHTML = '';
      menuData.forEach((sectionData) => {
        const sectionFragment = templates.section.content.cloneNode(true);
        const section = sectionFragment.querySelector('.menu-section');
        const slug = slugify(sectionData.category);
        section.id = slug;
        section.querySelector('.section-title').textContent = sectionData.category;
        const grid = section.querySelector('.menu-grid');

        sectionData.items.forEach((itemData) => {
          const itemFragment = templates.item.content.cloneNode(true);
          const imgEl = itemFragment.querySelector('.item-photo');
          const staticImageSrc = itemData.image || defaultImage;
          imgEl.src = staticImageSrc;
          const itemErrorHandler = attachImageFallback(imgEl);
          imgEl.alt = itemData.name;
          applyAnimatedPreview(imgEl, staticImageSrc, itemData.animatedImage, itemErrorHandler);

          itemFragment.querySelector('.item-name').textContent = itemData.name;
          itemFragment.querySelector('.item-description').textContent = itemData.description;
          itemFragment.querySelector('.price').textContent = formatPrice(itemData.price);
          const badgeEl = itemFragment.querySelector('.badge-info');
          if (badgeEl) {
            const iconEl = badgeEl.querySelector('.badge-icon');
            const textEl = badgeEl.querySelector('.badge-text');
            const badgeDetails = resolveBadgeDetails(itemData);
            if (badgeDetails) {
              if (iconEl) {
                iconEl.textContent = badgeDetails.icon;
              }
              if (textEl) {
                textEl.textContent = badgeDetails.text;
              }
              badgeEl.style.display = '';
            } else {
              badgeEl.style.display = 'none';
            }
          }
          itemFragment.querySelector('.item-category').textContent = sectionData.category;

          const ratingWrapper = itemFragment.querySelector('.rating-control');
          ratingWrapper.querySelector('.rating-count').textContent = '(0)';
          bindRatingEvents(ratingWrapper, itemData.id);
          updateRatingUI(ratingWrapper, itemData.id);

          const uploadTrigger = itemFragment.querySelector('.upload-area');
          const uploadInput = itemFragment.querySelector('.user-upload');
          const gallery = itemFragment.querySelector('.user-gallery');
          renderGallery(gallery, itemData.id);
          bindUpload(uploadInput, gallery, itemData.id, uploadTrigger);

          const addBtn = itemFragment.querySelector('.add-to-cart');
          const processSelection = () => handleItemSelection(itemData, sectionData.category, imgEl, addBtn);

          addBtn.addEventListener('click', (event) => {
            event.preventDefault();
            processSelection();
          });

          imgEl.addEventListener('click', processSelection);

          grid.appendChild(itemFragment);
        });

        menuContainer.appendChild(sectionFragment);
      });
    };

    const initEntreeModal = () => {
      if (!entreeModalEl || !entreeConfirmBtn || !entreeSidesGrid) return;

      ensureModalBackdrop();
      entreeModalEl.setAttribute('aria-hidden', 'true');

      const closeModal = () => {
        entreeModalEl.classList.remove('open');
        entreeModalEl.setAttribute('aria-hidden', 'true');
        entreeContext = null;
        resetEntreeModal();
        hideModalBackdropIfNone();
      };

      const openModal = () => {
        showModalBackdrop();
        entreeModalEl.classList.add('open');
        entreeModalEl.setAttribute('aria-hidden', 'false');
        setTimeout(() => {
          const focusTarget = entreeModalEl.querySelector('input[name="entree_side"]');
          (focusTarget || entreeConfirmBtn).focus();
        }, 50);
      };

      entreeModalInstance = {
        open: openModal,
        close: closeModal
      };

      entreeSidesGrid.addEventListener('change', (event) => {
        if (event.target && event.target.name === 'entree_side') {
          updateEntreeSelectionState();
        }
      });

      entreeConfirmBtn.addEventListener('click', (event) => {
        event.preventDefault();
        if (!entreeContext) return;
        const selectedSides = Array.from(entreeModalEl.querySelectorAll('input[name="entree_side"]:checked')).map((input) => input.value);
        if (selectedSides.length !== 2) return;
        addMenuItemToCart(entreeContext.item, entreeContext.imageEl, entreeContext.addBtn, { sides: selectedSides });
        closeModal();
      });

      if (cancelEntreeBtn) {
        cancelEntreeBtn.addEventListener('click', (event) => {
          event.preventDefault();
          closeModal();
        });
      }

      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && entreeModalEl.classList.contains('open')) {
          closeModal();
        }
      });

      resetEntreeModal();
    };

    const initNav = () => {
      if (menuJumpButton) {
        menuJumpButton.addEventListener('click', () => {
          const targetId = menuJumpButton.dataset.target;
          smoothScrollTo(targetId);
        });
      }

      if (navCartButton) {
        navCartButton.addEventListener('click', () => {
          if (navCartButton.getAttribute('aria-disabled') === 'true') return;
          const targetId = navCartButton.dataset.target;
          smoothScrollTo(targetId);
        });
      }

      menuTabs.forEach((tab) => {
        tab.addEventListener('click', () => {
          smoothScrollTo(tab.dataset.target);
        });
      });
    };

    window.addEventListener('load', () => {
      const loader = document.getElementById('pageLoader');
      setTimeout(() => loader.classList.add('hidden'), 2000);
    });

    document.addEventListener('DOMContentLoaded', () => {
      initState();
      initializeMenuTabs();
      renderMenu();
      buildSidesOptions();
      initEntreeModal();
      initDrinkModal();
      initReviewCarousel();
      initHighlightCarousel();
      renderHighlights();
      initNav();
      initFulfilment();
      updateCartDisplay();
    });
  </script>
</body>
</html>
