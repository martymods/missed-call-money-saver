<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mrs. B's Catering</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-pink: #ff4db0;
      --deep-pink: #d70f64;
      --charcoal: #2b2b2d;
      --soft-gray: #f9f9fb;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Raleway', sans-serif;
      background: var(--soft-gray);
      color: var(--charcoal);
      margin: 0;
      padding: 0;
    }

    .page-loader {
      align-items: center;
      background: #ffffff;
      display: flex;
      inset: 0;
      justify-content: center;
      position: fixed;
      transition: opacity 0.6s ease;
      z-index: 9999;
    }

    .page-loader.hidden {
      opacity: 0;
      pointer-events: none;
      visibility: hidden;
    }

    .loader-logo {
      max-width: 180px;
      width: 40vw;
      animation: pulse 1.6s ease-in-out infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.85; }
      100% { transform: scale(1); opacity: 1; }
    }

    header {
      text-align: center;
      padding: 3rem 1rem 1.5rem;
    }

    header img {
      max-width: 200px;
      width: 30vw;
    }

    header h1 {
      margin-top: 1.2rem;
      font-weight: 700;
      color: var(--deep-pink);
      letter-spacing: 2px;
    }

    header p {
      font-weight: 400;
      margin: 0 auto;
      max-width: 640px;
    }

    .menu-section {
      margin-bottom: 3rem;
    }

    .menu-section h2 {
      color: var(--deep-pink);
      font-weight: 700;
      letter-spacing: 1px;
      margin: 2rem 0 1rem;
      position: relative;
      text-transform: uppercase;
    }

    .menu-section h2::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: -8px;
      width: 80px;
      height: 4px;
      background: linear-gradient(90deg, var(--deep-pink), var(--primary-pink));
      border-radius: 4px;
    }

    .card.menu-card {
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 18px 40px rgba(215, 15, 100, 0.15);
    }

    .card.menu-card .card-image {
      position: relative;
      padding: 12px 12px 0;
    }

    .card.menu-card .card-image img {
      border-radius: 12px;
      height: 220px;
      object-fit: cover;
    }

    .card.menu-card .card-title {
      background: rgba(255, 77, 176, 0.9);
      border-radius: 12px;
      bottom: 16px !important;
      display: inline-flex;
      font-size: 1.2rem !important;
      font-weight: 600;
      letter-spacing: 0.04em;
      padding: 0.4rem 1rem !important;
    }

    .badge-info {
      align-items: center;
      background: #ffffff;
      border-radius: 100px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      color: var(--deep-pink);
      display: inline-flex;
      font-weight: 600;
      gap: 6px;
      padding: 0.3rem 0.8rem;
      position: absolute;
      right: 24px;
      top: 24px;
    }

    .badge-info i {
      font-size: 1.2rem;
    }

    .card-content ul {
      margin: 0;
      padding-left: 1.2rem;
    }

    .card-content li {
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .card-content .price {
      color: var(--deep-pink);
      font-weight: 700;
      font-size: 1.05rem;
    }

    .card-action {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1.5rem !important;
    }

    .rating-control {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 1.4rem;
      color: #ffc107;
    }

    .rating-control .material-icons {
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .rating-control .material-icons:hover {
      transform: scale(1.2);
    }

    .upload-area {
      border: 2px dashed rgba(215, 15, 100, 0.35);
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      margin-top: 1rem;
      transition: border-color 0.3s ease;
      color: var(--deep-pink);
    }

    .upload-area:hover,
    .upload-area:focus-within {
      border-color: var(--deep-pink);
    }

    .user-gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    .user-gallery img {
      border-radius: 8px;
      height: 70px;
      object-fit: cover;
      width: 70px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.12);
    }

    .cart-panel {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.12);
      margin-top: 3rem;
      padding: 2rem;
      position: sticky;
      top: 20px;
    }

    .cart-panel h3 {
      color: var(--deep-pink);
      font-weight: 700;
      margin-bottom: 1.2rem;
      text-transform: uppercase;
    }

    .cart-item {
      align-items: center;
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }

    .cart-item .qty-controls {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .qty-btn {
      background: linear-gradient(135deg, var(--deep-pink), var(--primary-pink));
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      height: 28px;
      width: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .total-row {
      border-top: 1px solid rgba(0,0,0,0.08);
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      display: flex;
      justify-content: space-between;
      font-weight: 700;
      color: var(--charcoal);
    }

    .checkout-btn {
      background: linear-gradient(135deg, var(--deep-pink), var(--primary-pink));
      border-radius: 100px;
      margin-top: 1.5rem;
    }

    .chips .chip {
      background: rgba(255, 77, 176, 0.12);
      color: var(--deep-pink);
      font-weight: 600;
    }

    @media (max-width: 992px) {
      header {
        padding-top: 2.5rem;
      }

      .card.menu-card .card-image img {
        height: 200px;
      }

      .cart-panel {
        position: static;
        margin-bottom: 2rem;
      }
    }

    @media (max-width: 600px) {
      header img {
        width: 48vw;
      }

      .card.menu-card .card-image img {
        height: 180px;
      }

      .card-action {
        flex-direction: column;
        gap: 0.75rem;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="page-loader" id="pageLoader">
    <img src="image/mrsB/mrsbscatering_logo_tran.png" alt="Mrs. B's Catering Logo" class="loader-logo">
  </div>

  <div class="container">
    <header>
      <img src="image/mrsB/mrsbscatering_logo_tran.png" alt="Mrs. B's Catering Logo" />
      <h1>Mrs. B's Catering Menu</h1>
      <p>Southern comfort classics, signature seafood, and sweet indulgences crafted with love. Build your plate, rate your favorites, and share your own food snaps with our community.</p>
      <div class="chips">
        <div class="chip">Entrées</div>
        <div class="chip">Sides</div>
        <div class="chip">Drinks</div>
        <div class="chip">Desserts</div>
      </div>
    </header>

    <div class="row">
      <div class="col l8 s12">
        <section id="menuContainer"></section>
      </div>
      <div class="col l4 s12">
        <aside class="cart-panel" aria-live="polite">
          <h3>Your Plate</h3>
          <div id="cartItems"></div>
          <div class="total-row">
            <span>Total</span>
            <span id="cartTotal">$0.00</span>
          </div>
          <a href="checkout.html" class="waves-effect waves-light btn-large checkout-btn"><i class="material-icons left">shopping_cart</i>Proceed to Checkout</a>
        </aside>
      </div>
    </div>
  </div>

  <template id="menuCardTemplate">
    <div class="menu-section">
      <h2 class="section-title"></h2>
      <div class="row menu-grid"></div>
    </div>
  </template>

  <template id="menuItemTemplate">
    <div class="col s12 m6">
      <div class="card menu-card">
        <div class="card-image">
          <img class="item-photo" alt="Food item image">
          <span class="card-title item-name"></span>
          <span class="badge-info"><i class="material-icons">schedule</i><span>Made to order</span></span>
        </div>
        <div class="card-content">
          <p class="item-description"></p>
          <ul>
            <li class="price"></li>
            <li><i class="material-icons tiny">restaurant</i> <span class="item-category"></span></li>
          </ul>
          <div class="upload-area">
            <p class="center-align" style="margin-bottom: 0.5rem;">
              <i class="material-icons" style="vertical-align: middle; margin-right: 4px;">photo_camera</i>
              Share your plate:
            </p>
            <input type="file" class="user-upload" accept="image/*">
            <div class="user-gallery"></div>
          </div>
        </div>
        <div class="card-action">
          <div class="rating-control" aria-label="Rate this dish">
            <i class="material-icons" data-value="1">star_border</i>
            <i class="material-icons" data-value="2">star_border</i>
            <i class="material-icons" data-value="3">star_border</i>
            <i class="material-icons" data-value="4">star_border</i>
            <i class="material-icons" data-value="5">star_border</i>
            <span class="rating-count">(0)</span>
          </div>
          <a class="btn waves-effect waves-light add-to-cart"><i class="material-icons left">add</i>Add to Cart</a>
        </div>
      </div>
    </div>
  </template>

  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
  <script>
    const defaultImage = 'image/mrsB/mrsbscatering_logo_tran.png';

    const menuData = [
      {
        category: 'Entrées',
        items: [
          {
            id: 'fried_catfish',
            name: 'Fried Catfish Dinner',
            price: 13.00,
            description: 'Crispy seasoned catfish fillets served with house-made sides for a soul-soothing feast.',
            image: 'image/mrsB/fried_catfish.png'
          },
          {
            id: 'turkey_wings_over_rice',
            name: 'Turkey Wings over Yellow Rice',
            price: 15.00,
            description: 'Slow-roasted turkey wings smothered in rich gravy and served over fragrant yellow rice.',
            image: 'image/mrsB/turkey_wings_over_rice.png'
          },
          {
            id: 'stuffed_salmon_over_rice',
            name: 'Stuffed Salmon over Rice',
            price: 17.00,
            description: 'Tender salmon stuffed with herbs and seafood cream sauce, resting on buttery rice.',
            image: 'image/mrsB/stuffed_salmon_over_rice.png'
          },
          {
            id: 'fried_whtiting',
            name: 'Fried Whiting Plate',
            price: 12.00,
            description: 'Golden fried whiting with Mrs. B’s signature blend of spices and a squeeze of lemon.',
            image: 'image/mrsB/fried_whtiting.png'
          },
          {
            id: 'fried_wingdings',
            name: 'Fried Wingdings',
            price: 11.00,
            description: 'Crispy fried wings tossed in your choice of sauce, paired with classic sides.',
            image: 'image/mrsB/fried_wingdings.png'
          }
        ]
      },
      {
        category: 'Sides',
        items: [
          {
            id: 'greens',
            name: 'Seasoned Collard Greens',
            price: 5.50,
            description: 'Slow-simmered greens infused with smoked turkey and savory spices.',
            image: 'image/mrsB/greens.png'
          },
          {
            id: 'baked_mac_and_cheese',
            name: 'Baked Mac & Cheese',
            price: 5.50,
            description: 'Creamy, cheesy macaroni baked until bubbling and topped with golden crust.',
            image: 'image/mrsB/baked_mac_and_cheese.png'
          },
          {
            id: 'sweet_potatoes',
            name: 'Candied Sweet Potatoes',
            price: 5.50,
            description: 'Tender sweet potatoes glazed with brown sugar, butter, and warm spices.',
            image: 'image/mrsB/sweet_potatoes.png'
          },
          {
            id: 'seafood_salad',
            name: 'Seafood Pasta Salad',
            price: 8.00,
            description: 'Chilled pasta tossed with shrimp, peppers, and creamy herb dressing.',
            image: 'image/mrsB/seafood_salad.png'
          }
        ]
      },
      {
        category: 'Drinks',
        items: [
          {
            id: 'can_soda',
            name: 'Can Soda',
            price: 1.50,
            description: 'Choice of Cola, Diet Cola, or Lemon-Lime.',
            image: defaultImage
          },
          {
            id: 'bottled_water',
            name: 'Bottled Water',
            price: 1.25,
            description: 'Pure and refreshing bottled water.',
            image: defaultImage
          }
        ]
      },
      {
        category: 'Desserts',
        items: [
          {
            id: 'krazie_pudding_oreo',
            name: 'Krazie Pudding Oreo',
            price: 6.00,
            description: 'Layers of creamy pudding, whipped topping, and crushed Oreo cookies.',
            image: defaultImage
          },
          {
            id: 'banana_pudding_kmaidson',
            name: 'Banana Pudding Kmaidson',
            price: 6.00,
            description: 'Creamy and smooth pudding with hints of vanilla and fresh banana.',
            image: defaultImage
          },
          {
            id: 'cake',
            name: 'Seasonal Layer Cake',
            price: 6.00,
            description: 'Layers of moist cake with rotating seasonal flavors and fillings.',
            image: defaultImage
          }
        ]
      }
    ];

    const menuContainer = document.getElementById('menuContainer');
    const cartItemsContainer = document.getElementById('cartItems');
    const cartTotalEl = document.getElementById('cartTotal');

    const loadStoredData = () => {
      const storedRatings = JSON.parse(localStorage.getItem('mrsb_ratings') || '{}');
      const storedUploads = JSON.parse(localStorage.getItem('mrsb_uploads') || '{}');
      const storedCart = JSON.parse(localStorage.getItem('mrsb_cart') || '[]');
      return { storedRatings, storedUploads, storedCart };
    };

    const saveData = ({ ratings, uploads, cart }) => {
      localStorage.setItem('mrsb_ratings', JSON.stringify(ratings));
      localStorage.setItem('mrsb_uploads', JSON.stringify(uploads));
      localStorage.setItem('mrsb_cart', JSON.stringify(cart));
    };

    const state = {
      ratings: {},
      uploads: {},
      cart: []
    };

    const templates = {
      section: document.getElementById('menuCardTemplate'),
      item: document.getElementById('menuItemTemplate')
    };

    const initState = () => {
      const { storedRatings, storedUploads, storedCart } = loadStoredData();
      state.ratings = storedRatings;
      state.uploads = storedUploads;
      state.cart = storedCart;
    };

    const formatPrice = (value) => `$${value.toFixed(2)}`;

    const updateCartDisplay = () => {
      cartItemsContainer.innerHTML = '';
      if (!state.cart.length) {
        const emptyMsg = document.createElement('p');
        emptyMsg.textContent = 'Your plate is empty. Add a dish to get started!';
        cartItemsContainer.appendChild(emptyMsg);
        cartTotalEl.textContent = '$0.00';
        return;
      }

      let total = 0;
      state.cart.forEach((item) => {
        total += item.price * item.quantity;
        const row = document.createElement('div');
        row.className = 'cart-item';

        const info = document.createElement('div');
        info.innerHTML = `<strong>${item.name}</strong><br><small>${formatPrice(item.price)}</small>`;

        const qtyControls = document.createElement('div');
        qtyControls.className = 'qty-controls';
        const minusBtn = document.createElement('button');
        minusBtn.className = 'qty-btn';
        minusBtn.innerHTML = '<i class="material-icons" style="font-size:16px;">remove</i>';
        minusBtn.addEventListener('click', () => updateCartQty(item.id, item.quantity - 1));
        const qtyDisplay = document.createElement('span');
        qtyDisplay.textContent = item.quantity;
        const plusBtn = document.createElement('button');
        plusBtn.className = 'qty-btn';
        plusBtn.innerHTML = '<i class="material-icons" style="font-size:16px;">add</i>';
        plusBtn.addEventListener('click', () => updateCartQty(item.id, item.quantity + 1));

        qtyControls.append(minusBtn, qtyDisplay, plusBtn);
        row.append(info, qtyControls);
        cartItemsContainer.appendChild(row);
      });

      cartTotalEl.textContent = formatPrice(total);
      saveData({ ratings: state.ratings, uploads: state.uploads, cart: state.cart });
    };

    const updateCartQty = (id, newQty) => {
      const itemIndex = state.cart.findIndex((item) => item.id === id);
      if (itemIndex === -1) return;

      if (newQty <= 0) {
        state.cart.splice(itemIndex, 1);
      } else {
        state.cart[itemIndex].quantity = newQty;
      }
      updateCartDisplay();
    };

    const addToCart = (menuItem) => {
      const existing = state.cart.find((item) => item.id === menuItem.id);
      if (existing) {
        existing.quantity += 1;
      } else {
        state.cart.push({ id: menuItem.id, name: menuItem.name, price: menuItem.price, quantity: 1 });
      }
      updateCartDisplay();
    };

    const updateRatingUI = (ratingWrapper, itemId) => {
      const ratingData = state.ratings[itemId];
      const ratingValue = ratingData ? Math.round((ratingData.total / ratingData.count) * 2) / 2 : 0;
      const ratingCount = ratingData?.count || 0;
      const stars = ratingWrapper.querySelectorAll('.material-icons');
      stars.forEach((star) => {
        const starValue = Number(star.dataset.value);
        star.textContent = starValue <= Math.round(ratingValue) ? 'star' : 'star_border';
      });
      const countLabel = ratingWrapper.querySelector('.rating-count');
      countLabel.textContent = ratingCount ? `${ratingValue.toFixed(1)} (${ratingCount})` : '(0)';
    };

    const bindRatingEvents = (ratingWrapper, itemId) => {
      const stars = ratingWrapper.querySelectorAll('.material-icons');
      stars.forEach((star) => {
        star.addEventListener('click', () => {
          const selectedValue = Number(star.dataset.value);
          const current = state.ratings[itemId];
          if (!current) {
            state.ratings[itemId] = { total: selectedValue, count: 1 };
          } else {
            const newCount = current.count + 1;
            const newTotal = current.total + selectedValue;
            state.ratings[itemId] = { total: newTotal, count: newCount };
          }
          saveData({ ratings: state.ratings, uploads: state.uploads, cart: state.cart });
          updateRatingUI(ratingWrapper, itemId);
        });
      });
    };

    const bindUpload = (uploadInput, gallery, itemId) => {
      uploadInput.addEventListener('change', (event) => {
        const files = Array.from(event.target.files || []);
        if (!files.length) return;
        const readers = files.map((file) => new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = (e) => resolve(e.target.result);
          reader.readAsDataURL(file);
        }));

        Promise.all(readers).then((images) => {
          const existingUploads = state.uploads[itemId] || [];
          state.uploads[itemId] = [...existingUploads, ...images].slice(-12);
          saveData({ ratings: state.ratings, uploads: state.uploads, cart: state.cart });
          renderGallery(gallery, itemId);
          uploadInput.value = '';
        });
      });
    };

    const renderGallery = (gallery, itemId) => {
      gallery.innerHTML = '';
      const uploads = state.uploads[itemId] || [];
      uploads.forEach((src) => {
        const img = document.createElement('img');
        img.src = src;
        img.alt = 'Customer submitted';
        gallery.appendChild(img);
      });
    };

    const renderMenu = () => {
      menuData.forEach((sectionData) => {
        const sectionFragment = templates.section.content.cloneNode(true);
        const section = sectionFragment.querySelector('.menu-section');
        section.querySelector('.section-title').textContent = sectionData.category;
        const grid = section.querySelector('.menu-grid');

        sectionData.items.forEach((itemData) => {
          const itemFragment = templates.item.content.cloneNode(true);
          const imgEl = itemFragment.querySelector('.item-photo');
          imgEl.src = itemData.image || defaultImage;
          imgEl.onerror = () => {
            imgEl.src = defaultImage;
          };
          imgEl.alt = itemData.name;

          itemFragment.querySelector('.item-name').textContent = itemData.name;
          itemFragment.querySelector('.item-description').textContent = itemData.description;
          itemFragment.querySelector('.price').textContent = formatPrice(itemData.price);
          itemFragment.querySelector('.item-category').textContent = sectionData.category;

          const ratingWrapper = itemFragment.querySelector('.rating-control');
          ratingWrapper.querySelector('.rating-count').textContent = '(0)';
          bindRatingEvents(ratingWrapper, itemData.id);
          updateRatingUI(ratingWrapper, itemData.id);

          const uploadInput = itemFragment.querySelector('.user-upload');
          const gallery = itemFragment.querySelector('.user-gallery');
          renderGallery(gallery, itemData.id);
          bindUpload(uploadInput, gallery, itemData.id);

          const addBtn = itemFragment.querySelector('.add-to-cart');
          addBtn.addEventListener('click', () => addToCart(itemData));

          grid.appendChild(itemFragment);
        });

        menuContainer.appendChild(sectionFragment);
      });
    };

    window.addEventListener('load', () => {
      const loader = document.getElementById('pageLoader');
      setTimeout(() => loader.classList.add('hidden'), 2000);
    });

    document.addEventListener('DOMContentLoaded', () => {
      initState();
      renderMenu();
      updateCartDisplay();
    });
  </script>
</body>
</html>
